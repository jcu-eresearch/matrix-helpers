<!--@@ Regex is the only way to (currently) get how the Content Container should be rendered @@-->
<!--@@ Pull out the first opening tag from the Content Container's rendering @@-->
<!--@@ Workaround for https://github.com/jcu-eresearch/matrix-helpers/issues/41 @@-->
<!--@@ Only show the hacked up opening tag if there's something there @@-->
%begin_asset_contents^preg_replace:379082%
%asset_contents^preg_replace:379082^replace:>:%
%else_asset%
<div
%end_begin%
    class="container content-block %globals_asset_metadata_jcu.features.theme^eq:content:jcu-content%" aria-label="%asset_metadata_template.title.title^striphtml% %asset_metadata_template.title.subtitle^striphtml%">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 container">

            %begin_asset_metadata_template.title.display^eq:show%
            <h3 class="%asset_metadata_template.title.alignment%">
              <script runat="server">phrasingHtmlFromKeyword('globals_asset_metadata_template.title.title:%asset_assetid%')</script>
              <script runat="server">phrasingHtmlFromKeyword('globals_asset_metadata_template.title.subtitle:%asset_assetid%', {prepend: '<br><span class="lead">', append: '</span>'})</script>
            </h3>
            %end_asset%

            <div class="row m-b-2">


        <script runat="server">
          var assetList="%asset_metadata_template.list.items%"
          var cardLayout = "%asset_metadata_template.card.layout%"

          assetList = assetList.slice(1,-1)
          var assets = assetList.split(",")

          if (cardLayout = "mosaicGrid") {
            print('<div class="card-columns">')
            _.each(assets, drawGridCard)
            print('</div>')
          } else if (cardLayout = "column")
            _.each(assets, drawColumnCard)
          else
            print("<h3>Card layout '" + cardLayout + "'' not supported yet </h3>")


          function drawGridCard(assetId) {
            print('<div class="card card-outline-secondary"><div class="card-block">')

            var imageWrapper = { prepend: '<img class="img-fluid" src="./?a=', append: '"/>' }
            print('%globals_asset_metadata_jcu.summarycard.image:' + assetId + '^prepend_if:' + imageWrapper.prepend +'^append_if:' + imageWrapper.append + '%')

            print('<h4 class="card-title">%globals_asset_attribute_name:' + assetId + '%</h4>')
            print('<p class="card-text">%globals_asset_metadata_jcu.summarycard.description:' + assetId + '%</p>')

            var buttonText = "More Details"
            var externalUrlTarget = ' target="_blank" rel="external noopener" '
            var href = '%globals_asset_metadata_jcu.summarycard.override.url:' + assetId + '^prepend_if:' + externalUrlTarget + 'href="^empty:href="./?a=' + assetId +'%'


            print('<a class="btn btn-secondary" ' + href + '">' + buttonText + '</a>')
            print('</div></div>')
          }

          function drawColumnCard(assetId) {
 //           print('<pre>%globals_asset_metadata_jcu.summarycard.override.url:' + assetId + '%, profileUrl- ' + profileUrl + '</pre>') // debugging
 //           print('<pre>%globals_asset_metadata_jcu.summarycard.image:' + assetId + '%, image- "' + image + '"</pre>') //debugging
            print('<div class="card card-outline-secondary"><div class="card-block">')

            var imageWrapper = { prepend: '<img class="card-img-top img-fluid" src="./?a=', append: '"/>' }
            print('%globals_asset_metadata_jcu.summarycard.image:' + assetId + '^prepend_if:' + imageWrapper.prepend +'^append_if:' + imageWrapper.append + '%')

            print('<h4 class="card-title">%globals_asset_attribute_name:' + assetId + '%</h4>')
            print('<div class="row"')
            print('<p class="card-text">%globals_asset_metadata_jcu.summarycard.description:' + assetId + '%</p>')
            print('</div>')
            var buttonText = "More Details"
            var externalUrlTarget = ' target="_blank" rel="external noopener" '
            var href = '%globals_asset_metadata_jcu.summarycard.override.url:' + assetId + '^prepend_if:' + externalUrlTarget + 'href="^empty:href="./?a=' + assetId +'%'


            print('<a class="btn btn-secondary" ' + href + '">' + buttonText + '</a>')
            print('</div></div>')
          }
        </script>







            </div>

            <!--@@ Buttons paint layout @@-->
            <script runat="server">
              this.args = {
                btn_wrapper: {
                  opening: '<div class="row"><div class="col-sm-12">',
                  closing: '</div></div>'
                }
              }
            </script>
            %asset_contents_paint_394551%
        </div>
    </div>

<!--@@ Pull out the last closing tag from the Content Container's rendering @@-->
<!--@@ Workaround for https://github.com/jcu-eresearch/matrix-helpers/issues/41 @@-->
%begin_asset_contents^preg_replace:379082%
%asset_contents^preg_replace:379097%
%else_asset%
</div>
%end_asset%
