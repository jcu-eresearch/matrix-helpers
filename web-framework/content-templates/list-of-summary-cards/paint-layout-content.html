<script runat="server">var parts = JCU.extractContentContainerParts("%asset_contents^json_encode%")</script>
<script runat="server">print(parts.opening)</script>
    class="container content-block %globals_asset_metadata_jcu.features.theme^eq:content:jcu-content%" aria-label="%asset_metadata_template.title.title^striphtml% %asset_metadata_template.title.subtitle^striphtml%">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 container">

            %begin_asset_metadata_template.title.display^eq:show%
            <h3 class="%asset_metadata_template.title.alignment%">
              <script runat="server">phrasingHtmlFromKeyword('globals_asset_metadata_template.title.title:%asset_assetid%')</script>
              <script runat="server">phrasingHtmlFromKeyword('globals_asset_metadata_template.title.subtitle:%asset_assetid%', {prepend: '<br><span class="lead">', append: '</span>'})</script>
            </h3>
            %end_asset%

            <div class="row m-b-2">


        <script runat="server">
          var assetList="%asset_metadata_template.list.items%"
          var cardLayout = "%asset_metadata_template.card.layout%"

          assetList = assetList.slice(1,-1)
          var assets = assetList.split(",")
          var imageShape = '%asset_metadata_template.card.image.shape^replace:circle:img-circle^replace:natural: %'


          // only used for thumbnail grid
          var rowCount = 0
          var columnCount = 0
          var columnsPerRow = 6

          if (cardLayout == "mosaicGrid") {
            print('<div class="card-columns">')
            _.each(assets, drawGridCard)
            print('</div>')
          } else if (cardLayout == "column") {
            print('<div class="container-fluid">')
            _.each(assets, drawColumnCard)
            print('</div>')
          } else if (cardLayout == "thumbnails") {
              print('<div class="container-fluid"><div class="row">')
              _.each(assets, drawThumbnailGridCard)
              print('</div></div>')
          } else
            print('<div class="alert alert-info">Card layout ' + cardLayout + ' not supported yet </div>')


           function buildCardHref2(assetId) {
            const externalUrlTarget = ' target="_blank" rel="external noopener" '

            return('globals_asset_metadata_jcu.summarycard.override.url:' + assetId + '^prepend_if:' + externalUrlTarget + 'href="^empty:href="./?a=' + assetId +'^append_if:"')
          }   // buildCardHref

          function buildCardLinkedImage(assetId, options) {
            options = options || { prepend : '', append : ''}

            var imageWrapper = { prepend: '<a {' + buildCardHref2(assetId) + '}> <img class="img-fluid ' + imageShape + '" src="./?a=', append: '\\:v3"/></a>' }

            var value ='%globals_asset_metadata_jcu.summarycard.image:' + assetId +
             '^prepend_if:' + options.prepend + imageWrapper.prepend +
             '^append_if:' + imageWrapper.append + options.append +
             '%'
             return('<pre>' + value + '</pre>')
          }   // buildCardLinkedImage

          function buildCardHref(assetId) {
            const externalUrlTarget = ' target="_blank" rel="external noopener" '

            return('%globals_asset_metadata_jcu.summarycard.override.url:' + assetId + '^prepend_if:' + externalUrlTarget + 'href="^empty:href="./?a=' + assetId +'^append_if:"%')
          }   // buildCardHref

          function buildCardImage(assetId, options) {
            options = options || { prepend : '', append : ''}

            var imageWrapper = { prepend: '<img class="img-fluid ' + imageShape + '" src="./?a=', append: '\\:v3"/>' }

            return('%globals_asset_metadata_jcu.summarycard.image:' + assetId +
             '^prepend_if:' + options.prepend + imageWrapper.prepend +
             '^append_if:' + imageWrapper.append + options.append +
             '%'
            )
          }

          function drawThumbnailGridCard(assetId, index, list) {
            ++columnCount;
            if (columnCount > columnsPerRow) {
              print('</div><div class="row">')    // close the row and start a new one
              columnCount = 1
              rowCount++
            }

            print('<div class="col-sm-2">')

            print('<a ' + buildCardHref(assetId) + '>' + buildCardImage(assetId) + '</a>')
            print('<p class="small">%globals_asset_attribute_name:' + assetId + '%</p>')
            print('</div>')
          }   // drawThumbnailGridCard


          function drawGridCard(assetId) {
            print('<div class="card card-outline-secondary">')

            print('<a ' + buildCardHref(assetId) + '>' + buildCardImage(assetId) + '</a>')

            print('<div class="card-block">')
            print('<h4 class="card-title">%globals_asset_attribute_name:' + assetId + '%</h4>')
            print('<p class="card-text">')
            phrasingHtmlFromKeyword('globals_asset_metadata_jcu.summarycard.description:' + assetId)
            print('</p>')

            var buttonText = "More Details"
            print('<a class="btn btn-secondary" ' + buildCardHref(assetId) + '>' + buttonText + '</a>')
            print('</div></div>')
          }   // drawGridCard

          function drawColumnCard(assetId) {
            print('<div class="row m-b-3">')

            // image section
            var imageOptions = { prepend : '<div class="col-sm-3">', append : '</div>'}
//            print('<a ' + buildCardHref(assetId) + '>' + buildCardImage(assetId, imageOptions) + '</a>')
            print(buildCardLinkedImage(assetId, imageOptions))

            // text section
            var columnWidth = '%globals_asset_metadata_jcu.summarycard.image:' + assetId + '^empty:12:9%'
            print('<div class="col-sm-' + columnWidth + ' m-l-2">')

            var byline = 'globals_asset_metadata_jcu.features.byline:' + assetId

            print('<h5>%globals_asset_attribute_name:' + assetId + '%    <small>')
            phrasingHtmlFromKeyword(byline)
            print('</small></h5>')
            print('<p>')
            phrasingHtmlFromKeyword('globals_asset_metadata_jcu.summarycard.description:' + assetId)
            print('</p>')

            var buttonText = "More Details"
            print('<a class="btn-link" ' + buildCardHref(assetId) + '>' + buttonText + '</a>')

            print('</div></div>')
          }   // drawColumnCard


        </script>







            </div>

            <!--@@ Buttons paint layout @@-->
            <script runat="server">
              this.args = {
                btn_wrapper: {
                  opening: '<div class="row"><div class="col-sm-12">',
                  closing: '</div></div>'
                }
              }
            </script>
            %asset_contents_paint_394551%
        </div>
    </div>
<script runat="server">print(parts.closing)</script>
