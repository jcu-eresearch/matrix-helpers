<!--@@ Web Framework Core CSS @@-->
<link rel="stylesheet" href="./?a=281218:dist/css/jcu.min.css" integrity="sha384-yvalFRKl+0g0tWrYJQwXPaf4oRFo9hOu7BssvfScVX9wdvvA+NjYtnAFm3sqP7LF" crossorigin="anonymous">

<!--@@ Edit+ CSS, cleaned up and integrated with JCU Web Framework @@-->
<link href="./?a=289979?v=%globals_asset_version:289979%" rel="stylesheet" media="screen" />


<!--@@ Standard Edit+ boilerplate @@-->
<link href="/__data/ees/Viper/viper.css" rel="stylesheet" media="screen" />

<!--@@ Edit+ JS API @@-->
<script src="./?a=438?v=%globals_asset_version:438%"></script>
<!--@@ Edit+ Configuration, customised for Analytics @@-->
<script src="./?a=318177?v=%globals_asset_version:318177%"></script>

<!--@@ JCU workaround for not being able to edit Site metadata @@-->
<script>
  (function() {
    var oldFn = Squiz_Matrix_API.prototype.getKeywordsReplacements
    Squiz_Matrix_API.prototype.getKeywordsReplacements = function() {
      // Prevent redirection for Site assets
      // Avoid uses of Squiz percent global keywords which actually resolve
      if (arguments.length === 1 &&
          arguments[0] &&
          arguments[0].keywords_array &&
          arguments[0].keywords_array.length === 1 &&
          arguments[0].keywords_array[0] === ('%' + 'asset_index_id%')) {
        arguments[0].keywords_array[0] = '%' + 'nonexistent_keyword%'
      }
      // getKeywordsReplacements is expecting either 0 or 1 arguments so apply
      return oldFn.apply(this, arguments)
    }
  })()
</script>

<!--@@ Edit+ Core Scripts @@-->
<script src="/__data/ees/easyedit.min.js"></script>
<script src="/__data/ees/Viper/viper.js"></script>

<!--@@ Edit+ Plugins @@-->
<!--@@ See https://matrix.squiz.net/manuals/edit-plus/chapters/javascript-plugins for details @@-->
<script>
  /**
   * Open Asset Wizard plugin - Automatically opens the Asset Wizard via the URL
   */
  EasyEdit.plugins.openAssetWizardViaUrl = {
    init: function() {
      EasyEditEventManager.bind('EasyEditAfterLoad', function() {
        if (window.location.hash.startsWith('#openWizard')) {
          EasyEdit.wizard.show()
        }
      })
    }
  }

  /**
   * User menu plugin - Adds extra buttons to the user toolbar
   */
  EasyEdit.isBackendUser = function() {
    return EasyEditAssetManager._currentUserAsset.attr.type.search(/Backend|System|Root/) >= 0
  }
  EasyEdit.plugins.addUserMenuButtons = {
    init: function() {
      EasyEditEventManager.bind('EasyEditBeforeLoad', function() {
        var oldFn = EasyEditComponentsToolbar.addCurrentUser
        EasyEditComponentsToolbar.addCurrentUser = function() {
          var buttons = '<div role="group" class="m-l-1 btn-group btn-group-sm">'
          if (EasyEdit.isBackendUser()) {
            buttons += '<a href="' + EasyEdit.getURL().url + '/' + EasyEdit.systemInfo.suffixes.admin + '" title="Go to Admin mode" class="btn btn-secondary"><span aria-label="Admin icon" class="icon-pagesetup"></span></a>'
          }
          buttons += '<a href="' + EasyEdit.getURL().url + '" class="btn btn-secondary" title="Go to public view" target="_blank"><span class="icon-eye" aria-label="View icon"></span></a><a class="btn btn-secondary" href="https://www.jcu.edu.au/digital-marketing/" target="_blank" title="Get help from a human"><span class="icon-support" aria-label="Help icon"></span></a>'
          buttons += '</div>'
          return $(oldFn()).append(buttons)[0].outerHTML
        }
      })
    }
  }

  /**
  * Hotfix Plugin - Fixes various EasyEdit bugs
  */
  EasyEdit.plugins.fixBugs = {
    init: function () {
      // Bug fix: hides the 'undefined' string
      // Add a function to the screen load event
      EasyEditEventManager.bind("EasyEditScreenLoad", function () {
        //check if we are on the metadata screen
        if (EasyEditScreens.getCurrentScreenName() === "Metadata") {
          $("#ees_editMetadata .notes:contains('undefined')").remove()
        }
      })

      // Bug fix: fix display issues on Preview mode
      EasyEditEventManager.bind("EasyEditModeLoaded", function (mode) {
        if (mode === "preview") {
          // Handle resize actions adding overflow: auto the iframe by
          // overriding the start() function. Other functions remain the same.
          jQuery("#ees_PreviewFrameContainer").resizable({
            start: function() {
              jQuery("#ees_modePreviewFrame").css("pointer-events", "none");
              EasyEditComponentsToolbar.deselectPreviewScreenSizeOption()
            }
          })

          // The Edit+ code is at fault in two areas, setting the wrapper
          // height to the height of iframe body. From easyedit.js:
          // Line 20478 jQuery("div", $iFrameBody).length > 0 ? n.height($iFrameBody.height() + 40 + "px") : n.height(jQuery(window).height() + "px");
          // Line 25159 c = jQuery("div", c).length > 0 ? c.height() + 40 : jQuery(window).height();
          function correctIframeWrapperHeight() {
            // Get rid of overflow: hidden from the preview iframe's HTML tag
            var iframe = document.getElementById('ees_modePreviewFrame')
            var iframeDocument = iframe.contentDocument || iframe.contentWindow.document
            iframeDocument.documentElement.removeAttribute('style')

            // Corrects the iframe wrapper height
            document.getElementById('ees_PreviewFrameContainer').style.height =
              (window.innerHeight - document.getElementById('ees_toolBar').scrollHeight) + 'px'
          }
          if (sessionStorage.getItem("preview_screen_size") === "auto") {
            correctIframeWrapperHeight()
          }
          jQuery('#ees_selectedSize_0').click(function() {
            correctIframeWrapperHeight()
          })
        }
      })
    }
  }

  /**
   * CSS loader animation plugin - Avoid using a huge animated GIF, use CSS3!
   */
  EasyEdit.plugins.cssLoaderAnimation = {
    init: function () {
      // Change the loader to be lighter
      EasyEditOverlay.overlays.loading._getTemplate = function(msg) {
        var output = "<div class='spinner'></div>"
        if (msg) {
            output += "<p class='h2 text-xs-center'>" + msg + "</p>"
        }
        return output
      }
    }
  }
</script>
