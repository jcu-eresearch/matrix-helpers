<!--@@ Container Block Opening Tag paint layout @@-->
<script runat="server">
  this.args = {content_block_class: 'cct-video-stream container'}
</script>
%asset_contents_paint_420277%
  <div class="row">
    <div class="col-xs-12 col-md-10 col-md-offset-1">
      <!--@@ Title paint layout @@-->
      %asset_contents_paint_420212%

      <!--@@ UNLESS they specifically wanted the text content AFTER.. @@-->
      %begin_asset_metadata_template.content.position^neq:after%
        %asset_contents_paint_420234%
      %end_asset%

      <div class='video-stream-player-wrapper m-b-1 embed-responsive embed-responsive-%asset_metadata_template.videostream.aspectratio%'>
        <div class='video-stream-player clearfix embed-responsive-item'
          style='height: 100%; width: 100%'
          data-vsp_source='%asset_metadata_template.videostream.source^escapehtml%'

          %begin_asset_metadata_template.videostream.watermark.type^neq:none%
            data-vsp_watermark='https://cdn.jcu.edu.au/web-framework/%asset_metadata_template.videostream.watermark.type%'
            data-vsp_position='%asset_metadata_template.videostream.watermark.position%'
          %end_asset%

          %begin_asset_metadata_template.videostream.watermark.link%
            data-vsp_watermark-link='%asset_metadata_template.videostream.watermark.link^escapehtml%'
          %end_asset%

          %begin_asset_metadata_template.videostream.poster.asset%
            data-vsp_poster='%asset_metadata_template.videostream.poster.asset^as_asset:asset_url^escapehtml%'
          %else_begin_asset_metadata_template.videostream.poster.url%
            data-vsp_poster='%asset_metadata_template.videostream.poster.url^escapehtml%'
          %end_asset%

          %begin_asset_metadata_template.videostream.autoplay^eq:true%
            data-vsp_auto-play='true'
            data-vsp_mute='true'
          %end_asset%

          %begin_asset_metadata_template.videostream.loop^eq:true%
            data-vsp_loop='true'
          %end_asset%

          data-vsp_max-buffer-length='90'
          data-vsp_width='100%'
          data-vsp_height='100%'
          data-vsp_auto-play-visible='partial'
          data-vsp_playback-not-supported-message='Sorry, your browser cannot play this video.&lt;br&gt;&lt;a href=&quot;%asset_metadata_template.videostream.source^htmlentities:ENT_HTML5^htmlentities:ENT_QUOTES^htmlentities:ENT_QUOTES%&quot;&gt;Click to open video in another application&lt;/a&gt;'
        ></div>
      </div>

      <script runat="server">
        // This runs at the end of the body, and:
        //
        // - searches for .video-stream-player divs
        // - reads data- attributes of each div
        // - invokes the Clappr video player on each div, using the `data-vsp_` attrs as settings
        //
        // This would have worked fine without the vsp_ bit, except that
        // the Clappr player has some style rules for an internal element
        // that is specified with [data-watermark]. That rule accidentally
        // targets our parent div, so we have to add a prefix.
        //
        // Note that data attr names get auto-magically re-written to
        // remove dashes and capitalise the letter following the dash.
        function JCU_body_empower_video_streams() {
          print('<script src="https://cdn.jsdelivr.net/clappr/latest/clappr.min.js"></scrip' + 't>\n')
          print('<script> \n \
            $(".video-stream-player").each( function(index, item) { \n \
              var config = { parent: item } \n \
              $.each($(item).data(), function(name, value) { \n \
                if (name.indexOf("vsp_") === 0) { \n \
                  name = name.slice(4) \n \
                } \n \
                if (value === "true" || value === "false") { \n \
                  value = !!(value === "true")\n \
                } \n \
                config[name] = value \n \
              }) \n \
              var player = new Clappr.Player(config) \n \
            }) \n \
            </scrip' + 't>')
        }
      </script>


      <!--@@ if they wanted the text content after.. @@-->
      %begin_asset_metadata_template.content.position^eq:after%
        %asset_contents_paint_420234%
      %end_asset%


      <!--@@ Buttons paint layout @@-->
      <script runat="server">
        this.args = {wrapper: {opening: '<div class="row m-t-2"><div class="col-xs-12">', closing: '</div></div>'}}
      </script>
      %asset_contents_paint_394551%
    </div>
  </div>
