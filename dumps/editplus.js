/* Copyright Squiz - For full terms see licence.txt */
/*! jQuery v1.11.0 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
! function(a, b) {
  "object" == typeof module && "object" == typeof module.exports ? module.exports = a.document ? b(a, !0) : function(a) {
    if (!a.document) throw new Error("jQuery requires a window with a document");
    return b(a)
  } : b(a)
}("undefined" != typeof window ? window : this, function(a, b) {
  var c = [],
    d = c.slice,
    e = c.concat,
    f = c.push,
    g = c.indexOf,
    h = {},
    i = h.toString,
    j = h.hasOwnProperty,
    k = "".trim,
    l = {},
    m = "1.11.0",
    n = function(a, b) {
      return new n.fn.init(a, b)
    },
    o = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
    p = /^-ms-/,
    q = /-([\da-z])/gi,
    r = function(a, b) {
      return b.toUpperCase()
    };
  n.fn = n.prototype = {
    jquery: m,
    constructor: n,
    selector: "",
    length: 0,
    toArray: function() {
      return d.call(this)
    },
    get: function(a) {
      return null != a ? 0 > a ? this[a + this.length] : this[a] : d.call(this)
    },
    pushStack: function(a) {
      var b = n.merge(this.constructor(), a);
      return b.prevObject = this, b.context = this.context, b
    },
    each: function(a, b) {
      return n.each(this, a, b)
    },
    map: function(a) {
      return this.pushStack(n.map(this, function(b, c) {
        return a.call(b, c, b)
      }))
    },
    slice: function() {
      return this.pushStack(d.apply(this, arguments))
    },
    first: function() {
      return this.eq(0)
    },
    last: function() {
      return this.eq(-1)
    },
    eq: function(a) {
      var b = this.length,
        c = +a + (0 > a ? b : 0);
      return this.pushStack(c >= 0 && b > c ? [this[c]] : [])
    },
    end: function() {
      return this.prevObject || this.constructor(null)
    },
    push: f,
    sort: c.sort,
    splice: c.splice
  }, n.extend = n.fn.extend = function() {
    var a, b, c, d, e, f, g = arguments[0] || {},
      h = 1,
      i = arguments.length,
      j = !1;
    for ("boolean" == typeof g && (j = g, g = arguments[h] || {}, h++), "object" == typeof g || n.isFunction(g) || (g = {}), h === i && (g = this, h--); i > h; h++)
      if (null != (e = arguments[h]))
        for (d in e) a = g[d], c = e[d], g !== c && (j && c && (n.isPlainObject(c) || (b = n.isArray(c))) ? (b ? (b = !1, f = a && n.isArray(a) ? a : []) : f = a && n.isPlainObject(a) ? a : {}, g[d] = n.extend(j, f, c)) : void 0 !== c && (g[d] = c));
    return g
  }, n.extend({
    expando: "jQuery" + (m + Math.random()).replace(/\D/g, ""),
    isReady: !0,
    error: function(a) {
      throw new Error(a)
    },
    noop: function() {},
    isFunction: function(a) {
      return "function" === n.type(a)
    },
    isArray: Array.isArray || function(a) {
      return "array" === n.type(a)
    },
    isWindow: function(a) {
      return null != a && a == a.window
    },
    isNumeric: function(a) {
      return a - parseFloat(a) >= 0
    },
    isEmptyObject: function(a) {
      var b;
      for (b in a) return !1;
      return !0
    },
    isPlainObject: function(a) {
      var b;
      if (!a || "object" !== n.type(a) || a.nodeType || n.isWindow(a)) return !1;
      try {
        if (a.constructor && !j.call(a, "constructor") && !j.call(a.constructor.prototype, "isPrototypeOf")) return !1
      } catch (c) {
        return !1
      }
      if (l.ownLast)
        for (b in a) return j.call(a, b);
      for (b in a);
      return void 0 === b || j.call(a, b)
    },
    type: function(a) {
      return null == a ? a + "" : "object" == typeof a || "function" == typeof a ? h[i.call(a)] || "object" : typeof a
    },
    globalEval: function(b) {
      b && n.trim(b) && (a.execScript || function(b) {
        a.eval.call(a, b)
      })(b)
    },
    camelCase: function(a) {
      return a.replace(p, "ms-").replace(q, r)
    },
    nodeName: function(a, b) {
      return a.nodeName && a.nodeName.toLowerCase() === b.toLowerCase()
    },
    each: function(a, b, c) {
      var d, e = 0,
        f = a.length,
        g = s(a);
      if (c) {
        if (g) {
          for (; f > e; e++)
            if (d = b.apply(a[e], c), d === !1) break
        } else
          for (e in a)
            if (d = b.apply(a[e], c), d === !1) break
      } else if (g) {
        for (; f > e; e++)
          if (d = b.call(a[e], e, a[e]), d === !1) break
      } else
        for (e in a)
          if (d = b.call(a[e], e, a[e]), d === !1) break; return a
    },
    trim: k && !k.call("\ufeff\xa0") ? function(a) {
      return null == a ? "" : k.call(a)
    } : function(a) {
      return null == a ? "" : (a + "").replace(o, "")
    },
    makeArray: function(a, b) {
      var c = b || [];
      return null != a && (s(Object(a)) ? n.merge(c, "string" == typeof a ? [a] : a) : f.call(c, a)), c
    },
    inArray: function(a, b, c) {
      var d;
      if (b) {
        if (g) return g.call(b, a, c);
        for (d = b.length, c = c ? 0 > c ? Math.max(0, d + c) : c : 0; d > c; c++)
          if (c in b && b[c] === a) return c
      }
      return -1
    },
    merge: function(a, b) {
      var c = +b.length,
        d = 0,
        e = a.length;
      while (c > d) a[e++] = b[d++];
      if (c !== c)
        while (void 0 !== b[d]) a[e++] = b[d++];
      return a.length = e, a
    },
    grep: function(a, b, c) {
      for (var d, e = [], f = 0, g = a.length, h = !c; g > f; f++) d = !b(a[f], f), d !== h && e.push(a[f]);
      return e
    },
    map: function(a, b, c) {
      var d, f = 0,
        g = a.length,
        h = s(a),
        i = [];
      if (h)
        for (; g > f; f++) d = b(a[f], f, c), null != d && i.push(d);
      else
        for (f in a) d = b(a[f], f, c), null != d && i.push(d);
      return e.apply([], i)
    },
    guid: 1,
    proxy: function(a, b) {
      var c, e, f;
      return "string" == typeof b && (f = a[b], b = a, a = f), n.isFunction(a) ? (c = d.call(arguments, 2), e = function() {
        return a.apply(b || this, c.concat(d.call(arguments)))
      }, e.guid = a.guid = a.guid || n.guid++, e) : void 0
    },
    now: function() {
      return +new Date
    },
    support: l
  }), n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(a, b) {
    h["[object " + b + "]"] = b.toLowerCase()
  });

  function s(a) {
    var b = a.length,
      c = n.type(a);
    return "function" === c || n.isWindow(a) ? !1 : 1 === a.nodeType && b ? !0 : "array" === c || 0 === b || "number" == typeof b && b > 0 && b - 1 in a
  }
  var t = function(a) {
    var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s = "sizzle" + -new Date,
      t = a.document,
      u = 0,
      v = 0,
      w = eb(),
      x = eb(),
      y = eb(),
      z = function(a, b) {
        return a === b && (j = !0), 0
      },
      A = "undefined",
      B = 1 << 31,
      C = {}.hasOwnProperty,
      D = [],
      E = D.pop,
      F = D.push,
      G = D.push,
      H = D.slice,
      I = D.indexOf || function(a) {
        for (var b = 0, c = this.length; c > b; b++)
          if (this[b] === a) return b;
        return -1
      },
      J = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
      K = "[\\x20\\t\\r\\n\\f]",
      L = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",
      M = L.replace("w", "w#"),
      N = "\\[" + K + "*(" + L + ")" + K + "*(?:([*^$|!~]?=)" + K + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + M + ")|)|)" + K + "*\\]",
      O = ":(" + L + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + N.replace(3, 8) + ")*)|.*)\\)|)",
      P = new RegExp("^" + K + "+|((?:^|[^\\\\])(?:\\\\.)*)" + K + "+$", "g"),
      Q = new RegExp("^" + K + "*," + K + "*"),
      R = new RegExp("^" + K + "*([>+~]|" + K + ")" + K + "*"),
      S = new RegExp("=" + K + "*([^\\]'\"]*?)" + K + "*\\]", "g"),
      T = new RegExp(O),
      U = new RegExp("^" + M + "$"),
      V = {
        ID: new RegExp("^#(" + L + ")"),
        CLASS: new RegExp("^\\.(" + L + ")"),
        TAG: new RegExp("^(" + L.replace("w", "w*") + ")"),
        ATTR: new RegExp("^" + N),
        PSEUDO: new RegExp("^" + O),
        CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + K + "*(even|odd|(([+-]|)(\\d*)n|)" + K + "*(?:([+-]|)" + K + "*(\\d+)|))" + K + "*\\)|)", "i"),
        bool: new RegExp("^(?:" + J + ")$", "i"),
        needsContext: new RegExp("^" + K + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + K + "*((?:-\\d)?\\d*)" + K + "*\\)|)(?=[^-]|$)", "i")
      },
      W = /^(?:input|select|textarea|button)$/i,
      X = /^h\d$/i,
      Y = /^[^{]+\{\s*\[native \w/,
      Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
      $ = /[+~]/,
      _ = /'|\\/g,
      ab = new RegExp("\\\\([\\da-f]{1,6}" + K + "?|(" + K + ")|.)", "ig"),
      bb = function(a, b, c) {
        var d = "0x" + b - 65536;
        return d !== d || c ? b : 0 > d ? String.fromCharCode(d + 65536) : String.fromCharCode(d >> 10 | 55296, 1023 & d | 56320)
      };
    try {
      G.apply(D = H.call(t.childNodes), t.childNodes), D[t.childNodes.length].nodeType
    } catch (cb) {
      G = {
        apply: D.length ? function(a, b) {
          F.apply(a, H.call(b))
        } : function(a, b) {
          var c = a.length,
            d = 0;
          while (a[c++] = b[d++]);
          a.length = c - 1
        }
      }
    }

    function db(a, b, d, e) {
      var f, g, h, i, j, m, p, q, u, v;
      if ((b ? b.ownerDocument || b : t) !== l && k(b), b = b || l, d = d || [], !a || "string" != typeof a) return d;
      if (1 !== (i = b.nodeType) && 9 !== i) return [];
      if (n && !e) {
        if (f = Z.exec(a))
          if (h = f[1]) {
            if (9 === i) {
              if (g = b.getElementById(h), !g || !g.parentNode) return d;
              if (g.id === h) return d.push(g), d
            } else if (b.ownerDocument && (g = b.ownerDocument.getElementById(h)) && r(b, g) && g.id === h) return d.push(g), d
          } else {
            if (f[2]) return G.apply(d, b.getElementsByTagName(a)), d;
            if ((h = f[3]) && c.getElementsByClassName && b.getElementsByClassName) return G.apply(d, b.getElementsByClassName(h)), d
          }
        if (c.qsa && (!o || !o.test(a))) {
          if (q = p = s, u = b, v = 9 === i && a, 1 === i && "object" !== b.nodeName.toLowerCase()) {
            m = ob(a), (p = b.getAttribute("id")) ? q = p.replace(_, "\\$&") : b.setAttribute("id", q), q = "[id='" + q + "'] ", j = m.length;
            while (j--) m[j] = q + pb(m[j]);
            u = $.test(a) && mb(b.parentNode) || b, v = m.join(",")
          }
          if (v) try {
            return G.apply(d, u.querySelectorAll(v)), d
          } catch (w) {} finally {
            p || b.removeAttribute("id")
          }
        }
      }
      return xb(a.replace(P, "$1"), b, d, e)
    }

    function eb() {
      var a = [];

      function b(c, e) {
        return a.push(c + " ") > d.cacheLength && delete b[a.shift()], b[c + " "] = e
      }
      return b
    }

    function fb(a) {
      return a[s] = !0, a
    }

    function gb(a) {
      var b = l.createElement("div");
      try {
        return !!a(b)
      } catch (c) {
        return !1
      } finally {
        b.parentNode && b.parentNode.removeChild(b), b = null
      }
    }

    function hb(a, b) {
      var c = a.split("|"),
        e = a.length;
      while (e--) d.attrHandle[c[e]] = b
    }

    function ib(a, b) {
      var c = b && a,
        d = c && 1 === a.nodeType && 1 === b.nodeType && (~b.sourceIndex || B) - (~a.sourceIndex || B);
      if (d) return d;
      if (c)
        while (c = c.nextSibling)
          if (c === b) return -1;
      return a ? 1 : -1
    }

    function jb(a) {
      return function(b) {
        var c = b.nodeName.toLowerCase();
        return "input" === c && b.type === a
      }
    }

    function kb(a) {
      return function(b) {
        var c = b.nodeName.toLowerCase();
        return ("input" === c || "button" === c) && b.type === a
      }
    }

    function lb(a) {
      return fb(function(b) {
        return b = +b, fb(function(c, d) {
          var e, f = a([], c.length, b),
            g = f.length;
          while (g--) c[e = f[g]] && (c[e] = !(d[e] = c[e]))
        })
      })
    }

    function mb(a) {
      return a && typeof a.getElementsByTagName !== A && a
    }
    c = db.support = {}, f = db.isXML = function(a) {
      var b = a && (a.ownerDocument || a).documentElement;
      return b ? "HTML" !== b.nodeName : !1
    }, k = db.setDocument = function(a) {
      var b, e = a ? a.ownerDocument || a : t,
        g = e.defaultView;
      return e !== l && 9 === e.nodeType && e.documentElement ? (l = e, m = e.documentElement, n = !f(e), g && g !== g.top && (g.addEventListener ? g.addEventListener("unload", function() {
        k()
      }, !1) : g.attachEvent && g.attachEvent("onunload", function() {
        k()
      })), c.attributes = gb(function(a) {
        return a.className = "i", !a.getAttribute("className")
      }), c.getElementsByTagName = gb(function(a) {
        return a.appendChild(e.createComment("")), !a.getElementsByTagName("*").length
      }), c.getElementsByClassName = Y.test(e.getElementsByClassName) && gb(function(a) {
        return a.innerHTML = "<div class='a'></div><div class='a i'></div>", a.firstChild.className = "i", 2 === a.getElementsByClassName("i").length
      }), c.getById = gb(function(a) {
        return m.appendChild(a).id = s, !e.getElementsByName || !e.getElementsByName(s).length
      }), c.getById ? (d.find.ID = function(a, b) {
        if (typeof b.getElementById !== A && n) {
          var c = b.getElementById(a);
          return c && c.parentNode ? [c] : []
        }
      }, d.filter.ID = function(a) {
        var b = a.replace(ab, bb);
        return function(a) {
          return a.getAttribute("id") === b
        }
      }) : (delete d.find.ID, d.filter.ID = function(a) {
        var b = a.replace(ab, bb);
        return function(a) {
          var c = typeof a.getAttributeNode !== A && a.getAttributeNode("id");
          return c && c.value === b
        }
      }), d.find.TAG = c.getElementsByTagName ? function(a, b) {
        return typeof b.getElementsByTagName !== A ? b.getElementsByTagName(a) : void 0
      } : function(a, b) {
        var c, d = [],
          e = 0,
          f = b.getElementsByTagName(a);
        if ("*" === a) {
          while (c = f[e++]) 1 === c.nodeType && d.push(c);
          return d
        }
        return f
      }, d.find.CLASS = c.getElementsByClassName && function(a, b) {
        return typeof b.getElementsByClassName !== A && n ? b.getElementsByClassName(a) : void 0
      }, p = [], o = [], (c.qsa = Y.test(e.querySelectorAll)) && (gb(function(a) {
        a.innerHTML = "<select t=''><option selected=''></option></select>", a.querySelectorAll("[t^='']").length && o.push("[*^$]=" + K + "*(?:''|\"\")"), a.querySelectorAll("[selected]").length || o.push("\\[" + K + "*(?:value|" + J + ")"), a.querySelectorAll(":checked").length || o.push(":checked")
      }), gb(function(a) {
        var b = e.createElement("input");
        b.setAttribute("type", "hidden"), a.appendChild(b).setAttribute("name", "D"), a.querySelectorAll("[name=d]").length && o.push("name" + K + "*[*^$|!~]?="), a.querySelectorAll(":enabled").length || o.push(":enabled", ":disabled"), a.querySelectorAll("*,:x"), o.push(",.*:")
      })), (c.matchesSelector = Y.test(q = m.webkitMatchesSelector || m.mozMatchesSelector || m.oMatchesSelector || m.msMatchesSelector)) && gb(function(a) {
        c.disconnectedMatch = q.call(a, "div"), q.call(a, "[s!='']:x"), p.push("!=", O)
      }), o = o.length && new RegExp(o.join("|")), p = p.length && new RegExp(p.join("|")), b = Y.test(m.compareDocumentPosition), r = b || Y.test(m.contains) ? function(a, b) {
        var c = 9 === a.nodeType ? a.documentElement : a,
          d = b && b.parentNode;
        return a === d || !(!d || 1 !== d.nodeType || !(c.contains ? c.contains(d) : a.compareDocumentPosition && 16 & a.compareDocumentPosition(d)))
      } : function(a, b) {
        if (b)
          while (b = b.parentNode)
            if (b === a) return !0;
        return !1
      }, z = b ? function(a, b) {
        if (a === b) return j = !0, 0;
        var d = !a.compareDocumentPosition - !b.compareDocumentPosition;
        return d ? d : (d = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1, 1 & d || !c.sortDetached && b.compareDocumentPosition(a) === d ? a === e || a.ownerDocument === t && r(t, a) ? -1 : b === e || b.ownerDocument === t && r(t, b) ? 1 : i ? I.call(i, a) - I.call(i, b) : 0 : 4 & d ? -1 : 1)
      } : function(a, b) {
        if (a === b) return j = !0, 0;
        var c, d = 0,
          f = a.parentNode,
          g = b.parentNode,
          h = [a],
          k = [b];
        if (!f || !g) return a === e ? -1 : b === e ? 1 : f ? -1 : g ? 1 : i ? I.call(i, a) - I.call(i, b) : 0;
        if (f === g) return ib(a, b);
        c = a;
        while (c = c.parentNode) h.unshift(c);
        c = b;
        while (c = c.parentNode) k.unshift(c);
        while (h[d] === k[d]) d++;
        return d ? ib(h[d], k[d]) : h[d] === t ? -1 : k[d] === t ? 1 : 0
      }, e) : l
    }, db.matches = function(a, b) {
      return db(a, null, null, b)
    }, db.matchesSelector = function(a, b) {
      if ((a.ownerDocument || a) !== l && k(a), b = b.replace(S, "='$1']"), !(!c.matchesSelector || !n || p && p.test(b) || o && o.test(b))) try {
        var d = q.call(a, b);
        if (d || c.disconnectedMatch || a.document && 11 !== a.document.nodeType) return d
      } catch (e) {}
      return db(b, l, null, [a]).length > 0
    }, db.contains = function(a, b) {
      return (a.ownerDocument || a) !== l && k(a), r(a, b)
    }, db.attr = function(a, b) {
      (a.ownerDocument || a) !== l && k(a);
      var e = d.attrHandle[b.toLowerCase()],
        f = e && C.call(d.attrHandle, b.toLowerCase()) ? e(a, b, !n) : void 0;
      return void 0 !== f ? f : c.attributes || !n ? a.getAttribute(b) : (f = a.getAttributeNode(b)) && f.specified ? f.value : null
    }, db.error = function(a) {
      throw new Error("Syntax error, unrecognized expression: " + a)
    }, db.uniqueSort = function(a) {
      var b, d = [],
        e = 0,
        f = 0;
      if (j = !c.detectDuplicates, i = !c.sortStable && a.slice(0), a.sort(z), j) {
        while (b = a[f++]) b === a[f] && (e = d.push(f));
        while (e--) a.splice(d[e], 1)
      }
      return i = null, a
    }, e = db.getText = function(a) {
      var b, c = "",
        d = 0,
        f = a.nodeType;
      if (f) {
        if (1 === f || 9 === f || 11 === f) {
          if ("string" == typeof a.textContent) return a.textContent;
          for (a = a.firstChild; a; a = a.nextSibling) c += e(a)
        } else if (3 === f || 4 === f) return a.nodeValue
      } else
        while (b = a[d++]) c += e(b);
      return c
    }, d = db.selectors = {
      cacheLength: 50,
      createPseudo: fb,
      match: V,
      attrHandle: {},
      find: {},
      relative: {
        ">": {
          dir: "parentNode",
          first: !0
        },
        " ": {
          dir: "parentNode"
        },
        "+": {
          dir: "previousSibling",
          first: !0
        },
        "~": {
          dir: "previousSibling"
        }
      },
      preFilter: {
        ATTR: function(a) {
          return a[1] = a[1].replace(ab, bb), a[3] = (a[4] || a[5] || "").replace(ab, bb), "~=" === a[2] && (a[3] = " " + a[3] + " "), a.slice(0, 4)
        },
        CHILD: function(a) {
          return a[1] = a[1].toLowerCase(), "nth" === a[1].slice(0, 3) ? (a[3] || db.error(a[0]), a[4] = +(a[4] ? a[5] + (a[6] || 1) : 2 * ("even" === a[3] || "odd" === a[3])), a[5] = +(a[7] + a[8] || "odd" === a[3])) : a[3] && db.error(a[0]), a
        },
        PSEUDO: function(a) {
          var b, c = !a[5] && a[2];
          return V.CHILD.test(a[0]) ? null : (a[3] && void 0 !== a[4] ? a[2] = a[4] : c && T.test(c) && (b = ob(c, !0)) && (b = c.indexOf(")", c.length - b) - c.length) && (a[0] = a[0].slice(0, b), a[2] = c.slice(0, b)), a.slice(0, 3))
        }
      },
      filter: {
        TAG: function(a) {
          var b = a.replace(ab, bb).toLowerCase();
          return "*" === a ? function() {
            return !0
          } : function(a) {
            return a.nodeName && a.nodeName.toLowerCase() === b
          }
        },
        CLASS: function(a) {
          var b = w[a + " "];
          return b || (b = new RegExp("(^|" + K + ")" + a + "(" + K + "|$)")) && w(a, function(a) {
            return b.test("string" == typeof a.className && a.className || typeof a.getAttribute !== A && a.getAttribute("class") || "")
          })
        },
        ATTR: function(a, b, c) {
          return function(d) {
            var e = db.attr(d, a);
            return null == e ? "!=" === b : b ? (e += "", "=" === b ? e === c : "!=" === b ? e !== c : "^=" === b ? c && 0 === e.indexOf(c) : "*=" === b ? c && e.indexOf(c) > -1 : "$=" === b ? c && e.slice(-c.length) === c : "~=" === b ? (" " + e + " ").indexOf(c) > -1 : "|=" === b ? e === c || e.slice(0, c.length + 1) === c + "-" : !1) : !0
          }
        },
        CHILD: function(a, b, c, d, e) {
          var f = "nth" !== a.slice(0, 3),
            g = "last" !== a.slice(-4),
            h = "of-type" === b;
          return 1 === d && 0 === e ? function(a) {
            return !!a.parentNode
          } : function(b, c, i) {
            var j, k, l, m, n, o, p = f !== g ? "nextSibling" : "previousSibling",
              q = b.parentNode,
              r = h && b.nodeName.toLowerCase(),
              t = !i && !h;
            if (q) {
              if (f) {
                while (p) {
                  l = b;
                  while (l = l[p])
                    if (h ? l.nodeName.toLowerCase() === r : 1 === l.nodeType) return !1;
                  o = p = "only" === a && !o && "nextSibling"
                }
                return !0
              }
              if (o = [g ? q.firstChild : q.lastChild], g && t) {
                k = q[s] || (q[s] = {}), j = k[a] || [], n = j[0] === u && j[1], m = j[0] === u && j[2], l = n && q.childNodes[n];
                while (l = ++n && l && l[p] || (m = n = 0) || o.pop())
                  if (1 === l.nodeType && ++m && l === b) {
                    k[a] = [u, n, m];
                    break
                  }
              } else if (t && (j = (b[s] || (b[s] = {}))[a]) && j[0] === u) m = j[1];
              else
                while (l = ++n && l && l[p] || (m = n = 0) || o.pop())
                  if ((h ? l.nodeName.toLowerCase() === r : 1 === l.nodeType) && ++m && (t && ((l[s] || (l[s] = {}))[a] = [u, m]), l === b)) break; return m -= e, m === d || m % d === 0 && m / d >= 0
            }
          }
        },
        PSEUDO: function(a, b) {
          var c, e = d.pseudos[a] || d.setFilters[a.toLowerCase()] || db.error("unsupported pseudo: " + a);
          return e[s] ? e(b) : e.length > 1 ? (c = [a, a, "", b], d.setFilters.hasOwnProperty(a.toLowerCase()) ? fb(function(a, c) {
            var d, f = e(a, b),
              g = f.length;
            while (g--) d = I.call(a, f[g]), a[d] = !(c[d] = f[g])
          }) : function(a) {
            return e(a, 0, c)
          }) : e
        }
      },
      pseudos: {
        not: fb(function(a) {
          var b = [],
            c = [],
            d = g(a.replace(P, "$1"));
          return d[s] ? fb(function(a, b, c, e) {
            var f, g = d(a, null, e, []),
              h = a.length;
            while (h--)(f = g[h]) && (a[h] = !(b[h] = f))
          }) : function(a, e, f) {
            return b[0] = a, d(b, null, f, c), !c.pop()
          }
        }),
        has: fb(function(a) {
          return function(b) {
            return db(a, b).length > 0
          }
        }),
        contains: fb(function(a) {
          return function(b) {
            return (b.textContent || b.innerText || e(b)).indexOf(a) > -1
          }
        }),
        lang: fb(function(a) {
          return U.test(a || "") || db.error("unsupported lang: " + a), a = a.replace(ab, bb).toLowerCase(),
            function(b) {
              var c;
              do
                if (c = n ? b.lang : b.getAttribute("xml:lang") || b.getAttribute("lang")) return c = c.toLowerCase(), c === a || 0 === c.indexOf(a + "-");
              while ((b = b.parentNode) && 1 === b.nodeType);
              return !1
            }
        }),
        target: function(b) {
          var c = a.location && a.location.hash;
          return c && c.slice(1) === b.id
        },
        root: function(a) {
          return a === m
        },
        focus: function(a) {
          return a === l.activeElement && (!l.hasFocus || l.hasFocus()) && !!(a.type || a.href || ~a.tabIndex)
        },
        enabled: function(a) {
          return a.disabled === !1
        },
        disabled: function(a) {
          return a.disabled === !0
        },
        checked: function(a) {
          var b = a.nodeName.toLowerCase();
          return "input" === b && !!a.checked || "option" === b && !!a.selected
        },
        selected: function(a) {
          return a.parentNode && a.parentNode.selectedIndex, a.selected === !0
        },
        empty: function(a) {
          for (a = a.firstChild; a; a = a.nextSibling)
            if (a.nodeType < 6) return !1;
          return !0
        },
        parent: function(a) {
          return !d.pseudos.empty(a)
        },
        header: function(a) {
          return X.test(a.nodeName)
        },
        input: function(a) {
          return W.test(a.nodeName)
        },
        button: function(a) {
          var b = a.nodeName.toLowerCase();
          return "input" === b && "button" === a.type || "button" === b
        },
        text: function(a) {
          var b;
          return "input" === a.nodeName.toLowerCase() && "text" === a.type && (null == (b = a.getAttribute("type")) || "text" === b.toLowerCase())
        },
        first: lb(function() {
          return [0]
        }),
        last: lb(function(a, b) {
          return [b - 1]
        }),
        eq: lb(function(a, b, c) {
          return [0 > c ? c + b : c]
        }),
        even: lb(function(a, b) {
          for (var c = 0; b > c; c += 2) a.push(c);
          return a
        }),
        odd: lb(function(a, b) {
          for (var c = 1; b > c; c += 2) a.push(c);
          return a
        }),
        lt: lb(function(a, b, c) {
          for (var d = 0 > c ? c + b : c; --d >= 0;) a.push(d);
          return a
        }),
        gt: lb(function(a, b, c) {
          for (var d = 0 > c ? c + b : c; ++d < b;) a.push(d);
          return a
        })
      }
    }, d.pseudos.nth = d.pseudos.eq;
    for (b in {
        radio: !0,
        checkbox: !0,
        file: !0,
        password: !0,
        image: !0
      }) d.pseudos[b] = jb(b);
    for (b in {
        submit: !0,
        reset: !0
      }) d.pseudos[b] = kb(b);

    function nb() {}
    nb.prototype = d.filters = d.pseudos, d.setFilters = new nb;

    function ob(a, b) {
      var c, e, f, g, h, i, j, k = x[a + " "];
      if (k) return b ? 0 : k.slice(0);
      h = a, i = [], j = d.preFilter;
      while (h) {
        (!c || (e = Q.exec(h))) && (e && (h = h.slice(e[0].length) || h), i.push(f = [])), c = !1, (e = R.exec(h)) && (c = e.shift(), f.push({
          value: c,
          type: e[0].replace(P, " ")
        }), h = h.slice(c.length));
        for (g in d.filter) !(e = V[g].exec(h)) || j[g] && !(e = j[g](e)) || (c = e.shift(), f.push({
          value: c,
          type: g,
          matches: e
        }), h = h.slice(c.length));
        if (!c) break
      }
      return b ? h.length : h ? db.error(a) : x(a, i).slice(0)
    }

    function pb(a) {
      for (var b = 0, c = a.length, d = ""; c > b; b++) d += a[b].value;
      return d
    }

    function qb(a, b, c) {
      var d = b.dir,
        e = c && "parentNode" === d,
        f = v++;
      return b.first ? function(b, c, f) {
        while (b = b[d])
          if (1 === b.nodeType || e) return a(b, c, f)
      } : function(b, c, g) {
        var h, i, j = [u, f];
        if (g) {
          while (b = b[d])
            if ((1 === b.nodeType || e) && a(b, c, g)) return !0
        } else
          while (b = b[d])
            if (1 === b.nodeType || e) {
              if (i = b[s] || (b[s] = {}), (h = i[d]) && h[0] === u && h[1] === f) return j[2] = h[2];
              if (i[d] = j, j[2] = a(b, c, g)) return !0
            }
      }
    }

    function rb(a) {
      return a.length > 1 ? function(b, c, d) {
        var e = a.length;
        while (e--)
          if (!a[e](b, c, d)) return !1;
        return !0
      } : a[0]
    }

    function sb(a, b, c, d, e) {
      for (var f, g = [], h = 0, i = a.length, j = null != b; i > h; h++)(f = a[h]) && (!c || c(f, d, e)) && (g.push(f), j && b.push(h));
      return g
    }

    function tb(a, b, c, d, e, f) {
      return d && !d[s] && (d = tb(d)), e && !e[s] && (e = tb(e, f)), fb(function(f, g, h, i) {
        var j, k, l, m = [],
          n = [],
          o = g.length,
          p = f || wb(b || "*", h.nodeType ? [h] : h, []),
          q = !a || !f && b ? p : sb(p, m, a, h, i),
          r = c ? e || (f ? a : o || d) ? [] : g : q;
        if (c && c(q, r, h, i), d) {
          j = sb(r, n), d(j, [], h, i), k = j.length;
          while (k--)(l = j[k]) && (r[n[k]] = !(q[n[k]] = l))
        }
        if (f) {
          if (e || a) {
            if (e) {
              j = [], k = r.length;
              while (k--)(l = r[k]) && j.push(q[k] = l);
              e(null, r = [], j, i)
            }
            k = r.length;
            while (k--)(l = r[k]) && (j = e ? I.call(f, l) : m[k]) > -1 && (f[j] = !(g[j] = l))
          }
        } else r = sb(r === g ? r.splice(o, r.length) : r), e ? e(null, g, r, i) : G.apply(g, r)
      })
    }

    function ub(a) {
      for (var b, c, e, f = a.length, g = d.relative[a[0].type], i = g || d.relative[" "], j = g ? 1 : 0, k = qb(function(a) {
          return a === b
        }, i, !0), l = qb(function(a) {
          return I.call(b, a) > -1
        }, i, !0), m = [function(a, c, d) {
          return !g && (d || c !== h) || ((b = c).nodeType ? k(a, c, d) : l(a, c, d))
        }]; f > j; j++)
        if (c = d.relative[a[j].type]) m = [qb(rb(m), c)];
        else {
          if (c = d.filter[a[j].type].apply(null, a[j].matches), c[s]) {
            for (e = ++j; f > e; e++)
              if (d.relative[a[e].type]) break;
            return tb(j > 1 && rb(m), j > 1 && pb(a.slice(0, j - 1).concat({
              value: " " === a[j - 2].type ? "*" : ""
            })).replace(P, "$1"), c, e > j && ub(a.slice(j, e)), f > e && ub(a = a.slice(e)), f > e && pb(a))
          }
          m.push(c)
        }
      return rb(m)
    }

    function vb(a, b) {
      var c = b.length > 0,
        e = a.length > 0,
        f = function(f, g, i, j, k) {
          var m, n, o, p = 0,
            q = "0",
            r = f && [],
            s = [],
            t = h,
            v = f || e && d.find.TAG("*", k),
            w = u += null == t ? 1 : Math.random() || .1,
            x = v.length;
          for (k && (h = g !== l && g); q !== x && null != (m = v[q]); q++) {
            if (e && m) {
              n = 0;
              while (o = a[n++])
                if (o(m, g, i)) {
                  j.push(m);
                  break
                }
              k && (u = w)
            }
            c && ((m = !o && m) && p--, f && r.push(m))
          }
          if (p += q, c && q !== p) {
            n = 0;
            while (o = b[n++]) o(r, s, g, i);
            if (f) {
              if (p > 0)
                while (q--) r[q] || s[q] || (s[q] = E.call(j));
              s = sb(s)
            }
            G.apply(j, s), k && !f && s.length > 0 && p + b.length > 1 && db.uniqueSort(j)
          }
          return k && (u = w, h = t), r
        };
      return c ? fb(f) : f
    }
    g = db.compile = function(a, b) {
      var c, d = [],
        e = [],
        f = y[a + " "];
      if (!f) {
        b || (b = ob(a)), c = b.length;
        while (c--) f = ub(b[c]), f[s] ? d.push(f) : e.push(f);
        f = y(a, vb(e, d))
      }
      return f
    };

    function wb(a, b, c) {
      for (var d = 0, e = b.length; e > d; d++) db(a, b[d], c);
      return c
    }

    function xb(a, b, e, f) {
      var h, i, j, k, l, m = ob(a);
      if (!f && 1 === m.length) {
        if (i = m[0] = m[0].slice(0), i.length > 2 && "ID" === (j = i[0]).type && c.getById && 9 === b.nodeType && n && d.relative[i[1].type]) {
          if (b = (d.find.ID(j.matches[0].replace(ab, bb), b) || [])[0], !b) return e;
          a = a.slice(i.shift().value.length)
        }
        h = V.needsContext.test(a) ? 0 : i.length;
        while (h--) {
          if (j = i[h], d.relative[k = j.type]) break;
          if ((l = d.find[k]) && (f = l(j.matches[0].replace(ab, bb), $.test(i[0].type) && mb(b.parentNode) || b))) {
            if (i.splice(h, 1), a = f.length && pb(i), !a) return G.apply(e, f), e;
            break
          }
        }
      }
      return g(a, m)(f, b, !n, e, $.test(a) && mb(b.parentNode) || b), e
    }
    return c.sortStable = s.split("").sort(z).join("") === s, c.detectDuplicates = !!j, k(), c.sortDetached = gb(function(a) {
      return 1 & a.compareDocumentPosition(l.createElement("div"))
    }), gb(function(a) {
      return a.innerHTML = "<a href='#'></a>", "#" === a.firstChild.getAttribute("href")
    }) || hb("type|href|height|width", function(a, b, c) {
      return c ? void 0 : a.getAttribute(b, "type" === b.toLowerCase() ? 1 : 2)
    }), c.attributes && gb(function(a) {
      return a.innerHTML = "<input/>", a.firstChild.setAttribute("value", ""), "" === a.firstChild.getAttribute("value")
    }) || hb("value", function(a, b, c) {
      return c || "input" !== a.nodeName.toLowerCase() ? void 0 : a.defaultValue
    }), gb(function(a) {
      return null == a.getAttribute("disabled")
    }) || hb(J, function(a, b, c) {
      var d;
      return c ? void 0 : a[b] === !0 ? b.toLowerCase() : (d = a.getAttributeNode(b)) && d.specified ? d.value : null
    }), db
  }(a);
  n.find = t, n.expr = t.selectors, n.expr[":"] = n.expr.pseudos, n.unique = t.uniqueSort, n.text = t.getText, n.isXMLDoc = t.isXML, n.contains = t.contains;
  var u = n.expr.match.needsContext,
    v = /^<(\w+)\s*\/?>(?:<\/\1>|)$/,
    w = /^.[^:#\[\.,]*$/;

  function x(a, b, c) {
    if (n.isFunction(b)) return n.grep(a, function(a, d) {
      return !!b.call(a, d, a) !== c
    });
    if (b.nodeType) return n.grep(a, function(a) {
      return a === b !== c
    });
    if ("string" == typeof b) {
      if (w.test(b)) return n.filter(b, a, c);
      b = n.filter(b, a)
    }
    return n.grep(a, function(a) {
      return n.inArray(a, b) >= 0 !== c
    })
  }
  n.filter = function(a, b, c) {
    var d = b[0];
    return c && (a = ":not(" + a + ")"), 1 === b.length && 1 === d.nodeType ? n.find.matchesSelector(d, a) ? [d] : [] : n.find.matches(a, n.grep(b, function(a) {
      return 1 === a.nodeType
    }))
  }, n.fn.extend({
    find: function(a) {
      var b, c = [],
        d = this,
        e = d.length;
      if ("string" != typeof a) return this.pushStack(n(a).filter(function() {
        for (b = 0; e > b; b++)
          if (n.contains(d[b], this)) return !0
      }));
      for (b = 0; e > b; b++) n.find(a, d[b], c);
      return c = this.pushStack(e > 1 ? n.unique(c) : c), c.selector = this.selector ? this.selector + " " + a : a, c
    },
    filter: function(a) {
      return this.pushStack(x(this, a || [], !1))
    },
    not: function(a) {
      return this.pushStack(x(this, a || [], !0))
    },
    is: function(a) {
      return !!x(this, "string" == typeof a && u.test(a) ? n(a) : a || [], !1).length
    }
  });
  var y, z = a.document,
    A = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,
    B = n.fn.init = function(a, b) {
      var c, d;
      if (!a) return this;
      if ("string" == typeof a) {
        if (c = "<" === a.charAt(0) && ">" === a.charAt(a.length - 1) && a.length >= 3 ? [null, a, null] : A.exec(a), !c || !c[1] && b) return !b || b.jquery ? (b || y).find(a) : this.constructor(b).find(a);
        if (c[1]) {
          if (b = b instanceof n ? b[0] : b, n.merge(this, n.parseHTML(c[1], b && b.nodeType ? b.ownerDocument || b : z, !0)), v.test(c[1]) && n.isPlainObject(b))
            for (c in b) n.isFunction(this[c]) ? this[c](b[c]) : this.attr(c, b[c]);
          return this
        }
        if (d = z.getElementById(c[2]), d && d.parentNode) {
          if (d.id !== c[2]) return y.find(a);
          this.length = 1, this[0] = d
        }
        return this.context = z, this.selector = a, this
      }
      return a.nodeType ? (this.context = this[0] = a, this.length = 1, this) : n.isFunction(a) ? "undefined" != typeof y.ready ? y.ready(a) : a(n) : (void 0 !== a.selector && (this.selector = a.selector, this.context = a.context), n.makeArray(a, this))
    };
  B.prototype = n.fn, y = n(z);
  var C = /^(?:parents|prev(?:Until|All))/,
    D = {
      children: !0,
      contents: !0,
      next: !0,
      prev: !0
    };
  n.extend({
    dir: function(a, b, c) {
      var d = [],
        e = a[b];
      while (e && 9 !== e.nodeType && (void 0 === c || 1 !== e.nodeType || !n(e).is(c))) 1 === e.nodeType && d.push(e), e = e[b];
      return d
    },
    sibling: function(a, b) {
      for (var c = []; a; a = a.nextSibling) 1 === a.nodeType && a !== b && c.push(a);
      return c
    }
  }), n.fn.extend({
    has: function(a) {
      var b, c = n(a, this),
        d = c.length;
      return this.filter(function() {
        for (b = 0; d > b; b++)
          if (n.contains(this, c[b])) return !0
      })
    },
    closest: function(a, b) {
      for (var c, d = 0, e = this.length, f = [], g = u.test(a) || "string" != typeof a ? n(a, b || this.context) : 0; e > d; d++)
        for (c = this[d]; c && c !== b; c = c.parentNode)
          if (c.nodeType < 11 && (g ? g.index(c) > -1 : 1 === c.nodeType && n.find.matchesSelector(c, a))) {
            f.push(c);
            break
          }
      return this.pushStack(f.length > 1 ? n.unique(f) : f)
    },
    index: function(a) {
      return a ? "string" == typeof a ? n.inArray(this[0], n(a)) : n.inArray(a.jquery ? a[0] : a, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
    },
    add: function(a, b) {
      return this.pushStack(n.unique(n.merge(this.get(), n(a, b))))
    },
    addBack: function(a) {
      return this.add(null == a ? this.prevObject : this.prevObject.filter(a))
    }
  });

  function E(a, b) {
    do a = a[b]; while (a && 1 !== a.nodeType);
    return a
  }
  n.each({
    parent: function(a) {
      var b = a.parentNode;
      return b && 11 !== b.nodeType ? b : null
    },
    parents: function(a) {
      return n.dir(a, "parentNode")
    },
    parentsUntil: function(a, b, c) {
      return n.dir(a, "parentNode", c)
    },
    next: function(a) {
      return E(a, "nextSibling")
    },
    prev: function(a) {
      return E(a, "previousSibling")
    },
    nextAll: function(a) {
      return n.dir(a, "nextSibling")
    },
    prevAll: function(a) {
      return n.dir(a, "previousSibling")
    },
    nextUntil: function(a, b, c) {
      return n.dir(a, "nextSibling", c)
    },
    prevUntil: function(a, b, c) {
      return n.dir(a, "previousSibling", c)
    },
    siblings: function(a) {
      return n.sibling((a.parentNode || {}).firstChild, a)
    },
    children: function(a) {
      return n.sibling(a.firstChild)
    },
    contents: function(a) {
      return n.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : n.merge([], a.childNodes)
    }
  }, function(a, b) {
    n.fn[a] = function(c, d) {
      var e = n.map(this, b, c);
      return "Until" !== a.slice(-5) && (d = c), d && "string" == typeof d && (e = n.filter(d, e)), this.length > 1 && (D[a] || (e = n.unique(e)), C.test(a) && (e = e.reverse())), this.pushStack(e)
    }
  });
  var F = /\S+/g,
    G = {};

  function H(a) {
    var b = G[a] = {};
    return n.each(a.match(F) || [], function(a, c) {
      b[c] = !0
    }), b
  }
  n.Callbacks = function(a) {
    a = "string" == typeof a ? G[a] || H(a) : n.extend({}, a);
    var b, c, d, e, f, g, h = [],
      i = !a.once && [],
      j = function(l) {
        for (c = a.memory && l, d = !0, f = g || 0, g = 0, e = h.length, b = !0; h && e > f; f++)
          if (h[f].apply(l[0], l[1]) === !1 && a.stopOnFalse) {
            c = !1;
            break
          }
        b = !1, h && (i ? i.length && j(i.shift()) : c ? h = [] : k.disable())
      },
      k = {
        add: function() {
          if (h) {
            var d = h.length;
            ! function f(b) {
              n.each(b, function(b, c) {
                var d = n.type(c);
                "function" === d ? a.unique && k.has(c) || h.push(c) : c && c.length && "string" !== d && f(c)
              })
            }(arguments), b ? e = h.length : c && (g = d, j(c))
          }
          return this
        },
        remove: function() {
          return h && n.each(arguments, function(a, c) {
            var d;
            while ((d = n.inArray(c, h, d)) > -1) h.splice(d, 1), b && (e >= d && e--, f >= d && f--)
          }), this
        },
        has: function(a) {
          return a ? n.inArray(a, h) > -1 : !(!h || !h.length)
        },
        empty: function() {
          return h = [], e = 0, this
        },
        disable: function() {
          return h = i = c = void 0, this
        },
        disabled: function() {
          return !h
        },
        lock: function() {
          return i = void 0, c || k.disable(), this
        },
        locked: function() {
          return !i
        },
        fireWith: function(a, c) {
          return !h || d && !i || (c = c || [], c = [a, c.slice ? c.slice() : c], b ? i.push(c) : j(c)), this
        },
        fire: function() {
          return k.fireWith(this, arguments), this
        },
        fired: function() {
          return !!d
        }
      };
    return k
  }, n.extend({
    Deferred: function(a) {
      var b = [
          ["resolve", "done", n.Callbacks("once memory"), "resolved"],
          ["reject", "fail", n.Callbacks("once memory"), "rejected"],
          ["notify", "progress", n.Callbacks("memory")]
        ],
        c = "pending",
        d = {
          state: function() {
            return c
          },
          always: function() {
            return e.done(arguments).fail(arguments), this
          },
          then: function() {
            var a = arguments;
            return n.Deferred(function(c) {
              n.each(b, function(b, f) {
                var g = n.isFunction(a[b]) && a[b];
                e[f[1]](function() {
                  var a = g && g.apply(this, arguments);
                  a && n.isFunction(a.promise) ? a.promise().done(c.resolve).fail(c.reject).progress(c.notify) : c[f[0] + "With"](this === d ? c.promise() : this, g ? [a] : arguments)
                })
              }), a = null
            }).promise()
          },
          promise: function(a) {
            return null != a ? n.extend(a, d) : d
          }
        },
        e = {};
      return d.pipe = d.then, n.each(b, function(a, f) {
        var g = f[2],
          h = f[3];
        d[f[1]] = g.add, h && g.add(function() {
          c = h
        }, b[1 ^ a][2].disable, b[2][2].lock), e[f[0]] = function() {
          return e[f[0] + "With"](this === e ? d : this, arguments), this
        }, e[f[0] + "With"] = g.fireWith
      }), d.promise(e), a && a.call(e, e), e
    },
    when: function(a) {
      var b = 0,
        c = d.call(arguments),
        e = c.length,
        f = 1 !== e || a && n.isFunction(a.promise) ? e : 0,
        g = 1 === f ? a : n.Deferred(),
        h = function(a, b, c) {
          return function(e) {
            b[a] = this, c[a] = arguments.length > 1 ? d.call(arguments) : e, c === i ? g.notifyWith(b, c) : --f || g.resolveWith(b, c)
          }
        },
        i, j, k;
      if (e > 1)
        for (i = new Array(e), j = new Array(e), k = new Array(e); e > b; b++) c[b] && n.isFunction(c[b].promise) ? c[b].promise().done(h(b, k, c)).fail(g.reject).progress(h(b, j, i)) : --f;
      return f || g.resolveWith(k, c), g.promise()
    }
  });
  var I;
  n.fn.ready = function(a) {
    return n.ready.promise().done(a), this
  }, n.extend({
    isReady: !1,
    readyWait: 1,
    holdReady: function(a) {
      a ? n.readyWait++ : n.ready(!0)
    },
    ready: function(a) {
      if (a === !0 ? !--n.readyWait : !n.isReady) {
        if (!z.body) return setTimeout(n.ready);
        n.isReady = !0, a !== !0 && --n.readyWait > 0 || (I.resolveWith(z, [n]), n.fn.trigger && n(z).trigger("ready").off("ready"))
      }
    }
  });

  function J() {
    z.addEventListener ? (z.removeEventListener("DOMContentLoaded", K, !1), a.removeEventListener("load", K, !1)) : (z.detachEvent("onreadystatechange", K), a.detachEvent("onload", K))
  }

  function K() {
    (z.addEventListener || "load" === event.type || "complete" === z.readyState) && (J(), n.ready())
  }
  n.ready.promise = function(b) {
    if (!I)
      if (I = n.Deferred(), "complete" === z.readyState) setTimeout(n.ready);
      else if (z.addEventListener) z.addEventListener("DOMContentLoaded", K, !1), a.addEventListener("load", K, !1);
    else {
      z.attachEvent("onreadystatechange", K), a.attachEvent("onload", K);
      var c = !1;
      try {
        c = null == a.frameElement && z.documentElement
      } catch (d) {}
      c && c.doScroll && ! function e() {
        if (!n.isReady) {
          try {
            c.doScroll("left")
          } catch (a) {
            return setTimeout(e, 50)
          }
          J(), n.ready()
        }
      }()
    }
    return I.promise(b)
  };
  var L = "undefined",
    M;
  for (M in n(l)) break;
  l.ownLast = "0" !== M, l.inlineBlockNeedsLayout = !1, n(function() {
      var a, b, c = z.getElementsByTagName("body")[0];
      c && (a = z.createElement("div"), a.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", b = z.createElement("div"), c.appendChild(a).appendChild(b), typeof b.style.zoom !== L && (b.style.cssText = "border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1", (l.inlineBlockNeedsLayout = 3 === b.offsetWidth) && (c.style.zoom = 1)), c.removeChild(a), a = b = null)
    }),
    function() {
      var a = z.createElement("div");
      if (null == l.deleteExpando) {
        l.deleteExpando = !0;
        try {
          delete a.test
        } catch (b) {
          l.deleteExpando = !1
        }
      }
      a = null
    }(), n.acceptData = function(a) {
      var b = n.noData[(a.nodeName + " ").toLowerCase()],
        c = +a.nodeType || 1;
      return 1 !== c && 9 !== c ? !1 : !b || b !== !0 && a.getAttribute("classid") === b
    };
  var N = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
    O = /([A-Z])/g;

  function P(a, b, c) {
    if (void 0 === c && 1 === a.nodeType) {
      var d = "data-" + b.replace(O, "-$1").toLowerCase();
      if (c = a.getAttribute(d), "string" == typeof c) {
        try {
          c = "true" === c ? !0 : "false" === c ? !1 : "null" === c ? null : +c + "" === c ? +c : N.test(c) ? n.parseJSON(c) : c
        } catch (e) {}
        n.data(a, b, c)
      } else c = void 0
    }
    return c
  }

  function Q(a) {
    var b;
    for (b in a)
      if (("data" !== b || !n.isEmptyObject(a[b])) && "toJSON" !== b) return !1;
    return !0
  }

  function R(a, b, d, e) {
    if (n.acceptData(a)) {
      var f, g, h = n.expando,
        i = a.nodeType,
        j = i ? n.cache : a,
        k = i ? a[h] : a[h] && h;
      if (k && j[k] && (e || j[k].data) || void 0 !== d || "string" != typeof b) return k || (k = i ? a[h] = c.pop() || n.guid++ : h), j[k] || (j[k] = i ? {} : {
        toJSON: n.noop
      }), ("object" == typeof b || "function" == typeof b) && (e ? j[k] = n.extend(j[k], b) : j[k].data = n.extend(j[k].data, b)), g = j[k], e || (g.data || (g.data = {}), g = g.data), void 0 !== d && (g[n.camelCase(b)] = d), "string" == typeof b ? (f = g[b], null == f && (f = g[n.camelCase(b)])) : f = g, f
    }
  }

  function S(a, b, c) {
    if (n.acceptData(a)) {
      var d, e, f = a.nodeType,
        g = f ? n.cache : a,
        h = f ? a[n.expando] : n.expando;
      if (g[h]) {
        if (b && (d = c ? g[h] : g[h].data)) {
          n.isArray(b) ? b = b.concat(n.map(b, n.camelCase)) : b in d ? b = [b] : (b = n.camelCase(b), b = b in d ? [b] : b.split(" ")), e = b.length;
          while (e--) delete d[b[e]];
          if (c ? !Q(d) : !n.isEmptyObject(d)) return
        }(c || (delete g[h].data, Q(g[h]))) && (f ? n.cleanData([a], !0) : l.deleteExpando || g != g.window ? delete g[h] : g[h] = null)
      }
    }
  }
  n.extend({
    cache: {},
    noData: {
      "applet ": !0,
      "embed ": !0,
      "object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
    },
    hasData: function(a) {
      return a = a.nodeType ? n.cache[a[n.expando]] : a[n.expando], !!a && !Q(a)
    },
    data: function(a, b, c) {
      return R(a, b, c)
    },
    removeData: function(a, b) {
      return S(a, b)
    },
    _data: function(a, b, c) {
      return R(a, b, c, !0)
    },
    _removeData: function(a, b) {
      return S(a, b, !0)
    }
  }), n.fn.extend({
    data: function(a, b) {
      var c, d, e, f = this[0],
        g = f && f.attributes;
      if (void 0 === a) {
        if (this.length && (e = n.data(f), 1 === f.nodeType && !n._data(f, "parsedAttrs"))) {
          c = g.length;
          while (c--) d = g[c].name, 0 === d.indexOf("data-") && (d = n.camelCase(d.slice(5)), P(f, d, e[d]));
          n._data(f, "parsedAttrs", !0)
        }
        return e
      }
      return "object" == typeof a ? this.each(function() {
        n.data(this, a)
      }) : arguments.length > 1 ? this.each(function() {
        n.data(this, a, b)
      }) : f ? P(f, a, n.data(f, a)) : void 0
    },
    removeData: function(a) {
      return this.each(function() {
        n.removeData(this, a)
      })
    }
  }), n.extend({
    queue: function(a, b, c) {
      var d;
      return a ? (b = (b || "fx") + "queue", d = n._data(a, b), c && (!d || n.isArray(c) ? d = n._data(a, b, n.makeArray(c)) : d.push(c)), d || []) : void 0
    },
    dequeue: function(a, b) {
      b = b || "fx";
      var c = n.queue(a, b),
        d = c.length,
        e = c.shift(),
        f = n._queueHooks(a, b),
        g = function() {
          n.dequeue(a, b)
        };
      "inprogress" === e && (e = c.shift(), d--), e && ("fx" === b && c.unshift("inprogress"), delete f.stop, e.call(a, g, f)), !d && f && f.empty.fire()
    },
    _queueHooks: function(a, b) {
      var c = b + "queueHooks";
      return n._data(a, c) || n._data(a, c, {
        empty: n.Callbacks("once memory").add(function() {
          n._removeData(a, b + "queue"), n._removeData(a, c)
        })
      })
    }
  }), n.fn.extend({
    queue: function(a, b) {
      var c = 2;
      return "string" != typeof a && (b = a, a = "fx", c--), arguments.length < c ? n.queue(this[0], a) : void 0 === b ? this : this.each(function() {
        var c = n.queue(this, a, b);
        n._queueHooks(this, a), "fx" === a && "inprogress" !== c[0] && n.dequeue(this, a)
      })
    },
    dequeue: function(a) {
      return this.each(function() {
        n.dequeue(this, a)
      })
    },
    clearQueue: function(a) {
      return this.queue(a || "fx", [])
    },
    promise: function(a, b) {
      var c, d = 1,
        e = n.Deferred(),
        f = this,
        g = this.length,
        h = function() {
          --d || e.resolveWith(f, [f])
        };
      "string" != typeof a && (b = a, a = void 0), a = a || "fx";
      while (g--) c = n._data(f[g], a + "queueHooks"), c && c.empty && (d++, c.empty.add(h));
      return h(), e.promise(b)
    }
  });
  var T = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
    U = ["Top", "Right", "Bottom", "Left"],
    V = function(a, b) {
      return a = b || a, "none" === n.css(a, "display") || !n.contains(a.ownerDocument, a)
    },
    W = n.access = function(a, b, c, d, e, f, g) {
      var h = 0,
        i = a.length,
        j = null == c;
      if ("object" === n.type(c)) {
        e = !0;
        for (h in c) n.access(a, b, h, c[h], !0, f, g)
      } else if (void 0 !== d && (e = !0, n.isFunction(d) || (g = !0), j && (g ? (b.call(a, d), b = null) : (j = b, b = function(a, b, c) {
          return j.call(n(a), c)
        })), b))
        for (; i > h; h++) b(a[h], c, g ? d : d.call(a[h], h, b(a[h], c)));
      return e ? a : j ? b.call(a) : i ? b(a[0], c) : f
    },
    X = /^(?:checkbox|radio)$/i;
  ! function() {
    var a = z.createDocumentFragment(),
      b = z.createElement("div"),
      c = z.createElement("input");
    if (b.setAttribute("className", "t"), b.innerHTML = "  <link/><table></table><a href='/a'>a</a>", l.leadingWhitespace = 3 === b.firstChild.nodeType, l.tbody = !b.getElementsByTagName("tbody").length, l.htmlSerialize = !!b.getElementsByTagName("link").length, l.html5Clone = "<:nav></:nav>" !== z.createElement("nav").cloneNode(!0).outerHTML, c.type = "checkbox", c.checked = !0, a.appendChild(c), l.appendChecked = c.checked, b.innerHTML = "<textarea>x</textarea>", l.noCloneChecked = !!b.cloneNode(!0).lastChild.defaultValue, a.appendChild(b), b.innerHTML = "<input type='radio' checked='checked' name='t'/>", l.checkClone = b.cloneNode(!0).cloneNode(!0).lastChild.checked, l.noCloneEvent = !0, b.attachEvent && (b.attachEvent("onclick", function() {
        l.noCloneEvent = !1
      }), b.cloneNode(!0).click()), null == l.deleteExpando) {
      l.deleteExpando = !0;
      try {
        delete b.test
      } catch (d) {
        l.deleteExpando = !1
      }
    }
    a = b = c = null
  }(),
  function() {
    var b, c, d = z.createElement("div");
    for (b in {
        submit: !0,
        change: !0,
        focusin: !0
      }) c = "on" + b, (l[b + "Bubbles"] = c in a) || (d.setAttribute(c, "t"), l[b + "Bubbles"] = d.attributes[c].expando === !1);
    d = null
  }();
  var Y = /^(?:input|select|textarea)$/i,
    Z = /^key/,
    $ = /^(?:mouse|contextmenu)|click/,
    _ = /^(?:focusinfocus|focusoutblur)$/,
    ab = /^([^.]*)(?:\.(.+)|)$/;

  function bb() {
    return !0
  }

  function cb() {
    return !1
  }

  function db() {
    try {
      return z.activeElement
    } catch (a) {}
  }
  n.event = {
    global: {},
    add: function(a, b, c, d, e) {
      var f, g, h, i, j, k, l, m, o, p, q, r = n._data(a);
      if (r) {
        c.handler && (i = c, c = i.handler, e = i.selector), c.guid || (c.guid = n.guid++), (g = r.events) || (g = r.events = {}), (k = r.handle) || (k = r.handle = function(a) {
          return typeof n === L || a && n.event.triggered === a.type ? void 0 : n.event.dispatch.apply(k.elem, arguments)
        }, k.elem = a), b = (b || "").match(F) || [""], h = b.length;
        while (h--) f = ab.exec(b[h]) || [], o = q = f[1], p = (f[2] || "").split(".").sort(), o && (j = n.event.special[o] || {}, o = (e ? j.delegateType : j.bindType) || o, j = n.event.special[o] || {}, l = n.extend({
          type: o,
          origType: q,
          data: d,
          handler: c,
          guid: c.guid,
          selector: e,
          needsContext: e && n.expr.match.needsContext.test(e),
          namespace: p.join(".")
        }, i), (m = g[o]) || (m = g[o] = [], m.delegateCount = 0, j.setup && j.setup.call(a, d, p, k) !== !1 || (a.addEventListener ? a.addEventListener(o, k, !1) : a.attachEvent && a.attachEvent("on" + o, k))), j.add && (j.add.call(a, l), l.handler.guid || (l.handler.guid = c.guid)), e ? m.splice(m.delegateCount++, 0, l) : m.push(l), n.event.global[o] = !0);
        a = null
      }
    },
    remove: function(a, b, c, d, e) {
      var f, g, h, i, j, k, l, m, o, p, q, r = n.hasData(a) && n._data(a);
      if (r && (k = r.events)) {
        b = (b || "").match(F) || [""], j = b.length;
        while (j--)
          if (h = ab.exec(b[j]) || [], o = q = h[1], p = (h[2] || "").split(".").sort(), o) {
            l = n.event.special[o] || {}, o = (d ? l.delegateType : l.bindType) || o, m = k[o] || [], h = h[2] && new RegExp("(^|\\.)" + p.join("\\.(?:.*\\.|)") + "(\\.|$)"), i = f = m.length;
            while (f--) g = m[f], !e && q !== g.origType || c && c.guid !== g.guid || h && !h.test(g.namespace) || d && d !== g.selector && ("**" !== d || !g.selector) || (m.splice(f, 1), g.selector && m.delegateCount--, l.remove && l.remove.call(a, g));
            i && !m.length && (l.teardown && l.teardown.call(a, p, r.handle) !== !1 || n.removeEvent(a, o, r.handle), delete k[o])
          } else
            for (o in k) n.event.remove(a, o + b[j], c, d, !0);
        n.isEmptyObject(k) && (delete r.handle, n._removeData(a, "events"))
      }
    },
    trigger: function(b, c, d, e) {
      var f, g, h, i, k, l, m, o = [d || z],
        p = j.call(b, "type") ? b.type : b,
        q = j.call(b, "namespace") ? b.namespace.split(".") : [];
      if (h = l = d = d || z, 3 !== d.nodeType && 8 !== d.nodeType && !_.test(p + n.event.triggered) && (p.indexOf(".") >= 0 && (q = p.split("."), p = q.shift(), q.sort()), g = p.indexOf(":") < 0 && "on" + p, b = b[n.expando] ? b : new n.Event(p, "object" == typeof b && b), b.isTrigger = e ? 2 : 3, b.namespace = q.join("."), b.namespace_re = b.namespace ? new RegExp("(^|\\.)" + q.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, b.result = void 0, b.target || (b.target = d), c = null == c ? [b] : n.makeArray(c, [b]), k = n.event.special[p] || {}, e || !k.trigger || k.trigger.apply(d, c) !== !1)) {
        if (!e && !k.noBubble && !n.isWindow(d)) {
          for (i = k.delegateType || p, _.test(i + p) || (h = h.parentNode); h; h = h.parentNode) o.push(h), l = h;
          l === (d.ownerDocument || z) && o.push(l.defaultView || l.parentWindow || a)
        }
        m = 0;
        while ((h = o[m++]) && !b.isPropagationStopped()) b.type = m > 1 ? i : k.bindType || p, f = (n._data(h, "events") || {})[b.type] && n._data(h, "handle"), f && f.apply(h, c), f = g && h[g], f && f.apply && n.acceptData(h) && (b.result = f.apply(h, c), b.result === !1 && b.preventDefault());
        if (b.type = p, !e && !b.isDefaultPrevented() && (!k._default || k._default.apply(o.pop(), c) === !1) && n.acceptData(d) && g && d[p] && !n.isWindow(d)) {
          l = d[g], l && (d[g] = null), n.event.triggered = p;
          try {
            d[p]()
          } catch (r) {}
          n.event.triggered = void 0, l && (d[g] = l)
        }
        return b.result
      }
    },
    dispatch: function(a) {
      a = n.event.fix(a);
      var b, c, e, f, g, h = [],
        i = d.call(arguments),
        j = (n._data(this, "events") || {})[a.type] || [],
        k = n.event.special[a.type] || {};
      if (i[0] = a, a.delegateTarget = this, !k.preDispatch || k.preDispatch.call(this, a) !== !1) {
        h = n.event.handlers.call(this, a, j), b = 0;
        while ((f = h[b++]) && !a.isPropagationStopped()) {
          a.currentTarget = f.elem, g = 0;
          while ((e = f.handlers[g++]) && !a.isImmediatePropagationStopped())(!a.namespace_re || a.namespace_re.test(e.namespace)) && (a.handleObj = e, a.data = e.data, c = ((n.event.special[e.origType] || {}).handle || e.handler).apply(f.elem, i), void 0 !== c && (a.result = c) === !1 && (a.preventDefault(), a.stopPropagation()))
        }
        return k.postDispatch && k.postDispatch.call(this, a), a.result
      }
    },
    handlers: function(a, b) {
      var c, d, e, f, g = [],
        h = b.delegateCount,
        i = a.target;
      if (h && i.nodeType && (!a.button || "click" !== a.type))
        for (; i != this; i = i.parentNode || this)
          if (1 === i.nodeType && (i.disabled !== !0 || "click" !== a.type)) {
            for (e = [], f = 0; h > f; f++) d = b[f], c = d.selector + " ", void 0 === e[c] && (e[c] = d.needsContext ? n(c, this).index(i) >= 0 : n.find(c, this, null, [i]).length), e[c] && e.push(d);
            e.length && g.push({
              elem: i,
              handlers: e
            })
          }
      return h < b.length && g.push({
        elem: this,
        handlers: b.slice(h)
      }), g
    },
    fix: function(a) {
      if (a[n.expando]) return a;
      var b, c, d, e = a.type,
        f = a,
        g = this.fixHooks[e];
      g || (this.fixHooks[e] = g = $.test(e) ? this.mouseHooks : Z.test(e) ? this.keyHooks : {}), d = g.props ? this.props.concat(g.props) : this.props, a = new n.Event(f), b = d.length;
      while (b--) c = d[b], a[c] = f[c];
      return a.target || (a.target = f.srcElement || z), 3 === a.target.nodeType && (a.target = a.target.parentNode), a.metaKey = !!a.metaKey, g.filter ? g.filter(a, f) : a
    },
    props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
    fixHooks: {},
    keyHooks: {
      props: "char charCode key keyCode".split(" "),
      filter: function(a, b) {
        return null == a.which && (a.which = null != b.charCode ? b.charCode : b.keyCode), a
      }
    },
    mouseHooks: {
      props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
      filter: function(a, b) {
        var c, d, e, f = b.button,
          g = b.fromElement;
        return null == a.pageX && null != b.clientX && (d = a.target.ownerDocument || z, e = d.documentElement, c = d.body, a.pageX = b.clientX + (e && e.scrollLeft || c && c.scrollLeft || 0) - (e && e.clientLeft || c && c.clientLeft || 0), a.pageY = b.clientY + (e && e.scrollTop || c && c.scrollTop || 0) - (e && e.clientTop || c && c.clientTop || 0)), !a.relatedTarget && g && (a.relatedTarget = g === a.target ? b.toElement : g), a.which || void 0 === f || (a.which = 1 & f ? 1 : 2 & f ? 3 : 4 & f ? 2 : 0), a
      }
    },
    special: {
      load: {
        noBubble: !0
      },
      focus: {
        trigger: function() {
          if (this !== db() && this.focus) try {
            return this.focus(), !1
          } catch (a) {}
        },
        delegateType: "focusin"
      },
      blur: {
        trigger: function() {
          return this === db() && this.blur ? (this.blur(), !1) : void 0
        },
        delegateType: "focusout"
      },
      click: {
        trigger: function() {
          return n.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : void 0
        },
        _default: function(a) {
          return n.nodeName(a.target, "a")
        }
      },
      beforeunload: {
        postDispatch: function(a) {
          void 0 !== a.result && (a.originalEvent.returnValue = a.result)
        }
      }
    },
    simulate: function(a, b, c, d) {
      var e = n.extend(new n.Event, c, {
        type: a,
        isSimulated: !0,
        originalEvent: {}
      });
      d ? n.event.trigger(e, null, b) : n.event.dispatch.call(b, e), e.isDefaultPrevented() && c.preventDefault()
    }
  }, n.removeEvent = z.removeEventListener ? function(a, b, c) {
    a.removeEventListener && a.removeEventListener(b, c, !1)
  } : function(a, b, c) {
    var d = "on" + b;
    a.detachEvent && (typeof a[d] === L && (a[d] = null), a.detachEvent(d, c))
  }, n.Event = function(a, b) {
    return this instanceof n.Event ? (a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || void 0 === a.defaultPrevented && (a.returnValue === !1 || a.getPreventDefault && a.getPreventDefault()) ? bb : cb) : this.type = a, b && n.extend(this, b), this.timeStamp = a && a.timeStamp || n.now(), void(this[n.expando] = !0)) : new n.Event(a, b)
  }, n.Event.prototype = {
    isDefaultPrevented: cb,
    isPropagationStopped: cb,
    isImmediatePropagationStopped: cb,
    preventDefault: function() {
      var a = this.originalEvent;
      this.isDefaultPrevented = bb, a && (a.preventDefault ? a.preventDefault() : a.returnValue = !1)
    },
    stopPropagation: function() {
      var a = this.originalEvent;
      this.isPropagationStopped = bb, a && (a.stopPropagation && a.stopPropagation(), a.cancelBubble = !0)
    },
    stopImmediatePropagation: function() {
      this.isImmediatePropagationStopped = bb, this.stopPropagation()
    }
  }, n.each({
    mouseenter: "mouseover",
    mouseleave: "mouseout"
  }, function(a, b) {
    n.event.special[a] = {
      delegateType: b,
      bindType: b,
      handle: function(a) {
        var c, d = this,
          e = a.relatedTarget,
          f = a.handleObj;
        return (!e || e !== d && !n.contains(d, e)) && (a.type = f.origType, c = f.handler.apply(this, arguments), a.type = b), c
      }
    }
  }), l.submitBubbles || (n.event.special.submit = {
    setup: function() {
      return n.nodeName(this, "form") ? !1 : void n.event.add(this, "click._submit keypress._submit", function(a) {
        var b = a.target,
          c = n.nodeName(b, "input") || n.nodeName(b, "button") ? b.form : void 0;
        c && !n._data(c, "submitBubbles") && (n.event.add(c, "submit._submit", function(a) {
          a._submit_bubble = !0
        }), n._data(c, "submitBubbles", !0))
      })
    },
    postDispatch: function(a) {
      a._submit_bubble && (delete a._submit_bubble, this.parentNode && !a.isTrigger && n.event.simulate("submit", this.parentNode, a, !0))
    },
    teardown: function() {
      return n.nodeName(this, "form") ? !1 : void n.event.remove(this, "._submit")
    }
  }), l.changeBubbles || (n.event.special.change = {
    setup: function() {
      return Y.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (n.event.add(this, "propertychange._change", function(a) {
        "checked" === a.originalEvent.propertyName && (this._just_changed = !0)
      }), n.event.add(this, "click._change", function(a) {
        this._just_changed && !a.isTrigger && (this._just_changed = !1), n.event.simulate("change", this, a, !0)
      })), !1) : void n.event.add(this, "beforeactivate._change", function(a) {
        var b = a.target;
        Y.test(b.nodeName) && !n._data(b, "changeBubbles") && (n.event.add(b, "change._change", function(a) {
          !this.parentNode || a.isSimulated || a.isTrigger || n.event.simulate("change", this.parentNode, a, !0)
        }), n._data(b, "changeBubbles", !0))
      })
    },
    handle: function(a) {
      var b = a.target;
      return this !== b || a.isSimulated || a.isTrigger || "radio" !== b.type && "checkbox" !== b.type ? a.handleObj.handler.apply(this, arguments) : void 0
    },
    teardown: function() {
      return n.event.remove(this, "._change"), !Y.test(this.nodeName)
    }
  }), l.focusinBubbles || n.each({
    focus: "focusin",
    blur: "focusout"
  }, function(a, b) {
    var c = function(a) {
      n.event.simulate(b, a.target, n.event.fix(a), !0)
    };
    n.event.special[b] = {
      setup: function() {
        var d = this.ownerDocument || this,
          e = n._data(d, b);
        e || d.addEventListener(a, c, !0), n._data(d, b, (e || 0) + 1)
      },
      teardown: function() {
        var d = this.ownerDocument || this,
          e = n._data(d, b) - 1;
        e ? n._data(d, b, e) : (d.removeEventListener(a, c, !0), n._removeData(d, b))
      }
    }
  }), n.fn.extend({
    on: function(a, b, c, d, e) {
      var f, g;
      if ("object" == typeof a) {
        "string" != typeof b && (c = c || b, b = void 0);
        for (f in a) this.on(f, b, c, a[f], e);
        return this
      }
      if (null == c && null == d ? (d = b, c = b = void 0) : null == d && ("string" == typeof b ? (d = c, c = void 0) : (d = c, c = b, b = void 0)), d === !1) d = cb;
      else if (!d) return this;
      return 1 === e && (g = d, d = function(a) {
        return n().off(a), g.apply(this, arguments)
      }, d.guid = g.guid || (g.guid = n.guid++)), this.each(function() {
        n.event.add(this, a, d, c, b)
      })
    },
    one: function(a, b, c, d) {
      return this.on(a, b, c, d, 1)
    },
    off: function(a, b, c) {
      var d, e;
      if (a && a.preventDefault && a.handleObj) return d = a.handleObj, n(a.delegateTarget).off(d.namespace ? d.origType + "." + d.namespace : d.origType, d.selector, d.handler), this;
      if ("object" == typeof a) {
        for (e in a) this.off(e, b, a[e]);
        return this
      }
      return (b === !1 || "function" == typeof b) && (c = b, b = void 0), c === !1 && (c = cb), this.each(function() {
        n.event.remove(this, a, c, b)
      })
    },
    trigger: function(a, b) {
      return this.each(function() {
        n.event.trigger(a, b, this)
      })
    },
    triggerHandler: function(a, b) {
      var c = this[0];
      return c ? n.event.trigger(a, b, c, !0) : void 0
    }
  });

  function eb(a) {
    var b = fb.split("|"),
      c = a.createDocumentFragment();
    if (c.createElement)
      while (b.length) c.createElement(b.pop());
    return c
  }
  var fb = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
    gb = / jQuery\d+="(?:null|\d+)"/g,
    hb = new RegExp("<(?:" + fb + ")[\\s/>]", "i"),
    ib = /^\s+/,
    jb = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
    kb = /<([\w:]+)/,
    lb = /<tbody/i,
    mb = /<|&#?\w+;/,
    nb = /<(?:script|style|link)/i,
    ob = /checked\s*(?:[^=]|=\s*.checked.)/i,
    pb = /^$|\/(?:java|ecma)script/i,
    qb = /^true\/(.*)/,
    rb = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,
    sb = {
      option: [1, "<select multiple='multiple'>", "</select>"],
      legend: [1, "<fieldset>", "</fieldset>"],
      area: [1, "<map>", "</map>"],
      param: [1, "<object>", "</object>"],
      thead: [1, "<table>", "</table>"],
      tr: [2, "<table><tbody>", "</tbody></table>"],
      col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
      td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
      _default: l.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]
    },
    tb = eb(z),
    ub = tb.appendChild(z.createElement("div"));
  sb.optgroup = sb.option, sb.tbody = sb.tfoot = sb.colgroup = sb.caption = sb.thead, sb.th = sb.td;

  function vb(a, b) {
    var c, d, e = 0,
      f = typeof a.getElementsByTagName !== L ? a.getElementsByTagName(b || "*") : typeof a.querySelectorAll !== L ? a.querySelectorAll(b || "*") : void 0;
    if (!f)
      for (f = [], c = a.childNodes || a; null != (d = c[e]); e++) !b || n.nodeName(d, b) ? f.push(d) : n.merge(f, vb(d, b));
    return void 0 === b || b && n.nodeName(a, b) ? n.merge([a], f) : f
  }

  function wb(a) {
    X.test(a.type) && (a.defaultChecked = a.checked)
  }

  function xb(a, b) {
    return n.nodeName(a, "table") && n.nodeName(11 !== b.nodeType ? b : b.firstChild, "tr") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a
  }

  function yb(a) {
    return a.type = (null !== n.find.attr(a, "type")) + "/" + a.type, a
  }

  function zb(a) {
    var b = qb.exec(a.type);
    return b ? a.type = b[1] : a.removeAttribute("type"), a
  }

  function Ab(a, b) {
    for (var c, d = 0; null != (c = a[d]); d++) n._data(c, "globalEval", !b || n._data(b[d], "globalEval"))
  }

  function Bb(a, b) {
    if (1 === b.nodeType && n.hasData(a)) {
      var c, d, e, f = n._data(a),
        g = n._data(b, f),
        h = f.events;
      if (h) {
        delete g.handle, g.events = {};
        for (c in h)
          for (d = 0, e = h[c].length; e > d; d++) n.event.add(b, c, h[c][d])
      }
      g.data && (g.data = n.extend({}, g.data))
    }
  }

  function Cb(a, b) {
    var c, d, e;
    if (1 === b.nodeType) {
      if (c = b.nodeName.toLowerCase(), !l.noCloneEvent && b[n.expando]) {
        e = n._data(b);
        for (d in e.events) n.removeEvent(b, d, e.handle);
        b.removeAttribute(n.expando)
      }
      "script" === c && b.text !== a.text ? (yb(b).text = a.text, zb(b)) : "object" === c ? (b.parentNode && (b.outerHTML = a.outerHTML), l.html5Clone && a.innerHTML && !n.trim(b.innerHTML) && (b.innerHTML = a.innerHTML)) : "input" === c && X.test(a.type) ? (b.defaultChecked = b.checked = a.checked, b.value !== a.value && (b.value = a.value)) : "option" === c ? b.defaultSelected = b.selected = a.defaultSelected : ("input" === c || "textarea" === c) && (b.defaultValue = a.defaultValue)
    }
  }
  n.extend({
    clone: function(a, b, c) {
      var d, e, f, g, h, i = n.contains(a.ownerDocument, a);
      if (l.html5Clone || n.isXMLDoc(a) || !hb.test("<" + a.nodeName + ">") ? f = a.cloneNode(!0) : (ub.innerHTML = a.outerHTML, ub.removeChild(f = ub.firstChild)), !(l.noCloneEvent && l.noCloneChecked || 1 !== a.nodeType && 11 !== a.nodeType || n.isXMLDoc(a)))
        for (d = vb(f), h = vb(a), g = 0; null != (e = h[g]); ++g) d[g] && Cb(e, d[g]);
      if (b)
        if (c)
          for (h = h || vb(a), d = d || vb(f), g = 0; null != (e = h[g]); g++) Bb(e, d[g]);
        else Bb(a, f);
      return d = vb(f, "script"), d.length > 0 && Ab(d, !i && vb(a, "script")), d = h = e = null, f
    },
    buildFragment: function(a, b, c, d) {
      for (var e, f, g, h, i, j, k, m = a.length, o = eb(b), p = [], q = 0; m > q; q++)
        if (f = a[q], f || 0 === f)
          if ("object" === n.type(f)) n.merge(p, f.nodeType ? [f] : f);
          else if (mb.test(f)) {
        h = h || o.appendChild(b.createElement("div")), i = (kb.exec(f) || ["", ""])[1].toLowerCase(), k = sb[i] || sb._default, h.innerHTML = k[1] + f.replace(jb, "<$1></$2>") + k[2], e = k[0];
        while (e--) h = h.lastChild;
        if (!l.leadingWhitespace && ib.test(f) && p.push(b.createTextNode(ib.exec(f)[0])), !l.tbody) {
          f = "table" !== i || lb.test(f) ? "<table>" !== k[1] || lb.test(f) ? 0 : h : h.firstChild, e = f && f.childNodes.length;
          while (e--) n.nodeName(j = f.childNodes[e], "tbody") && !j.childNodes.length && f.removeChild(j)
        }
        n.merge(p, h.childNodes), h.textContent = "";
        while (h.firstChild) h.removeChild(h.firstChild);
        h = o.lastChild
      } else p.push(b.createTextNode(f));
      h && o.removeChild(h), l.appendChecked || n.grep(vb(p, "input"), wb), q = 0;
      while (f = p[q++])
        if ((!d || -1 === n.inArray(f, d)) && (g = n.contains(f.ownerDocument, f), h = vb(o.appendChild(f), "script"), g && Ab(h), c)) {
          e = 0;
          while (f = h[e++]) pb.test(f.type || "") && c.push(f)
        }
      return h = null, o
    },
    cleanData: function(a, b) {
      for (var d, e, f, g, h = 0, i = n.expando, j = n.cache, k = l.deleteExpando, m = n.event.special; null != (d = a[h]); h++)
        if ((b || n.acceptData(d)) && (f = d[i], g = f && j[f])) {
          if (g.events)
            for (e in g.events) m[e] ? n.event.remove(d, e) : n.removeEvent(d, e, g.handle);
          j[f] && (delete j[f], k ? delete d[i] : typeof d.removeAttribute !== L ? d.removeAttribute(i) : d[i] = null, c.push(f))
        }
    }
  }), n.fn.extend({
    text: function(a) {
      return W(this, function(a) {
        return void 0 === a ? n.text(this) : this.empty().append((this[0] && this[0].ownerDocument || z).createTextNode(a))
      }, null, a, arguments.length)
    },
    append: function() {
      return this.domManip(arguments, function(a) {
        if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
          var b = xb(this, a);
          b.appendChild(a)
        }
      })
    },
    prepend: function() {
      return this.domManip(arguments, function(a) {
        if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
          var b = xb(this, a);
          b.insertBefore(a, b.firstChild)
        }
      })
    },
    before: function() {
      return this.domManip(arguments, function(a) {
        this.parentNode && this.parentNode.insertBefore(a, this)
      })
    },
    after: function() {
      return this.domManip(arguments, function(a) {
        this.parentNode && this.parentNode.insertBefore(a, this.nextSibling)
      })
    },
    remove: function(a, b) {
      for (var c, d = a ? n.filter(a, this) : this, e = 0; null != (c = d[e]); e++) b || 1 !== c.nodeType || n.cleanData(vb(c)), c.parentNode && (b && n.contains(c.ownerDocument, c) && Ab(vb(c, "script")), c.parentNode.removeChild(c));
      return this
    },
    empty: function() {
      for (var a, b = 0; null != (a = this[b]); b++) {
        1 === a.nodeType && n.cleanData(vb(a, !1));
        while (a.firstChild) a.removeChild(a.firstChild);
        a.options && n.nodeName(a, "select") && (a.options.length = 0)
      }
      return this
    },
    clone: function(a, b) {
      return a = null == a ? !1 : a, b = null == b ? a : b, this.map(function() {
        return n.clone(this, a, b)
      })
    },
    html: function(a) {
      return W(this, function(a) {
        var b = this[0] || {},
          c = 0,
          d = this.length;
        if (void 0 === a) return 1 === b.nodeType ? b.innerHTML.replace(gb, "") : void 0;
        if (!("string" != typeof a || nb.test(a) || !l.htmlSerialize && hb.test(a) || !l.leadingWhitespace && ib.test(a) || sb[(kb.exec(a) || ["", ""])[1].toLowerCase()])) {
          a = a.replace(jb, "<$1></$2>");
          try {
            for (; d > c; c++) b = this[c] || {}, 1 === b.nodeType && (n.cleanData(vb(b, !1)), b.innerHTML = a);
            b = 0
          } catch (e) {}
        }
        b && this.empty().append(a)
      }, null, a, arguments.length)
    },
    replaceWith: function() {
      var a = arguments[0];
      return this.domManip(arguments, function(b) {
        a = this.parentNode, n.cleanData(vb(this)), a && a.replaceChild(b, this)
      }), a && (a.length || a.nodeType) ? this : this.remove()
    },
    detach: function(a) {
      return this.remove(a, !0)
    },
    domManip: function(a, b) {
      a = e.apply([], a);
      var c, d, f, g, h, i, j = 0,
        k = this.length,
        m = this,
        o = k - 1,
        p = a[0],
        q = n.isFunction(p);
      if (q || k > 1 && "string" == typeof p && !l.checkClone && ob.test(p)) return this.each(function(c) {
        var d = m.eq(c);
        q && (a[0] = p.call(this, c, d.html())), d.domManip(a, b)
      });
      if (k && (i = n.buildFragment(a, this[0].ownerDocument, !1, this), c = i.firstChild, 1 === i.childNodes.length && (i = c), c)) {
        for (g = n.map(vb(i, "script"), yb), f = g.length; k > j; j++) d = i, j !== o && (d = n.clone(d, !0, !0), f && n.merge(g, vb(d, "script"))), b.call(this[j], d, j);
        if (f)
          for (h = g[g.length - 1].ownerDocument, n.map(g, zb), j = 0; f > j; j++) d = g[j], pb.test(d.type || "") && !n._data(d, "globalEval") && n.contains(h, d) && (d.src ? n._evalUrl && n._evalUrl(d.src) : n.globalEval((d.text || d.textContent || d.innerHTML || "").replace(rb, "")));
        i = c = null
      }
      return this
    }
  }), n.each({
    appendTo: "append",
    prependTo: "prepend",
    insertBefore: "before",
    insertAfter: "after",
    replaceAll: "replaceWith"
  }, function(a, b) {
    n.fn[a] = function(a) {
      for (var c, d = 0, e = [], g = n(a), h = g.length - 1; h >= d; d++) c = d === h ? this : this.clone(!0), n(g[d])[b](c), f.apply(e, c.get());
      return this.pushStack(e)
    }
  });
  var Db, Eb = {};

  function Fb(b, c) {
    var d = n(c.createElement(b)).appendTo(c.body),
      e = a.getDefaultComputedStyle ? a.getDefaultComputedStyle(d[0]).display : n.css(d[0], "display");
    return d.detach(), e
  }

  function Gb(a) {
    var b = z,
      c = Eb[a];
    return c || (c = Fb(a, b), "none" !== c && c || (Db = (Db || n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement), b = (Db[0].contentWindow || Db[0].contentDocument).document, b.write(), b.close(), c = Fb(a, b), Db.detach()), Eb[a] = c), c
  }! function() {
    var a, b, c = z.createElement("div"),
      d = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";
    c.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", a = c.getElementsByTagName("a")[0], a.style.cssText = "float:left;opacity:.5", l.opacity = /^0.5/.test(a.style.opacity), l.cssFloat = !!a.style.cssFloat, c.style.backgroundClip = "content-box", c.cloneNode(!0).style.backgroundClip = "", l.clearCloneStyle = "content-box" === c.style.backgroundClip, a = c = null, l.shrinkWrapBlocks = function() {
      var a, c, e, f;
      if (null == b) {
        if (a = z.getElementsByTagName("body")[0], !a) return;
        f = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px", c = z.createElement("div"), e = z.createElement("div"), a.appendChild(c).appendChild(e), b = !1, typeof e.style.zoom !== L && (e.style.cssText = d + ";width:1px;padding:1px;zoom:1", e.innerHTML = "<div></div>", e.firstChild.style.width = "5px", b = 3 !== e.offsetWidth), a.removeChild(c), a = c = e = null
      }
      return b
    }
  }();
  var Hb = /^margin/,
    Ib = new RegExp("^(" + T + ")(?!px)[a-z%]+$", "i"),
    Jb, Kb, Lb = /^(top|right|bottom|left)$/;
  a.getComputedStyle ? (Jb = function(a) {
    return a.ownerDocument.defaultView.getComputedStyle(a, null)
  }, Kb = function(a, b, c) {
    var d, e, f, g, h = a.style;
    return c = c || Jb(a), g = c ? c.getPropertyValue(b) || c[b] : void 0, c && ("" !== g || n.contains(a.ownerDocument, a) || (g = n.style(a, b)), Ib.test(g) && Hb.test(b) && (d = h.width, e = h.minWidth, f = h.maxWidth, h.minWidth = h.maxWidth = h.width = g, g = c.width, h.width = d, h.minWidth = e, h.maxWidth = f)), void 0 === g ? g : g + ""
  }) : z.documentElement.currentStyle && (Jb = function(a) {
    return a.currentStyle
  }, Kb = function(a, b, c) {
    var d, e, f, g, h = a.style;
    return c = c || Jb(a), g = c ? c[b] : void 0, null == g && h && h[b] && (g = h[b]), Ib.test(g) && !Lb.test(b) && (d = h.left, e = a.runtimeStyle, f = e && e.left, f && (e.left = a.currentStyle.left), h.left = "fontSize" === b ? "1em" : g, g = h.pixelLeft + "px", h.left = d, f && (e.left = f)), void 0 === g ? g : g + "" || "auto"
  });

  function Mb(a, b) {
    return {
      get: function() {
        var c = a();
        if (null != c) return c ? void delete this.get : (this.get = b).apply(this, arguments)
      }
    }
  }! function() {
    var b, c, d, e, f, g, h = z.createElement("div"),
      i = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px",
      j = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";
    h.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", b = h.getElementsByTagName("a")[0], b.style.cssText = "float:left;opacity:.5", l.opacity = /^0.5/.test(b.style.opacity), l.cssFloat = !!b.style.cssFloat, h.style.backgroundClip = "content-box", h.cloneNode(!0).style.backgroundClip = "", l.clearCloneStyle = "content-box" === h.style.backgroundClip, b = h = null, n.extend(l, {
      reliableHiddenOffsets: function() {
        if (null != c) return c;
        var a, b, d, e = z.createElement("div"),
          f = z.getElementsByTagName("body")[0];
        if (f) return e.setAttribute("className", "t"), e.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", a = z.createElement("div"), a.style.cssText = i, f.appendChild(a).appendChild(e), e.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", b = e.getElementsByTagName("td"), b[0].style.cssText = "padding:0;margin:0;border:0;display:none", d = 0 === b[0].offsetHeight, b[0].style.display = "", b[1].style.display = "none", c = d && 0 === b[0].offsetHeight, f.removeChild(a), e = f = null, c
      },
      boxSizing: function() {
        return null == d && k(), d
      },
      boxSizingReliable: function() {
        return null == e && k(), e
      },
      pixelPosition: function() {
        return null == f && k(), f
      },
      reliableMarginRight: function() {
        var b, c, d, e;
        if (null == g && a.getComputedStyle) {
          if (b = z.getElementsByTagName("body")[0], !b) return;
          c = z.createElement("div"), d = z.createElement("div"), c.style.cssText = i, b.appendChild(c).appendChild(d), e = d.appendChild(z.createElement("div")), e.style.cssText = d.style.cssText = j, e.style.marginRight = e.style.width = "0", d.style.width = "1px", g = !parseFloat((a.getComputedStyle(e, null) || {}).marginRight), b.removeChild(c)
        }
        return g
      }
    });

    function k() {
      var b, c, h = z.getElementsByTagName("body")[0];
      h && (b = z.createElement("div"), c = z.createElement("div"), b.style.cssText = i, h.appendChild(b).appendChild(c), c.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%", n.swap(h, null != h.style.zoom ? {
        zoom: 1
      } : {}, function() {
        d = 4 === c.offsetWidth
      }), e = !0, f = !1, g = !0, a.getComputedStyle && (f = "1%" !== (a.getComputedStyle(c, null) || {}).top, e = "4px" === (a.getComputedStyle(c, null) || {
        width: "4px"
      }).width), h.removeChild(b), c = h = null)
    }
  }(), n.swap = function(a, b, c, d) {
    var e, f, g = {};
    for (f in b) g[f] = a.style[f], a.style[f] = b[f];
    e = c.apply(a, d || []);
    for (f in b) a.style[f] = g[f];
    return e
  };
  var Nb = /alpha\([^)]*\)/i,
    Ob = /opacity\s*=\s*([^)]*)/,
    Pb = /^(none|table(?!-c[ea]).+)/,
    Qb = new RegExp("^(" + T + ")(.*)$", "i"),
    Rb = new RegExp("^([+-])=(" + T + ")", "i"),
    Sb = {
      position: "absolute",
      visibility: "hidden",
      display: "block"
    },
    Tb = {
      letterSpacing: 0,
      fontWeight: 400
    },
    Ub = ["Webkit", "O", "Moz", "ms"];

  function Vb(a, b) {
    if (b in a) return b;
    var c = b.charAt(0).toUpperCase() + b.slice(1),
      d = b,
      e = Ub.length;
    while (e--)
      if (b = Ub[e] + c, b in a) return b;
    return d
  }

  function Wb(a, b) {
    for (var c, d, e, f = [], g = 0, h = a.length; h > g; g++) d = a[g], d.style && (f[g] = n._data(d, "olddisplay"), c = d.style.display, b ? (f[g] || "none" !== c || (d.style.display = ""), "" === d.style.display && V(d) && (f[g] = n._data(d, "olddisplay", Gb(d.nodeName)))) : f[g] || (e = V(d), (c && "none" !== c || !e) && n._data(d, "olddisplay", e ? c : n.css(d, "display"))));
    for (g = 0; h > g; g++) d = a[g], d.style && (b && "none" !== d.style.display && "" !== d.style.display || (d.style.display = b ? f[g] || "" : "none"));
    return a
  }

  function Xb(a, b, c) {
    var d = Qb.exec(b);
    return d ? Math.max(0, d[1] - (c || 0)) + (d[2] || "px") : b
  }

  function Yb(a, b, c, d, e) {
    for (var f = c === (d ? "border" : "content") ? 4 : "width" === b ? 1 : 0, g = 0; 4 > f; f += 2) "margin" === c && (g += n.css(a, c + U[f], !0, e)), d ? ("content" === c && (g -= n.css(a, "padding" + U[f], !0, e)), "margin" !== c && (g -= n.css(a, "border" + U[f] + "Width", !0, e))) : (g += n.css(a, "padding" + U[f], !0, e), "padding" !== c && (g += n.css(a, "border" + U[f] + "Width", !0, e)));
    return g
  }

  function Zb(a, b, c) {
    var d = !0,
      e = "width" === b ? a.offsetWidth : a.offsetHeight,
      f = Jb(a),
      g = l.boxSizing() && "border-box" === n.css(a, "boxSizing", !1, f);
    if (0 >= e || null == e) {
      if (e = Kb(a, b, f), (0 > e || null == e) && (e = a.style[b]), Ib.test(e)) return e;
      d = g && (l.boxSizingReliable() || e === a.style[b]), e = parseFloat(e) || 0
    }
    return e + Yb(a, b, c || (g ? "border" : "content"), d, f) + "px"
  }
  n.extend({
    cssHooks: {
      opacity: {
        get: function(a, b) {
          if (b) {
            var c = Kb(a, "opacity");
            return "" === c ? "1" : c
          }
        }
      }
    },
    cssNumber: {
      columnCount: !0,
      fillOpacity: !0,
      fontWeight: !0,
      lineHeight: !0,
      opacity: !0,
      order: !0,
      orphans: !0,
      widows: !0,
      zIndex: !0,
      zoom: !0
    },
    cssProps: {
      "float": l.cssFloat ? "cssFloat" : "styleFloat"
    },
    style: function(a, b, c, d) {
      if (a && 3 !== a.nodeType && 8 !== a.nodeType && a.style) {
        var e, f, g, h = n.camelCase(b),
          i = a.style;
        if (b = n.cssProps[h] || (n.cssProps[h] = Vb(i, h)), g = n.cssHooks[b] || n.cssHooks[h], void 0 === c) return g && "get" in g && void 0 !== (e = g.get(a, !1, d)) ? e : i[b];
        if (f = typeof c, "string" === f && (e = Rb.exec(c)) && (c = (e[1] + 1) * e[2] + parseFloat(n.css(a, b)), f = "number"), null != c && c === c && ("number" !== f || n.cssNumber[h] || (c += "px"), l.clearCloneStyle || "" !== c || 0 !== b.indexOf("background") || (i[b] = "inherit"), !(g && "set" in g && void 0 === (c = g.set(a, c, d))))) try {
          i[b] = "", i[b] = c
        } catch (j) {}
      }
    },
    css: function(a, b, c, d) {
      var e, f, g, h = n.camelCase(b);
      return b = n.cssProps[h] || (n.cssProps[h] = Vb(a.style, h)), g = n.cssHooks[b] || n.cssHooks[h], g && "get" in g && (f = g.get(a, !0, c)), void 0 === f && (f = Kb(a, b, d)), "normal" === f && b in Tb && (f = Tb[b]), "" === c || c ? (e = parseFloat(f), c === !0 || n.isNumeric(e) ? e || 0 : f) : f
    }
  }), n.each(["height", "width"], function(a, b) {
    n.cssHooks[b] = {
      get: function(a, c, d) {
        return c ? 0 === a.offsetWidth && Pb.test(n.css(a, "display")) ? n.swap(a, Sb, function() {
          return Zb(a, b, d)
        }) : Zb(a, b, d) : void 0
      },
      set: function(a, c, d) {
        var e = d && Jb(a);
        return Xb(a, c, d ? Yb(a, b, d, l.boxSizing() && "border-box" === n.css(a, "boxSizing", !1, e), e) : 0)
      }
    }
  }), l.opacity || (n.cssHooks.opacity = {
    get: function(a, b) {
      return Ob.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : b ? "1" : ""
    },
    set: function(a, b) {
      var c = a.style,
        d = a.currentStyle,
        e = n.isNumeric(b) ? "alpha(opacity=" + 100 * b + ")" : "",
        f = d && d.filter || c.filter || "";
      c.zoom = 1, (b >= 1 || "" === b) && "" === n.trim(f.replace(Nb, "")) && c.removeAttribute && (c.removeAttribute("filter"), "" === b || d && !d.filter) || (c.filter = Nb.test(f) ? f.replace(Nb, e) : f + " " + e)
    }
  }), n.cssHooks.marginRight = Mb(l.reliableMarginRight, function(a, b) {
    return b ? n.swap(a, {
      display: "inline-block"
    }, Kb, [a, "marginRight"]) : void 0
  }), n.each({
    margin: "",
    padding: "",
    border: "Width"
  }, function(a, b) {
    n.cssHooks[a + b] = {
      expand: function(c) {
        for (var d = 0, e = {}, f = "string" == typeof c ? c.split(" ") : [c]; 4 > d; d++) e[a + U[d] + b] = f[d] || f[d - 2] || f[0];
        return e
      }
    }, Hb.test(a) || (n.cssHooks[a + b].set = Xb)
  }), n.fn.extend({
    css: function(a, b) {
      return W(this, function(a, b, c) {
        var d, e, f = {},
          g = 0;
        if (n.isArray(b)) {
          for (d = Jb(a), e = b.length; e > g; g++) f[b[g]] = n.css(a, b[g], !1, d);
          return f
        }
        return void 0 !== c ? n.style(a, b, c) : n.css(a, b)
      }, a, b, arguments.length > 1)
    },
    show: function() {
      return Wb(this, !0)
    },
    hide: function() {
      return Wb(this)
    },
    toggle: function(a) {
      return "boolean" == typeof a ? a ? this.show() : this.hide() : this.each(function() {
        V(this) ? n(this).show() : n(this).hide()
      })
    }
  });

  function $b(a, b, c, d, e) {
    return new $b.prototype.init(a, b, c, d, e)
  }
  n.Tween = $b, $b.prototype = {
    constructor: $b,
    init: function(a, b, c, d, e, f) {
      this.elem = a, this.prop = c, this.easing = e || "swing", this.options = b, this.start = this.now = this.cur(), this.end = d, this.unit = f || (n.cssNumber[c] ? "" : "px")
    },
    cur: function() {
      var a = $b.propHooks[this.prop];
      return a && a.get ? a.get(this) : $b.propHooks._default.get(this)
    },
    run: function(a) {
      var b, c = $b.propHooks[this.prop];
      return this.pos = b = this.options.duration ? n.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration) : a, this.now = (this.end - this.start) * b + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), c && c.set ? c.set(this) : $b.propHooks._default.set(this), this
    }
  }, $b.prototype.init.prototype = $b.prototype, $b.propHooks = {
    _default: {
      get: function(a) {
        var b;
        return null == a.elem[a.prop] || a.elem.style && null != a.elem.style[a.prop] ? (b = n.css(a.elem, a.prop, ""), b && "auto" !== b ? b : 0) : a.elem[a.prop]
      },
      set: function(a) {
        n.fx.step[a.prop] ? n.fx.step[a.prop](a) : a.elem.style && (null != a.elem.style[n.cssProps[a.prop]] || n.cssHooks[a.prop]) ? n.style(a.elem, a.prop, a.now + a.unit) : a.elem[a.prop] = a.now
      }
    }
  }, $b.propHooks.scrollTop = $b.propHooks.scrollLeft = {
    set: function(a) {
      a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now)
    }
  }, n.easing = {
    linear: function(a) {
      return a
    },
    swing: function(a) {
      return .5 - Math.cos(a * Math.PI) / 2
    }
  }, n.fx = $b.prototype.init, n.fx.step = {};
  var _b, ac, bc = /^(?:toggle|show|hide)$/,
    cc = new RegExp("^(?:([+-])=|)(" + T + ")([a-z%]*)$", "i"),
    dc = /queueHooks$/,
    ec = [jc],
    fc = {
      "*": [function(a, b) {
        var c = this.createTween(a, b),
          d = c.cur(),
          e = cc.exec(b),
          f = e && e[3] || (n.cssNumber[a] ? "" : "px"),
          g = (n.cssNumber[a] || "px" !== f && +d) && cc.exec(n.css(c.elem, a)),
          h = 1,
          i = 20;
        if (g && g[3] !== f) {
          f = f || g[3], e = e || [], g = +d || 1;
          do h = h || ".5", g /= h, n.style(c.elem, a, g + f); while (h !== (h = c.cur() / d) && 1 !== h && --i)
        }
        return e && (g = c.start = +g || +d || 0, c.unit = f, c.end = e[1] ? g + (e[1] + 1) * e[2] : +e[2]), c
      }]
    };

  function gc() {
    return setTimeout(function() {
      _b = void 0
    }), _b = n.now()
  }

  function hc(a, b) {
    var c, d = {
        height: a
      },
      e = 0;
    for (b = b ? 1 : 0; 4 > e; e += 2 - b) c = U[e], d["margin" + c] = d["padding" + c] = a;
    return b && (d.opacity = d.width = a), d
  }

  function ic(a, b, c) {
    for (var d, e = (fc[b] || []).concat(fc["*"]), f = 0, g = e.length; g > f; f++)
      if (d = e[f].call(c, b, a)) return d
  }

  function jc(a, b, c) {
    var d, e, f, g, h, i, j, k, m = this,
      o = {},
      p = a.style,
      q = a.nodeType && V(a),
      r = n._data(a, "fxshow");
    c.queue || (h = n._queueHooks(a, "fx"), null == h.unqueued && (h.unqueued = 0, i = h.empty.fire, h.empty.fire = function() {
      h.unqueued || i()
    }), h.unqueued++, m.always(function() {
      m.always(function() {
        h.unqueued--, n.queue(a, "fx").length || h.empty.fire()
      })
    })), 1 === a.nodeType && ("height" in b || "width" in b) && (c.overflow = [p.overflow, p.overflowX, p.overflowY], j = n.css(a, "display"), k = Gb(a.nodeName), "none" === j && (j = k), "inline" === j && "none" === n.css(a, "float") && (l.inlineBlockNeedsLayout && "inline" !== k ? p.zoom = 1 : p.display = "inline-block")), c.overflow && (p.overflow = "hidden", l.shrinkWrapBlocks() || m.always(function() {
      p.overflow = c.overflow[0], p.overflowX = c.overflow[1], p.overflowY = c.overflow[2]
    }));
    for (d in b)
      if (e = b[d], bc.exec(e)) {
        if (delete b[d], f = f || "toggle" === e, e === (q ? "hide" : "show")) {
          if ("show" !== e || !r || void 0 === r[d]) continue;
          q = !0
        }
        o[d] = r && r[d] || n.style(a, d)
      }
    if (!n.isEmptyObject(o)) {
      r ? "hidden" in r && (q = r.hidden) : r = n._data(a, "fxshow", {}), f && (r.hidden = !q), q ? n(a).show() : m.done(function() {
        n(a).hide()
      }), m.done(function() {
        var b;
        n._removeData(a, "fxshow");
        for (b in o) n.style(a, b, o[b])
      });
      for (d in o) g = ic(q ? r[d] : 0, d, m), d in r || (r[d] = g.start, q && (g.end = g.start, g.start = "width" === d || "height" === d ? 1 : 0))
    }
  }

  function kc(a, b) {
    var c, d, e, f, g;
    for (c in a)
      if (d = n.camelCase(c), e = b[d], f = a[c], n.isArray(f) && (e = f[1], f = a[c] = f[0]), c !== d && (a[d] = f, delete a[c]), g = n.cssHooks[d], g && "expand" in g) {
        f = g.expand(f), delete a[d];
        for (c in f) c in a || (a[c] = f[c], b[c] = e)
      } else b[d] = e
  }

  function lc(a, b, c) {
    var d, e, f = 0,
      g = ec.length,
      h = n.Deferred().always(function() {
        delete i.elem
      }),
      i = function() {
        if (e) return !1;
        for (var b = _b || gc(), c = Math.max(0, j.startTime + j.duration - b), d = c / j.duration || 0, f = 1 - d, g = 0, i = j.tweens.length; i > g; g++) j.tweens[g].run(f);
        return h.notifyWith(a, [j, f, c]), 1 > f && i ? c : (h.resolveWith(a, [j]), !1)
      },
      j = h.promise({
        elem: a,
        props: n.extend({}, b),
        opts: n.extend(!0, {
          specialEasing: {}
        }, c),
        originalProperties: b,
        originalOptions: c,
        startTime: _b || gc(),
        duration: c.duration,
        tweens: [],
        createTween: function(b, c) {
          var d = n.Tween(a, j.opts, b, c, j.opts.specialEasing[b] || j.opts.easing);
          return j.tweens.push(d), d
        },
        stop: function(b) {
          var c = 0,
            d = b ? j.tweens.length : 0;
          if (e) return this;
          for (e = !0; d > c; c++) j.tweens[c].run(1);
          return b ? h.resolveWith(a, [j, b]) : h.rejectWith(a, [j, b]), this
        }
      }),
      k = j.props;
    for (kc(k, j.opts.specialEasing); g > f; f++)
      if (d = ec[f].call(j, a, k, j.opts)) return d;
    return n.map(k, ic, j), n.isFunction(j.opts.start) && j.opts.start.call(a, j), n.fx.timer(n.extend(i, {
      elem: a,
      anim: j,
      queue: j.opts.queue
    })), j.progress(j.opts.progress).done(j.opts.done, j.opts.complete).fail(j.opts.fail).always(j.opts.always)
  }
  n.Animation = n.extend(lc, {
      tweener: function(a, b) {
        n.isFunction(a) ? (b = a, a = ["*"]) : a = a.split(" ");
        for (var c, d = 0, e = a.length; e > d; d++) c = a[d], fc[c] = fc[c] || [], fc[c].unshift(b)
      },
      prefilter: function(a, b) {
        b ? ec.unshift(a) : ec.push(a)
      }
    }), n.speed = function(a, b, c) {
      var d = a && "object" == typeof a ? n.extend({}, a) : {
        complete: c || !c && b || n.isFunction(a) && a,
        duration: a,
        easing: c && b || b && !n.isFunction(b) && b
      };
      return d.duration = n.fx.off ? 0 : "number" == typeof d.duration ? d.duration : d.duration in n.fx.speeds ? n.fx.speeds[d.duration] : n.fx.speeds._default, (null == d.queue || d.queue === !0) && (d.queue = "fx"), d.old = d.complete, d.complete = function() {
        n.isFunction(d.old) && d.old.call(this), d.queue && n.dequeue(this, d.queue)
      }, d
    }, n.fn.extend({
      fadeTo: function(a, b, c, d) {
        return this.filter(V).css("opacity", 0).show().end().animate({
          opacity: b
        }, a, c, d)
      },
      animate: function(a, b, c, d) {
        var e = n.isEmptyObject(a),
          f = n.speed(b, c, d),
          g = function() {
            var b = lc(this, n.extend({}, a), f);
            (e || n._data(this, "finish")) && b.stop(!0)
          };
        return g.finish = g, e || f.queue === !1 ? this.each(g) : this.queue(f.queue, g)
      },
      stop: function(a, b, c) {
        var d = function(a) {
          var b = a.stop;
          delete a.stop, b(c)
        };
        return "string" != typeof a && (c = b, b = a, a = void 0), b && a !== !1 && this.queue(a || "fx", []), this.each(function() {
          var b = !0,
            e = null != a && a + "queueHooks",
            f = n.timers,
            g = n._data(this);
          if (e) g[e] && g[e].stop && d(g[e]);
          else
            for (e in g) g[e] && g[e].stop && dc.test(e) && d(g[e]);
          for (e = f.length; e--;) f[e].elem !== this || null != a && f[e].queue !== a || (f[e].anim.stop(c), b = !1, f.splice(e, 1));
          (b || !c) && n.dequeue(this, a)
        })
      },
      finish: function(a) {
        return a !== !1 && (a = a || "fx"), this.each(function() {
          var b, c = n._data(this),
            d = c[a + "queue"],
            e = c[a + "queueHooks"],
            f = n.timers,
            g = d ? d.length : 0;
          for (c.finish = !0, n.queue(this, a, []), e && e.stop && e.stop.call(this, !0), b = f.length; b--;) f[b].elem === this && f[b].queue === a && (f[b].anim.stop(!0), f.splice(b, 1));
          for (b = 0; g > b; b++) d[b] && d[b].finish && d[b].finish.call(this);
          delete c.finish
        })
      }
    }), n.each(["toggle", "show", "hide"], function(a, b) {
      var c = n.fn[b];
      n.fn[b] = function(a, d, e) {
        return null == a || "boolean" == typeof a ? c.apply(this, arguments) : this.animate(hc(b, !0), a, d, e)
      }
    }), n.each({
      slideDown: hc("show"),
      slideUp: hc("hide"),
      slideToggle: hc("toggle"),
      fadeIn: {
        opacity: "show"
      },
      fadeOut: {
        opacity: "hide"
      },
      fadeToggle: {
        opacity: "toggle"
      }
    }, function(a, b) {
      n.fn[a] = function(a, c, d) {
        return this.animate(b, a, c, d)
      }
    }), n.timers = [], n.fx.tick = function() {
      var a, b = n.timers,
        c = 0;
      for (_b = n.now(); c < b.length; c++) a = b[c], a() || b[c] !== a || b.splice(c--, 1);
      b.length || n.fx.stop(), _b = void 0
    }, n.fx.timer = function(a) {
      n.timers.push(a), a() ? n.fx.start() : n.timers.pop()
    }, n.fx.interval = 13, n.fx.start = function() {
      ac || (ac = setInterval(n.fx.tick, n.fx.interval))
    }, n.fx.stop = function() {
      clearInterval(ac), ac = null
    }, n.fx.speeds = {
      slow: 600,
      fast: 200,
      _default: 400
    }, n.fn.delay = function(a, b) {
      return a = n.fx ? n.fx.speeds[a] || a : a, b = b || "fx", this.queue(b, function(b, c) {
        var d = setTimeout(b, a);
        c.stop = function() {
          clearTimeout(d)
        }
      })
    },
    function() {
      var a, b, c, d, e = z.createElement("div");
      e.setAttribute("className", "t"), e.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", a = e.getElementsByTagName("a")[0], c = z.createElement("select"), d = c.appendChild(z.createElement("option")), b = e.getElementsByTagName("input")[0], a.style.cssText = "top:1px", l.getSetAttribute = "t" !== e.className, l.style = /top/.test(a.getAttribute("style")), l.hrefNormalized = "/a" === a.getAttribute("href"), l.checkOn = !!b.value, l.optSelected = d.selected, l.enctype = !!z.createElement("form").enctype, c.disabled = !0, l.optDisabled = !d.disabled, b = z.createElement("input"), b.setAttribute("value", ""), l.input = "" === b.getAttribute("value"), b.value = "t", b.setAttribute("type", "radio"), l.radioValue = "t" === b.value, a = b = c = d = e = null
    }();
  var mc = /\r/g;
  n.fn.extend({
    val: function(a) {
      var b, c, d, e = this[0]; {
        if (arguments.length) return d = n.isFunction(a), this.each(function(c) {
          var e;
          1 === this.nodeType && (e = d ? a.call(this, c, n(this).val()) : a, null == e ? e = "" : "number" == typeof e ? e += "" : n.isArray(e) && (e = n.map(e, function(a) {
            return null == a ? "" : a + ""
          })), b = n.valHooks[this.type] || n.valHooks[this.nodeName.toLowerCase()], b && "set" in b && void 0 !== b.set(this, e, "value") || (this.value = e))
        });
        if (e) return b = n.valHooks[e.type] || n.valHooks[e.nodeName.toLowerCase()], b && "get" in b && void 0 !== (c = b.get(e, "value")) ? c : (c = e.value, "string" == typeof c ? c.replace(mc, "") : null == c ? "" : c)
      }
    }
  }), n.extend({
    valHooks: {
      option: {
        get: function(a) {
          var b = n.find.attr(a, "value");
          return null != b ? b : n.text(a)
        }
      },
      select: {
        get: function(a) {
          for (var b, c, d = a.options, e = a.selectedIndex, f = "select-one" === a.type || 0 > e, g = f ? null : [], h = f ? e + 1 : d.length, i = 0 > e ? h : f ? e : 0; h > i; i++)
            if (c = d[i], !(!c.selected && i !== e || (l.optDisabled ? c.disabled : null !== c.getAttribute("disabled")) || c.parentNode.disabled && n.nodeName(c.parentNode, "optgroup"))) {
              if (b = n(c).val(), f) return b;
              g.push(b)
            }
          return g
        },
        set: function(a, b) {
          var c, d, e = a.options,
            f = n.makeArray(b),
            g = e.length;
          while (g--)
            if (d = e[g], n.inArray(n.valHooks.option.get(d), f) >= 0) try {
              d.selected = c = !0
            } catch (h) {
              d.scrollHeight
            } else d.selected = !1;
          return c || (a.selectedIndex = -1), e
        }
      }
    }
  }), n.each(["radio", "checkbox"], function() {
    n.valHooks[this] = {
      set: function(a, b) {
        return n.isArray(b) ? a.checked = n.inArray(n(a).val(), b) >= 0 : void 0
      }
    }, l.checkOn || (n.valHooks[this].get = function(a) {
      return null === a.getAttribute("value") ? "on" : a.value
    })
  });
  var nc, oc, pc = n.expr.attrHandle,
    qc = /^(?:checked|selected)$/i,
    rc = l.getSetAttribute,
    sc = l.input;
  n.fn.extend({
    attr: function(a, b) {
      return W(this, n.attr, a, b, arguments.length > 1)
    },
    removeAttr: function(a) {
      return this.each(function() {
        n.removeAttr(this, a)
      })
    }
  }), n.extend({
    attr: function(a, b, c) {
      var d, e, f = a.nodeType;
      if (a && 3 !== f && 8 !== f && 2 !== f) return typeof a.getAttribute === L ? n.prop(a, b, c) : (1 === f && n.isXMLDoc(a) || (b = b.toLowerCase(), d = n.attrHooks[b] || (n.expr.match.bool.test(b) ? oc : nc)), void 0 === c ? d && "get" in d && null !== (e = d.get(a, b)) ? e : (e = n.find.attr(a, b), null == e ? void 0 : e) : null !== c ? d && "set" in d && void 0 !== (e = d.set(a, c, b)) ? e : (a.setAttribute(b, c + ""), c) : void n.removeAttr(a, b))
    },
    removeAttr: function(a, b) {
      var c, d, e = 0,
        f = b && b.match(F);
      if (f && 1 === a.nodeType)
        while (c = f[e++]) d = n.propFix[c] || c, n.expr.match.bool.test(c) ? sc && rc || !qc.test(c) ? a[d] = !1 : a[n.camelCase("default-" + c)] = a[d] = !1 : n.attr(a, c, ""), a.removeAttribute(rc ? c : d)
    },
    attrHooks: {
      type: {
        set: function(a, b) {
          if (!l.radioValue && "radio" === b && n.nodeName(a, "input")) {
            var c = a.value;
            return a.setAttribute("type", b), c && (a.value = c), b
          }
        }
      }
    }
  }), oc = {
    set: function(a, b, c) {
      return b === !1 ? n.removeAttr(a, c) : sc && rc || !qc.test(c) ? a.setAttribute(!rc && n.propFix[c] || c, c) : a[n.camelCase("default-" + c)] = a[c] = !0, c
    }
  }, n.each(n.expr.match.bool.source.match(/\w+/g), function(a, b) {
    var c = pc[b] || n.find.attr;
    pc[b] = sc && rc || !qc.test(b) ? function(a, b, d) {
      var e, f;
      return d || (f = pc[b], pc[b] = e, e = null != c(a, b, d) ? b.toLowerCase() : null, pc[b] = f), e
    } : function(a, b, c) {
      return c ? void 0 : a[n.camelCase("default-" + b)] ? b.toLowerCase() : null
    }
  }), sc && rc || (n.attrHooks.value = {
    set: function(a, b, c) {
      return n.nodeName(a, "input") ? void(a.defaultValue = b) : nc && nc.set(a, b, c)
    }
  }), rc || (nc = {
    set: function(a, b, c) {
      var d = a.getAttributeNode(c);
      return d || a.setAttributeNode(d = a.ownerDocument.createAttribute(c)), d.value = b += "", "value" === c || b === a.getAttribute(c) ? b : void 0
    }
  }, pc.id = pc.name = pc.coords = function(a, b, c) {
    var d;
    return c ? void 0 : (d = a.getAttributeNode(b)) && "" !== d.value ? d.value : null
  }, n.valHooks.button = {
    get: function(a, b) {
      var c = a.getAttributeNode(b);
      return c && c.specified ? c.value : void 0
    },
    set: nc.set
  }, n.attrHooks.contenteditable = {
    set: function(a, b, c) {
      nc.set(a, "" === b ? !1 : b, c)
    }
  }, n.each(["width", "height"], function(a, b) {
    n.attrHooks[b] = {
      set: function(a, c) {
        return "" === c ? (a.setAttribute(b, "auto"), c) : void 0
      }
    }
  })), l.style || (n.attrHooks.style = {
    get: function(a) {
      return a.style.cssText || void 0
    },
    set: function(a, b) {
      return a.style.cssText = b + ""
    }
  });
  var tc = /^(?:input|select|textarea|button|object)$/i,
    uc = /^(?:a|area)$/i;
  n.fn.extend({
    prop: function(a, b) {
      return W(this, n.prop, a, b, arguments.length > 1)
    },
    removeProp: function(a) {
      return a = n.propFix[a] || a, this.each(function() {
        try {
          this[a] = void 0, delete this[a]
        } catch (b) {}
      })
    }
  }), n.extend({
    propFix: {
      "for": "htmlFor",
      "class": "className"
    },
    prop: function(a, b, c) {
      var d, e, f, g = a.nodeType;
      if (a && 3 !== g && 8 !== g && 2 !== g) return f = 1 !== g || !n.isXMLDoc(a), f && (b = n.propFix[b] || b, e = n.propHooks[b]), void 0 !== c ? e && "set" in e && void 0 !== (d = e.set(a, c, b)) ? d : a[b] = c : e && "get" in e && null !== (d = e.get(a, b)) ? d : a[b]
    },
    propHooks: {
      tabIndex: {
        get: function(a) {
          var b = n.find.attr(a, "tabindex");
          return b ? parseInt(b, 10) : tc.test(a.nodeName) || uc.test(a.nodeName) && a.href ? 0 : -1
        }
      }
    }
  }), l.hrefNormalized || n.each(["href", "src"], function(a, b) {
    n.propHooks[b] = {
      get: function(a) {
        return a.getAttribute(b, 4)
      }
    }
  }), l.optSelected || (n.propHooks.selected = {
    get: function(a) {
      var b = a.parentNode;
      return b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex), null
    }
  }), n.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function() {
    n.propFix[this.toLowerCase()] = this
  }), l.enctype || (n.propFix.enctype = "encoding");
  var vc = /[\t\r\n\f]/g;
  n.fn.extend({
    addClass: function(a) {
      var b, c, d, e, f, g, h = 0,
        i = this.length,
        j = "string" == typeof a && a;
      if (n.isFunction(a)) return this.each(function(b) {
        n(this).addClass(a.call(this, b, this.className))
      });
      if (j)
        for (b = (a || "").match(F) || []; i > h; h++)
          if (c = this[h], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(vc, " ") : " ")) {
            f = 0;
            while (e = b[f++]) d.indexOf(" " + e + " ") < 0 && (d += e + " ");
            g = n.trim(d), c.className !== g && (c.className = g)
          }
      return this
    },
    removeClass: function(a) {
      var b, c, d, e, f, g, h = 0,
        i = this.length,
        j = 0 === arguments.length || "string" == typeof a && a;
      if (n.isFunction(a)) return this.each(function(b) {
        n(this).removeClass(a.call(this, b, this.className))
      });
      if (j)
        for (b = (a || "").match(F) || []; i > h; h++)
          if (c = this[h], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(vc, " ") : "")) {
            f = 0;
            while (e = b[f++])
              while (d.indexOf(" " + e + " ") >= 0) d = d.replace(" " + e + " ", " ");
            g = a ? n.trim(d) : "", c.className !== g && (c.className = g)
          }
      return this
    },
    toggleClass: function(a, b) {
      var c = typeof a;
      return "boolean" == typeof b && "string" === c ? b ? this.addClass(a) : this.removeClass(a) : this.each(n.isFunction(a) ? function(c) {
        n(this).toggleClass(a.call(this, c, this.className, b), b)
      } : function() {
        if ("string" === c) {
          var b, d = 0,
            e = n(this),
            f = a.match(F) || [];
          while (b = f[d++]) e.hasClass(b) ? e.removeClass(b) : e.addClass(b)
        } else(c === L || "boolean" === c) && (this.className && n._data(this, "__className__", this.className), this.className = this.className || a === !1 ? "" : n._data(this, "__className__") || "")
      })
    },
    hasClass: function(a) {
      for (var b = " " + a + " ", c = 0, d = this.length; d > c; c++)
        if (1 === this[c].nodeType && (" " + this[c].className + " ").replace(vc, " ").indexOf(b) >= 0) return !0;
      return !1
    }
  }), n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function(a, b) {
    n.fn[b] = function(a, c) {
      return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b)
    }
  }), n.fn.extend({
    hover: function(a, b) {
      return this.mouseenter(a).mouseleave(b || a)
    },
    bind: function(a, b, c) {
      return this.on(a, null, b, c)
    },
    unbind: function(a, b) {
      return this.off(a, null, b)
    },
    delegate: function(a, b, c, d) {
      return this.on(b, a, c, d)
    },
    undelegate: function(a, b, c) {
      return 1 === arguments.length ? this.off(a, "**") : this.off(b, a || "**", c)
    }
  });
  var wc = n.now(),
    xc = /\?/,
    yc = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
  n.parseJSON = function(b) {
    if (a.JSON && a.JSON.parse) return a.JSON.parse(b + "");
    var c, d = null,
      e = n.trim(b + "");
    return e && !n.trim(e.replace(yc, function(a, b, e, f) {
      return c && b && (d = 0), 0 === d ? a : (c = e || b, d += !f - !e, "")
    })) ? Function("return " + e)() : n.error("Invalid JSON: " + b)
  }, n.parseXML = function(b) {
    var c, d;
    if (!b || "string" != typeof b) return null;
    try {
      a.DOMParser ? (d = new DOMParser, c = d.parseFromString(b, "text/xml")) : (c = new ActiveXObject("Microsoft.XMLDOM"), c.async = "false", c.loadXML(b))
    } catch (e) {
      c = void 0
    }
    return c && c.documentElement && !c.getElementsByTagName("parsererror").length || n.error("Invalid XML: " + b), c
  };
  var zc, Ac, Bc = /#.*$/,
    Cc = /([?&])_=[^&]*/,
    Dc = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm,
    Ec = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,
    Fc = /^(?:GET|HEAD)$/,
    Gc = /^\/\//,
    Hc = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
    Ic = {},
    Jc = {},
    Kc = "*/".concat("*");
  try {
    Ac = location.href
  } catch (Lc) {
    Ac = z.createElement("a"), Ac.href = "", Ac = Ac.href
  }
  zc = Hc.exec(Ac.toLowerCase()) || [];

  function Mc(a) {
    return function(b, c) {
      "string" != typeof b && (c = b, b = "*");
      var d, e = 0,
        f = b.toLowerCase().match(F) || [];
      if (n.isFunction(c))
        while (d = f[e++]) "+" === d.charAt(0) ? (d = d.slice(1) || "*", (a[d] = a[d] || []).unshift(c)) : (a[d] = a[d] || []).push(c)
    }
  }

  function Nc(a, b, c, d) {
    var e = {},
      f = a === Jc;

    function g(h) {
      var i;
      return e[h] = !0, n.each(a[h] || [], function(a, h) {
        var j = h(b, c, d);
        return "string" != typeof j || f || e[j] ? f ? !(i = j) : void 0 : (b.dataTypes.unshift(j), g(j), !1)
      }), i
    }
    return g(b.dataTypes[0]) || !e["*"] && g("*")
  }

  function Oc(a, b) {
    var c, d, e = n.ajaxSettings.flatOptions || {};
    for (d in b) void 0 !== b[d] && ((e[d] ? a : c || (c = {}))[d] = b[d]);
    return c && n.extend(!0, a, c), a
  }

  function Pc(a, b, c) {
    var d, e, f, g, h = a.contents,
      i = a.dataTypes;
    while ("*" === i[0]) i.shift(), void 0 === e && (e = a.mimeType || b.getResponseHeader("Content-Type"));
    if (e)
      for (g in h)
        if (h[g] && h[g].test(e)) {
          i.unshift(g);
          break
        }
    if (i[0] in c) f = i[0];
    else {
      for (g in c) {
        if (!i[0] || a.converters[g + " " + i[0]]) {
          f = g;
          break
        }
        d || (d = g)
      }
      f = f || d
    }
    return f ? (f !== i[0] && i.unshift(f), c[f]) : void 0
  }

  function Qc(a, b, c, d) {
    var e, f, g, h, i, j = {},
      k = a.dataTypes.slice();
    if (k[1])
      for (g in a.converters) j[g.toLowerCase()] = a.converters[g];
    f = k.shift();
    while (f)
      if (a.responseFields[f] && (c[a.responseFields[f]] = b), !i && d && a.dataFilter && (b = a.dataFilter(b, a.dataType)), i = f, f = k.shift())
        if ("*" === f) f = i;
        else if ("*" !== i && i !== f) {
      if (g = j[i + " " + f] || j["* " + f], !g)
        for (e in j)
          if (h = e.split(" "), h[1] === f && (g = j[i + " " + h[0]] || j["* " + h[0]])) {
            g === !0 ? g = j[e] : j[e] !== !0 && (f = h[0], k.unshift(h[1]));
            break
          }
      if (g !== !0)
        if (g && a["throws"]) b = g(b);
        else try {
          b = g(b)
        } catch (l) {
          return {
            state: "parsererror",
            error: g ? l : "No conversion from " + i + " to " + f
          }
        }
    }
    return {
      state: "success",
      data: b
    }
  }
  n.extend({
    active: 0,
    lastModified: {},
    etag: {},
    ajaxSettings: {
      url: Ac,
      type: "GET",
      isLocal: Ec.test(zc[1]),
      global: !0,
      processData: !0,
      async: !0,
      contentType: "application/x-www-form-urlencoded; charset=UTF-8",
      accepts: {
        "*": Kc,
        text: "text/plain",
        html: "text/html",
        xml: "application/xml, text/xml",
        json: "application/json, text/javascript"
      },
      contents: {
        xml: /xml/,
        html: /html/,
        json: /json/
      },
      responseFields: {
        xml: "responseXML",
        text: "responseText",
        json: "responseJSON"
      },
      converters: {
        "* text": String,
        "text html": !0,
        "text json": n.parseJSON,
        "text xml": n.parseXML
      },
      flatOptions: {
        url: !0,
        context: !0
      }
    },
    ajaxSetup: function(a, b) {
      return b ? Oc(Oc(a, n.ajaxSettings), b) : Oc(n.ajaxSettings, a)
    },
    ajaxPrefilter: Mc(Ic),
    ajaxTransport: Mc(Jc),
    ajax: function(a, b) {
      "object" == typeof a && (b = a, a = void 0), b = b || {};
      var c, d, e, f, g, h, i, j, k = n.ajaxSetup({}, b),
        l = k.context || k,
        m = k.context && (l.nodeType || l.jquery) ? n(l) : n.event,
        o = n.Deferred(),
        p = n.Callbacks("once memory"),
        q = k.statusCode || {},
        r = {},
        s = {},
        t = 0,
        u = "canceled",
        v = {
          readyState: 0,
          getResponseHeader: function(a) {
            var b;
            if (2 === t) {
              if (!j) {
                j = {};
                while (b = Dc.exec(f)) j[b[1].toLowerCase()] = b[2]
              }
              b = j[a.toLowerCase()]
            }
            return null == b ? null : b
          },
          getAllResponseHeaders: function() {
            return 2 === t ? f : null
          },
          setRequestHeader: function(a, b) {
            var c = a.toLowerCase();
            return t || (a = s[c] = s[c] || a, r[a] = b), this
          },
          overrideMimeType: function(a) {
            return t || (k.mimeType = a), this
          },
          statusCode: function(a) {
            var b;
            if (a)
              if (2 > t)
                for (b in a) q[b] = [q[b], a[b]];
              else v.always(a[v.status]);
            return this
          },
          abort: function(a) {
            var b = a || u;
            return i && i.abort(b), x(0, b), this
          }
        };
      if (o.promise(v).complete = p.add, v.success = v.done, v.error = v.fail, k.url = ((a || k.url || Ac) + "").replace(Bc, "").replace(Gc, zc[1] + "//"), k.type = b.method || b.type || k.method || k.type, k.dataTypes = n.trim(k.dataType || "*").toLowerCase().match(F) || [""], null == k.crossDomain && (c = Hc.exec(k.url.toLowerCase()), k.crossDomain = !(!c || c[1] === zc[1] && c[2] === zc[2] && (c[3] || ("http:" === c[1] ? "80" : "443")) === (zc[3] || ("http:" === zc[1] ? "80" : "443")))), k.data && k.processData && "string" != typeof k.data && (k.data = n.param(k.data, k.traditional)), Nc(Ic, k, b, v), 2 === t) return v;
      h = k.global, h && 0 === n.active++ && n.event.trigger("ajaxStart"), k.type = k.type.toUpperCase(), k.hasContent = !Fc.test(k.type), e = k.url, k.hasContent || (k.data && (e = k.url += (xc.test(e) ? "&" : "?") + k.data, delete k.data), k.cache === !1 && (k.url = Cc.test(e) ? e.replace(Cc, "$1_=" + wc++) : e + (xc.test(e) ? "&" : "?") + "_=" + wc++)), k.ifModified && (n.lastModified[e] && v.setRequestHeader("If-Modified-Since", n.lastModified[e]), n.etag[e] && v.setRequestHeader("If-None-Match", n.etag[e])), (k.data && k.hasContent && k.contentType !== !1 || b.contentType) && v.setRequestHeader("Content-Type", k.contentType), v.setRequestHeader("Accept", k.dataTypes[0] && k.accepts[k.dataTypes[0]] ? k.accepts[k.dataTypes[0]] + ("*" !== k.dataTypes[0] ? ", " + Kc + "; q=0.01" : "") : k.accepts["*"]);
      for (d in k.headers) v.setRequestHeader(d, k.headers[d]);
      if (k.beforeSend && (k.beforeSend.call(l, v, k) === !1 || 2 === t)) return v.abort();
      u = "abort";
      for (d in {
          success: 1,
          error: 1,
          complete: 1
        }) v[d](k[d]);
      if (i = Nc(Jc, k, b, v)) {
        v.readyState = 1, h && m.trigger("ajaxSend", [v, k]), k.async && k.timeout > 0 && (g = setTimeout(function() {
          v.abort("timeout")
        }, k.timeout));
        try {
          t = 1, i.send(r, x)
        } catch (w) {
          if (!(2 > t)) throw w;
          x(-1, w)
        }
      } else x(-1, "No Transport");

      function x(a, b, c, d) {
        var j, r, s, u, w, x = b;
        2 !== t && (t = 2, g && clearTimeout(g), i = void 0, f = d || "", v.readyState = a > 0 ? 4 : 0, j = a >= 200 && 300 > a || 304 === a, c && (u = Pc(k, v, c)), u = Qc(k, u, v, j), j ? (k.ifModified && (w = v.getResponseHeader("Last-Modified"), w && (n.lastModified[e] = w), w = v.getResponseHeader("etag"), w && (n.etag[e] = w)), 204 === a || "HEAD" === k.type ? x = "nocontent" : 304 === a ? x = "notmodified" : (x = u.state, r = u.data, s = u.error, j = !s)) : (s = x, (a || !x) && (x = "error", 0 > a && (a = 0))), v.status = a, v.statusText = (b || x) + "", j ? o.resolveWith(l, [r, x, v]) : o.rejectWith(l, [v, x, s]), v.statusCode(q), q = void 0, h && m.trigger(j ? "ajaxSuccess" : "ajaxError", [v, k, j ? r : s]), p.fireWith(l, [v, x]), h && (m.trigger("ajaxComplete", [v, k]), --n.active || n.event.trigger("ajaxStop")))
      }
      return v
    },
    getJSON: function(a, b, c) {
      return n.get(a, b, c, "json")
    },
    getScript: function(a, b) {
      return n.get(a, void 0, b, "script")
    }
  }), n.each(["get", "post"], function(a, b) {
    n[b] = function(a, c, d, e) {
      return n.isFunction(c) && (e = e || d, d = c, c = void 0), n.ajax({
        url: a,
        type: b,
        dataType: e,
        data: c,
        success: d
      })
    }
  }), n.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function(a, b) {
    n.fn[b] = function(a) {
      return this.on(b, a)
    }
  }), n._evalUrl = function(a) {
    return n.ajax({
      url: a,
      type: "GET",
      dataType: "script",
      async: !1,
      global: !1,
      "throws": !0
    })
  }, n.fn.extend({
    wrapAll: function(a) {
      if (n.isFunction(a)) return this.each(function(b) {
        n(this).wrapAll(a.call(this, b))
      });
      if (this[0]) {
        var b = n(a, this[0].ownerDocument).eq(0).clone(!0);
        this[0].parentNode && b.insertBefore(this[0]), b.map(function() {
          var a = this;
          while (a.firstChild && 1 === a.firstChild.nodeType) a = a.firstChild;
          return a
        }).append(this)
      }
      return this
    },
    wrapInner: function(a) {
      return this.each(n.isFunction(a) ? function(b) {
        n(this).wrapInner(a.call(this, b))
      } : function() {
        var b = n(this),
          c = b.contents();
        c.length ? c.wrapAll(a) : b.append(a)
      })
    },
    wrap: function(a) {
      var b = n.isFunction(a);
      return this.each(function(c) {
        n(this).wrapAll(b ? a.call(this, c) : a)
      })
    },
    unwrap: function() {
      return this.parent().each(function() {
        n.nodeName(this, "body") || n(this).replaceWith(this.childNodes)
      }).end()
    }
  }), n.expr.filters.hidden = function(a) {
    return a.offsetWidth <= 0 && a.offsetHeight <= 0 || !l.reliableHiddenOffsets() && "none" === (a.style && a.style.display || n.css(a, "display"))
  }, n.expr.filters.visible = function(a) {
    return !n.expr.filters.hidden(a)
  };
  var Rc = /%20/g,
    Sc = /\[\]$/,
    Tc = /\r?\n/g,
    Uc = /^(?:submit|button|image|reset|file)$/i,
    Vc = /^(?:input|select|textarea|keygen)/i;

  function Wc(a, b, c, d) {
    var e;
    if (n.isArray(b)) n.each(b, function(b, e) {
      c || Sc.test(a) ? d(a, e) : Wc(a + "[" + ("object" == typeof e ? b : "") + "]", e, c, d)
    });
    else if (c || "object" !== n.type(b)) d(a, b);
    else
      for (e in b) Wc(a + "[" + e + "]", b[e], c, d)
  }
  n.param = function(a, b) {
    var c, d = [],
      e = function(a, b) {
        b = n.isFunction(b) ? b() : null == b ? "" : b, d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b)
      };
    if (void 0 === b && (b = n.ajaxSettings && n.ajaxSettings.traditional), n.isArray(a) || a.jquery && !n.isPlainObject(a)) n.each(a, function() {
      e(this.name, this.value)
    });
    else
      for (c in a) Wc(c, a[c], b, e);
    return d.join("&").replace(Rc, "+")
  }, n.fn.extend({
    serialize: function() {
      return n.param(this.serializeArray())
    },
    serializeArray: function() {
      return this.map(function() {
        var a = n.prop(this, "elements");
        return a ? n.makeArray(a) : this
      }).filter(function() {
        var a = this.type;
        return this.name && !n(this).is(":disabled") && Vc.test(this.nodeName) && !Uc.test(a) && (this.checked || !X.test(a))
      }).map(function(a, b) {
        var c = n(this).val();
        return null == c ? null : n.isArray(c) ? n.map(c, function(a) {
          return {
            name: b.name,
            value: a.replace(Tc, "\r\n")
          }
        }) : {
          name: b.name,
          value: c.replace(Tc, "\r\n")
        }
      }).get()
    }
  }), n.ajaxSettings.xhr = void 0 !== a.ActiveXObject ? function() {
    return !this.isLocal && /^(get|post|head|put|delete|options)$/i.test(this.type) && $c() || _c()
  } : $c;
  var Xc = 0,
    Yc = {},
    Zc = n.ajaxSettings.xhr();
  a.ActiveXObject && n(a).on("unload", function() {
    for (var a in Yc) Yc[a](void 0, !0)
  }), l.cors = !!Zc && "withCredentials" in Zc, Zc = l.ajax = !!Zc, Zc && n.ajaxTransport(function(a) {
    if (!a.crossDomain || l.cors) {
      var b;
      return {
        send: function(c, d) {
          var e, f = a.xhr(),
            g = ++Xc;
          if (f.open(a.type, a.url, a.async, a.username, a.password), a.xhrFields)
            for (e in a.xhrFields) f[e] = a.xhrFields[e];
          a.mimeType && f.overrideMimeType && f.overrideMimeType(a.mimeType), a.crossDomain || c["X-Requested-With"] || (c["X-Requested-With"] = "XMLHttpRequest");
          for (e in c) void 0 !== c[e] && f.setRequestHeader(e, c[e] + "");
          f.send(a.hasContent && a.data || null), b = function(c, e) {
            var h, i, j;
            if (b && (e || 4 === f.readyState))
              if (delete Yc[g], b = void 0, f.onreadystatechange = n.noop, e) 4 !== f.readyState && f.abort();
              else {
                j = {}, h = f.status, "string" == typeof f.responseText && (j.text = f.responseText);
                try {
                  i = f.statusText
                } catch (k) {
                  i = ""
                }
                h || !a.isLocal || a.crossDomain ? 1223 === h && (h = 204) : h = j.text ? 200 : 404
              }
            j && d(h, i, j, f.getAllResponseHeaders())
          }, a.async ? 4 === f.readyState ? setTimeout(b) : f.onreadystatechange = Yc[g] = b : b()
        },
        abort: function() {
          b && b(void 0, !0)
        }
      }
    }
  });

  function $c() {
    try {
      return new a.XMLHttpRequest
    } catch (b) {}
  }

  function _c() {
    try {
      return new a.ActiveXObject("Microsoft.XMLHTTP")
    } catch (b) {}
  }
  n.ajaxSetup({
    accepts: {
      script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
    },
    contents: {
      script: /(?:java|ecma)script/
    },
    converters: {
      "text script": function(a) {
        return n.globalEval(a), a
      }
    }
  }), n.ajaxPrefilter("script", function(a) {
    void 0 === a.cache && (a.cache = !1), a.crossDomain && (a.type = "GET", a.global = !1)
  }), n.ajaxTransport("script", function(a) {
    if (a.crossDomain) {
      var b, c = z.head || n("head")[0] || z.documentElement;
      return {
        send: function(d, e) {
          b = z.createElement("script"), b.async = !0, a.scriptCharset && (b.charset = a.scriptCharset), b.src = a.url, b.onload = b.onreadystatechange = function(a, c) {
            (c || !b.readyState || /loaded|complete/.test(b.readyState)) && (b.onload = b.onreadystatechange = null, b.parentNode && b.parentNode.removeChild(b), b = null, c || e(200, "success"))
          }, c.insertBefore(b, c.firstChild)
        },
        abort: function() {
          b && b.onload(void 0, !0)
        }
      }
    }
  });
  var ad = [],
    bd = /(=)\?(?=&|$)|\?\?/;
  n.ajaxSetup({
    jsonp: "callback",
    jsonpCallback: function() {
      var a = ad.pop() || n.expando + "_" + wc++;
      return this[a] = !0, a
    }
  }), n.ajaxPrefilter("json jsonp", function(b, c, d) {
    var e, f, g, h = b.jsonp !== !1 && (bd.test(b.url) ? "url" : "string" == typeof b.data && !(b.contentType || "").indexOf("application/x-www-form-urlencoded") && bd.test(b.data) && "data");
    return h || "jsonp" === b.dataTypes[0] ? (e = b.jsonpCallback = n.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, h ? b[h] = b[h].replace(bd, "$1" + e) : b.jsonp !== !1 && (b.url += (xc.test(b.url) ? "&" : "?") + b.jsonp + "=" + e), b.converters["script json"] = function() {
      return g || n.error(e + " was not called"), g[0]
    }, b.dataTypes[0] = "json", f = a[e], a[e] = function() {
      g = arguments
    }, d.always(function() {
      a[e] = f, b[e] && (b.jsonpCallback = c.jsonpCallback, ad.push(e)), g && n.isFunction(f) && f(g[0]), g = f = void 0
    }), "script") : void 0
  }), n.parseHTML = function(a, b, c) {
    if (!a || "string" != typeof a) return null;
    "boolean" == typeof b && (c = b, b = !1), b = b || z;
    var d = v.exec(a),
      e = !c && [];
    return d ? [b.createElement(d[1])] : (d = n.buildFragment([a], b, e), e && e.length && n(e).remove(), n.merge([], d.childNodes))
  };
  var cd = n.fn.load;
  n.fn.load = function(a, b, c) {
    if ("string" != typeof a && cd) return cd.apply(this, arguments);
    var d, e, f, g = this,
      h = a.indexOf(" ");
    return h >= 0 && (d = a.slice(h, a.length), a = a.slice(0, h)), n.isFunction(b) ? (c = b, b = void 0) : b && "object" == typeof b && (f = "POST"), g.length > 0 && n.ajax({
      url: a,
      type: f,
      dataType: "html",
      data: b
    }).done(function(a) {
      e = arguments, g.html(d ? n("<div>").append(n.parseHTML(a)).find(d) : a)
    }).complete(c && function(a, b) {
      g.each(c, e || [a.responseText, b, a])
    }), this
  }, n.expr.filters.animated = function(a) {
    return n.grep(n.timers, function(b) {
      return a === b.elem
    }).length
  };
  var dd = a.document.documentElement;

  function ed(a) {
    return n.isWindow(a) ? a : 9 === a.nodeType ? a.defaultView || a.parentWindow : !1
  }
  n.offset = {
    setOffset: function(a, b, c) {
      var d, e, f, g, h, i, j, k = n.css(a, "position"),
        l = n(a),
        m = {};
      "static" === k && (a.style.position = "relative"), h = l.offset(), f = n.css(a, "top"), i = n.css(a, "left"), j = ("absolute" === k || "fixed" === k) && n.inArray("auto", [f, i]) > -1, j ? (d = l.position(), g = d.top, e = d.left) : (g = parseFloat(f) || 0, e = parseFloat(i) || 0), n.isFunction(b) && (b = b.call(a, c, h)), null != b.top && (m.top = b.top - h.top + g), null != b.left && (m.left = b.left - h.left + e), "using" in b ? b.using.call(a, m) : l.css(m)
    }
  }, n.fn.extend({
    offset: function(a) {
      if (arguments.length) return void 0 === a ? this : this.each(function(b) {
        n.offset.setOffset(this, a, b)
      });
      var b, c, d = {
          top: 0,
          left: 0
        },
        e = this[0],
        f = e && e.ownerDocument;
      if (f) return b = f.documentElement, n.contains(b, e) ? (typeof e.getBoundingClientRect !== L && (d = e.getBoundingClientRect()), c = ed(f), {
        top: d.top + (c.pageYOffset || b.scrollTop) - (b.clientTop || 0),
        left: d.left + (c.pageXOffset || b.scrollLeft) - (b.clientLeft || 0)
      }) : d
    },
    position: function() {
      if (this[0]) {
        var a, b, c = {
            top: 0,
            left: 0
          },
          d = this[0];
        return "fixed" === n.css(d, "position") ? b = d.getBoundingClientRect() : (a = this.offsetParent(), b = this.offset(), n.nodeName(a[0], "html") || (c = a.offset()), c.top += n.css(a[0], "borderTopWidth", !0), c.left += n.css(a[0], "borderLeftWidth", !0)), {
          top: b.top - c.top - n.css(d, "marginTop", !0),
          left: b.left - c.left - n.css(d, "marginLeft", !0)
        }
      }
    },
    offsetParent: function() {
      return this.map(function() {
        var a = this.offsetParent || dd;
        while (a && !n.nodeName(a, "html") && "static" === n.css(a, "position")) a = a.offsetParent;
        return a || dd
      })
    }
  }), n.each({
    scrollLeft: "pageXOffset",
    scrollTop: "pageYOffset"
  }, function(a, b) {
    var c = /Y/.test(b);
    n.fn[a] = function(d) {
      return W(this, function(a, d, e) {
        var f = ed(a);
        return void 0 === e ? f ? b in f ? f[b] : f.document.documentElement[d] : a[d] : void(f ? f.scrollTo(c ? n(f).scrollLeft() : e, c ? e : n(f).scrollTop()) : a[d] = e)
      }, a, d, arguments.length, null)
    }
  }), n.each(["top", "left"], function(a, b) {
    n.cssHooks[b] = Mb(l.pixelPosition, function(a, c) {
      return c ? (c = Kb(a, b), Ib.test(c) ? n(a).position()[b] + "px" : c) : void 0
    })
  }), n.each({
    Height: "height",
    Width: "width"
  }, function(a, b) {
    n.each({
      padding: "inner" + a,
      content: b,
      "": "outer" + a
    }, function(c, d) {
      n.fn[d] = function(d, e) {
        var f = arguments.length && (c || "boolean" != typeof d),
          g = c || (d === !0 || e === !0 ? "margin" : "border");
        return W(this, function(b, c, d) {
          var e;
          return n.isWindow(b) ? b.document.documentElement["client" + a] : 9 === b.nodeType ? (e = b.documentElement, Math.max(b.body["scroll" + a], e["scroll" + a], b.body["offset" + a], e["offset" + a], e["client" + a])) : void 0 === d ? n.css(b, c, g) : n.style(b, c, d, g)
        }, b, f ? d : void 0, f, null)
      }
    })
  }), n.fn.size = function() {
    return this.length
  }, n.fn.andSelf = n.fn.addBack, "function" == typeof define && define.amd && define("jquery", [], function() {
    return n
  });
  var fd = a.jQuery,
    gd = a.$;
  return n.noConflict = function(b) {
    return a.$ === n && (a.$ = gd), b && a.jQuery === n && (a.jQuery = fd), n
  }, typeof b === L && (a.jQuery = a.$ = n), n
});
/*! jQuery UI - v1.10.4 - 2014-04-15
 * http://jqueryui.com
 * Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.resizable.js, jquery.ui.sortable.js, jquery.ui.slider.js
 * Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

(function(e, t) {
  function i(t, i) {
    var s, a, o, r = t.nodeName.toLowerCase();
    return "area" === r ? (s = t.parentNode, a = s.name, t.href && a && "map" === s.nodeName.toLowerCase() ? (o = e("img[usemap=#" + a + "]")[0], !!o && n(o)) : !1) : (/input|select|textarea|button|object/.test(r) ? !t.disabled : "a" === r ? t.href || i : i) && n(t)
  }

  function n(t) {
    return e.expr.filters.visible(t) && !e(t).parents().addBack().filter(function() {
      return "hidden" === e.css(this, "visibility")
    }).length
  }
  var s = 0,
    a = /^ui-id-\d+$/;
  e.ui = e.ui || {}, e.extend(e.ui, {
    version: "1.10.4",
    keyCode: {
      BACKSPACE: 8,
      COMMA: 188,
      DELETE: 46,
      DOWN: 40,
      END: 35,
      ENTER: 13,
      ESCAPE: 27,
      HOME: 36,
      LEFT: 37,
      NUMPAD_ADD: 107,
      NUMPAD_DECIMAL: 110,
      NUMPAD_DIVIDE: 111,
      NUMPAD_ENTER: 108,
      NUMPAD_MULTIPLY: 106,
      NUMPAD_SUBTRACT: 109,
      PAGE_DOWN: 34,
      PAGE_UP: 33,
      PERIOD: 190,
      RIGHT: 39,
      SPACE: 32,
      TAB: 9,
      UP: 38
    }
  }), e.fn.extend({
    focus: function(t) {
      return function(i, n) {
        return "number" == typeof i ? this.each(function() {
          var t = this;
          setTimeout(function() {
            e(t).focus(), n && n.call(t)
          }, i)
        }) : t.apply(this, arguments)
      }
    }(e.fn.focus),
    scrollParent: function() {
      var t;
      return t = e.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? this.parents().filter(function() {
        return /(relative|absolute|fixed)/.test(e.css(this, "position")) && /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
      }).eq(0) : this.parents().filter(function() {
        return /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
      }).eq(0), /fixed/.test(this.css("position")) || !t.length ? e(document) : t
    },
    zIndex: function(i) {
      if (i !== t) return this.css("zIndex", i);
      if (this.length)
        for (var n, s, a = e(this[0]); a.length && a[0] !== document;) {
          if (n = a.css("position"), ("absolute" === n || "relative" === n || "fixed" === n) && (s = parseInt(a.css("zIndex"), 10), !isNaN(s) && 0 !== s)) return s;
          a = a.parent()
        }
      return 0
    },
    uniqueId: function() {
      return this.each(function() {
        this.id || (this.id = "ui-id-" + ++s)
      })
    },
    removeUniqueId: function() {
      return this.each(function() {
        a.test(this.id) && e(this).removeAttr("id")
      })
    }
  }), e.extend(e.expr[":"], {
    data: e.expr.createPseudo ? e.expr.createPseudo(function(t) {
      return function(i) {
        return !!e.data(i, t)
      }
    }) : function(t, i, n) {
      return !!e.data(t, n[3])
    },
    focusable: function(t) {
      return i(t, !isNaN(e.attr(t, "tabindex")))
    },
    tabbable: function(t) {
      var n = e.attr(t, "tabindex"),
        s = isNaN(n);
      return (s || n >= 0) && i(t, !s)
    }
  }), e("<a>").outerWidth(1).jquery || e.each(["Width", "Height"], function(i, n) {
    function s(t, i, n, s) {
      return e.each(a, function() {
        i -= parseFloat(e.css(t, "padding" + this)) || 0, n && (i -= parseFloat(e.css(t, "border" + this + "Width")) || 0), s && (i -= parseFloat(e.css(t, "margin" + this)) || 0)
      }), i
    }
    var a = "Width" === n ? ["Left", "Right"] : ["Top", "Bottom"],
      o = n.toLowerCase(),
      r = {
        innerWidth: e.fn.innerWidth,
        innerHeight: e.fn.innerHeight,
        outerWidth: e.fn.outerWidth,
        outerHeight: e.fn.outerHeight
      };
    e.fn["inner" + n] = function(i) {
      return i === t ? r["inner" + n].call(this) : this.each(function() {
        e(this).css(o, s(this, i) + "px")
      })
    }, e.fn["outer" + n] = function(t, i) {
      return "number" != typeof t ? r["outer" + n].call(this, t) : this.each(function() {
        e(this).css(o, s(this, t, !0, i) + "px")
      })
    }
  }), e.fn.addBack || (e.fn.addBack = function(e) {
    return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
  }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function(t) {
    return function(i) {
      return arguments.length ? t.call(this, e.camelCase(i)) : t.call(this)
    }
  }(e.fn.removeData)), e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), e.support.selectstart = "onselectstart" in document.createElement("div"), e.fn.extend({
    disableSelection: function() {
      return this.bind((e.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function(e) {
        e.preventDefault()
      })
    },
    enableSelection: function() {
      return this.unbind(".ui-disableSelection")
    }
  }), e.extend(e.ui, {
    plugin: {
      add: function(t, i, n) {
        var s, a = e.ui[t].prototype;
        for (s in n) a.plugins[s] = a.plugins[s] || [], a.plugins[s].push([i, n[s]])
      },
      call: function(e, t, i) {
        var n, s = e.plugins[t];
        if (s && e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType)
          for (n = 0; s.length > n; n++) e.options[s[n][0]] && s[n][1].apply(e.element, i)
      }
    },
    hasScroll: function(t, i) {
      if ("hidden" === e(t).css("overflow")) return !1;
      var n = i && "left" === i ? "scrollLeft" : "scrollTop",
        s = !1;
      return t[n] > 0 ? !0 : (t[n] = 1, s = t[n] > 0, t[n] = 0, s)
    }
  })
})(jQuery);
(function(t, e) {
  var i = 0,
    s = Array.prototype.slice,
    n = t.cleanData;
  t.cleanData = function(e) {
    for (var i, s = 0; null != (i = e[s]); s++) try {
      t(i).triggerHandler("remove")
    } catch (o) {}
    n(e)
  }, t.widget = function(i, s, n) {
    var o, a, r, h, l = {},
      c = i.split(".")[0];
    i = i.split(".")[1], o = c + "-" + i, n || (n = s, s = t.Widget), t.expr[":"][o.toLowerCase()] = function(e) {
      return !!t.data(e, o)
    }, t[c] = t[c] || {}, a = t[c][i], r = t[c][i] = function(t, i) {
      return this._createWidget ? (arguments.length && this._createWidget(t, i), e) : new r(t, i)
    }, t.extend(r, a, {
      version: n.version,
      _proto: t.extend({}, n),
      _childConstructors: []
    }), h = new s, h.options = t.widget.extend({}, h.options), t.each(n, function(i, n) {
      return t.isFunction(n) ? (l[i] = function() {
        var t = function() {
            return s.prototype[i].apply(this, arguments)
          },
          e = function(t) {
            return s.prototype[i].apply(this, t)
          };
        return function() {
          var i, s = this._super,
            o = this._superApply;
          return this._super = t, this._superApply = e, i = n.apply(this, arguments), this._super = s, this._superApply = o, i
        }
      }(), e) : (l[i] = n, e)
    }), r.prototype = t.widget.extend(h, {
      widgetEventPrefix: a ? h.widgetEventPrefix || i : i
    }, l, {
      constructor: r,
      namespace: c,
      widgetName: i,
      widgetFullName: o
    }), a ? (t.each(a._childConstructors, function(e, i) {
      var s = i.prototype;
      t.widget(s.namespace + "." + s.widgetName, r, i._proto)
    }), delete a._childConstructors) : s._childConstructors.push(r), t.widget.bridge(i, r)
  }, t.widget.extend = function(i) {
    for (var n, o, a = s.call(arguments, 1), r = 0, h = a.length; h > r; r++)
      for (n in a[r]) o = a[r][n], a[r].hasOwnProperty(n) && o !== e && (i[n] = t.isPlainObject(o) ? t.isPlainObject(i[n]) ? t.widget.extend({}, i[n], o) : t.widget.extend({}, o) : o);
    return i
  }, t.widget.bridge = function(i, n) {
    var o = n.prototype.widgetFullName || i;
    t.fn[i] = function(a) {
      var r = "string" == typeof a,
        h = s.call(arguments, 1),
        l = this;
      return a = !r && h.length ? t.widget.extend.apply(null, [a].concat(h)) : a, r ? this.each(function() {
        var s, n = t.data(this, o);
        return n ? t.isFunction(n[a]) && "_" !== a.charAt(0) ? (s = n[a].apply(n, h), s !== n && s !== e ? (l = s && s.jquery ? l.pushStack(s.get()) : s, !1) : e) : t.error("no such method '" + a + "' for " + i + " widget instance") : t.error("cannot call methods on " + i + " prior to initialization; " + "attempted to call method '" + a + "'")
      }) : this.each(function() {
        var e = t.data(this, o);
        e ? e.option(a || {})._init() : t.data(this, o, new n(a, this))
      }), l
    }
  }, t.Widget = function() {}, t.Widget._childConstructors = [], t.Widget.prototype = {
    widgetName: "widget",
    widgetEventPrefix: "",
    defaultElement: "<div>",
    options: {
      disabled: !1,
      create: null
    },
    _createWidget: function(e, s) {
      s = t(s || this.defaultElement || this)[0], this.element = t(s), this.uuid = i++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e), this.bindings = t(), this.hoverable = t(), this.focusable = t(), s !== this && (t.data(s, this.widgetFullName, this), this._on(!0, this.element, {
        remove: function(t) {
          t.target === s && this.destroy()
        }
      }), this.document = t(s.style ? s.ownerDocument : s.document || s), this.window = t(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
    },
    _getCreateOptions: t.noop,
    _getCreateEventData: t.noop,
    _create: t.noop,
    _init: t.noop,
    destroy: function() {
      this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
    },
    _destroy: t.noop,
    widget: function() {
      return this.element
    },
    option: function(i, s) {
      var n, o, a, r = i;
      if (0 === arguments.length) return t.widget.extend({}, this.options);
      if ("string" == typeof i)
        if (r = {}, n = i.split("."), i = n.shift(), n.length) {
          for (o = r[i] = t.widget.extend({}, this.options[i]), a = 0; n.length - 1 > a; a++) o[n[a]] = o[n[a]] || {}, o = o[n[a]];
          if (i = n.pop(), 1 === arguments.length) return o[i] === e ? null : o[i];
          o[i] = s
        } else {
          if (1 === arguments.length) return this.options[i] === e ? null : this.options[i];
          r[i] = s
        }
      return this._setOptions(r), this
    },
    _setOptions: function(t) {
      var e;
      for (e in t) this._setOption(e, t[e]);
      return this
    },
    _setOption: function(t, e) {
      return this.options[t] = e, "disabled" === t && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!e).attr("aria-disabled", e), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")), this
    },
    enable: function() {
      return this._setOption("disabled", !1)
    },
    disable: function() {
      return this._setOption("disabled", !0)
    },
    _on: function(i, s, n) {
      var o, a = this;
      "boolean" != typeof i && (n = s, s = i, i = !1), n ? (s = o = t(s), this.bindings = this.bindings.add(s)) : (n = s, s = this.element, o = this.widget()), t.each(n, function(n, r) {
        function h() {
          return i || a.options.disabled !== !0 && !t(this).hasClass("ui-state-disabled") ? ("string" == typeof r ? a[r] : r).apply(a, arguments) : e
        }
        "string" != typeof r && (h.guid = r.guid = r.guid || h.guid || t.guid++);
        var l = n.match(/^(\w+)\s*(.*)$/),
          c = l[1] + a.eventNamespace,
          u = l[2];
        u ? o.delegate(u, c, h) : s.bind(c, h)
      })
    },
    _off: function(t, e) {
      e = (e || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, t.unbind(e).undelegate(e)
    },
    _delay: function(t, e) {
      function i() {
        return ("string" == typeof t ? s[t] : t).apply(s, arguments)
      }
      var s = this;
      return setTimeout(i, e || 0)
    },
    _hoverable: function(e) {
      this.hoverable = this.hoverable.add(e), this._on(e, {
        mouseenter: function(e) {
          t(e.currentTarget).addClass("ui-state-hover")
        },
        mouseleave: function(e) {
          t(e.currentTarget).removeClass("ui-state-hover")
        }
      })
    },
    _focusable: function(e) {
      this.focusable = this.focusable.add(e), this._on(e, {
        focusin: function(e) {
          t(e.currentTarget).addClass("ui-state-focus")
        },
        focusout: function(e) {
          t(e.currentTarget).removeClass("ui-state-focus")
        }
      })
    },
    _trigger: function(e, i, s) {
      var n, o, a = this.options[e];
      if (s = s || {}, i = t.Event(i), i.type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(), i.target = this.element[0], o = i.originalEvent)
        for (n in o) n in i || (i[n] = o[n]);
      return this.element.trigger(i, s), !(t.isFunction(a) && a.apply(this.element[0], [i].concat(s)) === !1 || i.isDefaultPrevented())
    }
  }, t.each({
    show: "fadeIn",
    hide: "fadeOut"
  }, function(e, i) {
    t.Widget.prototype["_" + e] = function(s, n, o) {
      "string" == typeof n && (n = {
        effect: n
      });
      var a, r = n ? n === !0 || "number" == typeof n ? i : n.effect || i : e;
      n = n || {}, "number" == typeof n && (n = {
        duration: n
      }), a = !t.isEmptyObject(n), n.complete = o, n.delay && s.delay(n.delay), a && t.effects && t.effects.effect[r] ? s[e](n) : r !== e && s[r] ? s[r](n.duration, n.easing, o) : s.queue(function(i) {
        t(this)[e](), o && o.call(s[0]), i()
      })
    }
  })
})(jQuery);
(function(t) {
  var e = !1;
  t(document).mouseup(function() {
    e = !1
  }), t.widget("ui.mouse", {
    version: "1.10.4",
    options: {
      cancel: "input,textarea,button,select,option",
      distance: 1,
      delay: 0
    },
    _mouseInit: function() {
      var e = this;
      this.element.bind("mousedown." + this.widgetName, function(t) {
        return e._mouseDown(t)
      }).bind("click." + this.widgetName, function(i) {
        return !0 === t.data(i.target, e.widgetName + ".preventClickEvent") ? (t.removeData(i.target, e.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1) : undefined
      }), this.started = !1
    },
    _mouseDestroy: function() {
      this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
    },
    _mouseDown: function(i) {
      if (!e) {
        this._mouseStarted && this._mouseUp(i), this._mouseDownEvent = i;
        var s = this,
          n = 1 === i.which,
          a = "string" == typeof this.options.cancel && i.target.nodeName ? t(i.target).closest(this.options.cancel).length : !1;
        return n && !a && this._mouseCapture(i) ? (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
          s.mouseDelayMet = !0
        }, this.options.delay)), this._mouseDistanceMet(i) && this._mouseDelayMet(i) && (this._mouseStarted = this._mouseStart(i) !== !1, !this._mouseStarted) ? (i.preventDefault(), !0) : (!0 === t.data(i.target, this.widgetName + ".preventClickEvent") && t.removeData(i.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function(t) {
          return s._mouseMove(t)
        }, this._mouseUpDelegate = function(t) {
          return s._mouseUp(t)
        }, t(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), i.preventDefault(), e = !0, !0)) : !0
      }
    },
    _mouseMove: function(e) {
      return t.ui.ie && (!document.documentMode || 9 > document.documentMode) && !e.button ? this._mouseUp(e) : this._mouseStarted ? (this._mouseDrag(e), e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, e) !== !1, this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)), !this._mouseStarted)
    },
    _mouseUp: function(e) {
      return t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(e)), !1
    },
    _mouseDistanceMet: function(t) {
      return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance
    },
    _mouseDelayMet: function() {
      return this.mouseDelayMet
    },
    _mouseStart: function() {},
    _mouseDrag: function() {},
    _mouseStop: function() {},
    _mouseCapture: function() {
      return !0
    }
  })
})(jQuery);
(function(t, e) {
  function i(t, e, i) {
    return [parseFloat(t[0]) * (p.test(t[0]) ? e / 100 : 1), parseFloat(t[1]) * (p.test(t[1]) ? i / 100 : 1)]
  }

  function s(e, i) {
    return parseInt(t.css(e, i), 10) || 0
  }

  function n(e) {
    var i = e[0];
    return 9 === i.nodeType ? {
      width: e.width(),
      height: e.height(),
      offset: {
        top: 0,
        left: 0
      }
    } : t.isWindow(i) ? {
      width: e.width(),
      height: e.height(),
      offset: {
        top: e.scrollTop(),
        left: e.scrollLeft()
      }
    } : i.preventDefault ? {
      width: 0,
      height: 0,
      offset: {
        top: i.pageY,
        left: i.pageX
      }
    } : {
      width: e.outerWidth(),
      height: e.outerHeight(),
      offset: e.offset()
    }
  }
  t.ui = t.ui || {};
  var a, o = Math.max,
    r = Math.abs,
    l = Math.round,
    h = /left|center|right/,
    c = /top|center|bottom/,
    u = /[\+\-]\d+(\.[\d]+)?%?/,
    d = /^\w+/,
    p = /%$/,
    f = t.fn.position;
  t.position = {
      scrollbarWidth: function() {
        if (a !== e) return a;
        var i, s, n = t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),
          o = n.children()[0];
        return t("body").append(n), i = o.offsetWidth, n.css("overflow", "scroll"), s = o.offsetWidth, i === s && (s = n[0].clientWidth), n.remove(), a = i - s
      },
      getScrollInfo: function(e) {
        var i = e.isWindow || e.isDocument ? "" : e.element.css("overflow-x"),
          s = e.isWindow || e.isDocument ? "" : e.element.css("overflow-y"),
          n = "scroll" === i || "auto" === i && e.width < e.element[0].scrollWidth,
          a = "scroll" === s || "auto" === s && e.height < e.element[0].scrollHeight;
        return {
          width: a ? t.position.scrollbarWidth() : 0,
          height: n ? t.position.scrollbarWidth() : 0
        }
      },
      getWithinInfo: function(e) {
        var i = t(e || window),
          s = t.isWindow(i[0]),
          n = !!i[0] && 9 === i[0].nodeType;
        return {
          element: i,
          isWindow: s,
          isDocument: n,
          offset: i.offset() || {
            left: 0,
            top: 0
          },
          scrollLeft: i.scrollLeft(),
          scrollTop: i.scrollTop(),
          width: s ? i.width() : i.outerWidth(),
          height: s ? i.height() : i.outerHeight()
        }
      }
    }, t.fn.position = function(e) {
      if (!e || !e.of) return f.apply(this, arguments);
      e = t.extend({}, e);
      var a, p, g, m, v, _, b = t(e.of),
        y = t.position.getWithinInfo(e.within),
        k = t.position.getScrollInfo(y),
        w = (e.collision || "flip").split(" "),
        D = {};
      return _ = n(b), b[0].preventDefault && (e.at = "left top"), p = _.width, g = _.height, m = _.offset, v = t.extend({}, m), t.each(["my", "at"], function() {
        var t, i, s = (e[this] || "").split(" ");
        1 === s.length && (s = h.test(s[0]) ? s.concat(["center"]) : c.test(s[0]) ? ["center"].concat(s) : ["center", "center"]), s[0] = h.test(s[0]) ? s[0] : "center", s[1] = c.test(s[1]) ? s[1] : "center", t = u.exec(s[0]), i = u.exec(s[1]), D[this] = [t ? t[0] : 0, i ? i[0] : 0], e[this] = [d.exec(s[0])[0], d.exec(s[1])[0]]
      }), 1 === w.length && (w[1] = w[0]), "right" === e.at[0] ? v.left += p : "center" === e.at[0] && (v.left += p / 2), "bottom" === e.at[1] ? v.top += g : "center" === e.at[1] && (v.top += g / 2), a = i(D.at, p, g), v.left += a[0], v.top += a[1], this.each(function() {
        var n, h, c = t(this),
          u = c.outerWidth(),
          d = c.outerHeight(),
          f = s(this, "marginLeft"),
          _ = s(this, "marginTop"),
          x = u + f + s(this, "marginRight") + k.width,
          C = d + _ + s(this, "marginBottom") + k.height,
          M = t.extend({}, v),
          T = i(D.my, c.outerWidth(), c.outerHeight());
        "right" === e.my[0] ? M.left -= u : "center" === e.my[0] && (M.left -= u / 2), "bottom" === e.my[1] ? M.top -= d : "center" === e.my[1] && (M.top -= d / 2), M.left += T[0], M.top += T[1], t.support.offsetFractions || (M.left = l(M.left), M.top = l(M.top)), n = {
          marginLeft: f,
          marginTop: _
        }, t.each(["left", "top"], function(i, s) {
          t.ui.position[w[i]] && t.ui.position[w[i]][s](M, {
            targetWidth: p,
            targetHeight: g,
            elemWidth: u,
            elemHeight: d,
            collisionPosition: n,
            collisionWidth: x,
            collisionHeight: C,
            offset: [a[0] + T[0], a[1] + T[1]],
            my: e.my,
            at: e.at,
            within: y,
            elem: c
          })
        }), e.using && (h = function(t) {
          var i = m.left - M.left,
            s = i + p - u,
            n = m.top - M.top,
            a = n + g - d,
            l = {
              target: {
                element: b,
                left: m.left,
                top: m.top,
                width: p,
                height: g
              },
              element: {
                element: c,
                left: M.left,
                top: M.top,
                width: u,
                height: d
              },
              horizontal: 0 > s ? "left" : i > 0 ? "right" : "center",
              vertical: 0 > a ? "top" : n > 0 ? "bottom" : "middle"
            };
          u > p && p > r(i + s) && (l.horizontal = "center"), d > g && g > r(n + a) && (l.vertical = "middle"), l.important = o(r(i), r(s)) > o(r(n), r(a)) ? "horizontal" : "vertical", e.using.call(this, t, l)
        }), c.offset(t.extend(M, {
          using: h
        }))
      })
    }, t.ui.position = {
      fit: {
        left: function(t, e) {
          var i, s = e.within,
            n = s.isWindow ? s.scrollLeft : s.offset.left,
            a = s.width,
            r = t.left - e.collisionPosition.marginLeft,
            l = n - r,
            h = r + e.collisionWidth - a - n;
          e.collisionWidth > a ? l > 0 && 0 >= h ? (i = t.left + l + e.collisionWidth - a - n, t.left += l - i) : t.left = h > 0 && 0 >= l ? n : l > h ? n + a - e.collisionWidth : n : l > 0 ? t.left += l : h > 0 ? t.left -= h : t.left = o(t.left - r, t.left)
        },
        top: function(t, e) {
          var i, s = e.within,
            n = s.isWindow ? s.scrollTop : s.offset.top,
            a = e.within.height,
            r = t.top - e.collisionPosition.marginTop,
            l = n - r,
            h = r + e.collisionHeight - a - n;
          e.collisionHeight > a ? l > 0 && 0 >= h ? (i = t.top + l + e.collisionHeight - a - n, t.top += l - i) : t.top = h > 0 && 0 >= l ? n : l > h ? n + a - e.collisionHeight : n : l > 0 ? t.top += l : h > 0 ? t.top -= h : t.top = o(t.top - r, t.top)
        }
      },
      flip: {
        left: function(t, e) {
          var i, s, n = e.within,
            a = n.offset.left + n.scrollLeft,
            o = n.width,
            l = n.isWindow ? n.scrollLeft : n.offset.left,
            h = t.left - e.collisionPosition.marginLeft,
            c = h - l,
            u = h + e.collisionWidth - o - l,
            d = "left" === e.my[0] ? -e.elemWidth : "right" === e.my[0] ? e.elemWidth : 0,
            p = "left" === e.at[0] ? e.targetWidth : "right" === e.at[0] ? -e.targetWidth : 0,
            f = -2 * e.offset[0];
          0 > c ? (i = t.left + d + p + f + e.collisionWidth - o - a, (0 > i || r(c) > i) && (t.left += d + p + f)) : u > 0 && (s = t.left - e.collisionPosition.marginLeft + d + p + f - l, (s > 0 || u > r(s)) && (t.left += d + p + f))
        },
        top: function(t, e) {
          var i, s, n = e.within,
            a = n.offset.top + n.scrollTop,
            o = n.height,
            l = n.isWindow ? n.scrollTop : n.offset.top,
            h = t.top - e.collisionPosition.marginTop,
            c = h - l,
            u = h + e.collisionHeight - o - l,
            d = "top" === e.my[1],
            p = d ? -e.elemHeight : "bottom" === e.my[1] ? e.elemHeight : 0,
            f = "top" === e.at[1] ? e.targetHeight : "bottom" === e.at[1] ? -e.targetHeight : 0,
            g = -2 * e.offset[1];
          0 > c ? (s = t.top + p + f + g + e.collisionHeight - o - a, t.top + p + f + g > c && (0 > s || r(c) > s) && (t.top += p + f + g)) : u > 0 && (i = t.top - e.collisionPosition.marginTop + p + f + g - l, t.top + p + f + g > u && (i > 0 || u > r(i)) && (t.top += p + f + g))
        }
      },
      flipfit: {
        left: function() {
          t.ui.position.flip.left.apply(this, arguments), t.ui.position.fit.left.apply(this, arguments)
        },
        top: function() {
          t.ui.position.flip.top.apply(this, arguments), t.ui.position.fit.top.apply(this, arguments)
        }
      }
    },
    function() {
      var e, i, s, n, a, o = document.getElementsByTagName("body")[0],
        r = document.createElement("div");
      e = document.createElement(o ? "div" : "body"), s = {
        visibility: "hidden",
        width: 0,
        height: 0,
        border: 0,
        margin: 0,
        background: "none"
      }, o && t.extend(s, {
        position: "absolute",
        left: "-1000px",
        top: "-1000px"
      });
      for (a in s) e.style[a] = s[a];
      e.appendChild(r), i = o || document.documentElement, i.insertBefore(e, i.firstChild), r.style.cssText = "position: absolute; left: 10.7432222px;", n = t(r).offset().left, t.support.offsetFractions = n > 10 && 11 > n, e.innerHTML = "", i.removeChild(e)
    }()
})(jQuery);
(function(t) {
  t.widget("ui.draggable", t.ui.mouse, {
    version: "1.10.4",
    widgetEventPrefix: "drag",
    options: {
      addClasses: !0,
      appendTo: "parent",
      axis: !1,
      connectToSortable: !1,
      containment: !1,
      cursor: "auto",
      cursorAt: !1,
      grid: !1,
      handle: !1,
      helper: "original",
      iframeFix: !1,
      opacity: !1,
      refreshPositions: !1,
      revert: !1,
      revertDuration: 500,
      scope: "default",
      scroll: !0,
      scrollSensitivity: 20,
      scrollSpeed: 20,
      snap: !1,
      snapMode: "both",
      snapTolerance: 20,
      stack: !1,
      zIndex: !1,
      drag: null,
      start: null,
      stop: null
    },
    _create: function() {
      "original" !== this.options.helper || /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative"), this.options.addClasses && this.element.addClass("ui-draggable"), this.options.disabled && this.element.addClass("ui-draggable-disabled"), this._mouseInit()
    },
    _destroy: function() {
      this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"), this._mouseDestroy()
    },
    _mouseCapture: function(e) {
      var i = this.options;
      return this.helper || i.disabled || t(e.target).closest(".ui-resizable-handle").length > 0 ? !1 : (this.handle = this._getHandle(e), this.handle ? (t(i.iframeFix === !0 ? "iframe" : i.iframeFix).each(function() {
        t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({
          width: this.offsetWidth + "px",
          height: this.offsetHeight + "px",
          position: "absolute",
          opacity: "0.001",
          zIndex: 1e3
        }).css(t(this).offset()).appendTo("body")
      }), !0) : !1)
    },
    _mouseStart: function(e) {
      var i = this.options;
      return this.helper = this._createHelper(e), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), t.ui.ddmanager && (t.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(), this.offsetParent = this.helper.offsetParent(), this.offsetParentCssPosition = this.offsetParent.css("position"), this.offset = this.positionAbs = this.element.offset(), this.offset = {
        top: this.offset.top - this.margins.top,
        left: this.offset.left - this.margins.left
      }, this.offset.scroll = !1, t.extend(this.offset, {
        click: {
          left: e.pageX - this.offset.left,
          top: e.pageY - this.offset.top
        },
        parent: this._getParentOffset(),
        relative: this._getRelativeOffset()
      }), this.originalPosition = this.position = this._generatePosition(e), this.originalPageX = e.pageX, this.originalPageY = e.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this._setContainment(), this._trigger("start", e) === !1 ? (this._clear(), !1) : (this._cacheHelperProportions(), t.ui.ddmanager && !i.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e), this._mouseDrag(e, !0), t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e), !0)
    },
    _mouseDrag: function(e, i) {
      if ("fixed" === this.offsetParentCssPosition && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(e), this.positionAbs = this._convertPositionTo("absolute"), !i) {
        var s = this._uiHash();
        if (this._trigger("drag", e, s) === !1) return this._mouseUp({}), !1;
        this.position = s.position
      }
      return this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"), this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"), t.ui.ddmanager && t.ui.ddmanager.drag(this, e), !1
    },
    _mouseStop: function(e) {
      var i = this,
        s = !1;
      return t.ui.ddmanager && !this.options.dropBehaviour && (s = t.ui.ddmanager.drop(this, e)), this.dropped && (s = this.dropped, this.dropped = !1), "original" !== this.options.helper || t.contains(this.element[0].ownerDocument, this.element[0]) ? ("invalid" === this.options.revert && !s || "valid" === this.options.revert && s || this.options.revert === !0 || t.isFunction(this.options.revert) && this.options.revert.call(this.element, s) ? t(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
        i._trigger("stop", e) !== !1 && i._clear()
      }) : this._trigger("stop", e) !== !1 && this._clear(), !1) : !1
    },
    _mouseUp: function(e) {
      return t("div.ui-draggable-iframeFix").each(function() {
        this.parentNode.removeChild(this)
      }), t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e), t.ui.mouse.prototype._mouseUp.call(this, e)
    },
    cancel: function() {
      return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this
    },
    _getHandle: function(e) {
      return this.options.handle ? !!t(e.target).closest(this.element.find(this.options.handle)).length : !0
    },
    _createHelper: function(e) {
      var i = this.options,
        s = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element;
      return s.parents("body").length || s.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo), s[0] === this.element[0] || /(fixed|absolute)/.test(s.css("position")) || s.css("position", "absolute"), s
    },
    _adjustOffsetFromHelper: function(e) {
      "string" == typeof e && (e = e.split(" ")), t.isArray(e) && (e = {
        left: +e[0],
        top: +e[1] || 0
      }), "left" in e && (this.offset.click.left = e.left + this.margins.left), "right" in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left), "top" in e && (this.offset.click.top = e.top + this.margins.top), "bottom" in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
    },
    _getParentOffset: function() {
      var e = this.offsetParent.offset();
      return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
        top: 0,
        left: 0
      }), {
        top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
        left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
      }
    },
    _getRelativeOffset: function() {
      if ("relative" === this.cssPosition) {
        var t = this.element.position();
        return {
          top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
          left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
        }
      }
      return {
        top: 0,
        left: 0
      }
    },
    _cacheMargins: function() {
      this.margins = {
        left: parseInt(this.element.css("marginLeft"), 10) || 0,
        top: parseInt(this.element.css("marginTop"), 10) || 0,
        right: parseInt(this.element.css("marginRight"), 10) || 0,
        bottom: parseInt(this.element.css("marginBottom"), 10) || 0
      }
    },
    _cacheHelperProportions: function() {
      this.helperProportions = {
        width: this.helper.outerWidth(),
        height: this.helper.outerHeight()
      }
    },
    _setContainment: function() {
      var e, i, s, n = this.options;
      return n.containment ? "window" === n.containment ? (this.containment = [t(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, t(window).scrollLeft() + t(window).width() - this.helperProportions.width - this.margins.left, t(window).scrollTop() + (t(window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top], undefined) : "document" === n.containment ? (this.containment = [0, 0, t(document).width() - this.helperProportions.width - this.margins.left, (t(document).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top], undefined) : n.containment.constructor === Array ? (this.containment = n.containment, undefined) : ("parent" === n.containment && (n.containment = this.helper[0].parentNode), i = t(n.containment), s = i[0], s && (e = "hidden" !== i.css("overflow"), this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (e ? Math.max(s.scrollWidth, s.offsetWidth) : s.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (e ? Math.max(s.scrollHeight, s.offsetHeight) : s.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relative_container = i), undefined) : (this.containment = null, undefined)
    },
    _convertPositionTo: function(e, i) {
      i || (i = this.position);
      var s = "absolute" === e ? 1 : -1,
        n = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent;
      return this.offset.scroll || (this.offset.scroll = {
        top: n.scrollTop(),
        left: n.scrollLeft()
      }), {
        top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top) * s,
        left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left) * s
      }
    },
    _generatePosition: function(e) {
      var i, s, n, a, o = this.options,
        r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
        l = e.pageX,
        h = e.pageY;
      return this.offset.scroll || (this.offset.scroll = {
        top: r.scrollTop(),
        left: r.scrollLeft()
      }), this.originalPosition && (this.containment && (this.relative_container ? (s = this.relative_container.offset(), i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment, e.pageX - this.offset.click.left < i[0] && (l = i[0] + this.offset.click.left), e.pageY - this.offset.click.top < i[1] && (h = i[1] + this.offset.click.top), e.pageX - this.offset.click.left > i[2] && (l = i[2] + this.offset.click.left), e.pageY - this.offset.click.top > i[3] && (h = i[3] + this.offset.click.top)), o.grid && (n = o.grid[1] ? this.originalPageY + Math.round((h - this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY, h = i ? n - this.offset.click.top >= i[1] || n - this.offset.click.top > i[3] ? n : n - this.offset.click.top >= i[1] ? n - o.grid[1] : n + o.grid[1] : n, a = o.grid[0] ? this.originalPageX + Math.round((l - this.originalPageX) / o.grid[0]) * o.grid[0] : this.originalPageX, l = i ? a - this.offset.click.left >= i[0] || a - this.offset.click.left > i[2] ? a : a - this.offset.click.left >= i[0] ? a - o.grid[0] : a + o.grid[0] : a)), {
        top: h - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top),
        left: l - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left)
      }
    },
    _clear: function() {
      this.helper.removeClass("ui-draggable-dragging"), this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(), this.helper = null, this.cancelHelperRemoval = !1
    },
    _trigger: function(e, i, s) {
      return s = s || this._uiHash(), t.ui.plugin.call(this, e, [i, s]), "drag" === e && (this.positionAbs = this._convertPositionTo("absolute")), t.Widget.prototype._trigger.call(this, e, i, s)
    },
    plugins: {},
    _uiHash: function() {
      return {
        helper: this.helper,
        position: this.position,
        originalPosition: this.originalPosition,
        offset: this.positionAbs
      }
    }
  }), t.ui.plugin.add("draggable", "connectToSortable", {
    start: function(e, i) {
      var s = t(this).data("ui-draggable"),
        n = s.options,
        a = t.extend({}, i, {
          item: s.element
        });
      s.sortables = [], t(n.connectToSortable).each(function() {
        var i = t.data(this, "ui-sortable");
        i && !i.options.disabled && (s.sortables.push({
          instance: i,
          shouldRevert: i.options.revert
        }), i.refreshPositions(), i._trigger("activate", e, a))
      })
    },
    stop: function(e, i) {
      var s = t(this).data("ui-draggable"),
        n = t.extend({}, i, {
          item: s.element
        });
      t.each(s.sortables, function() {
        this.instance.isOver ? (this.instance.isOver = 0, s.cancelHelperRemoval = !0, this.instance.cancelHelperRemoval = !1, this.shouldRevert && (this.instance.options.revert = this.shouldRevert), this.instance._mouseStop(e), this.instance.options.helper = this.instance.options._helper, "original" === s.options.helper && this.instance.currentItem.css({
          top: "auto",
          left: "auto"
        })) : (this.instance.cancelHelperRemoval = !1, this.instance._trigger("deactivate", e, n))
      })
    },
    drag: function(e, i) {
      var s = t(this).data("ui-draggable"),
        n = this;
      t.each(s.sortables, function() {
        var a = !1,
          o = this;
        this.instance.positionAbs = s.positionAbs, this.instance.helperProportions = s.helperProportions, this.instance.offset.click = s.offset.click, this.instance._intersectsWith(this.instance.containerCache) && (a = !0, t.each(s.sortables, function() {
          return this.instance.positionAbs = s.positionAbs, this.instance.helperProportions = s.helperProportions, this.instance.offset.click = s.offset.click, this !== o && this.instance._intersectsWith(this.instance.containerCache) && t.contains(o.instance.element[0], this.instance.element[0]) && (a = !1), a
        })), a ? (this.instance.isOver || (this.instance.isOver = 1, this.instance.currentItem = t(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item", !0), this.instance.options._helper = this.instance.options.helper, this.instance.options.helper = function() {
          return i.helper[0]
        }, e.target = this.instance.currentItem[0], this.instance._mouseCapture(e, !0), this.instance._mouseStart(e, !0, !0), this.instance.offset.click.top = s.offset.click.top, this.instance.offset.click.left = s.offset.click.left, this.instance.offset.parent.left -= s.offset.parent.left - this.instance.offset.parent.left, this.instance.offset.parent.top -= s.offset.parent.top - this.instance.offset.parent.top, s._trigger("toSortable", e), s.dropped = this.instance.element, s.currentItem = s.element, this.instance.fromOutside = s), this.instance.currentItem && this.instance._mouseDrag(e)) : this.instance.isOver && (this.instance.isOver = 0, this.instance.cancelHelperRemoval = !0, this.instance.options.revert = !1, this.instance._trigger("out", e, this.instance._uiHash(this.instance)), this.instance._mouseStop(e, !0), this.instance.options.helper = this.instance.options._helper, this.instance.currentItem.remove(), this.instance.placeholder && this.instance.placeholder.remove(), s._trigger("fromSortable", e), s.dropped = !1)
      })
    }
  }), t.ui.plugin.add("draggable", "cursor", {
    start: function() {
      var e = t("body"),
        i = t(this).data("ui-draggable").options;
      e.css("cursor") && (i._cursor = e.css("cursor")), e.css("cursor", i.cursor)
    },
    stop: function() {
      var e = t(this).data("ui-draggable").options;
      e._cursor && t("body").css("cursor", e._cursor)
    }
  }), t.ui.plugin.add("draggable", "opacity", {
    start: function(e, i) {
      var s = t(i.helper),
        n = t(this).data("ui-draggable").options;
      s.css("opacity") && (n._opacity = s.css("opacity")), s.css("opacity", n.opacity)
    },
    stop: function(e, i) {
      var s = t(this).data("ui-draggable").options;
      s._opacity && t(i.helper).css("opacity", s._opacity)
    }
  }), t.ui.plugin.add("draggable", "scroll", {
    start: function() {
      var e = t(this).data("ui-draggable");
      e.scrollParent[0] !== document && "HTML" !== e.scrollParent[0].tagName && (e.overflowOffset = e.scrollParent.offset())
    },
    drag: function(e) {
      var i = t(this).data("ui-draggable"),
        s = i.options,
        n = !1;
      i.scrollParent[0] !== document && "HTML" !== i.scrollParent[0].tagName ? (s.axis && "x" === s.axis || (i.overflowOffset.top + i.scrollParent[0].offsetHeight - e.pageY < s.scrollSensitivity ? i.scrollParent[0].scrollTop = n = i.scrollParent[0].scrollTop + s.scrollSpeed : e.pageY - i.overflowOffset.top < s.scrollSensitivity && (i.scrollParent[0].scrollTop = n = i.scrollParent[0].scrollTop - s.scrollSpeed)), s.axis && "y" === s.axis || (i.overflowOffset.left + i.scrollParent[0].offsetWidth - e.pageX < s.scrollSensitivity ? i.scrollParent[0].scrollLeft = n = i.scrollParent[0].scrollLeft + s.scrollSpeed : e.pageX - i.overflowOffset.left < s.scrollSensitivity && (i.scrollParent[0].scrollLeft = n = i.scrollParent[0].scrollLeft - s.scrollSpeed))) : (s.axis && "x" === s.axis || (e.pageY - t(document).scrollTop() < s.scrollSensitivity ? n = t(document).scrollTop(t(document).scrollTop() - s.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < s.scrollSensitivity && (n = t(document).scrollTop(t(document).scrollTop() + s.scrollSpeed))), s.axis && "y" === s.axis || (e.pageX - t(document).scrollLeft() < s.scrollSensitivity ? n = t(document).scrollLeft(t(document).scrollLeft() - s.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < s.scrollSensitivity && (n = t(document).scrollLeft(t(document).scrollLeft() + s.scrollSpeed)))), n !== !1 && t.ui.ddmanager && !s.dropBehaviour && t.ui.ddmanager.prepareOffsets(i, e)
    }
  }), t.ui.plugin.add("draggable", "snap", {
    start: function() {
      var e = t(this).data("ui-draggable"),
        i = e.options;
      e.snapElements = [], t(i.snap.constructor !== String ? i.snap.items || ":data(ui-draggable)" : i.snap).each(function() {
        var i = t(this),
          s = i.offset();
        this !== e.element[0] && e.snapElements.push({
          item: this,
          width: i.outerWidth(),
          height: i.outerHeight(),
          top: s.top,
          left: s.left
        })
      })
    },
    drag: function(e, i) {
      var s, n, a, o, r, l, h, c, u, d, p = t(this).data("ui-draggable"),
        g = p.options,
        f = g.snapTolerance,
        m = i.offset.left,
        _ = m + p.helperProportions.width,
        v = i.offset.top,
        b = v + p.helperProportions.height;
      for (u = p.snapElements.length - 1; u >= 0; u--) r = p.snapElements[u].left, l = r + p.snapElements[u].width, h = p.snapElements[u].top, c = h + p.snapElements[u].height, r - f > _ || m > l + f || h - f > b || v > c + f || !t.contains(p.snapElements[u].item.ownerDocument, p.snapElements[u].item) ? (p.snapElements[u].snapping && p.options.snap.release && p.options.snap.release.call(p.element, e, t.extend(p._uiHash(), {
        snapItem: p.snapElements[u].item
      })), p.snapElements[u].snapping = !1) : ("inner" !== g.snapMode && (s = f >= Math.abs(h - b), n = f >= Math.abs(c - v), a = f >= Math.abs(r - _), o = f >= Math.abs(l - m), s && (i.position.top = p._convertPositionTo("relative", {
        top: h - p.helperProportions.height,
        left: 0
      }).top - p.margins.top), n && (i.position.top = p._convertPositionTo("relative", {
        top: c,
        left: 0
      }).top - p.margins.top), a && (i.position.left = p._convertPositionTo("relative", {
        top: 0,
        left: r - p.helperProportions.width
      }).left - p.margins.left), o && (i.position.left = p._convertPositionTo("relative", {
        top: 0,
        left: l
      }).left - p.margins.left)), d = s || n || a || o, "outer" !== g.snapMode && (s = f >= Math.abs(h - v), n = f >= Math.abs(c - b), a = f >= Math.abs(r - m), o = f >= Math.abs(l - _), s && (i.position.top = p._convertPositionTo("relative", {
        top: h,
        left: 0
      }).top - p.margins.top), n && (i.position.top = p._convertPositionTo("relative", {
        top: c - p.helperProportions.height,
        left: 0
      }).top - p.margins.top), a && (i.position.left = p._convertPositionTo("relative", {
        top: 0,
        left: r
      }).left - p.margins.left), o && (i.position.left = p._convertPositionTo("relative", {
        top: 0,
        left: l - p.helperProportions.width
      }).left - p.margins.left)), !p.snapElements[u].snapping && (s || n || a || o || d) && p.options.snap.snap && p.options.snap.snap.call(p.element, e, t.extend(p._uiHash(), {
        snapItem: p.snapElements[u].item
      })), p.snapElements[u].snapping = s || n || a || o || d)
    }
  }), t.ui.plugin.add("draggable", "stack", {
    start: function() {
      var e, i = this.data("ui-draggable").options,
        s = t.makeArray(t(i.stack)).sort(function(e, i) {
          return (parseInt(t(e).css("zIndex"), 10) || 0) - (parseInt(t(i).css("zIndex"), 10) || 0)
        });
      s.length && (e = parseInt(t(s[0]).css("zIndex"), 10) || 0, t(s).each(function(i) {
        t(this).css("zIndex", e + i)
      }), this.css("zIndex", e + s.length))
    }
  }), t.ui.plugin.add("draggable", "zIndex", {
    start: function(e, i) {
      var s = t(i.helper),
        n = t(this).data("ui-draggable").options;
      s.css("zIndex") && (n._zIndex = s.css("zIndex")), s.css("zIndex", n.zIndex)
    },
    stop: function(e, i) {
      var s = t(this).data("ui-draggable").options;
      s._zIndex && t(i.helper).css("zIndex", s._zIndex)
    }
  })
})(jQuery);
(function(t) {
  function e(t) {
    return parseInt(t, 10) || 0
  }

  function i(t) {
    return !isNaN(parseInt(t, 10))
  }
  t.widget("ui.resizable", t.ui.mouse, {
    version: "1.10.4",
    widgetEventPrefix: "resize",
    options: {
      alsoResize: !1,
      animate: !1,
      animateDuration: "slow",
      animateEasing: "swing",
      aspectRatio: !1,
      autoHide: !1,
      containment: !1,
      ghost: !1,
      grid: !1,
      handles: "e,s,se",
      helper: !1,
      maxHeight: null,
      maxWidth: null,
      minHeight: 10,
      minWidth: 10,
      zIndex: 90,
      resize: null,
      start: null,
      stop: null
    },
    _create: function() {
      var e, i, s, n, a, o = this,
        r = this.options;
      if (this.element.addClass("ui-resizable"), t.extend(this, {
          _aspectRatio: !!r.aspectRatio,
          aspectRatio: r.aspectRatio,
          originalElement: this.element,
          _proportionallyResizeElements: [],
          _helper: r.helper || r.ghost || r.animate ? r.helper || "ui-resizable-helper" : null
        }), this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i) && (this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
          position: this.element.css("position"),
          width: this.element.outerWidth(),
          height: this.element.outerHeight(),
          top: this.element.css("top"),
          left: this.element.css("left")
        })), this.element = this.element.parent().data("ui-resizable", this.element.data("ui-resizable")), this.elementIsWrapper = !0, this.element.css({
          marginLeft: this.originalElement.css("marginLeft"),
          marginTop: this.originalElement.css("marginTop"),
          marginRight: this.originalElement.css("marginRight"),
          marginBottom: this.originalElement.css("marginBottom")
        }), this.originalElement.css({
          marginLeft: 0,
          marginTop: 0,
          marginRight: 0,
          marginBottom: 0
        }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({
          position: "static",
          zoom: 1,
          display: "block"
        })), this.originalElement.css({
          margin: this.originalElement.css("margin")
        }), this._proportionallyResize()), this.handles = r.handles || (t(".ui-resizable-handle", this.element).length ? {
          n: ".ui-resizable-n",
          e: ".ui-resizable-e",
          s: ".ui-resizable-s",
          w: ".ui-resizable-w",
          se: ".ui-resizable-se",
          sw: ".ui-resizable-sw",
          ne: ".ui-resizable-ne",
          nw: ".ui-resizable-nw"
        } : "e,s,se"), this.handles.constructor === String)
        for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"), e = this.handles.split(","), this.handles = {}, i = 0; e.length > i; i++) s = t.trim(e[i]), a = "ui-resizable-" + s, n = t("<div class='ui-resizable-handle " + a + "'></div>"), n.css({
          zIndex: r.zIndex
        }), "se" === s && n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[s] = ".ui-resizable-" + s, this.element.append(n);
      this._renderAxis = function(e) {
        var i, s, n, a;
        e = e || this.element;
        for (i in this.handles) this.handles[i].constructor === String && (this.handles[i] = t(this.handles[i], this.element).show()), this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i) && (s = t(this.handles[i], this.element), a = /sw|ne|nw|se|n|s/.test(i) ? s.outerHeight() : s.outerWidth(), n = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""), e.css(n, a), this._proportionallyResize()), t(this.handles[i]).length
      }, this._renderAxis(this.element), this._handles = t(".ui-resizable-handle", this.element).disableSelection(), this._handles.mouseover(function() {
        o.resizing || (this.className && (n = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), o.axis = n && n[1] ? n[1] : "se")
      }), r.autoHide && (this._handles.hide(), t(this.element).addClass("ui-resizable-autohide").mouseenter(function() {
        r.disabled || (t(this).removeClass("ui-resizable-autohide"), o._handles.show())
      }).mouseleave(function() {
        r.disabled || o.resizing || (t(this).addClass("ui-resizable-autohide"), o._handles.hide())
      })), this._mouseInit()
    },
    _destroy: function() {
      this._mouseDestroy();
      var e, i = function(e) {
        t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()
      };
      return this.elementIsWrapper && (i(this.element), e = this.element, this.originalElement.css({
        position: e.css("position"),
        width: e.outerWidth(),
        height: e.outerHeight(),
        top: e.css("top"),
        left: e.css("left")
      }).insertAfter(e), e.remove()), this.originalElement.css("resize", this.originalResizeStyle), i(this.originalElement), this
    },
    _mouseCapture: function(e) {
      var i, s, n = !1;
      for (i in this.handles) s = t(this.handles[i])[0], (s === e.target || t.contains(s, e.target)) && (n = !0);
      return !this.options.disabled && n
    },
    _mouseStart: function(i) {
      var s, n, a, o = this.options,
        r = this.element.position(),
        h = this.element;
      return this.resizing = !0, /absolute/.test(h.css("position")) ? h.css({
        position: "absolute",
        top: h.css("top"),
        left: h.css("left")
      }) : h.is(".ui-draggable") && h.css({
        position: "absolute",
        top: r.top,
        left: r.left
      }), this._renderProxy(), s = e(this.helper.css("left")), n = e(this.helper.css("top")), o.containment && (s += t(o.containment).scrollLeft() || 0, n += t(o.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = {
        left: s,
        top: n
      }, this.size = this._helper ? {
        width: this.helper.width(),
        height: this.helper.height()
      } : {
        width: h.width(),
        height: h.height()
      }, this.originalSize = this._helper ? {
        width: h.outerWidth(),
        height: h.outerHeight()
      } : {
        width: h.width(),
        height: h.height()
      }, this.originalPosition = {
        left: s,
        top: n
      }, this.sizeDiff = {
        width: h.outerWidth() - h.width(),
        height: h.outerHeight() - h.height()
      }, this.originalMousePosition = {
        left: i.pageX,
        top: i.pageY
      }, this.aspectRatio = "number" == typeof o.aspectRatio ? o.aspectRatio : this.originalSize.width / this.originalSize.height || 1, a = t(".ui-resizable-" + this.axis).css("cursor"), t("body").css("cursor", "auto" === a ? this.axis + "-resize" : a), h.addClass("ui-resizable-resizing"), this._propagate("start", i), !0
    },
    _mouseDrag: function(e) {
      var i, s = this.helper,
        n = {},
        a = this.originalMousePosition,
        o = this.axis,
        r = this.position.top,
        h = this.position.left,
        l = this.size.width,
        c = this.size.height,
        u = e.pageX - a.left || 0,
        d = e.pageY - a.top || 0,
        p = this._change[o];
      return p ? (i = p.apply(this, [e, u, d]), this._updateVirtualBoundaries(e.shiftKey), (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)), i = this._respectSize(i, e), this._updateCache(i), this._propagate("resize", e), this.position.top !== r && (n.top = this.position.top + "px"), this.position.left !== h && (n.left = this.position.left + "px"), this.size.width !== l && (n.width = this.size.width + "px"), this.size.height !== c && (n.height = this.size.height + "px"), s.css(n), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), t.isEmptyObject(n) || this._trigger("resize", e, this.ui()), !1) : !1
    },
    _mouseStop: function(e) {
      this.resizing = !1;
      var i, s, n, a, o, r, h, l = this.options,
        c = this;
      return this._helper && (i = this._proportionallyResizeElements, s = i.length && /textarea/i.test(i[0].nodeName), n = s && t.ui.hasScroll(i[0], "left") ? 0 : c.sizeDiff.height, a = s ? 0 : c.sizeDiff.width, o = {
        width: c.helper.width() - a,
        height: c.helper.height() - n
      }, r = parseInt(c.element.css("left"), 10) + (c.position.left - c.originalPosition.left) || null, h = parseInt(c.element.css("top"), 10) + (c.position.top - c.originalPosition.top) || null, l.animate || this.element.css(t.extend(o, {
        top: h,
        left: r
      })), c.helper.height(c.size.height), c.helper.width(c.size.width), this._helper && !l.animate && this._proportionallyResize()), t("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", e), this._helper && this.helper.remove(), !1
    },
    _updateVirtualBoundaries: function(t) {
      var e, s, n, a, o, r = this.options;
      o = {
        minWidth: i(r.minWidth) ? r.minWidth : 0,
        maxWidth: i(r.maxWidth) ? r.maxWidth : 1 / 0,
        minHeight: i(r.minHeight) ? r.minHeight : 0,
        maxHeight: i(r.maxHeight) ? r.maxHeight : 1 / 0
      }, (this._aspectRatio || t) && (e = o.minHeight * this.aspectRatio, n = o.minWidth / this.aspectRatio, s = o.maxHeight * this.aspectRatio, a = o.maxWidth / this.aspectRatio, e > o.minWidth && (o.minWidth = e), n > o.minHeight && (o.minHeight = n), o.maxWidth > s && (o.maxWidth = s), o.maxHeight > a && (o.maxHeight = a)), this._vBoundaries = o
    },
    _updateCache: function(t) {
      this.offset = this.helper.offset(), i(t.left) && (this.position.left = t.left), i(t.top) && (this.position.top = t.top), i(t.height) && (this.size.height = t.height), i(t.width) && (this.size.width = t.width)
    },
    _updateRatio: function(t) {
      var e = this.position,
        s = this.size,
        n = this.axis;
      return i(t.height) ? t.width = t.height * this.aspectRatio : i(t.width) && (t.height = t.width / this.aspectRatio), "sw" === n && (t.left = e.left + (s.width - t.width), t.top = null), "nw" === n && (t.top = e.top + (s.height - t.height), t.left = e.left + (s.width - t.width)), t
    },
    _respectSize: function(t) {
      var e = this._vBoundaries,
        s = this.axis,
        n = i(t.width) && e.maxWidth && e.maxWidth < t.width,
        a = i(t.height) && e.maxHeight && e.maxHeight < t.height,
        o = i(t.width) && e.minWidth && e.minWidth > t.width,
        r = i(t.height) && e.minHeight && e.minHeight > t.height,
        h = this.originalPosition.left + this.originalSize.width,
        l = this.position.top + this.size.height,
        c = /sw|nw|w/.test(s),
        u = /nw|ne|n/.test(s);
      return o && (t.width = e.minWidth), r && (t.height = e.minHeight), n && (t.width = e.maxWidth), a && (t.height = e.maxHeight), o && c && (t.left = h - e.minWidth), n && c && (t.left = h - e.maxWidth), r && u && (t.top = l - e.minHeight), a && u && (t.top = l - e.maxHeight), t.width || t.height || t.left || !t.top ? t.width || t.height || t.top || !t.left || (t.left = null) : t.top = null, t
    },
    _proportionallyResize: function() {
      if (this._proportionallyResizeElements.length) {
        var t, e, i, s, n, a = this.helper || this.element;
        for (t = 0; this._proportionallyResizeElements.length > t; t++) {
          if (n = this._proportionallyResizeElements[t], !this.borderDif)
            for (this.borderDif = [], i = [n.css("borderTopWidth"), n.css("borderRightWidth"), n.css("borderBottomWidth"), n.css("borderLeftWidth")], s = [n.css("paddingTop"), n.css("paddingRight"), n.css("paddingBottom"), n.css("paddingLeft")], e = 0; i.length > e; e++) this.borderDif[e] = (parseInt(i[e], 10) || 0) + (parseInt(s[e], 10) || 0);
          n.css({
            height: a.height() - this.borderDif[0] - this.borderDif[2] || 0,
            width: a.width() - this.borderDif[1] - this.borderDif[3] || 0
          })
        }
      }
    },
    _renderProxy: function() {
      var e = this.element,
        i = this.options;
      this.elementOffset = e.offset(), this._helper ? (this.helper = this.helper || t("<div style='overflow:hidden;'></div>"), this.helper.addClass(this._helper).css({
        width: this.element.outerWidth() - 1,
        height: this.element.outerHeight() - 1,
        position: "absolute",
        left: this.elementOffset.left + "px",
        top: this.elementOffset.top + "px",
        zIndex: ++i.zIndex
      }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element
    },
    _change: {
      e: function(t, e) {
        return {
          width: this.originalSize.width + e
        }
      },
      w: function(t, e) {
        var i = this.originalSize,
          s = this.originalPosition;
        return {
          left: s.left + e,
          width: i.width - e
        }
      },
      n: function(t, e, i) {
        var s = this.originalSize,
          n = this.originalPosition;
        return {
          top: n.top + i,
          height: s.height - i
        }
      },
      s: function(t, e, i) {
        return {
          height: this.originalSize.height + i
        }
      },
      se: function(e, i, s) {
        return t.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [e, i, s]))
      },
      sw: function(e, i, s) {
        return t.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [e, i, s]))
      },
      ne: function(e, i, s) {
        return t.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [e, i, s]))
      },
      nw: function(e, i, s) {
        return t.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [e, i, s]))
      }
    },
    _propagate: function(e, i) {
      t.ui.plugin.call(this, e, [i, this.ui()]), "resize" !== e && this._trigger(e, i, this.ui())
    },
    plugins: {},
    ui: function() {
      return {
        originalElement: this.originalElement,
        element: this.element,
        helper: this.helper,
        position: this.position,
        size: this.size,
        originalSize: this.originalSize,
        originalPosition: this.originalPosition
      }
    }
  }), t.ui.plugin.add("resizable", "animate", {
    stop: function(e) {
      var i = t(this).data("ui-resizable"),
        s = i.options,
        n = i._proportionallyResizeElements,
        a = n.length && /textarea/i.test(n[0].nodeName),
        o = a && t.ui.hasScroll(n[0], "left") ? 0 : i.sizeDiff.height,
        r = a ? 0 : i.sizeDiff.width,
        h = {
          width: i.size.width - r,
          height: i.size.height - o
        },
        l = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null,
        c = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null;
      i.element.animate(t.extend(h, c && l ? {
        top: c,
        left: l
      } : {}), {
        duration: s.animateDuration,
        easing: s.animateEasing,
        step: function() {
          var s = {
            width: parseInt(i.element.css("width"), 10),
            height: parseInt(i.element.css("height"), 10),
            top: parseInt(i.element.css("top"), 10),
            left: parseInt(i.element.css("left"), 10)
          };
          n && n.length && t(n[0]).css({
            width: s.width,
            height: s.height
          }), i._updateCache(s), i._propagate("resize", e)
        }
      })
    }
  }), t.ui.plugin.add("resizable", "containment", {
    start: function() {
      var i, s, n, a, o, r, h, l = t(this).data("ui-resizable"),
        c = l.options,
        u = l.element,
        d = c.containment,
        p = d instanceof t ? d.get(0) : /parent/.test(d) ? u.parent().get(0) : d;
      p && (l.containerElement = t(p), /document/.test(d) || d === document ? (l.containerOffset = {
        left: 0,
        top: 0
      }, l.containerPosition = {
        left: 0,
        top: 0
      }, l.parentData = {
        element: t(document),
        left: 0,
        top: 0,
        width: t(document).width(),
        height: t(document).height() || document.body.parentNode.scrollHeight
      }) : (i = t(p), s = [], t(["Top", "Right", "Left", "Bottom"]).each(function(t, n) {
        s[t] = e(i.css("padding" + n))
      }), l.containerOffset = i.offset(), l.containerPosition = i.position(), l.containerSize = {
        height: i.innerHeight() - s[3],
        width: i.innerWidth() - s[1]
      }, n = l.containerOffset, a = l.containerSize.height, o = l.containerSize.width, r = t.ui.hasScroll(p, "left") ? p.scrollWidth : o, h = t.ui.hasScroll(p) ? p.scrollHeight : a, l.parentData = {
        element: p,
        left: n.left,
        top: n.top,
        width: r,
        height: h
      }))
    },
    resize: function(e) {
      var i, s, n, a, o = t(this).data("ui-resizable"),
        r = o.options,
        h = o.containerOffset,
        l = o.position,
        c = o._aspectRatio || e.shiftKey,
        u = {
          top: 0,
          left: 0
        },
        d = o.containerElement;
      d[0] !== document && /static/.test(d.css("position")) && (u = h), l.left < (o._helper ? h.left : 0) && (o.size.width = o.size.width + (o._helper ? o.position.left - h.left : o.position.left - u.left), c && (o.size.height = o.size.width / o.aspectRatio), o.position.left = r.helper ? h.left : 0), l.top < (o._helper ? h.top : 0) && (o.size.height = o.size.height + (o._helper ? o.position.top - h.top : o.position.top), c && (o.size.width = o.size.height * o.aspectRatio), o.position.top = o._helper ? h.top : 0), o.offset.left = o.parentData.left + o.position.left, o.offset.top = o.parentData.top + o.position.top, i = Math.abs((o._helper ? o.offset.left - u.left : o.offset.left - u.left) + o.sizeDiff.width), s = Math.abs((o._helper ? o.offset.top - u.top : o.offset.top - h.top) + o.sizeDiff.height), n = o.containerElement.get(0) === o.element.parent().get(0), a = /relative|absolute/.test(o.containerElement.css("position")), n && a && (i -= Math.abs(o.parentData.left)), i + o.size.width >= o.parentData.width && (o.size.width = o.parentData.width - i, c && (o.size.height = o.size.width / o.aspectRatio)), s + o.size.height >= o.parentData.height && (o.size.height = o.parentData.height - s, c && (o.size.width = o.size.height * o.aspectRatio))
    },
    stop: function() {
      var e = t(this).data("ui-resizable"),
        i = e.options,
        s = e.containerOffset,
        n = e.containerPosition,
        a = e.containerElement,
        o = t(e.helper),
        r = o.offset(),
        h = o.outerWidth() - e.sizeDiff.width,
        l = o.outerHeight() - e.sizeDiff.height;
      e._helper && !i.animate && /relative/.test(a.css("position")) && t(this).css({
        left: r.left - n.left - s.left,
        width: h,
        height: l
      }), e._helper && !i.animate && /static/.test(a.css("position")) && t(this).css({
        left: r.left - n.left - s.left,
        width: h,
        height: l
      })
    }
  }), t.ui.plugin.add("resizable", "alsoResize", {
    start: function() {
      var e = t(this).data("ui-resizable"),
        i = e.options,
        s = function(e) {
          t(e).each(function() {
            var e = t(this);
            e.data("ui-resizable-alsoresize", {
              width: parseInt(e.width(), 10),
              height: parseInt(e.height(), 10),
              left: parseInt(e.css("left"), 10),
              top: parseInt(e.css("top"), 10)
            })
          })
        };
      "object" != typeof i.alsoResize || i.alsoResize.parentNode ? s(i.alsoResize) : i.alsoResize.length ? (i.alsoResize = i.alsoResize[0], s(i.alsoResize)) : t.each(i.alsoResize, function(t) {
        s(t)
      })
    },
    resize: function(e, i) {
      var s = t(this).data("ui-resizable"),
        n = s.options,
        a = s.originalSize,
        o = s.originalPosition,
        r = {
          height: s.size.height - a.height || 0,
          width: s.size.width - a.width || 0,
          top: s.position.top - o.top || 0,
          left: s.position.left - o.left || 0
        },
        h = function(e, s) {
          t(e).each(function() {
            var e = t(this),
              n = t(this).data("ui-resizable-alsoresize"),
              a = {},
              o = s && s.length ? s : e.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
            t.each(o, function(t, e) {
              var i = (n[e] || 0) + (r[e] || 0);
              i && i >= 0 && (a[e] = i || null)
            }), e.css(a)
          })
        };
      "object" != typeof n.alsoResize || n.alsoResize.nodeType ? h(n.alsoResize) : t.each(n.alsoResize, function(t, e) {
        h(t, e)
      })
    },
    stop: function() {
      t(this).removeData("resizable-alsoresize")
    }
  }), t.ui.plugin.add("resizable", "ghost", {
    start: function() {
      var e = t(this).data("ui-resizable"),
        i = e.options,
        s = e.size;
      e.ghost = e.originalElement.clone(), e.ghost.css({
        opacity: .25,
        display: "block",
        position: "relative",
        height: s.height,
        width: s.width,
        margin: 0,
        left: 0,
        top: 0
      }).addClass("ui-resizable-ghost").addClass("string" == typeof i.ghost ? i.ghost : ""), e.ghost.appendTo(e.helper)
    },
    resize: function() {
      var e = t(this).data("ui-resizable");
      e.ghost && e.ghost.css({
        position: "relative",
        height: e.size.height,
        width: e.size.width
      })
    },
    stop: function() {
      var e = t(this).data("ui-resizable");
      e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0))
    }
  }), t.ui.plugin.add("resizable", "grid", {
    resize: function() {
      var e = t(this).data("ui-resizable"),
        i = e.options,
        s = e.size,
        n = e.originalSize,
        a = e.originalPosition,
        o = e.axis,
        r = "number" == typeof i.grid ? [i.grid, i.grid] : i.grid,
        h = r[0] || 1,
        l = r[1] || 1,
        c = Math.round((s.width - n.width) / h) * h,
        u = Math.round((s.height - n.height) / l) * l,
        d = n.width + c,
        p = n.height + u,
        f = i.maxWidth && d > i.maxWidth,
        g = i.maxHeight && p > i.maxHeight,
        m = i.minWidth && i.minWidth > d,
        v = i.minHeight && i.minHeight > p;
      i.grid = r, m && (d += h), v && (p += l), f && (d -= h), g && (p -= l), /^(se|s|e)$/.test(o) ? (e.size.width = d, e.size.height = p) : /^(ne)$/.test(o) ? (e.size.width = d, e.size.height = p, e.position.top = a.top - u) : /^(sw)$/.test(o) ? (e.size.width = d, e.size.height = p, e.position.left = a.left - c) : (p - l > 0 ? (e.size.height = p, e.position.top = a.top - u) : (e.size.height = l, e.position.top = a.top + n.height - l), d - h > 0 ? (e.size.width = d, e.position.left = a.left - c) : (e.size.width = h, e.position.left = a.left + n.width - h))
    }
  })
})(jQuery);
(function(t) {
  function e(t, e, i) {
    return t > e && e + i > t
  }

  function i(t) {
    return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display"))
  }
  t.widget("ui.sortable", t.ui.mouse, {
    version: "1.10.4",
    widgetEventPrefix: "sort",
    ready: !1,
    options: {
      appendTo: "parent",
      axis: !1,
      connectWith: !1,
      containment: !1,
      cursor: "auto",
      cursorAt: !1,
      dropOnEmpty: !0,
      forcePlaceholderSize: !1,
      forceHelperSize: !1,
      grid: !1,
      handle: !1,
      helper: "original",
      items: "> *",
      opacity: !1,
      placeholder: !1,
      revert: !1,
      scroll: !0,
      scrollSensitivity: 20,
      scrollSpeed: 20,
      scope: "default",
      tolerance: "intersect",
      zIndex: 1e3,
      activate: null,
      beforeStop: null,
      change: null,
      deactivate: null,
      out: null,
      over: null,
      receive: null,
      remove: null,
      sort: null,
      start: null,
      stop: null,
      update: null
    },
    _create: function() {
      var t = this.options;
      this.containerCache = {}, this.element.addClass("ui-sortable"), this.refresh(), this.floating = this.items.length ? "x" === t.axis || i(this.items[0].item) : !1, this.offset = this.element.offset(), this._mouseInit(), this.ready = !0
    },
    _destroy: function() {
      this.element.removeClass("ui-sortable ui-sortable-disabled"), this._mouseDestroy();
      for (var t = this.items.length - 1; t >= 0; t--) this.items[t].item.removeData(this.widgetName + "-item");
      return this
    },
    _setOption: function(e, i) {
      "disabled" === e ? (this.options[e] = i, this.widget().toggleClass("ui-sortable-disabled", !!i)) : t.Widget.prototype._setOption.apply(this, arguments)
    },
    _mouseCapture: function(e, i) {
      var s = null,
        n = !1,
        o = this;
      return this.reverting ? !1 : this.options.disabled || "static" === this.options.type ? !1 : (this._refreshItems(e), t(e.target).parents().each(function() {
        return t.data(this, o.widgetName + "-item") === o ? (s = t(this), !1) : undefined
      }), t.data(e.target, o.widgetName + "-item") === o && (s = t(e.target)), s ? !this.options.handle || i || (t(this.options.handle, s).find("*").addBack().each(function() {
        this === e.target && (n = !0)
      }), n) ? (this.currentItem = s, this._removeCurrentsFromItems(), !0) : !1 : !1)
    },
    _mouseStart: function(e, i, s) {
      var n, o, a = this.options;
      if (this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(e), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = {
          top: this.offset.top - this.margins.top,
          left: this.offset.left - this.margins.left
        }, t.extend(this.offset, {
          click: {
            left: e.pageX - this.offset.left,
            top: e.pageY - this.offset.top
          },
          parent: this._getParentOffset(),
          relative: this._getRelativeOffset()
        }), this.helper.css("position", "absolute"), this.cssPosition = this.helper.css("position"), this.originalPosition = this._generatePosition(e), this.originalPageX = e.pageX, this.originalPageY = e.pageY, a.cursorAt && this._adjustOffsetFromHelper(a.cursorAt), this.domPosition = {
          prev: this.currentItem.prev()[0],
          parent: this.currentItem.parent()[0]
        }, this.helper[0] !== this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), a.containment && this._setContainment(), a.cursor && "auto" !== a.cursor && (o = this.document.find("body"), this.storedCursor = o.css("cursor"), o.css("cursor", a.cursor), this.storedStylesheet = t("<style>*{ cursor: " + a.cursor + " !important; }</style>").appendTo(o)), a.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")), this.helper.css("opacity", a.opacity)), a.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")), this.helper.css("zIndex", a.zIndex)), this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()), this._trigger("start", e, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions(), !s)
        for (n = this.containers.length - 1; n >= 0; n--) this.containers[n]._trigger("activate", e, this._uiHash(this));
      return t.ui.ddmanager && (t.ui.ddmanager.current = this), t.ui.ddmanager && !a.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e), this.dragging = !0, this.helper.addClass("ui-sortable-helper"), this._mouseDrag(e), !0
    },
    _mouseDrag: function(e) {
      var i, s, n, o, a = this.options,
        r = !1;
      for (this.position = this._generatePosition(e), this.positionAbs = this._convertPositionTo("absolute"), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs), this.options.scroll && (this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < a.scrollSensitivity ? this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop + a.scrollSpeed : e.pageY - this.overflowOffset.top < a.scrollSensitivity && (this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop - a.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < a.scrollSensitivity ? this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft + a.scrollSpeed : e.pageX - this.overflowOffset.left < a.scrollSensitivity && (this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft - a.scrollSpeed)) : (e.pageY - t(document).scrollTop() < a.scrollSensitivity ? r = t(document).scrollTop(t(document).scrollTop() - a.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < a.scrollSensitivity && (r = t(document).scrollTop(t(document).scrollTop() + a.scrollSpeed)), e.pageX - t(document).scrollLeft() < a.scrollSensitivity ? r = t(document).scrollLeft(t(document).scrollLeft() - a.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < a.scrollSensitivity && (r = t(document).scrollLeft(t(document).scrollLeft() + a.scrollSpeed))), r !== !1 && t.ui.ddmanager && !a.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)), this.positionAbs = this._convertPositionTo("absolute"), this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"), this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"), i = this.items.length - 1; i >= 0; i--)
        if (s = this.items[i], n = s.item[0], o = this._intersectsWithPointer(s), o && s.instance === this.currentContainer && n !== this.currentItem[0] && this.placeholder[1 === o ? "next" : "prev"]()[0] !== n && !t.contains(this.placeholder[0], n) && ("semi-dynamic" === this.options.type ? !t.contains(this.element[0], n) : !0)) {
          if (this.direction = 1 === o ? "down" : "up", "pointer" !== this.options.tolerance && !this._intersectsWithSides(s)) break;
          this._rearrange(e, s), this._trigger("change", e, this._uiHash());
          break
        }
      return this._contactContainers(e), t.ui.ddmanager && t.ui.ddmanager.drag(this, e), this._trigger("sort", e, this._uiHash()), this.lastPositionAbs = this.positionAbs, !1
    },
    _mouseStop: function(e, i) {
      if (e) {
        if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e), this.options.revert) {
          var s = this,
            n = this.placeholder.offset(),
            o = this.options.axis,
            a = {};
          o && "x" !== o || (a.left = n.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)), o && "y" !== o || (a.top = n.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)), this.reverting = !0, t(this.helper).animate(a, parseInt(this.options.revert, 10) || 500, function() {
            s._clear(e)
          })
        } else this._clear(e, i);
        return !1
      }
    },
    cancel: function() {
      if (this.dragging) {
        this._mouseUp({
          target: null
        }), "original" === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
        for (var e = this.containers.length - 1; e >= 0; e--) this.containers[e]._trigger("deactivate", null, this._uiHash(this)), this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)), this.containers[e].containerCache.over = 0)
      }
      return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(), t.extend(this, {
        helper: null,
        dragging: !1,
        reverting: !1,
        _noFinalSort: null
      }), this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)), this
    },
    serialize: function(e) {
      var i = this._getItemsAsjQuery(e && e.connected),
        s = [];
      return e = e || {}, t(i).each(function() {
        var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/);
        i && s.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2]))
      }), !s.length && e.key && s.push(e.key + "="), s.join("&")
    },
    toArray: function(e) {
      var i = this._getItemsAsjQuery(e && e.connected),
        s = [];
      return e = e || {}, i.each(function() {
        s.push(t(e.item || this).attr(e.attribute || "id") || "")
      }), s
    },
    _intersectsWith: function(t) {
      var e = this.positionAbs.left,
        i = e + this.helperProportions.width,
        s = this.positionAbs.top,
        n = s + this.helperProportions.height,
        o = t.left,
        a = o + t.width,
        r = t.top,
        h = r + t.height,
        l = this.offset.click.top,
        c = this.offset.click.left,
        u = "x" === this.options.axis || s + l > r && h > s + l,
        d = "y" === this.options.axis || e + c > o && a > e + c,
        p = u && d;
      return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? p : e + this.helperProportions.width / 2 > o && a > i - this.helperProportions.width / 2 && s + this.helperProportions.height / 2 > r && h > n - this.helperProportions.height / 2
    },
    _intersectsWithPointer: function(t) {
      var i = "x" === this.options.axis || e(this.positionAbs.top + this.offset.click.top, t.top, t.height),
        s = "y" === this.options.axis || e(this.positionAbs.left + this.offset.click.left, t.left, t.width),
        n = i && s,
        o = this._getDragVerticalDirection(),
        a = this._getDragHorizontalDirection();
      return n ? this.floating ? a && "right" === a || "down" === o ? 2 : 1 : o && ("down" === o ? 2 : 1) : !1
    },
    _intersectsWithSides: function(t) {
      var i = e(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height),
        s = e(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width),
        n = this._getDragVerticalDirection(),
        o = this._getDragHorizontalDirection();
      return this.floating && o ? "right" === o && s || "left" === o && !s : n && ("down" === n && i || "up" === n && !i)
    },
    _getDragVerticalDirection: function() {
      var t = this.positionAbs.top - this.lastPositionAbs.top;
      return 0 !== t && (t > 0 ? "down" : "up")
    },
    _getDragHorizontalDirection: function() {
      var t = this.positionAbs.left - this.lastPositionAbs.left;
      return 0 !== t && (t > 0 ? "right" : "left")
    },
    refresh: function(t) {
      return this._refreshItems(t), this.refreshPositions(), this
    },
    _connectWith: function() {
      var t = this.options;
      return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith
    },
    _getItemsAsjQuery: function(e) {
      function i() {
        r.push(this)
      }
      var s, n, o, a, r = [],
        h = [],
        l = this._connectWith();
      if (l && e)
        for (s = l.length - 1; s >= 0; s--)
          for (o = t(l[s]), n = o.length - 1; n >= 0; n--) a = t.data(o[n], this.widgetFullName), a && a !== this && !a.options.disabled && h.push([t.isFunction(a.options.items) ? a.options.items.call(a.element) : t(a.options.items, a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), a]);
      for (h.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
          options: this.options,
          item: this.currentItem
        }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]), s = h.length - 1; s >= 0; s--) h[s][0].each(i);
      return t(r)
    },
    _removeCurrentsFromItems: function() {
      var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
      this.items = t.grep(this.items, function(t) {
        for (var i = 0; e.length > i; i++)
          if (e[i] === t.item[0]) return !1;
        return !0
      })
    },
    _refreshItems: function(e) {
      this.items = [], this.containers = [this];
      var i, s, n, o, a, r, h, l, c = this.items,
        u = [
          [t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
            item: this.currentItem
          }) : t(this.options.items, this.element), this]
        ],
        d = this._connectWith();
      if (d && this.ready)
        for (i = d.length - 1; i >= 0; i--)
          for (n = t(d[i]), s = n.length - 1; s >= 0; s--) o = t.data(n[s], this.widgetFullName), o && o !== this && !o.options.disabled && (u.push([t.isFunction(o.options.items) ? o.options.items.call(o.element[0], e, {
            item: this.currentItem
          }) : t(o.options.items, o.element), o]), this.containers.push(o));
      for (i = u.length - 1; i >= 0; i--)
        for (a = u[i][1], r = u[i][0], s = 0, l = r.length; l > s; s++) h = t(r[s]), h.data(this.widgetName + "-item", a), c.push({
          item: h,
          instance: a,
          width: 0,
          height: 0,
          left: 0,
          top: 0
        })
    },
    refreshPositions: function(e) {
      this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
      var i, s, n, o;
      for (i = this.items.length - 1; i >= 0; i--) s = this.items[i], s.instance !== this.currentContainer && this.currentContainer && s.item[0] !== this.currentItem[0] || (n = this.options.toleranceElement ? t(this.options.toleranceElement, s.item) : s.item, e || (s.width = n.outerWidth(), s.height = n.outerHeight()), o = n.offset(), s.left = o.left, s.top = o.top);
      if (this.options.custom && this.options.custom.refreshContainers) this.options.custom.refreshContainers.call(this);
      else
        for (i = this.containers.length - 1; i >= 0; i--) o = this.containers[i].element.offset(), this.containers[i].containerCache.left = o.left, this.containers[i].containerCache.top = o.top, this.containers[i].containerCache.width = this.containers[i].element.outerWidth(), this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
      return this
    },
    _createPlaceholder: function(e) {
      e = e || this;
      var i, s = e.options;
      s.placeholder && s.placeholder.constructor !== String || (i = s.placeholder, s.placeholder = {
        element: function() {
          var s = e.currentItem[0].nodeName.toLowerCase(),
            n = t("<" + s + ">", e.document[0]).addClass(i || e.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
          return "tr" === s ? e.currentItem.children().each(function() {
            t("<td>&#160;</td>", e.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(n)
          }) : "img" === s && n.attr("src", e.currentItem.attr("src")), i || n.css("visibility", "hidden"), n
        },
        update: function(t, n) {
          (!i || s.forcePlaceholderSize) && (n.height() || n.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)), n.width() || n.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10)))
        }
      }), e.placeholder = t(s.placeholder.element.call(e.element, e.currentItem)), e.currentItem.after(e.placeholder), s.placeholder.update(e, e.placeholder)
    },
    _contactContainers: function(s) {
      var n, o, a, r, h, l, c, u, d, p, f = null,
        g = null;
      for (n = this.containers.length - 1; n >= 0; n--)
        if (!t.contains(this.currentItem[0], this.containers[n].element[0]))
          if (this._intersectsWith(this.containers[n].containerCache)) {
            if (f && t.contains(this.containers[n].element[0], f.element[0])) continue;
            f = this.containers[n], g = n
          } else this.containers[n].containerCache.over && (this.containers[n]._trigger("out", s, this._uiHash(this)), this.containers[n].containerCache.over = 0);
      if (f)
        if (1 === this.containers.length) this.containers[g].containerCache.over || (this.containers[g]._trigger("over", s, this._uiHash(this)), this.containers[g].containerCache.over = 1);
        else {
          for (a = 1e4, r = null, p = f.floating || i(this.currentItem), h = p ? "left" : "top", l = p ? "width" : "height", c = this.positionAbs[h] + this.offset.click[h], o = this.items.length - 1; o >= 0; o--) t.contains(this.containers[g].element[0], this.items[o].item[0]) && this.items[o].item[0] !== this.currentItem[0] && (!p || e(this.positionAbs.top + this.offset.click.top, this.items[o].top, this.items[o].height)) && (u = this.items[o].item.offset()[h], d = !1, Math.abs(u - c) > Math.abs(u + this.items[o][l] - c) && (d = !0, u += this.items[o][l]), a > Math.abs(u - c) && (a = Math.abs(u - c), r = this.items[o], this.direction = d ? "up" : "down"));
          if (!r && !this.options.dropOnEmpty) return;
          if (this.currentContainer === this.containers[g]) return;
          r ? this._rearrange(s, r, null, !0) : this._rearrange(s, null, this.containers[g].element, !0), this._trigger("change", s, this._uiHash()), this.containers[g]._trigger("change", s, this._uiHash(this)), this.currentContainer = this.containers[g], this.options.placeholder.update(this.currentContainer, this.placeholder), this.containers[g]._trigger("over", s, this._uiHash(this)), this.containers[g].containerCache.over = 1
        }
    },
    _createHelper: function(e) {
      var i = this.options,
        s = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem;
      return s.parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(s[0]), s[0] === this.currentItem[0] && (this._storedCSS = {
        width: this.currentItem[0].style.width,
        height: this.currentItem[0].style.height,
        position: this.currentItem.css("position"),
        top: this.currentItem.css("top"),
        left: this.currentItem.css("left")
      }), (!s[0].style.width || i.forceHelperSize) && s.width(this.currentItem.width()), (!s[0].style.height || i.forceHelperSize) && s.height(this.currentItem.height()), s
    },
    _adjustOffsetFromHelper: function(e) {
      "string" == typeof e && (e = e.split(" ")), t.isArray(e) && (e = {
        left: +e[0],
        top: +e[1] || 0
      }), "left" in e && (this.offset.click.left = e.left + this.margins.left), "right" in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left), "top" in e && (this.offset.click.top = e.top + this.margins.top), "bottom" in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
    },
    _getParentOffset: function() {
      this.offsetParent = this.helper.offsetParent();
      var e = this.offsetParent.offset();
      return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
        top: 0,
        left: 0
      }), {
        top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
        left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
      }
    },
    _getRelativeOffset: function() {
      if ("relative" === this.cssPosition) {
        var t = this.currentItem.position();
        return {
          top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
          left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
        }
      }
      return {
        top: 0,
        left: 0
      }
    },
    _cacheMargins: function() {
      this.margins = {
        left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
        top: parseInt(this.currentItem.css("marginTop"), 10) || 0
      }
    },
    _cacheHelperProportions: function() {
      this.helperProportions = {
        width: this.helper.outerWidth(),
        height: this.helper.outerHeight()
      }
    },
    _setContainment: function() {
      var e, i, s, n = this.options;
      "parent" === n.containment && (n.containment = this.helper[0].parentNode), ("document" === n.containment || "window" === n.containment) && (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, t("document" === n.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (t("document" === n.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]), /^(document|window|parent)$/.test(n.containment) || (e = t(n.containment)[0], i = t(n.containment).offset(), s = "hidden" !== t(e).css("overflow"), this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (s ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (s ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
    },
    _convertPositionTo: function(e, i) {
      i || (i = this.position);
      var s = "absolute" === e ? 1 : -1,
        n = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
        o = /(html|body)/i.test(n[0].tagName);
      return {
        top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : o ? 0 : n.scrollTop()) * s,
        left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : o ? 0 : n.scrollLeft()) * s
      }
    },
    _generatePosition: function(e) {
      var i, s, n = this.options,
        o = e.pageX,
        a = e.pageY,
        r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
        h = /(html|body)/i.test(r[0].tagName);
      return "relative" !== this.cssPosition || this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()), this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (o = this.containment[0] + this.offset.click.left), e.pageY - this.offset.click.top < this.containment[1] && (a = this.containment[1] + this.offset.click.top), e.pageX - this.offset.click.left > this.containment[2] && (o = this.containment[2] + this.offset.click.left), e.pageY - this.offset.click.top > this.containment[3] && (a = this.containment[3] + this.offset.click.top)), n.grid && (i = this.originalPageY + Math.round((a - this.originalPageY) / n.grid[1]) * n.grid[1], a = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - n.grid[1] : i + n.grid[1] : i, s = this.originalPageX + Math.round((o - this.originalPageX) / n.grid[0]) * n.grid[0], o = this.containment ? s - this.offset.click.left >= this.containment[0] && s - this.offset.click.left <= this.containment[2] ? s : s - this.offset.click.left >= this.containment[0] ? s - n.grid[0] : s + n.grid[0] : s)), {
        top: a - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : h ? 0 : r.scrollTop()),
        left: o - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : h ? 0 : r.scrollLeft())
      }
    },
    _rearrange: function(t, e, i, s) {
      i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling), this.counter = this.counter ? ++this.counter : 1;
      var n = this.counter;
      this._delay(function() {
        n === this.counter && this.refreshPositions(!s)
      })
    },
    _clear: function(t, e) {
      function i(t, e, i) {
        return function(s) {
          i._trigger(t, s, e._uiHash(e))
        }
      }
      this.reverting = !1;
      var s, n = [];
      if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null, this.helper[0] === this.currentItem[0]) {
        for (s in this._storedCSS)("auto" === this._storedCSS[s] || "static" === this._storedCSS[s]) && (this._storedCSS[s] = "");
        this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
      } else this.currentItem.show();
      for (this.fromOutside && !e && n.push(function(t) {
          this._trigger("receive", t, this._uiHash(this.fromOutside))
        }), !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || n.push(function(t) {
          this._trigger("update", t, this._uiHash())
        }), this !== this.currentContainer && (e || (n.push(function(t) {
          this._trigger("remove", t, this._uiHash())
        }), n.push(function(t) {
          return function(e) {
            t._trigger("receive", e, this._uiHash(this))
          }
        }.call(this, this.currentContainer)), n.push(function(t) {
          return function(e) {
            t._trigger("update", e, this._uiHash(this))
          }
        }.call(this, this.currentContainer)))), s = this.containers.length - 1; s >= 0; s--) e || n.push(i("deactivate", this, this.containers[s])), this.containers[s].containerCache.over && (n.push(i("out", this, this.containers[s])), this.containers[s].containerCache.over = 0);
      if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor), this.storedStylesheet.remove()), this._storedOpacity && this.helper.css("opacity", this._storedOpacity), this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex), this.dragging = !1, this.cancelHelperRemoval) {
        if (!e) {
          for (this._trigger("beforeStop", t, this._uiHash()), s = 0; n.length > s; s++) n[s].call(this, t);
          this._trigger("stop", t, this._uiHash())
        }
        return this.fromOutside = !1, !1
      }
      if (e || this._trigger("beforeStop", t, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.helper[0] !== this.currentItem[0] && this.helper.remove(), this.helper = null, !e) {
        for (s = 0; n.length > s; s++) n[s].call(this, t);
        this._trigger("stop", t, this._uiHash())
      }
      return this.fromOutside = !1, !0
    },
    _trigger: function() {
      t.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
    },
    _uiHash: function(e) {
      var i = e || this;
      return {
        helper: i.helper,
        placeholder: i.placeholder || t([]),
        position: i.position,
        originalPosition: i.originalPosition,
        offset: i.positionAbs,
        item: i.currentItem,
        sender: e ? e.element : null
      }
    }
  })
})(jQuery);
(function(t) {
  var e = 5;
  t.widget("ui.slider", t.ui.mouse, {
    version: "1.10.4",
    widgetEventPrefix: "slide",
    options: {
      animate: !1,
      distance: 0,
      max: 100,
      min: 0,
      orientation: "horizontal",
      range: !1,
      step: 1,
      value: 0,
      values: null,
      change: null,
      slide: null,
      start: null,
      stop: null
    },
    _create: function() {
      this._keySliding = !1, this._mouseSliding = !1, this._animateOff = !0, this._handleIndex = null, this._detectOrientation(), this._mouseInit(), this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget" + " ui-widget-content" + " ui-corner-all"), this._refresh(), this._setOption("disabled", this.options.disabled), this._animateOff = !1
    },
    _refresh: function() {
      this._createRange(), this._createHandles(), this._setupEvents(), this._refreshValue()
    },
    _createHandles: function() {
      var e, i, s = this.options,
        n = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),
        a = "<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",
        o = [];
      for (i = s.values && s.values.length || 1, n.length > i && (n.slice(i).remove(), n = n.slice(0, i)), e = n.length; i > e; e++) o.push(a);
      this.handles = n.add(t(o.join("")).appendTo(this.element)), this.handle = this.handles.eq(0), this.handles.each(function(e) {
        t(this).data("ui-slider-handle-index", e)
      })
    },
    _createRange: function() {
      var e = this.options,
        i = "";
      e.range ? (e.range === !0 && (e.values ? e.values.length && 2 !== e.values.length ? e.values = [e.values[0], e.values[0]] : t.isArray(e.values) && (e.values = e.values.slice(0)) : e.values = [this._valueMin(), this._valueMin()]), this.range && this.range.length ? this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({
        left: "",
        bottom: ""
      }) : (this.range = t("<div></div>").appendTo(this.element), i = "ui-slider-range ui-widget-header ui-corner-all"), this.range.addClass(i + ("min" === e.range || "max" === e.range ? " ui-slider-range-" + e.range : ""))) : (this.range && this.range.remove(), this.range = null)
    },
    _setupEvents: function() {
      var t = this.handles.add(this.range).filter("a");
      this._off(t), this._on(t, this._handleEvents), this._hoverable(t), this._focusable(t)
    },
    _destroy: function() {
      this.handles.remove(), this.range && this.range.remove(), this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"), this._mouseDestroy()
    },
    _mouseCapture: function(e) {
      var i, s, n, a, o, r, l, h, u = this,
        c = this.options;
      return c.disabled ? !1 : (this.elementSize = {
        width: this.element.outerWidth(),
        height: this.element.outerHeight()
      }, this.elementOffset = this.element.offset(), i = {
        x: e.pageX,
        y: e.pageY
      }, s = this._normValueFromMouse(i), n = this._valueMax() - this._valueMin() + 1, this.handles.each(function(e) {
        var i = Math.abs(s - u.values(e));
        (n > i || n === i && (e === u._lastChangedValue || u.values(e) === c.min)) && (n = i, a = t(this), o = e)
      }), r = this._start(e, o), r === !1 ? !1 : (this._mouseSliding = !0, this._handleIndex = o, a.addClass("ui-state-active").focus(), l = a.offset(), h = !t(e.target).parents().addBack().is(".ui-slider-handle"), this._clickOffset = h ? {
        left: 0,
        top: 0
      } : {
        left: e.pageX - l.left - a.width() / 2,
        top: e.pageY - l.top - a.height() / 2 - (parseInt(a.css("borderTopWidth"), 10) || 0) - (parseInt(a.css("borderBottomWidth"), 10) || 0) + (parseInt(a.css("marginTop"), 10) || 0)
      }, this.handles.hasClass("ui-state-hover") || this._slide(e, o, s), this._animateOff = !0, !0))
    },
    _mouseStart: function() {
      return !0
    },
    _mouseDrag: function(t) {
      var e = {
          x: t.pageX,
          y: t.pageY
        },
        i = this._normValueFromMouse(e);
      return this._slide(t, this._handleIndex, i), !1
    },
    _mouseStop: function(t) {
      return this.handles.removeClass("ui-state-active"), this._mouseSliding = !1, this._stop(t, this._handleIndex), this._change(t, this._handleIndex), this._handleIndex = null, this._clickOffset = null, this._animateOff = !1, !1
    },
    _detectOrientation: function() {
      this.orientation = "vertical" === this.options.orientation ? "vertical" : "horizontal"
    },
    _normValueFromMouse: function(t) {
      var e, i, s, n, a;
      return "horizontal" === this.orientation ? (e = this.elementSize.width, i = t.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (e = this.elementSize.height, i = t.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)), s = i / e, s > 1 && (s = 1), 0 > s && (s = 0), "vertical" === this.orientation && (s = 1 - s), n = this._valueMax() - this._valueMin(), a = this._valueMin() + s * n, this._trimAlignValue(a)
    },
    _start: function(t, e) {
      var i = {
        handle: this.handles[e],
        value: this.value()
      };
      return this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()), this._trigger("start", t, i)
    },
    _slide: function(t, e, i) {
      var s, n, a;
      this.options.values && this.options.values.length ? (s = this.values(e ? 0 : 1), 2 === this.options.values.length && this.options.range === !0 && (0 === e && i > s || 1 === e && s > i) && (i = s), i !== this.values(e) && (n = this.values(), n[e] = i, a = this._trigger("slide", t, {
        handle: this.handles[e],
        value: i,
        values: n
      }), s = this.values(e ? 0 : 1), a !== !1 && this.values(e, i))) : i !== this.value() && (a = this._trigger("slide", t, {
        handle: this.handles[e],
        value: i
      }), a !== !1 && this.value(i))
    },
    _stop: function(t, e) {
      var i = {
        handle: this.handles[e],
        value: this.value()
      };
      this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()), this._trigger("stop", t, i)
    },
    _change: function(t, e) {
      if (!this._keySliding && !this._mouseSliding) {
        var i = {
          handle: this.handles[e],
          value: this.value()
        };
        this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()), this._lastChangedValue = e, this._trigger("change", t, i)
      }
    },
    value: function(t) {
      return arguments.length ? (this.options.value = this._trimAlignValue(t), this._refreshValue(), this._change(null, 0), undefined) : this._value()
    },
    values: function(e, i) {
      var s, n, a;
      if (arguments.length > 1) return this.options.values[e] = this._trimAlignValue(i), this._refreshValue(), this._change(null, e), undefined;
      if (!arguments.length) return this._values();
      if (!t.isArray(arguments[0])) return this.options.values && this.options.values.length ? this._values(e) : this.value();
      for (s = this.options.values, n = arguments[0], a = 0; s.length > a; a += 1) s[a] = this._trimAlignValue(n[a]), this._change(null, a);
      this._refreshValue()
    },
    _setOption: function(e, i) {
      var s, n = 0;
      switch ("range" === e && this.options.range === !0 && ("min" === i ? (this.options.value = this._values(0), this.options.values = null) : "max" === i && (this.options.value = this._values(this.options.values.length - 1), this.options.values = null)), t.isArray(this.options.values) && (n = this.options.values.length), t.Widget.prototype._setOption.apply(this, arguments), e) {
        case "orientation":
          this._detectOrientation(), this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation), this._refreshValue();
          break;
        case "value":
          this._animateOff = !0, this._refreshValue(), this._change(null, 0), this._animateOff = !1;
          break;
        case "values":
          for (this._animateOff = !0, this._refreshValue(), s = 0; n > s; s += 1) this._change(null, s);
          this._animateOff = !1;
          break;
        case "min":
        case "max":
          this._animateOff = !0, this._refreshValue(), this._animateOff = !1;
          break;
        case "range":
          this._animateOff = !0, this._refresh(), this._animateOff = !1
      }
    },
    _value: function() {
      var t = this.options.value;
      return t = this._trimAlignValue(t)
    },
    _values: function(t) {
      var e, i, s;
      if (arguments.length) return e = this.options.values[t], e = this._trimAlignValue(e);
      if (this.options.values && this.options.values.length) {
        for (i = this.options.values.slice(), s = 0; i.length > s; s += 1) i[s] = this._trimAlignValue(i[s]);
        return i
      }
      return []
    },
    _trimAlignValue: function(t) {
      if (this._valueMin() >= t) return this._valueMin();
      if (t >= this._valueMax()) return this._valueMax();
      var e = this.options.step > 0 ? this.options.step : 1,
        i = (t - this._valueMin()) % e,
        s = t - i;
      return 2 * Math.abs(i) >= e && (s += i > 0 ? e : -e), parseFloat(s.toFixed(5))
    },
    _valueMin: function() {
      return this.options.min
    },
    _valueMax: function() {
      return this.options.max
    },
    _refreshValue: function() {
      var e, i, s, n, a, o = this.options.range,
        r = this.options,
        l = this,
        h = this._animateOff ? !1 : r.animate,
        u = {};
      this.options.values && this.options.values.length ? this.handles.each(function(s) {
        i = 100 * ((l.values(s) - l._valueMin()) / (l._valueMax() - l._valueMin())), u["horizontal" === l.orientation ? "left" : "bottom"] = i + "%", t(this).stop(1, 1)[h ? "animate" : "css"](u, r.animate), l.options.range === !0 && ("horizontal" === l.orientation ? (0 === s && l.range.stop(1, 1)[h ? "animate" : "css"]({
          left: i + "%"
        }, r.animate), 1 === s && l.range[h ? "animate" : "css"]({
          width: i - e + "%"
        }, {
          queue: !1,
          duration: r.animate
        })) : (0 === s && l.range.stop(1, 1)[h ? "animate" : "css"]({
          bottom: i + "%"
        }, r.animate), 1 === s && l.range[h ? "animate" : "css"]({
          height: i - e + "%"
        }, {
          queue: !1,
          duration: r.animate
        }))), e = i
      }) : (s = this.value(), n = this._valueMin(), a = this._valueMax(), i = a !== n ? 100 * ((s - n) / (a - n)) : 0, u["horizontal" === this.orientation ? "left" : "bottom"] = i + "%", this.handle.stop(1, 1)[h ? "animate" : "css"](u, r.animate), "min" === o && "horizontal" === this.orientation && this.range.stop(1, 1)[h ? "animate" : "css"]({
        width: i + "%"
      }, r.animate), "max" === o && "horizontal" === this.orientation && this.range[h ? "animate" : "css"]({
        width: 100 - i + "%"
      }, {
        queue: !1,
        duration: r.animate
      }), "min" === o && "vertical" === this.orientation && this.range.stop(1, 1)[h ? "animate" : "css"]({
        height: i + "%"
      }, r.animate), "max" === o && "vertical" === this.orientation && this.range[h ? "animate" : "css"]({
        height: 100 - i + "%"
      }, {
        queue: !1,
        duration: r.animate
      }))
    },
    _handleEvents: {
      keydown: function(i) {
        var s, n, a, o, r = t(i.target).data("ui-slider-handle-index");
        switch (i.keyCode) {
          case t.ui.keyCode.HOME:
          case t.ui.keyCode.END:
          case t.ui.keyCode.PAGE_UP:
          case t.ui.keyCode.PAGE_DOWN:
          case t.ui.keyCode.UP:
          case t.ui.keyCode.RIGHT:
          case t.ui.keyCode.DOWN:
          case t.ui.keyCode.LEFT:
            if (i.preventDefault(), !this._keySliding && (this._keySliding = !0, t(i.target).addClass("ui-state-active"), s = this._start(i, r), s === !1)) return
        }
        switch (o = this.options.step, n = a = this.options.values && this.options.values.length ? this.values(r) : this.value(), i.keyCode) {
          case t.ui.keyCode.HOME:
            a = this._valueMin();
            break;
          case t.ui.keyCode.END:
            a = this._valueMax();
            break;
          case t.ui.keyCode.PAGE_UP:
            a = this._trimAlignValue(n + (this._valueMax() - this._valueMin()) / e);
            break;
          case t.ui.keyCode.PAGE_DOWN:
            a = this._trimAlignValue(n - (this._valueMax() - this._valueMin()) / e);
            break;
          case t.ui.keyCode.UP:
          case t.ui.keyCode.RIGHT:
            if (n === this._valueMax()) return;
            a = this._trimAlignValue(n + o);
            break;
          case t.ui.keyCode.DOWN:
          case t.ui.keyCode.LEFT:
            if (n === this._valueMin()) return;
            a = this._trimAlignValue(n - o)
        }
        this._slide(i, r, a)
      },
      click: function(t) {
        t.preventDefault()
      },
      keyup: function(e) {
        var i = t(e.target).data("ui-slider-handle-index");
        this._keySliding && (this._keySliding = !1, this._stop(e, i), this._change(e, i), t(e.target).removeClass("ui-state-active"))
      }
    }
  })
})(jQuery);
if (navigator.userAgent.indexOf('MSIE 8.0') === -1) {
  ! function() {
    function n(n, t) {
      return t > n ? -1 : n > t ? 1 : n >= t ? 0 : 0 / 0
    }

    function t(n) {
      return null != n && !isNaN(n)
    }

    function e(n) {
      return {
        left: function(t, e, r, u) {
          for (arguments.length < 3 && (r = 0), arguments.length < 4 && (u = t.length); u > r;) {
            var i = r + u >>> 1;
            n(t[i], e) < 0 ? r = i + 1 : u = i
          }
          return r
        },
        right: function(t, e, r, u) {
          for (arguments.length < 3 && (r = 0), arguments.length < 4 && (u = t.length); u > r;) {
            var i = r + u >>> 1;
            n(t[i], e) > 0 ? u = i : r = i + 1
          }
          return r
        }
      }
    }

    function r(n) {
      return n.length
    }

    function u(n) {
      for (var t = 1; n * t % 1;) t *= 10;
      return t
    }

    function i(n, t) {
      try {
        for (var e in t) Object.defineProperty(n.prototype, e, {
          value: t[e],
          enumerable: !1
        })
      } catch (r) {
        n.prototype = t
      }
    }

    function o() {}

    function a(n) {
      return ia + n in this
    }

    function c(n) {
      return n = ia + n, n in this && delete this[n]
    }

    function s() {
      var n = [];
      return this.forEach(function(t) {
        n.push(t)
      }), n
    }

    function l() {
      var n = 0;
      for (var t in this) t.charCodeAt(0) === oa && ++n;
      return n
    }

    function f() {
      for (var n in this)
        if (n.charCodeAt(0) === oa) return !1;
      return !0
    }

    function h() {}

    function g(n, t, e) {
      return function() {
        var r = e.apply(t, arguments);
        return r === t ? n : r
      }
    }

    function p(n, t) {
      if (t in n) return t;
      t = t.charAt(0).toUpperCase() + t.substring(1);
      for (var e = 0, r = aa.length; r > e; ++e) {
        var u = aa[e] + t;
        if (u in n) return u
      }
    }

    function v() {}

    function d() {}

    function m(n) {
      function t() {
        for (var t, r = e, u = -1, i = r.length; ++u < i;)(t = r[u].on) && t.apply(this, arguments);
        return n
      }
      var e = [],
        r = new o;
      return t.on = function(t, u) {
        var i, o = r.get(t);
        return arguments.length < 2 ? o && o.on : (o && (o.on = null, e = e.slice(0, i = e.indexOf(o)).concat(e.slice(i + 1)), r.remove(t)), u && e.push(r.set(t, {
          on: u
        })), n)
      }, t
    }

    function y() {
      Zo.event.preventDefault()
    }

    function x() {
      for (var n, t = Zo.event; n = t.sourceEvent;) t = n;
      return t
    }

    function M(n) {
      for (var t = new d, e = 0, r = arguments.length; ++e < r;) t[arguments[e]] = m(t);
      return t.of = function(e, r) {
        return function(u) {
          try {
            var i = u.sourceEvent = Zo.event;
            u.target = n, Zo.event = u, t[u.type].apply(e, r)
          } finally {
            Zo.event = i
          }
        }
      }, t
    }

    function _(n) {
      return sa(n, pa), n
    }

    function b(n) {
      return "function" == typeof n ? n : function() {
        return la(n, this)
      }
    }

    function w(n) {
      return "function" == typeof n ? n : function() {
        return fa(n, this)
      }
    }

    function S(n, t) {
      function e() {
        this.removeAttribute(n)
      }

      function r() {
        this.removeAttributeNS(n.space, n.local)
      }

      function u() {
        this.setAttribute(n, t)
      }

      function i() {
        this.setAttributeNS(n.space, n.local, t)
      }

      function o() {
        var e = t.apply(this, arguments);
        null == e ? this.removeAttribute(n) : this.setAttribute(n, e)
      }

      function a() {
        var e = t.apply(this, arguments);
        null == e ? this.removeAttributeNS(n.space, n.local) : this.setAttributeNS(n.space, n.local, e)
      }
      return n = Zo.ns.qualify(n), null == t ? n.local ? r : e : "function" == typeof t ? n.local ? a : o : n.local ? i : u
    }

    function k(n) {
      return n.trim().replace(/\s+/g, " ")
    }

    function E(n) {
      return new RegExp("(?:^|\\s+)" + Zo.requote(n) + "(?:\\s+|$)", "g")
    }

    function A(n) {
      return (n + "").trim().split(/^|\s+/)
    }

    function C(n, t) {
      function e() {
        for (var e = -1; ++e < u;) n[e](this, t)
      }

      function r() {
        for (var e = -1, r = t.apply(this, arguments); ++e < u;) n[e](this, r)
      }
      n = A(n).map(N);
      var u = n.length;
      return "function" == typeof t ? r : e
    }

    function N(n) {
      var t = E(n);
      return function(e, r) {
        if (u = e.classList) return r ? u.add(n) : u.remove(n);
        var u = e.getAttribute("class") || "";
        r ? (t.lastIndex = 0, t.test(u) || e.setAttribute("class", k(u + " " + n))) : e.setAttribute("class", k(u.replace(t, " ")))
      }
    }

    function z(n, t, e) {
      function r() {
        this.style.removeProperty(n)
      }

      function u() {
        this.style.setProperty(n, t, e)
      }

      function i() {
        var r = t.apply(this, arguments);
        null == r ? this.style.removeProperty(n) : this.style.setProperty(n, r, e)
      }
      return null == t ? r : "function" == typeof t ? i : u
    }

    function L(n, t) {
      function e() {
        delete this[n]
      }

      function r() {
        this[n] = t
      }

      function u() {
        var e = t.apply(this, arguments);
        null == e ? delete this[n] : this[n] = e
      }
      return null == t ? e : "function" == typeof t ? u : r
    }

    function T(n) {
      return "function" == typeof n ? n : (n = Zo.ns.qualify(n)).local ? function() {
        return this.ownerDocument.createElementNS(n.space, n.local)
      } : function() {
        return this.ownerDocument.createElementNS(this.namespaceURI, n)
      }
    }

    function q(n) {
      return {
        __data__: n
      }
    }

    function R(n) {
      return function() {
        return ga(this, n)
      }
    }

    function D(t) {
      return arguments.length || (t = n),
        function(n, e) {
          return n && e ? t(n.__data__, e.__data__) : !n - !e
        }
    }

    function P(n, t) {
      for (var e = 0, r = n.length; r > e; e++)
        for (var u, i = n[e], o = 0, a = i.length; a > o; o++)(u = i[o]) && t(u, o, e);
      return n
    }

    function U(n) {
      return sa(n, da), n
    }

    function j(n) {
      var t, e;
      return function(r, u, i) {
        var o, a = n[i].update,
          c = a.length;
        for (i != e && (e = i, t = 0), u >= t && (t = u + 1); !(o = a[t]) && ++t < c;);
        return o
      }
    }

    function H() {
      var n = this.__transition__;
      n && ++n.active
    }

    function F(n, t, e) {
      function r() {
        var t = this[o];
        t && (this.removeEventListener(n, t, t.$), delete this[o])
      }

      function u() {
        var u = c(t, Xo(arguments));
        r.call(this), this.addEventListener(n, this[o] = u, u.$ = e), u._ = t
      }

      function i() {
        var t, e = new RegExp("^__on([^.]+)" + Zo.requote(n) + "$");
        for (var r in this)
          if (t = r.match(e)) {
            var u = this[r];
            this.removeEventListener(t[1], u, u.$), delete this[r]
          }
      }
      var o = "__on" + n,
        a = n.indexOf("."),
        c = O;
      a > 0 && (n = n.substring(0, a));
      var s = ya.get(n);
      return s && (n = s, c = Y), a ? t ? u : r : t ? v : i
    }

    function O(n, t) {
      return function(e) {
        var r = Zo.event;
        Zo.event = e, t[0] = this.__data__;
        try {
          n.apply(this, t)
        } finally {
          Zo.event = r
        }
      }
    }

    function Y(n, t) {
      var e = O(n, t);
      return function(n) {
        var t = this,
          r = n.relatedTarget;
        r && (r === t || 8 & r.compareDocumentPosition(t)) || e.call(t, n)
      }
    }

    function I() {
      var n = ".dragsuppress-" + ++Ma,
        t = "click" + n,
        e = Zo.select(Wo).on("touchmove" + n, y).on("dragstart" + n, y).on("selectstart" + n, y);
      if (xa) {
        var r = Bo.style,
          u = r[xa];
        r[xa] = "none"
      }
      return function(i) {
        function o() {
          e.on(t, null)
        }
        e.on(n, null), xa && (r[xa] = u), i && (e.on(t, function() {
          y(), o()
        }, !0), setTimeout(o, 0))
      }
    }

    function Z(n, t) {
      t.changedTouches && (t = t.changedTouches[0]);
      var e = n.ownerSVGElement || n;
      if (e.createSVGPoint) {
        var r = e.createSVGPoint();
        if (0 > _a && (Wo.scrollX || Wo.scrollY)) {
          e = Zo.select("body").append("svg").style({
            position: "absolute",
            top: 0,
            left: 0,
            margin: 0,
            padding: 0,
            border: "none"
          }, "important");
          var u = e[0][0].getScreenCTM();
          _a = !(u.f || u.e), e.remove()
        }
        return _a ? (r.x = t.pageX, r.y = t.pageY) : (r.x = t.clientX, r.y = t.clientY), r = r.matrixTransform(n.getScreenCTM().inverse()), [r.x, r.y]
      }
      var i = n.getBoundingClientRect();
      return [t.clientX - i.left - n.clientLeft, t.clientY - i.top - n.clientTop]
    }

    function V() {
      return Zo.event.changedTouches[0].identifier
    }

    function X() {
      return Zo.event.target
    }

    function $() {
      return Wo
    }

    function B(n) {
      return n > 0 ? 1 : 0 > n ? -1 : 0
    }

    function W(n, t, e) {
      return (t[0] - n[0]) * (e[1] - n[1]) - (t[1] - n[1]) * (e[0] - n[0])
    }

    function J(n) {
      return n > 1 ? 0 : -1 > n ? ba : Math.acos(n)
    }

    function G(n) {
      return n > 1 ? Sa : -1 > n ? -Sa : Math.asin(n)
    }

    function K(n) {
      return ((n = Math.exp(n)) - 1 / n) / 2
    }

    function Q(n) {
      return ((n = Math.exp(n)) + 1 / n) / 2
    }

    function nt(n) {
      return ((n = Math.exp(2 * n)) - 1) / (n + 1)
    }

    function tt(n) {
      return (n = Math.sin(n / 2)) * n
    }

    function et() {}

    function rt(n, t, e) {
      return this instanceof rt ? (this.h = +n, this.s = +t, void(this.l = +e)) : arguments.length < 2 ? n instanceof rt ? new rt(n.h, n.s, n.l) : mt("" + n, yt, rt) : new rt(n, t, e)
    }

    function ut(n, t, e) {
      function r(n) {
        return n > 360 ? n -= 360 : 0 > n && (n += 360), 60 > n ? i + (o - i) * n / 60 : 180 > n ? o : 240 > n ? i + (o - i) * (240 - n) / 60 : i
      }

      function u(n) {
        return Math.round(255 * r(n))
      }
      var i, o;
      return n = isNaN(n) ? 0 : (n %= 360) < 0 ? n + 360 : n, t = isNaN(t) ? 0 : 0 > t ? 0 : t > 1 ? 1 : t, e = 0 > e ? 0 : e > 1 ? 1 : e, o = .5 >= e ? e * (1 + t) : e + t - e * t, i = 2 * e - o, new gt(u(n + 120), u(n), u(n - 120))
    }

    function it(n, t, e) {
      return this instanceof it ? (this.h = +n, this.c = +t, void(this.l = +e)) : arguments.length < 2 ? n instanceof it ? new it(n.h, n.c, n.l) : n instanceof at ? st(n.l, n.a, n.b) : st((n = xt((n = Zo.rgb(n)).r, n.g, n.b)).l, n.a, n.b) : new it(n, t, e)
    }

    function ot(n, t, e) {
      return isNaN(n) && (n = 0), isNaN(t) && (t = 0), new at(e, Math.cos(n *= Aa) * t, Math.sin(n) * t)
    }

    function at(n, t, e) {
      return this instanceof at ? (this.l = +n, this.a = +t, void(this.b = +e)) : arguments.length < 2 ? n instanceof at ? new at(n.l, n.a, n.b) : n instanceof it ? ot(n.l, n.c, n.h) : xt((n = gt(n)).r, n.g, n.b) : new at(n, t, e)
    }

    function ct(n, t, e) {
      var r = (n + 16) / 116,
        u = r + t / 500,
        i = r - e / 200;
      return u = lt(u) * ja, r = lt(r) * Ha, i = lt(i) * Fa, new gt(ht(3.2404542 * u - 1.5371385 * r - .4985314 * i), ht(-.969266 * u + 1.8760108 * r + .041556 * i), ht(.0556434 * u - .2040259 * r + 1.0572252 * i))
    }

    function st(n, t, e) {
      return n > 0 ? new it(Math.atan2(e, t) * Ca, Math.sqrt(t * t + e * e), n) : new it(0 / 0, 0 / 0, n)
    }

    function lt(n) {
      return n > .206893034 ? n * n * n : (n - 4 / 29) / 7.787037
    }

    function ft(n) {
      return n > .008856 ? Math.pow(n, 1 / 3) : 7.787037 * n + 4 / 29
    }

    function ht(n) {
      return Math.round(255 * (.00304 >= n ? 12.92 * n : 1.055 * Math.pow(n, 1 / 2.4) - .055))
    }

    function gt(n, t, e) {
      return this instanceof gt ? (this.r = ~~n, this.g = ~~t, void(this.b = ~~e)) : arguments.length < 2 ? n instanceof gt ? new gt(n.r, n.g, n.b) : mt("" + n, gt, ut) : new gt(n, t, e)
    }

    function pt(n) {
      return new gt(n >> 16, 255 & n >> 8, 255 & n)
    }

    function vt(n) {
      return pt(n) + ""
    }

    function dt(n) {
      return 16 > n ? "0" + Math.max(0, n).toString(16) : Math.min(255, n).toString(16)
    }

    function mt(n, t, e) {
      var r, u, i, o = 0,
        a = 0,
        c = 0;
      if (r = /([a-z]+)\((.*)\)/i.exec(n)) switch (u = r[2].split(","), r[1]) {
        case "hsl":
          return e(parseFloat(u[0]), parseFloat(u[1]) / 100, parseFloat(u[2]) / 100);
        case "rgb":
          return t(_t(u[0]), _t(u[1]), _t(u[2]))
      }
      return (i = Ia.get(n)) ? t(i.r, i.g, i.b) : (null == n || "#" !== n.charAt(0) || isNaN(i = parseInt(n.substring(1), 16)) || (4 === n.length ? (o = (3840 & i) >> 4, o = o >> 4 | o, a = 240 & i, a = a >> 4 | a, c = 15 & i, c = c << 4 | c) : 7 === n.length && (o = (16711680 & i) >> 16, a = (65280 & i) >> 8, c = 255 & i)), t(o, a, c))
    }

    function yt(n, t, e) {
      var r, u, i = Math.min(n /= 255, t /= 255, e /= 255),
        o = Math.max(n, t, e),
        a = o - i,
        c = (o + i) / 2;
      return a ? (u = .5 > c ? a / (o + i) : a / (2 - o - i), r = n == o ? (t - e) / a + (e > t ? 6 : 0) : t == o ? (e - n) / a + 2 : (n - t) / a + 4, r *= 60) : (r = 0 / 0, u = c > 0 && 1 > c ? 0 : r), new rt(r, u, c)
    }

    function xt(n, t, e) {
      n = Mt(n), t = Mt(t), e = Mt(e);
      var r = ft((.4124564 * n + .3575761 * t + .1804375 * e) / ja),
        u = ft((.2126729 * n + .7151522 * t + .072175 * e) / Ha),
        i = ft((.0193339 * n + .119192 * t + .9503041 * e) / Fa);
      return at(116 * u - 16, 500 * (r - u), 200 * (u - i))
    }

    function Mt(n) {
      return (n /= 255) <= .04045 ? n / 12.92 : Math.pow((n + .055) / 1.055, 2.4)
    }

    function _t(n) {
      var t = parseFloat(n);
      return "%" === n.charAt(n.length - 1) ? Math.round(2.55 * t) : t
    }

    function bt(n) {
      return "function" == typeof n ? n : function() {
        return n
      }
    }

    function wt(n) {
      return n
    }

    function St(n) {
      return function(t, e, r) {
        return 2 === arguments.length && "function" == typeof e && (r = e, e = null), kt(t, e, n, r)
      }
    }

    function kt(n, t, e, r) {
      function u() {
        var n, t = c.status;
        if (!t && c.responseText || t >= 200 && 300 > t || 304 === t) {
          try {
            n = e.call(i, c)
          } catch (r) {
            return o.error.call(i, r), void 0
          }
          o.load.call(i, n)
        } else o.error.call(i, c)
      }
      var i = {},
        o = Zo.dispatch("beforesend", "progress", "load", "error"),
        a = {},
        c = new XMLHttpRequest,
        s = null;
      return !Wo.XDomainRequest || "withCredentials" in c || !/^(http(s)?:)?\/\//.test(n) || (c = new XDomainRequest), "onload" in c ? c.onload = c.onerror = u : c.onreadystatechange = function() {
        c.readyState > 3 && u()
      }, c.onprogress = function(n) {
        var t = Zo.event;
        Zo.event = n;
        try {
          o.progress.call(i, c)
        } finally {
          Zo.event = t
        }
      }, i.header = function(n, t) {
        return n = (n + "").toLowerCase(), arguments.length < 2 ? a[n] : (null == t ? delete a[n] : a[n] = t + "", i)
      }, i.mimeType = function(n) {
        return arguments.length ? (t = null == n ? null : n + "", i) : t
      }, i.responseType = function(n) {
        return arguments.length ? (s = n, i) : s
      }, i.response = function(n) {
        return e = n, i
      }, ["get", "post"].forEach(function(n) {
        i[n] = function() {
          return i.send.apply(i, [n].concat(Xo(arguments)))
        }
      }), i.send = function(e, r, u) {
        if (2 === arguments.length && "function" == typeof r && (u = r, r = null), c.open(e, n, !0), null == t || "accept" in a || (a.accept = t + ",*/*"), c.setRequestHeader)
          for (var l in a) c.setRequestHeader(l, a[l]);
        return null != t && c.overrideMimeType && c.overrideMimeType(t), null != s && (c.responseType = s), null != u && i.on("error", u).on("load", function(n) {
          u(null, n)
        }), o.beforesend.call(i, c), c.send(null == r ? null : r), i
      }, i.abort = function() {
        return c.abort(), i
      }, Zo.rebind(i, o, "on"), null == r ? i : i.get(Et(r))
    }

    function Et(n) {
      return 1 === n.length ? function(t, e) {
        n(null == t ? e : null)
      } : n
    }

    function At() {
      var n = Ct(),
        t = Nt() - n;
      t > 24 ? (isFinite(t) && (clearTimeout($a), $a = setTimeout(At, t)), Xa = 0) : (Xa = 1, Wa(At))
    }

    function Ct() {
      var n = Date.now();
      for (Ba = Za; Ba;) n >= Ba.t && (Ba.f = Ba.c(n - Ba.t)), Ba = Ba.n;
      return n
    }

    function Nt() {
      for (var n, t = Za, e = 1 / 0; t;) t.f ? t = n ? n.n = t.n : Za = t.n : (t.t < e && (e = t.t), t = (n = t).n);
      return Va = n, e
    }

    function zt(n, t) {
      return t - (n ? Math.ceil(Math.log(n) / Math.LN10) : 1)
    }

    function Lt(n, t) {
      var e = Math.pow(10, 3 * ua(8 - t));
      return {
        scale: t > 8 ? function(n) {
          return n / e
        } : function(n) {
          return n * e
        },
        symbol: n
      }
    }

    function Tt(n) {
      var t = n.decimal,
        e = n.thousands,
        r = n.grouping,
        u = n.currency,
        i = r ? function(n) {
          for (var t = n.length, u = [], i = 0, o = r[0]; t > 0 && o > 0;) u.push(n.substring(t -= o, t + o)), o = r[i = (i + 1) % r.length];
          return u.reverse().join(e)
        } : wt;
      return function(n) {
        var e = Ga.exec(n),
          r = e[1] || " ",
          o = e[2] || ">",
          a = e[3] || "",
          c = e[4] || "",
          s = e[5],
          l = +e[6],
          f = e[7],
          h = e[8],
          g = e[9],
          p = 1,
          v = "",
          d = "",
          m = !1;
        switch (h && (h = +h.substring(1)), (s || "0" === r && "=" === o) && (s = r = "0", o = "=", f && (l -= Math.floor((l - 1) / 4))), g) {
          case "n":
            f = !0, g = "g";
            break;
          case "%":
            p = 100, d = "%", g = "f";
            break;
          case "p":
            p = 100, d = "%", g = "r";
            break;
          case "b":
          case "o":
          case "x":
          case "X":
            "#" === c && (v = "0" + g.toLowerCase());
          case "c":
          case "d":
            m = !0, h = 0;
            break;
          case "s":
            p = -1, g = "r"
        }
        "$" === c && (v = u[0], d = u[1]), "r" != g || h || (g = "g"), null != h && ("g" == g ? h = Math.max(1, Math.min(21, h)) : ("e" == g || "f" == g) && (h = Math.max(0, Math.min(20, h)))), g = Ka.get(g) || qt;
        var y = s && f;
        return function(n) {
          var e = d;
          if (m && n % 1) return "";
          var u = 0 > n || 0 === n && 0 > 1 / n ? (n = -n, "-") : a;
          if (0 > p) {
            var c = Zo.formatPrefix(n, h);
            n = c.scale(n), e = c.symbol + d
          } else n *= p;
          n = g(n, h);
          var x = n.lastIndexOf("."),
            M = 0 > x ? n : n.substring(0, x),
            _ = 0 > x ? "" : t + n.substring(x + 1);
          !s && f && (M = i(M));
          var b = v.length + M.length + _.length + (y ? 0 : u.length),
            w = l > b ? new Array(b = l - b + 1).join(r) : "";
          return y && (M = i(w + M)), u += v, n = M + _, ("<" === o ? u + n + w : ">" === o ? w + u + n : "^" === o ? w.substring(0, b >>= 1) + u + n + w.substring(b) : u + (y ? n : w + n)) + e
        }
      }
    }

    function qt(n) {
      return n + ""
    }

    function Rt() {
      this._ = new Date(arguments.length > 1 ? Date.UTC.apply(this, arguments) : arguments[0])
    }

    function Dt(n, t, e) {
      function r(t) {
        var e = n(t),
          r = i(e, 1);
        return r - t > t - e ? e : r
      }

      function u(e) {
        return t(e = n(new nc(e - 1)), 1), e
      }

      function i(n, e) {
        return t(n = new nc(+n), e), n
      }

      function o(n, r, i) {
        var o = u(n),
          a = [];
        if (i > 1)
          for (; r > o;) e(o) % i || a.push(new Date(+o)), t(o, 1);
        else
          for (; r > o;) a.push(new Date(+o)), t(o, 1);
        return a
      }

      function a(n, t, e) {
        try {
          nc = Rt;
          var r = new Rt;
          return r._ = n, o(r, t, e)
        } finally {
          nc = Date
        }
      }
      n.floor = n, n.round = r, n.ceil = u, n.offset = i, n.range = o;
      var c = n.utc = Pt(n);
      return c.floor = c, c.round = Pt(r), c.ceil = Pt(u), c.offset = Pt(i), c.range = a, n
    }

    function Pt(n) {
      return function(t, e) {
        try {
          nc = Rt;
          var r = new Rt;
          return r._ = t, n(r, e)._
        } finally {
          nc = Date
        }
      }
    }

    function Ut(n) {
      function t(n) {
        function t(t) {
          for (var e, u, i, o = [], a = -1, c = 0; ++a < r;) 37 === n.charCodeAt(a) && (o.push(n.substring(c, a)), null != (u = ec[e = n.charAt(++a)]) && (e = n.charAt(++a)), (i = C[e]) && (e = i(t, null == u ? "e" === e ? " " : "0" : u)), o.push(e), c = a + 1);
          return o.push(n.substring(c, a)), o.join("")
        }
        var r = n.length;
        return t.parse = function(t) {
          var r = {
              y: 1900,
              m: 0,
              d: 1,
              H: 0,
              M: 0,
              S: 0,
              L: 0,
              Z: null
            },
            u = e(r, n, t, 0);
          if (u != t.length) return null;
          "p" in r && (r.H = r.H % 12 + 12 * r.p);
          var i = null != r.Z && nc !== Rt,
            o = new(i ? Rt : nc);
          return "j" in r ? o.setFullYear(r.y, 0, r.j) : "w" in r && ("W" in r || "U" in r) ? (o.setFullYear(r.y, 0, 1), o.setFullYear(r.y, 0, "W" in r ? (r.w + 6) % 7 + 7 * r.W - (o.getDay() + 5) % 7 : r.w + 7 * r.U - (o.getDay() + 6) % 7)) : o.setFullYear(r.y, r.m, r.d), o.setHours(r.H + Math.floor(r.Z / 100), r.M + r.Z % 100, r.S, r.L), i ? o._ : o
        }, t.toString = function() {
          return n
        }, t
      }

      function e(n, t, e, r) {
        for (var u, i, o, a = 0, c = t.length, s = e.length; c > a;) {
          if (r >= s) return -1;
          if (u = t.charCodeAt(a++), 37 === u) {
            if (o = t.charAt(a++), i = N[o in ec ? t.charAt(a++) : o], !i || (r = i(n, e, r)) < 0) return -1
          } else if (u != e.charCodeAt(r++)) return -1
        }
        return r
      }

      function r(n, t, e) {
        b.lastIndex = 0;
        var r = b.exec(t.substring(e));
        return r ? (n.w = w.get(r[0].toLowerCase()), e + r[0].length) : -1
      }

      function u(n, t, e) {
        M.lastIndex = 0;
        var r = M.exec(t.substring(e));
        return r ? (n.w = _.get(r[0].toLowerCase()), e + r[0].length) : -1
      }

      function i(n, t, e) {
        E.lastIndex = 0;
        var r = E.exec(t.substring(e));
        return r ? (n.m = A.get(r[0].toLowerCase()), e + r[0].length) : -1
      }

      function o(n, t, e) {
        S.lastIndex = 0;
        var r = S.exec(t.substring(e));
        return r ? (n.m = k.get(r[0].toLowerCase()), e + r[0].length) : -1
      }

      function a(n, t, r) {
        return e(n, C.c.toString(), t, r)
      }

      function c(n, t, r) {
        return e(n, C.x.toString(), t, r)
      }

      function s(n, t, r) {
        return e(n, C.X.toString(), t, r)
      }

      function l(n, t, e) {
        var r = x.get(t.substring(e, e += 2).toLowerCase());
        return null == r ? -1 : (n.p = r, e)
      }
      var f = n.dateTime,
        h = n.date,
        g = n.time,
        p = n.periods,
        v = n.days,
        d = n.shortDays,
        m = n.months,
        y = n.shortMonths;
      t.utc = function(n) {
        function e(n) {
          try {
            nc = Rt;
            var t = new nc;
            return t._ = n, r(t)
          } finally {
            nc = Date
          }
        }
        var r = t(n);
        return e.parse = function(n) {
          try {
            nc = Rt;
            var t = r.parse(n);
            return t && t._
          } finally {
            nc = Date
          }
        }, e.toString = r.toString, e
      }, t.multi = t.utc.multi = re;
      var x = Zo.map(),
        M = Ht(v),
        _ = Ft(v),
        b = Ht(d),
        w = Ft(d),
        S = Ht(m),
        k = Ft(m),
        E = Ht(y),
        A = Ft(y);
      p.forEach(function(n, t) {
        x.set(n.toLowerCase(), t)
      });
      var C = {
          a: function(n) {
            return d[n.getDay()]
          },
          A: function(n) {
            return v[n.getDay()]
          },
          b: function(n) {
            return y[n.getMonth()]
          },
          B: function(n) {
            return m[n.getMonth()]
          },
          c: t(f),
          d: function(n, t) {
            return jt(n.getDate(), t, 2)
          },
          e: function(n, t) {
            return jt(n.getDate(), t, 2)
          },
          H: function(n, t) {
            return jt(n.getHours(), t, 2)
          },
          I: function(n, t) {
            return jt(n.getHours() % 12 || 12, t, 2)
          },
          j: function(n, t) {
            return jt(1 + Qa.dayOfYear(n), t, 3)
          },
          L: function(n, t) {
            return jt(n.getMilliseconds(), t, 3)
          },
          m: function(n, t) {
            return jt(n.getMonth() + 1, t, 2)
          },
          M: function(n, t) {
            return jt(n.getMinutes(), t, 2)
          },
          p: function(n) {
            return p[+(n.getHours() >= 12)]
          },
          S: function(n, t) {
            return jt(n.getSeconds(), t, 2)
          },
          U: function(n, t) {
            return jt(Qa.sundayOfYear(n), t, 2)
          },
          w: function(n) {
            return n.getDay()
          },
          W: function(n, t) {
            return jt(Qa.mondayOfYear(n), t, 2)
          },
          x: t(h),
          X: t(g),
          y: function(n, t) {
            return jt(n.getFullYear() % 100, t, 2)
          },
          Y: function(n, t) {
            return jt(n.getFullYear() % 1e4, t, 4)
          },
          Z: te,
          "%": function() {
            return "%"
          }
        },
        N = {
          a: r,
          A: u,
          b: i,
          B: o,
          c: a,
          d: Wt,
          e: Wt,
          H: Gt,
          I: Gt,
          j: Jt,
          L: ne,
          m: Bt,
          M: Kt,
          p: l,
          S: Qt,
          U: Yt,
          w: Ot,
          W: It,
          x: c,
          X: s,
          y: Vt,
          Y: Zt,
          Z: Xt,
          "%": ee
        };
      return t
    }

    function jt(n, t, e) {
      var r = 0 > n ? "-" : "",
        u = (r ? -n : n) + "",
        i = u.length;
      return r + (e > i ? new Array(e - i + 1).join(t) + u : u)
    }

    function Ht(n) {
      return new RegExp("^(?:" + n.map(Zo.requote).join("|") + ")", "i")
    }

    function Ft(n) {
      for (var t = new o, e = -1, r = n.length; ++e < r;) t.set(n[e].toLowerCase(), e);
      return t
    }

    function Ot(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 1));
      return r ? (n.w = +r[0], e + r[0].length) : -1
    }

    function Yt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e));
      return r ? (n.U = +r[0], e + r[0].length) : -1
    }

    function It(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e));
      return r ? (n.W = +r[0], e + r[0].length) : -1
    }

    function Zt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 4));
      return r ? (n.y = +r[0], e + r[0].length) : -1
    }

    function Vt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.y = $t(+r[0]), e + r[0].length) : -1
    }

    function Xt(n, t, e) {
      return /^[+-]\d{4}$/.test(t = t.substring(e, e + 5)) ? (n.Z = -t, e + 5) : -1
    }

    function $t(n) {
      return n + (n > 68 ? 1900 : 2e3)
    }

    function Bt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.m = r[0] - 1, e + r[0].length) : -1
    }

    function Wt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.d = +r[0], e + r[0].length) : -1
    }

    function Jt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 3));
      return r ? (n.j = +r[0], e + r[0].length) : -1
    }

    function Gt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.H = +r[0], e + r[0].length) : -1
    }

    function Kt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.M = +r[0], e + r[0].length) : -1
    }

    function Qt(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 2));
      return r ? (n.S = +r[0], e + r[0].length) : -1
    }

    function ne(n, t, e) {
      rc.lastIndex = 0;
      var r = rc.exec(t.substring(e, e + 3));
      return r ? (n.L = +r[0], e + r[0].length) : -1
    }

    function te(n) {
      var t = n.getTimezoneOffset(),
        e = t > 0 ? "-" : "+",
        r = ~~(ua(t) / 60),
        u = ua(t) % 60;
      return e + jt(r, "0", 2) + jt(u, "0", 2)
    }

    function ee(n, t, e) {
      uc.lastIndex = 0;
      var r = uc.exec(t.substring(e, e + 1));
      return r ? e + r[0].length : -1
    }

    function re(n) {
      for (var t = n.length, e = -1; ++e < t;) n[e][0] = this(n[e][0]);
      return function(t) {
        for (var e = 0, r = n[e]; !r[1](t);) r = n[++e];
        return r[0](t)
      }
    }

    function ue() {}

    function ie(n, t, e) {
      var r = e.s = n + t,
        u = r - n,
        i = r - u;
      e.t = n - i + (t - u)
    }

    function oe(n, t) {
      n && cc.hasOwnProperty(n.type) && cc[n.type](n, t)
    }

    function ae(n, t, e) {
      var r, u = -1,
        i = n.length - e;
      for (t.lineStart(); ++u < i;) r = n[u], t.point(r[0], r[1], r[2]);
      t.lineEnd()
    }

    function ce(n, t) {
      var e = -1,
        r = n.length;
      for (t.polygonStart(); ++e < r;) ae(n[e], t, 1);
      t.polygonEnd()
    }

    function se() {
      function n(n, t) {
        n *= Aa, t = t * Aa / 2 + ba / 4;
        var e = n - r,
          o = e >= 0 ? 1 : -1,
          a = o * e,
          c = Math.cos(t),
          s = Math.sin(t),
          l = i * s,
          f = u * c + l * Math.cos(a),
          h = l * o * Math.sin(a);
        lc.add(Math.atan2(h, f)), r = n, u = c, i = s
      }
      var t, e, r, u, i;
      fc.point = function(o, a) {
        fc.point = n, r = (t = o) * Aa, u = Math.cos(a = (e = a) * Aa / 2 + ba / 4), i = Math.sin(a)
      }, fc.lineEnd = function() {
        n(t, e)
      }
    }

    function le(n) {
      var t = n[0],
        e = n[1],
        r = Math.cos(e);
      return [r * Math.cos(t), r * Math.sin(t), Math.sin(e)]
    }

    function fe(n, t) {
      return n[0] * t[0] + n[1] * t[1] + n[2] * t[2]
    }

    function he(n, t) {
      return [n[1] * t[2] - n[2] * t[1], n[2] * t[0] - n[0] * t[2], n[0] * t[1] - n[1] * t[0]]
    }

    function ge(n, t) {
      n[0] += t[0], n[1] += t[1], n[2] += t[2]
    }

    function pe(n, t) {
      return [n[0] * t, n[1] * t, n[2] * t]
    }

    function ve(n) {
      var t = Math.sqrt(n[0] * n[0] + n[1] * n[1] + n[2] * n[2]);
      n[0] /= t, n[1] /= t, n[2] /= t
    }

    function de(n) {
      return [Math.atan2(n[1], n[0]), G(n[2])]
    }

    function me(n, t) {
      return ua(n[0] - t[0]) < ka && ua(n[1] - t[1]) < ka
    }

    function ye(n, t) {
      n *= Aa;
      var e = Math.cos(t *= Aa);
      xe(e * Math.cos(n), e * Math.sin(n), Math.sin(t))
    }

    function xe(n, t, e) {
      ++hc, pc += (n - pc) / hc, vc += (t - vc) / hc, dc += (e - dc) / hc
    }

    function Me() {
      function n(n, u) {
        n *= Aa;
        var i = Math.cos(u *= Aa),
          o = i * Math.cos(n),
          a = i * Math.sin(n),
          c = Math.sin(u),
          s = Math.atan2(Math.sqrt((s = e * c - r * a) * s + (s = r * o - t * c) * s + (s = t * a - e * o) * s), t * o + e * a + r * c);
        gc += s, mc += s * (t + (t = o)), yc += s * (e + (e = a)), xc += s * (r + (r = c)), xe(t, e, r)
      }
      var t, e, r;
      wc.point = function(u, i) {
        u *= Aa;
        var o = Math.cos(i *= Aa);
        t = o * Math.cos(u), e = o * Math.sin(u), r = Math.sin(i), wc.point = n, xe(t, e, r)
      }
    }

    function _e() {
      wc.point = ye
    }

    function be() {
      function n(n, t) {
        n *= Aa;
        var e = Math.cos(t *= Aa),
          o = e * Math.cos(n),
          a = e * Math.sin(n),
          c = Math.sin(t),
          s = u * c - i * a,
          l = i * o - r * c,
          f = r * a - u * o,
          h = Math.sqrt(s * s + l * l + f * f),
          g = r * o + u * a + i * c,
          p = h && -J(g) / h,
          v = Math.atan2(h, g);
        Mc += p * s, _c += p * l, bc += p * f, gc += v, mc += v * (r + (r = o)), yc += v * (u + (u = a)), xc += v * (i + (i = c)), xe(r, u, i)
      }
      var t, e, r, u, i;
      wc.point = function(o, a) {
        t = o, e = a, wc.point = n, o *= Aa;
        var c = Math.cos(a *= Aa);
        r = c * Math.cos(o), u = c * Math.sin(o), i = Math.sin(a), xe(r, u, i)
      }, wc.lineEnd = function() {
        n(t, e), wc.lineEnd = _e, wc.point = ye
      }
    }

    function we() {
      return !0
    }

    function Se(n, t, e, r, u) {
      var i = [],
        o = [];
      if (n.forEach(function(n) {
          if (!((t = n.length - 1) <= 0)) {
            var t, e = n[0],
              r = n[t];
            if (me(e, r)) {
              u.lineStart();
              for (var a = 0; t > a; ++a) u.point((e = n[a])[0], e[1]);
              return u.lineEnd(), void 0
            }
            var c = new Ee(e, n, null, !0),
              s = new Ee(e, null, c, !1);
            c.o = s, i.push(c), o.push(s), c = new Ee(r, n, null, !1), s = new Ee(r, null, c, !0), c.o = s, i.push(c), o.push(s)
          }
        }), o.sort(t), ke(i), ke(o), i.length) {
        for (var a = 0, c = e, s = o.length; s > a; ++a) o[a].e = c = !c;
        for (var l, f, h = i[0];;) {
          for (var g = h, p = !0; g.v;)
            if ((g = g.n) === h) return;
          l = g.z, u.lineStart();
          do {
            if (g.v = g.o.v = !0, g.e) {
              if (p)
                for (var a = 0, s = l.length; s > a; ++a) u.point((f = l[a])[0], f[1]);
              else r(g.x, g.n.x, 1, u);
              g = g.n
            } else {
              if (p) {
                l = g.p.z;
                for (var a = l.length - 1; a >= 0; --a) u.point((f = l[a])[0], f[1])
              } else r(g.x, g.p.x, -1, u);
              g = g.p
            }
            g = g.o, l = g.z, p = !p
          } while (!g.v);
          u.lineEnd()
        }
      }
    }

    function ke(n) {
      if (t = n.length) {
        for (var t, e, r = 0, u = n[0]; ++r < t;) u.n = e = n[r], e.p = u, u = e;
        u.n = e = n[0], e.p = u
      }
    }

    function Ee(n, t, e, r) {
      this.x = n, this.z = t, this.o = e, this.e = r, this.v = !1, this.n = this.p = null
    }

    function Ae(n, t, e, r) {
      return function(u, i) {
        function o(t, e) {
          var r = u(t, e);
          n(t = r[0], e = r[1]) && i.point(t, e)
        }

        function a(n, t) {
          var e = u(n, t);
          d.point(e[0], e[1])
        }

        function c() {
          y.point = a, d.lineStart()
        }

        function s() {
          y.point = o, d.lineEnd()
        }

        function l(n, t) {
          v.push([n, t]);
          var e = u(n, t);
          M.point(e[0], e[1])
        }

        function f() {
          M.lineStart(), v = []
        }

        function h() {
          l(v[0][0], v[0][1]), M.lineEnd();
          var n, t = M.clean(),
            e = x.buffer(),
            r = e.length;
          if (v.pop(), p.push(v), v = null, r)
            if (1 & t) {
              n = e[0];
              var u, r = n.length - 1,
                o = -1;
              if (r > 0) {
                for (_ || (i.polygonStart(), _ = !0), i.lineStart(); ++o < r;) i.point((u = n[o])[0], u[1]);
                i.lineEnd()
              }
            } else r > 1 && 2 & t && e.push(e.pop().concat(e.shift())), g.push(e.filter(Ce))
        }
        var g, p, v, d = t(i),
          m = u.invert(r[0], r[1]),
          y = {
            point: o,
            lineStart: c,
            lineEnd: s,
            polygonStart: function() {
              y.point = l, y.lineStart = f, y.lineEnd = h, g = [], p = []
            },
            polygonEnd: function() {
              y.point = o, y.lineStart = c, y.lineEnd = s, g = Zo.merge(g);
              var n = Le(m, p);
              g.length ? (_ || (i.polygonStart(), _ = !0), Se(g, ze, n, e, i)) : n && (_ || (i.polygonStart(), _ = !0), i.lineStart(), e(null, null, 1, i), i.lineEnd()), _ && (i.polygonEnd(), _ = !1), g = p = null
            },
            sphere: function() {
              i.polygonStart(), i.lineStart(), e(null, null, 1, i), i.lineEnd(), i.polygonEnd()
            }
          },
          x = Ne(),
          M = t(x),
          _ = !1;
        return y
      }
    }

    function Ce(n) {
      return n.length > 1
    }

    function Ne() {
      var n, t = [];
      return {
        lineStart: function() {
          t.push(n = [])
        },
        point: function(t, e) {
          n.push([t, e])
        },
        lineEnd: v,
        buffer: function() {
          var e = t;
          return t = [], n = null, e
        },
        rejoin: function() {
          t.length > 1 && t.push(t.pop().concat(t.shift()))
        }
      }
    }

    function ze(n, t) {
      return ((n = n.x)[0] < 0 ? n[1] - Sa - ka : Sa - n[1]) - ((t = t.x)[0] < 0 ? t[1] - Sa - ka : Sa - t[1])
    }

    function Le(n, t) {
      var e = n[0],
        r = n[1],
        u = [Math.sin(e), -Math.cos(e), 0],
        i = 0,
        o = 0;
      lc.reset();
      for (var a = 0, c = t.length; c > a; ++a) {
        var s = t[a],
          l = s.length;
        if (l)
          for (var f = s[0], h = f[0], g = f[1] / 2 + ba / 4, p = Math.sin(g), v = Math.cos(g), d = 1;;) {
            d === l && (d = 0), n = s[d];
            var m = n[0],
              y = n[1] / 2 + ba / 4,
              x = Math.sin(y),
              M = Math.cos(y),
              _ = m - h,
              b = _ >= 0 ? 1 : -1,
              w = b * _,
              S = w > ba,
              k = p * x;
            if (lc.add(Math.atan2(k * b * Math.sin(w), v * M + k * Math.cos(w))), i += S ? _ + b * wa : _, S ^ h >= e ^ m >= e) {
              var E = he(le(f), le(n));
              ve(E);
              var A = he(u, E);
              ve(A);
              var C = (S ^ _ >= 0 ? -1 : 1) * G(A[2]);
              (r > C || r === C && (E[0] || E[1])) && (o += S ^ _ >= 0 ? 1 : -1)
            }
            if (!d++) break;
            h = m, p = x, v = M, f = n
          }
      }
      return (-ka > i || ka > i && 0 > lc) ^ 1 & o
    }

    function Te(n) {
      var t, e = 0 / 0,
        r = 0 / 0,
        u = 0 / 0;
      return {
        lineStart: function() {
          n.lineStart(), t = 1
        },
        point: function(i, o) {
          var a = i > 0 ? ba : -ba,
            c = ua(i - e);
          ua(c - ba) < ka ? (n.point(e, r = (r + o) / 2 > 0 ? Sa : -Sa), n.point(u, r), n.lineEnd(), n.lineStart(), n.point(a, r), n.point(i, r), t = 0) : u !== a && c >= ba && (ua(e - u) < ka && (e -= u * ka), ua(i - a) < ka && (i -= a * ka), r = qe(e, r, i, o), n.point(u, r), n.lineEnd(), n.lineStart(), n.point(a, r), t = 0), n.point(e = i, r = o), u = a
        },
        lineEnd: function() {
          n.lineEnd(), e = r = 0 / 0
        },
        clean: function() {
          return 2 - t
        }
      }
    }

    function qe(n, t, e, r) {
      var u, i, o = Math.sin(n - e);
      return ua(o) > ka ? Math.atan((Math.sin(t) * (i = Math.cos(r)) * Math.sin(e) - Math.sin(r) * (u = Math.cos(t)) * Math.sin(n)) / (u * i * o)) : (t + r) / 2
    }

    function Re(n, t, e, r) {
      var u;
      if (null == n) u = e * Sa, r.point(-ba, u), r.point(0, u), r.point(ba, u), r.point(ba, 0), r.point(ba, -u), r.point(0, -u), r.point(-ba, -u), r.point(-ba, 0), r.point(-ba, u);
      else if (ua(n[0] - t[0]) > ka) {
        var i = n[0] < t[0] ? ba : -ba;
        u = e * i / 2, r.point(-i, u), r.point(0, u), r.point(i, u)
      } else r.point(t[0], t[1])
    }

    function De(n) {
      function t(n, t) {
        return Math.cos(n) * Math.cos(t) > i
      }

      function e(n) {
        var e, i, c, s, l;
        return {
          lineStart: function() {
            s = c = !1, l = 1
          },
          point: function(f, h) {
            var g, p = [f, h],
              v = t(f, h),
              d = o ? v ? 0 : u(f, h) : v ? u(f + (0 > f ? ba : -ba), h) : 0;
            if (!e && (s = c = v) && n.lineStart(), v !== c && (g = r(e, p), (me(e, g) || me(p, g)) && (p[0] += ka, p[1] += ka, v = t(p[0], p[1]))), v !== c) l = 0, v ? (n.lineStart(), g = r(p, e), n.point(g[0], g[1])) : (g = r(e, p), n.point(g[0], g[1]), n.lineEnd()), e = g;
            else if (a && e && o ^ v) {
              var m;
              d & i || !(m = r(p, e, !0)) || (l = 0, o ? (n.lineStart(), n.point(m[0][0], m[0][1]), n.point(m[1][0], m[1][1]), n.lineEnd()) : (n.point(m[1][0], m[1][1]), n.lineEnd(), n.lineStart(), n.point(m[0][0], m[0][1])))
            }!v || e && me(e, p) || n.point(p[0], p[1]), e = p, c = v, i = d
          },
          lineEnd: function() {
            c && n.lineEnd(), e = null
          },
          clean: function() {
            return l | (s && c) << 1
          }
        }
      }

      function r(n, t, e) {
        var r = le(n),
          u = le(t),
          o = [1, 0, 0],
          a = he(r, u),
          c = fe(a, a),
          s = a[0],
          l = c - s * s;
        if (!l) return !e && n;
        var f = i * c / l,
          h = -i * s / l,
          g = he(o, a),
          p = pe(o, f),
          v = pe(a, h);
        ge(p, v);
        var d = g,
          m = fe(p, d),
          y = fe(d, d),
          x = m * m - y * (fe(p, p) - 1);
        if (!(0 > x)) {
          var M = Math.sqrt(x),
            _ = pe(d, (-m - M) / y);
          if (ge(_, p), _ = de(_), !e) return _;
          var b, w = n[0],
            S = t[0],
            k = n[1],
            E = t[1];
          w > S && (b = w, w = S, S = b);
          var A = S - w,
            C = ua(A - ba) < ka,
            N = C || ka > A;
          if (!C && k > E && (b = k, k = E, E = b), N ? C ? k + E > 0 ^ _[1] < (ua(_[0] - w) < ka ? k : E) : k <= _[1] && _[1] <= E : A > ba ^ (w <= _[0] && _[0] <= S)) {
            var z = pe(d, (-m + M) / y);
            return ge(z, p), [_, de(z)]
          }
        }
      }

      function u(t, e) {
        var r = o ? n : ba - n,
          u = 0;
        return -r > t ? u |= 1 : t > r && (u |= 2), -r > e ? u |= 4 : e > r && (u |= 8), u
      }
      var i = Math.cos(n),
        o = i > 0,
        a = ua(i) > ka,
        c = sr(n, 6 * Aa);
      return Ae(t, e, c, o ? [0, -n] : [-ba, n - ba])
    }

    function Pe(n, t, e, r) {
      return function(u) {
        var i, o = u.a,
          a = u.b,
          c = o.x,
          s = o.y,
          l = a.x,
          f = a.y,
          h = 0,
          g = 1,
          p = l - c,
          v = f - s;
        if (i = n - c, p || !(i > 0)) {
          if (i /= p, 0 > p) {
            if (h > i) return;
            g > i && (g = i)
          } else if (p > 0) {
            if (i > g) return;
            i > h && (h = i)
          }
          if (i = e - c, p || !(0 > i)) {
            if (i /= p, 0 > p) {
              if (i > g) return;
              i > h && (h = i)
            } else if (p > 0) {
              if (h > i) return;
              g > i && (g = i)
            }
            if (i = t - s, v || !(i > 0)) {
              if (i /= v, 0 > v) {
                if (h > i) return;
                g > i && (g = i)
              } else if (v > 0) {
                if (i > g) return;
                i > h && (h = i)
              }
              if (i = r - s, v || !(0 > i)) {
                if (i /= v, 0 > v) {
                  if (i > g) return;
                  i > h && (h = i)
                } else if (v > 0) {
                  if (h > i) return;
                  g > i && (g = i)
                }
                return h > 0 && (u.a = {
                  x: c + h * p,
                  y: s + h * v
                }), 1 > g && (u.b = {
                  x: c + g * p,
                  y: s + g * v
                }), u
              }
            }
          }
        }
      }
    }

    function Ue(n, t, e, r) {
      function u(r, u) {
        return ua(r[0] - n) < ka ? u > 0 ? 0 : 3 : ua(r[0] - e) < ka ? u > 0 ? 2 : 1 : ua(r[1] - t) < ka ? u > 0 ? 1 : 0 : u > 0 ? 3 : 2
      }

      function i(n, t) {
        return o(n.x, t.x)
      }

      function o(n, t) {
        var e = u(n, 1),
          r = u(t, 1);
        return e !== r ? e - r : 0 === e ? t[1] - n[1] : 1 === e ? n[0] - t[0] : 2 === e ? n[1] - t[1] : t[0] - n[0]
      }
      return function(a) {
        function c(n) {
          for (var t = 0, e = d.length, r = n[1], u = 0; e > u; ++u)
            for (var i, o = 1, a = d[u], c = a.length, s = a[0]; c > o; ++o) i = a[o], s[1] <= r ? i[1] > r && W(s, i, n) > 0 && ++t : i[1] <= r && W(s, i, n) < 0 && --t, s = i;
          return 0 !== t
        }

        function s(i, a, c, s) {
          var l = 0,
            f = 0;
          if (null == i || (l = u(i, c)) !== (f = u(a, c)) || o(i, a) < 0 ^ c > 0) {
            do s.point(0 === l || 3 === l ? n : e, l > 1 ? r : t); while ((l = (l + c + 4) % 4) !== f)
          } else s.point(a[0], a[1])
        }

        function l(u, i) {
          return u >= n && e >= u && i >= t && r >= i
        }

        function f(n, t) {
          l(n, t) && a.point(n, t)
        }

        function h() {
          N.point = p, d && d.push(m = []), S = !0, w = !1, _ = b = 0 / 0
        }

        function g() {
          v && (p(y, x), M && w && A.rejoin(), v.push(A.buffer())), N.point = f, w && a.lineEnd()
        }

        function p(n, t) {
          n = Math.max(-kc, Math.min(kc, n)), t = Math.max(-kc, Math.min(kc, t));
          var e = l(n, t);
          if (d && m.push([n, t]), S) y = n, x = t, M = e, S = !1, e && (a.lineStart(), a.point(n, t));
          else if (e && w) a.point(n, t);
          else {
            var r = {
              a: {
                x: _,
                y: b
              },
              b: {
                x: n,
                y: t
              }
            };
            C(r) ? (w || (a.lineStart(), a.point(r.a.x, r.a.y)), a.point(r.b.x, r.b.y), e || a.lineEnd(), k = !1) : e && (a.lineStart(), a.point(n, t), k = !1)
          }
          _ = n, b = t, w = e
        }
        var v, d, m, y, x, M, _, b, w, S, k, E = a,
          A = Ne(),
          C = Pe(n, t, e, r),
          N = {
            point: f,
            lineStart: h,
            lineEnd: g,
            polygonStart: function() {
              a = A, v = [], d = [], k = !0
            },
            polygonEnd: function() {
              a = E, v = Zo.merge(v);
              var t = c([n, r]),
                e = k && t,
                u = v.length;
              (e || u) && (a.polygonStart(), e && (a.lineStart(), s(null, null, 1, a), a.lineEnd()), u && Se(v, i, t, s, a), a.polygonEnd()), v = d = m = null
            }
          };
        return N
      }
    }

    function je(n, t) {
      function e(e, r) {
        return e = n(e, r), t(e[0], e[1])
      }
      return n.invert && t.invert && (e.invert = function(e, r) {
        return e = t.invert(e, r), e && n.invert(e[0], e[1])
      }), e
    }

    function He(n) {
      var t = 0,
        e = ba / 3,
        r = tr(n),
        u = r(t, e);
      return u.parallels = function(n) {
        return arguments.length ? r(t = n[0] * ba / 180, e = n[1] * ba / 180) : [180 * (t / ba), 180 * (e / ba)]
      }, u
    }

    function Fe(n, t) {
      function e(n, t) {
        var e = Math.sqrt(i - 2 * u * Math.sin(t)) / u;
        return [e * Math.sin(n *= u), o - e * Math.cos(n)]
      }
      var r = Math.sin(n),
        u = (r + Math.sin(t)) / 2,
        i = 1 + r * (2 * u - r),
        o = Math.sqrt(i) / u;
      return e.invert = function(n, t) {
        var e = o - t;
        return [Math.atan2(n, e) / u, G((i - (n * n + e * e) * u * u) / (2 * u))]
      }, e
    }

    function Oe() {
      function n(n, t) {
        Ac += u * n - r * t, r = n, u = t
      }
      var t, e, r, u;
      Tc.point = function(i, o) {
        Tc.point = n, t = r = i, e = u = o
      }, Tc.lineEnd = function() {
        n(t, e)
      }
    }

    function Ye(n, t) {
      Cc > n && (Cc = n), n > zc && (zc = n), Nc > t && (Nc = t), t > Lc && (Lc = t)
    }

    function Ie() {
      function n(n, t) {
        o.push("M", n, ",", t, i)
      }

      function t(n, t) {
        o.push("M", n, ",", t), a.point = e
      }

      function e(n, t) {
        o.push("L", n, ",", t)
      }

      function r() {
        a.point = n
      }

      function u() {
        o.push("Z")
      }
      var i = Ze(4.5),
        o = [],
        a = {
          point: n,
          lineStart: function() {
            a.point = t
          },
          lineEnd: r,
          polygonStart: function() {
            a.lineEnd = u
          },
          polygonEnd: function() {
            a.lineEnd = r, a.point = n
          },
          pointRadius: function(n) {
            return i = Ze(n), a
          },
          result: function() {
            if (o.length) {
              var n = o.join("");
              return o = [], n
            }
          }
        };
      return a
    }

    function Ze(n) {
      return "m0," + n + "a" + n + "," + n + " 0 1,1 0," + -2 * n + "a" + n + "," + n + " 0 1,1 0," + 2 * n + "z"
    }

    function Ve(n, t) {
      pc += n, vc += t, ++dc
    }

    function Xe() {
      function n(n, r) {
        var u = n - t,
          i = r - e,
          o = Math.sqrt(u * u + i * i);
        mc += o * (t + n) / 2, yc += o * (e + r) / 2, xc += o, Ve(t = n, e = r)
      }
      var t, e;
      Rc.point = function(r, u) {
        Rc.point = n, Ve(t = r, e = u)
      }
    }

    function $e() {
      Rc.point = Ve
    }

    function Be() {
      function n(n, t) {
        var e = n - r,
          i = t - u,
          o = Math.sqrt(e * e + i * i);
        mc += o * (r + n) / 2, yc += o * (u + t) / 2, xc += o, o = u * n - r * t, Mc += o * (r + n), _c += o * (u + t), bc += 3 * o, Ve(r = n, u = t)
      }
      var t, e, r, u;
      Rc.point = function(i, o) {
        Rc.point = n, Ve(t = r = i, e = u = o)
      }, Rc.lineEnd = function() {
        n(t, e)
      }
    }

    function We(n) {
      function t(t, e) {
        n.moveTo(t, e), n.arc(t, e, o, 0, wa)
      }

      function e(t, e) {
        n.moveTo(t, e), a.point = r
      }

      function r(t, e) {
        n.lineTo(t, e)
      }

      function u() {
        a.point = t
      }

      function i() {
        n.closePath()
      }
      var o = 4.5,
        a = {
          point: t,
          lineStart: function() {
            a.point = e
          },
          lineEnd: u,
          polygonStart: function() {
            a.lineEnd = i
          },
          polygonEnd: function() {
            a.lineEnd = u, a.point = t
          },
          pointRadius: function(n) {
            return o = n, a
          },
          result: v
        };
      return a
    }

    function Je(n) {
      function t(n) {
        return (a ? r : e)(n)
      }

      function e(t) {
        return Qe(t, function(e, r) {
          e = n(e, r), t.point(e[0], e[1])
        })
      }

      function r(t) {
        function e(e, r) {
          e = n(e, r), t.point(e[0], e[1])
        }

        function r() {
          x = 0 / 0, S.point = i, t.lineStart()
        }

        function i(e, r) {
          var i = le([e, r]),
            o = n(e, r);
          u(x, M, y, _, b, w, x = o[0], M = o[1], y = e, _ = i[0], b = i[1], w = i[2], a, t), t.point(x, M)
        }

        function o() {
          S.point = e, t.lineEnd()
        }

        function c() {
          r(), S.point = s, S.lineEnd = l
        }

        function s(n, t) {
          i(f = n, h = t), g = x, p = M, v = _, d = b, m = w, S.point = i
        }

        function l() {
          u(x, M, y, _, b, w, g, p, f, v, d, m, a, t), S.lineEnd = o, o()
        }
        var f, h, g, p, v, d, m, y, x, M, _, b, w, S = {
          point: e,
          lineStart: r,
          lineEnd: o,
          polygonStart: function() {
            t.polygonStart(), S.lineStart = c
          },
          polygonEnd: function() {
            t.polygonEnd(), S.lineStart = r
          }
        };
        return S
      }

      function u(t, e, r, a, c, s, l, f, h, g, p, v, d, m) {
        var y = l - t,
          x = f - e,
          M = y * y + x * x;
        if (M > 4 * i && d--) {
          var _ = a + g,
            b = c + p,
            w = s + v,
            S = Math.sqrt(_ * _ + b * b + w * w),
            k = Math.asin(w /= S),
            E = ua(ua(w) - 1) < ka || ua(r - h) < ka ? (r + h) / 2 : Math.atan2(b, _),
            A = n(E, k),
            C = A[0],
            N = A[1],
            z = C - t,
            L = N - e,
            T = x * z - y * L;
          (T * T / M > i || ua((y * z + x * L) / M - .5) > .3 || o > a * g + c * p + s * v) && (u(t, e, r, a, c, s, C, N, E, _ /= S, b /= S, w, d, m), m.point(C, N), u(C, N, E, _, b, w, l, f, h, g, p, v, d, m))
        }
      }
      var i = .5,
        o = Math.cos(30 * Aa),
        a = 16;
      return t.precision = function(n) {
        return arguments.length ? (a = (i = n * n) > 0 && 16, t) : Math.sqrt(i)
      }, t
    }

    function Ge(n) {
      var t = Je(function(t, e) {
        return n([t * Ca, e * Ca])
      });
      return function(n) {
        return er(t(n))
      }
    }

    function Ke(n) {
      this.stream = n
    }

    function Qe(n, t) {
      return {
        point: t,
        sphere: function() {
          n.sphere()
        },
        lineStart: function() {
          n.lineStart()
        },
        lineEnd: function() {
          n.lineEnd()
        },
        polygonStart: function() {
          n.polygonStart()
        },
        polygonEnd: function() {
          n.polygonEnd()
        }
      }
    }

    function nr(n) {
      return tr(function() {
        return n
      })()
    }

    function tr(n) {
      function t(n) {
        return n = a(n[0] * Aa, n[1] * Aa), [n[0] * h + c, s - n[1] * h]
      }

      function e(n) {
        return n = a.invert((n[0] - c) / h, (s - n[1]) / h), n && [n[0] * Ca, n[1] * Ca]
      }

      function r() {
        a = je(o = ir(m, y, x), i);
        var n = i(v, d);
        return c = g - n[0] * h, s = p + n[1] * h, u()
      }

      function u() {
        return l && (l.valid = !1, l = null), t
      }
      var i, o, a, c, s, l, f = Je(function(n, t) {
          return n = i(n, t), [n[0] * h + c, s - n[1] * h]
        }),
        h = 150,
        g = 480,
        p = 250,
        v = 0,
        d = 0,
        m = 0,
        y = 0,
        x = 0,
        M = Sc,
        _ = wt,
        b = null,
        w = null;
      return t.stream = function(n) {
          return l && (l.valid = !1), l = er(M(o, f(_(n)))), l.valid = !0, l
        }, t.clipAngle = function(n) {
          return arguments.length ? (M = null == n ? (b = n, Sc) : De((b = +n) * Aa), u()) : b
        }, t.clipExtent = function(n) {
          return arguments.length ? (w = n, _ = n ? Ue(n[0][0], n[0][1], n[1][0], n[1][1]) : wt, u()) : w
        }, t.scale = function(n) {
          return arguments.length ? (h = +n, r()) : h
        }, t.translate = function(n) {
          return arguments.length ? (g = +n[0], p = +n[1], r()) : [g, p]
        }, t.center = function(n) {
          return arguments.length ? (v = n[0] % 360 * Aa, d = n[1] % 360 * Aa, r()) : [v * Ca, d * Ca]
        }, t.rotate = function(n) {
          return arguments.length ? (m = n[0] % 360 * Aa, y = n[1] % 360 * Aa, x = n.length > 2 ? n[2] % 360 * Aa : 0, r()) : [m * Ca, y * Ca, x * Ca]
        }, Zo.rebind(t, f, "precision"),
        function() {
          return i = n.apply(this, arguments), t.invert = i.invert && e, r()
        }
    }

    function er(n) {
      return Qe(n, function(t, e) {
        n.point(t * Aa, e * Aa)
      })
    }

    function rr(n, t) {
      return [n, t]
    }

    function ur(n, t) {
      return [n > ba ? n - wa : -ba > n ? n + wa : n, t]
    }

    function ir(n, t, e) {
      return n ? t || e ? je(ar(n), cr(t, e)) : ar(n) : t || e ? cr(t, e) : ur
    }

    function or(n) {
      return function(t, e) {
        return t += n, [t > ba ? t - wa : -ba > t ? t + wa : t, e]
      }
    }

    function ar(n) {
      var t = or(n);
      return t.invert = or(-n), t
    }

    function cr(n, t) {
      function e(n, t) {
        var e = Math.cos(t),
          a = Math.cos(n) * e,
          c = Math.sin(n) * e,
          s = Math.sin(t),
          l = s * r + a * u;
        return [Math.atan2(c * i - l * o, a * r - s * u), G(l * i + c * o)]
      }
      var r = Math.cos(n),
        u = Math.sin(n),
        i = Math.cos(t),
        o = Math.sin(t);
      return e.invert = function(n, t) {
        var e = Math.cos(t),
          a = Math.cos(n) * e,
          c = Math.sin(n) * e,
          s = Math.sin(t),
          l = s * i - c * o;
        return [Math.atan2(c * i + s * o, a * r + l * u), G(l * r - a * u)]
      }, e
    }

    function sr(n, t) {
      var e = Math.cos(n),
        r = Math.sin(n);
      return function(u, i, o, a) {
        var c = o * t;
        null != u ? (u = lr(e, u), i = lr(e, i), (o > 0 ? i > u : u > i) && (u += o * wa)) : (u = n + o * wa, i = n - .5 * c);
        for (var s, l = u; o > 0 ? l > i : i > l; l -= c) a.point((s = de([e, -r * Math.cos(l), -r * Math.sin(l)]))[0], s[1])
      }
    }

    function lr(n, t) {
      var e = le(t);
      e[0] -= n, ve(e);
      var r = J(-e[1]);
      return ((-e[2] < 0 ? -r : r) + 2 * Math.PI - ka) % (2 * Math.PI)
    }

    function fr(n, t, e) {
      var r = Zo.range(n, t - ka, e).concat(t);
      return function(n) {
        return r.map(function(t) {
          return [n, t]
        })
      }
    }

    function hr(n, t, e) {
      var r = Zo.range(n, t - ka, e).concat(t);
      return function(n) {
        return r.map(function(t) {
          return [t, n]
        })
      }
    }

    function gr(n) {
      return n.source
    }

    function pr(n) {
      return n.target
    }

    function vr(n, t, e, r) {
      var u = Math.cos(t),
        i = Math.sin(t),
        o = Math.cos(r),
        a = Math.sin(r),
        c = u * Math.cos(n),
        s = u * Math.sin(n),
        l = o * Math.cos(e),
        f = o * Math.sin(e),
        h = 2 * Math.asin(Math.sqrt(tt(r - t) + u * o * tt(e - n))),
        g = 1 / Math.sin(h),
        p = h ? function(n) {
          var t = Math.sin(n *= h) * g,
            e = Math.sin(h - n) * g,
            r = e * c + t * l,
            u = e * s + t * f,
            o = e * i + t * a;
          return [Math.atan2(u, r) * Ca, Math.atan2(o, Math.sqrt(r * r + u * u)) * Ca]
        } : function() {
          return [n * Ca, t * Ca]
        };
      return p.distance = h, p
    }

    function dr() {
      function n(n, u) {
        var i = Math.sin(u *= Aa),
          o = Math.cos(u),
          a = ua((n *= Aa) - t),
          c = Math.cos(a);
        Dc += Math.atan2(Math.sqrt((a = o * Math.sin(a)) * a + (a = r * i - e * o * c) * a), e * i + r * o * c), t = n, e = i, r = o
      }
      var t, e, r;
      Pc.point = function(u, i) {
        t = u * Aa, e = Math.sin(i *= Aa), r = Math.cos(i), Pc.point = n
      }, Pc.lineEnd = function() {
        Pc.point = Pc.lineEnd = v
      }
    }

    function mr(n, t) {
      function e(t, e) {
        var r = Math.cos(t),
          u = Math.cos(e),
          i = n(r * u);
        return [i * u * Math.sin(t), i * Math.sin(e)]
      }
      return e.invert = function(n, e) {
        var r = Math.sqrt(n * n + e * e),
          u = t(r),
          i = Math.sin(u),
          o = Math.cos(u);
        return [Math.atan2(n * i, r * o), Math.asin(r && e * i / r)]
      }, e
    }

    function yr(n, t) {
      function e(n, t) {
        o > 0 ? -Sa + ka > t && (t = -Sa + ka) : t > Sa - ka && (t = Sa - ka);
        var e = o / Math.pow(u(t), i);
        return [e * Math.sin(i * n), o - e * Math.cos(i * n)]
      }
      var r = Math.cos(n),
        u = function(n) {
          return Math.tan(ba / 4 + n / 2)
        },
        i = n === t ? Math.sin(n) : Math.log(r / Math.cos(t)) / Math.log(u(t) / u(n)),
        o = r * Math.pow(u(n), i) / i;
      return i ? (e.invert = function(n, t) {
        var e = o - t,
          r = B(i) * Math.sqrt(n * n + e * e);
        return [Math.atan2(n, e) / i, 2 * Math.atan(Math.pow(o / r, 1 / i)) - Sa]
      }, e) : Mr
    }

    function xr(n, t) {
      function e(n, t) {
        var e = i - t;
        return [e * Math.sin(u * n), i - e * Math.cos(u * n)]
      }
      var r = Math.cos(n),
        u = n === t ? Math.sin(n) : (r - Math.cos(t)) / (t - n),
        i = r / u + n;
      return ua(u) < ka ? rr : (e.invert = function(n, t) {
        var e = i - t;
        return [Math.atan2(n, e) / u, i - B(u) * Math.sqrt(n * n + e * e)]
      }, e)
    }

    function Mr(n, t) {
      return [n, Math.log(Math.tan(ba / 4 + t / 2))]
    }

    function _r(n) {
      var t, e = nr(n),
        r = e.scale,
        u = e.translate,
        i = e.clipExtent;
      return e.scale = function() {
        var n = r.apply(e, arguments);
        return n === e ? t ? e.clipExtent(null) : e : n
      }, e.translate = function() {
        var n = u.apply(e, arguments);
        return n === e ? t ? e.clipExtent(null) : e : n
      }, e.clipExtent = function(n) {
        var o = i.apply(e, arguments);
        if (o === e) {
          if (t = null == n) {
            var a = ba * r(),
              c = u();
            i([
              [c[0] - a, c[1] - a],
              [c[0] + a, c[1] + a]
            ])
          }
        } else t && (o = null);
        return o
      }, e.clipExtent(null)
    }

    function br(n, t) {
      return [Math.log(Math.tan(ba / 4 + t / 2)), -n]
    }

    function wr(n) {
      return n[0]
    }

    function Sr(n) {
      return n[1]
    }

    function kr(n) {
      for (var t = n.length, e = [0, 1], r = 2, u = 2; t > u; u++) {
        for (; r > 1 && W(n[e[r - 2]], n[e[r - 1]], n[u]) <= 0;) --r;
        e[r++] = u
      }
      return e.slice(0, r)
    }

    function Er(n, t) {
      return n[0] - t[0] || n[1] - t[1]
    }

    function Ar(n, t, e) {
      return (e[0] - t[0]) * (n[1] - t[1]) < (e[1] - t[1]) * (n[0] - t[0])
    }

    function Cr(n, t, e, r) {
      var u = n[0],
        i = e[0],
        o = t[0] - u,
        a = r[0] - i,
        c = n[1],
        s = e[1],
        l = t[1] - c,
        f = r[1] - s,
        h = (a * (c - s) - f * (u - i)) / (f * o - a * l);
      return [u + h * o, c + h * l]
    }

    function Nr(n) {
      var t = n[0],
        e = n[n.length - 1];
      return !(t[0] - e[0] || t[1] - e[1])
    }

    function zr() {
      Gr(this), this.edge = this.site = this.circle = null
    }

    function Lr(n) {
      var t = Bc.pop() || new zr;
      return t.site = n, t
    }

    function Tr(n) {
      Yr(n), Vc.remove(n), Bc.push(n), Gr(n)
    }

    function qr(n) {
      var t = n.circle,
        e = t.x,
        r = t.cy,
        u = {
          x: e,
          y: r
        },
        i = n.P,
        o = n.N,
        a = [n];
      Tr(n);
      for (var c = i; c.circle && ua(e - c.circle.x) < ka && ua(r - c.circle.cy) < ka;) i = c.P, a.unshift(c), Tr(c), c = i;
      a.unshift(c), Yr(c);
      for (var s = o; s.circle && ua(e - s.circle.x) < ka && ua(r - s.circle.cy) < ka;) o = s.N, a.push(s), Tr(s), s = o;
      a.push(s), Yr(s);
      var l, f = a.length;
      for (l = 1; f > l; ++l) s = a[l], c = a[l - 1], Br(s.edge, c.site, s.site, u);
      c = a[0], s = a[f - 1], s.edge = Xr(c.site, s.site, null, u), Or(c), Or(s)
    }

    function Rr(n) {
      for (var t, e, r, u, i = n.x, o = n.y, a = Vc._; a;)
        if (r = Dr(a, o) - i, r > ka) a = a.L;
        else {
          if (u = i - Pr(a, o), !(u > ka)) {
            r > -ka ? (t = a.P, e = a) : u > -ka ? (t = a, e = a.N) : t = e = a;
            break
          }
          if (!a.R) {
            t = a;
            break
          }
          a = a.R
        }
      var c = Lr(n);
      if (Vc.insert(t, c), t || e) {
        if (t === e) return Yr(t), e = Lr(t.site), Vc.insert(c, e), c.edge = e.edge = Xr(t.site, c.site), Or(t), Or(e), void 0;
        if (!e) return c.edge = Xr(t.site, c.site), void 0;
        Yr(t), Yr(e);
        var s = t.site,
          l = s.x,
          f = s.y,
          h = n.x - l,
          g = n.y - f,
          p = e.site,
          v = p.x - l,
          d = p.y - f,
          m = 2 * (h * d - g * v),
          y = h * h + g * g,
          x = v * v + d * d,
          M = {
            x: (d * y - g * x) / m + l,
            y: (h * x - v * y) / m + f
          };
        Br(e.edge, s, p, M), c.edge = Xr(s, n, null, M), e.edge = Xr(n, p, null, M), Or(t), Or(e)
      }
    }

    function Dr(n, t) {
      var e = n.site,
        r = e.x,
        u = e.y,
        i = u - t;
      if (!i) return r;
      var o = n.P;
      if (!o) return -1 / 0;
      e = o.site;
      var a = e.x,
        c = e.y,
        s = c - t;
      if (!s) return a;
      var l = a - r,
        f = 1 / i - 1 / s,
        h = l / s;
      return f ? (-h + Math.sqrt(h * h - 2 * f * (l * l / (-2 * s) - c + s / 2 + u - i / 2))) / f + r : (r + a) / 2
    }

    function Pr(n, t) {
      var e = n.N;
      if (e) return Dr(e, t);
      var r = n.site;
      return r.y === t ? r.x : 1 / 0
    }

    function Ur(n) {
      this.site = n, this.edges = []
    }

    function jr(n) {
      for (var t, e, r, u, i, o, a, c, s, l, f = n[0][0], h = n[1][0], g = n[0][1], p = n[1][1], v = Zc, d = v.length; d--;)
        if (i = v[d], i && i.prepare())
          for (a = i.edges, c = a.length, o = 0; c > o;) l = a[o].end(), r = l.x, u = l.y, s = a[++o % c].start(), t = s.x, e = s.y, (ua(r - t) > ka || ua(u - e) > ka) && (a.splice(o, 0, new Wr($r(i.site, l, ua(r - f) < ka && p - u > ka ? {
            x: f,
            y: ua(t - f) < ka ? e : p
          } : ua(u - p) < ka && h - r > ka ? {
            x: ua(e - p) < ka ? t : h,
            y: p
          } : ua(r - h) < ka && u - g > ka ? {
            x: h,
            y: ua(t - h) < ka ? e : g
          } : ua(u - g) < ka && r - f > ka ? {
            x: ua(e - g) < ka ? t : f,
            y: g
          } : null), i.site, null)), ++c)
    }

    function Hr(n, t) {
      return t.angle - n.angle
    }

    function Fr() {
      Gr(this), this.x = this.y = this.arc = this.site = this.cy = null
    }

    function Or(n) {
      var t = n.P,
        e = n.N;
      if (t && e) {
        var r = t.site,
          u = n.site,
          i = e.site;
        if (r !== i) {
          var o = u.x,
            a = u.y,
            c = r.x - o,
            s = r.y - a,
            l = i.x - o,
            f = i.y - a,
            h = 2 * (c * f - s * l);
          if (!(h >= -Ea)) {
            var g = c * c + s * s,
              p = l * l + f * f,
              v = (f * g - s * p) / h,
              d = (c * p - l * g) / h,
              f = d + a,
              m = Wc.pop() || new Fr;
            m.arc = n, m.site = u, m.x = v + o, m.y = f + Math.sqrt(v * v + d * d), m.cy = f, n.circle = m;
            for (var y = null, x = $c._; x;)
              if (m.y < x.y || m.y === x.y && m.x <= x.x) {
                if (!x.L) {
                  y = x.P;
                  break
                }
                x = x.L
              } else {
                if (!x.R) {
                  y = x;
                  break
                }
                x = x.R
              }
            $c.insert(y, m), y || (Xc = m)
          }
        }
      }
    }

    function Yr(n) {
      var t = n.circle;
      t && (t.P || (Xc = t.N), $c.remove(t), Wc.push(t), Gr(t), n.circle = null)
    }

    function Ir(n) {
      for (var t, e = Ic, r = Pe(n[0][0], n[0][1], n[1][0], n[1][1]), u = e.length; u--;) t = e[u], (!Zr(t, n) || !r(t) || ua(t.a.x - t.b.x) < ka && ua(t.a.y - t.b.y) < ka) && (t.a = t.b = null, e.splice(u, 1))
    }

    function Zr(n, t) {
      var e = n.b;
      if (e) return !0;
      var r, u, i = n.a,
        o = t[0][0],
        a = t[1][0],
        c = t[0][1],
        s = t[1][1],
        l = n.l,
        f = n.r,
        h = l.x,
        g = l.y,
        p = f.x,
        v = f.y,
        d = (h + p) / 2,
        m = (g + v) / 2;
      if (v === g) {
        if (o > d || d >= a) return;
        if (h > p) {
          if (i) {
            if (i.y >= s) return
          } else i = {
            x: d,
            y: c
          };
          e = {
            x: d,
            y: s
          }
        } else {
          if (i) {
            if (i.y < c) return
          } else i = {
            x: d,
            y: s
          };
          e = {
            x: d,
            y: c
          }
        }
      } else if (r = (h - p) / (v - g), u = m - r * d, -1 > r || r > 1)
        if (h > p) {
          if (i) {
            if (i.y >= s) return
          } else i = {
            x: (c - u) / r,
            y: c
          };
          e = {
            x: (s - u) / r,
            y: s
          }
        } else {
          if (i) {
            if (i.y < c) return
          } else i = {
            x: (s - u) / r,
            y: s
          };
          e = {
            x: (c - u) / r,
            y: c
          }
        }
      else if (v > g) {
        if (i) {
          if (i.x >= a) return
        } else i = {
          x: o,
          y: r * o + u
        };
        e = {
          x: a,
          y: r * a + u
        }
      } else {
        if (i) {
          if (i.x < o) return
        } else i = {
          x: a,
          y: r * a + u
        };
        e = {
          x: o,
          y: r * o + u
        }
      }
      return n.a = i, n.b = e, !0
    }

    function Vr(n, t) {
      this.l = n, this.r = t, this.a = this.b = null
    }

    function Xr(n, t, e, r) {
      var u = new Vr(n, t);
      return Ic.push(u), e && Br(u, n, t, e), r && Br(u, t, n, r), Zc[n.i].edges.push(new Wr(u, n, t)), Zc[t.i].edges.push(new Wr(u, t, n)), u
    }

    function $r(n, t, e) {
      var r = new Vr(n, null);
      return r.a = t, r.b = e, Ic.push(r), r
    }

    function Br(n, t, e, r) {
      n.a || n.b ? n.l === e ? n.b = r : n.a = r : (n.a = r, n.l = t, n.r = e)
    }

    function Wr(n, t, e) {
      var r = n.a,
        u = n.b;
      this.edge = n, this.site = t, this.angle = e ? Math.atan2(e.y - t.y, e.x - t.x) : n.l === t ? Math.atan2(u.x - r.x, r.y - u.y) : Math.atan2(r.x - u.x, u.y - r.y)
    }

    function Jr() {
      this._ = null
    }

    function Gr(n) {
      n.U = n.C = n.L = n.R = n.P = n.N = null
    }

    function Kr(n, t) {
      var e = t,
        r = t.R,
        u = e.U;
      u ? u.L === e ? u.L = r : u.R = r : n._ = r, r.U = u, e.U = r, e.R = r.L, e.R && (e.R.U = e), r.L = e
    }

    function Qr(n, t) {
      var e = t,
        r = t.L,
        u = e.U;
      u ? u.L === e ? u.L = r : u.R = r : n._ = r, r.U = u, e.U = r, e.L = r.R, e.L && (e.L.U = e), r.R = e
    }

    function nu(n) {
      for (; n.L;) n = n.L;
      return n
    }

    function tu(n, t) {
      var e, r, u, i = n.sort(eu).pop();
      for (Ic = [], Zc = new Array(n.length), Vc = new Jr, $c = new Jr;;)
        if (u = Xc, i && (!u || i.y < u.y || i.y === u.y && i.x < u.x))(i.x !== e || i.y !== r) && (Zc[i.i] = new Ur(i), Rr(i), e = i.x, r = i.y), i = n.pop();
        else {
          if (!u) break;
          qr(u.arc)
        }
      t && (Ir(t), jr(t));
      var o = {
        cells: Zc,
        edges: Ic
      };
      return Vc = $c = Ic = Zc = null, o
    }

    function eu(n, t) {
      return t.y - n.y || t.x - n.x
    }

    function ru(n, t, e) {
      return (n.x - e.x) * (t.y - n.y) - (n.x - t.x) * (e.y - n.y)
    }

    function uu(n) {
      return n.x
    }

    function iu(n) {
      return n.y
    }

    function ou() {
      return {
        leaf: !0,
        nodes: [],
        point: null,
        x: null,
        y: null
      }
    }

    function au(n, t, e, r, u, i) {
      if (!n(t, e, r, u, i)) {
        var o = .5 * (e + u),
          a = .5 * (r + i),
          c = t.nodes;
        c[0] && au(n, c[0], e, r, o, a), c[1] && au(n, c[1], o, r, u, a), c[2] && au(n, c[2], e, a, o, i), c[3] && au(n, c[3], o, a, u, i)
      }
    }

    function cu(n, t) {
      n = Zo.rgb(n), t = Zo.rgb(t);
      var e = n.r,
        r = n.g,
        u = n.b,
        i = t.r - e,
        o = t.g - r,
        a = t.b - u;
      return function(n) {
        return "#" + dt(Math.round(e + i * n)) + dt(Math.round(r + o * n)) + dt(Math.round(u + a * n))
      }
    }

    function su(n, t) {
      var e, r = {},
        u = {};
      for (e in n) e in t ? r[e] = hu(n[e], t[e]) : u[e] = n[e];
      for (e in t) e in n || (u[e] = t[e]);
      return function(n) {
        for (e in r) u[e] = r[e](n);
        return u
      }
    }

    function lu(n, t) {
      return t -= n = +n,
        function(e) {
          return n + t * e
        }
    }

    function fu(n, t) {
      var e, r, u, i = Gc.lastIndex = Kc.lastIndex = 0,
        o = -1,
        a = [],
        c = [];
      for (n += "", t += "";
        (e = Gc.exec(n)) && (r = Kc.exec(t));)(u = r.index) > i && (u = t.substring(i, u), a[o] ? a[o] += u : a[++o] = u), (e = e[0]) === (r = r[0]) ? a[o] ? a[o] += r : a[++o] = r : (a[++o] = null, c.push({
        i: o,
        x: lu(e, r)
      })), i = Kc.lastIndex;
      return i < t.length && (u = t.substring(i), a[o] ? a[o] += u : a[++o] = u), a.length < 2 ? c[0] ? (t = c[0].x, function(n) {
        return t(n) + ""
      }) : function() {
        return t
      } : (t = c.length, function(n) {
        for (var e, r = 0; t > r; ++r) a[(e = c[r]).i] = e.x(n);
        return a.join("")
      })
    }

    function hu(n, t) {
      for (var e, r = Zo.interpolators.length; --r >= 0 && !(e = Zo.interpolators[r](n, t)););
      return e
    }

    function gu(n, t) {
      var e, r = [],
        u = [],
        i = n.length,
        o = t.length,
        a = Math.min(n.length, t.length);
      for (e = 0; a > e; ++e) r.push(hu(n[e], t[e]));
      for (; i > e; ++e) u[e] = n[e];
      for (; o > e; ++e) u[e] = t[e];
      return function(n) {
        for (e = 0; a > e; ++e) u[e] = r[e](n);
        return u
      }
    }

    function pu(n) {
      return function(t) {
        return 0 >= t ? 0 : t >= 1 ? 1 : n(t)
      }
    }

    function vu(n) {
      return function(t) {
        return 1 - n(1 - t)
      }
    }

    function du(n) {
      return function(t) {
        return .5 * (.5 > t ? n(2 * t) : 2 - n(2 - 2 * t))
      }
    }

    function mu(n) {
      return n * n
    }

    function yu(n) {
      return n * n * n
    }

    function xu(n) {
      if (0 >= n) return 0;
      if (n >= 1) return 1;
      var t = n * n,
        e = t * n;
      return 4 * (.5 > n ? e : 3 * (n - t) + e - .75)
    }

    function Mu(n) {
      return function(t) {
        return Math.pow(t, n)
      }
    }

    function _u(n) {
      return 1 - Math.cos(n * Sa)
    }

    function bu(n) {
      return Math.pow(2, 10 * (n - 1))
    }

    function wu(n) {
      return 1 - Math.sqrt(1 - n * n)
    }

    function Su(n, t) {
      var e;
      return arguments.length < 2 && (t = .45), arguments.length ? e = t / wa * Math.asin(1 / n) : (n = 1, e = t / 4),
        function(r) {
          return 1 + n * Math.pow(2, -10 * r) * Math.sin((r - e) * wa / t)
        }
    }

    function ku(n) {
      return n || (n = 1.70158),
        function(t) {
          return t * t * ((n + 1) * t - n)
        }
    }

    function Eu(n) {
      return 1 / 2.75 > n ? 7.5625 * n * n : 2 / 2.75 > n ? 7.5625 * (n -= 1.5 / 2.75) * n + .75 : 2.5 / 2.75 > n ? 7.5625 * (n -= 2.25 / 2.75) * n + .9375 : 7.5625 * (n -= 2.625 / 2.75) * n + .984375
    }

    function Au(n, t) {
      n = Zo.hcl(n), t = Zo.hcl(t);
      var e = n.h,
        r = n.c,
        u = n.l,
        i = t.h - e,
        o = t.c - r,
        a = t.l - u;
      return isNaN(o) && (o = 0, r = isNaN(r) ? t.c : r), isNaN(i) ? (i = 0, e = isNaN(e) ? t.h : e) : i > 180 ? i -= 360 : -180 > i && (i += 360),
        function(n) {
          return ot(e + i * n, r + o * n, u + a * n) + ""
        }
    }

    function Cu(n, t) {
      n = Zo.hsl(n), t = Zo.hsl(t);
      var e = n.h,
        r = n.s,
        u = n.l,
        i = t.h - e,
        o = t.s - r,
        a = t.l - u;
      return isNaN(o) && (o = 0, r = isNaN(r) ? t.s : r), isNaN(i) ? (i = 0, e = isNaN(e) ? t.h : e) : i > 180 ? i -= 360 : -180 > i && (i += 360),
        function(n) {
          return ut(e + i * n, r + o * n, u + a * n) + ""
        }
    }

    function Nu(n, t) {
      n = Zo.lab(n), t = Zo.lab(t);
      var e = n.l,
        r = n.a,
        u = n.b,
        i = t.l - e,
        o = t.a - r,
        a = t.b - u;
      return function(n) {
        return ct(e + i * n, r + o * n, u + a * n) + ""
      }
    }

    function zu(n, t) {
      return t -= n,
        function(e) {
          return Math.round(n + t * e)
        }
    }

    function Lu(n) {
      var t = [n.a, n.b],
        e = [n.c, n.d],
        r = qu(t),
        u = Tu(t, e),
        i = qu(Ru(e, t, -u)) || 0;
      t[0] * e[1] < e[0] * t[1] && (t[0] *= -1, t[1] *= -1, r *= -1, u *= -1), this.rotate = (r ? Math.atan2(t[1], t[0]) : Math.atan2(-e[0], e[1])) * Ca, this.translate = [n.e, n.f], this.scale = [r, i], this.skew = i ? Math.atan2(u, i) * Ca : 0
    }

    function Tu(n, t) {
      return n[0] * t[0] + n[1] * t[1]
    }

    function qu(n) {
      var t = Math.sqrt(Tu(n, n));
      return t && (n[0] /= t, n[1] /= t), t
    }

    function Ru(n, t, e) {
      return n[0] += e * t[0], n[1] += e * t[1], n
    }

    function Du(n, t) {
      var e, r = [],
        u = [],
        i = Zo.transform(n),
        o = Zo.transform(t),
        a = i.translate,
        c = o.translate,
        s = i.rotate,
        l = o.rotate,
        f = i.skew,
        h = o.skew,
        g = i.scale,
        p = o.scale;
      return a[0] != c[0] || a[1] != c[1] ? (r.push("translate(", null, ",", null, ")"), u.push({
          i: 1,
          x: lu(a[0], c[0])
        }, {
          i: 3,
          x: lu(a[1], c[1])
        })) : c[0] || c[1] ? r.push("translate(" + c + ")") : r.push(""), s != l ? (s - l > 180 ? l += 360 : l - s > 180 && (s += 360), u.push({
          i: r.push(r.pop() + "rotate(", null, ")") - 2,
          x: lu(s, l)
        })) : l && r.push(r.pop() + "rotate(" + l + ")"), f != h ? u.push({
          i: r.push(r.pop() + "skewX(", null, ")") - 2,
          x: lu(f, h)
        }) : h && r.push(r.pop() + "skewX(" + h + ")"), g[0] != p[0] || g[1] != p[1] ? (e = r.push(r.pop() + "scale(", null, ",", null, ")"), u.push({
          i: e - 4,
          x: lu(g[0], p[0])
        }, {
          i: e - 2,
          x: lu(g[1], p[1])
        })) : (1 != p[0] || 1 != p[1]) && r.push(r.pop() + "scale(" + p + ")"), e = u.length,
        function(n) {
          for (var t, i = -1; ++i < e;) r[(t = u[i]).i] = t.x(n);
          return r.join("")
        }
    }

    function Pu(n, t) {
      return t = t - (n = +n) ? 1 / (t - n) : 0,
        function(e) {
          return (e - n) * t
        }
    }

    function Uu(n, t) {
      return t = t - (n = +n) ? 1 / (t - n) : 0,
        function(e) {
          return Math.max(0, Math.min(1, (e - n) * t))
        }
    }

    function ju(n) {
      for (var t = n.source, e = n.target, r = Fu(t, e), u = [t]; t !== r;) t = t.parent, u.push(t);
      for (var i = u.length; e !== r;) u.splice(i, 0, e), e = e.parent;
      return u
    }

    function Hu(n) {
      for (var t = [], e = n.parent; null != e;) t.push(n), n = e, e = e.parent;
      return t.push(n), t
    }

    function Fu(n, t) {
      if (n === t) return n;
      for (var e = Hu(n), r = Hu(t), u = e.pop(), i = r.pop(), o = null; u === i;) o = u, u = e.pop(), i = r.pop();
      return o
    }

    function Ou(n) {
      n.fixed |= 2
    }

    function Yu(n) {
      n.fixed &= -7
    }

    function Iu(n) {
      n.fixed |= 4, n.px = n.x, n.py = n.y
    }

    function Zu(n) {
      n.fixed &= -5
    }

    function Vu(n, t, e) {
      var r = 0,
        u = 0;
      if (n.charge = 0, !n.leaf)
        for (var i, o = n.nodes, a = o.length, c = -1; ++c < a;) i = o[c], null != i && (Vu(i, t, e), n.charge += i.charge, r += i.charge * i.cx, u += i.charge * i.cy);
      if (n.point) {
        n.leaf || (n.point.x += Math.random() - .5, n.point.y += Math.random() - .5);
        var s = t * e[n.point.index];
        n.charge += n.pointCharge = s, r += s * n.point.x, u += s * n.point.y
      }
      n.cx = r / n.charge, n.cy = u / n.charge
    }

    function Xu(n, t) {
      return Zo.rebind(n, t, "sort", "children", "value"), n.nodes = n, n.links = Ku, n
    }

    function $u(n, t) {
      for (var e = [n]; null != (n = e.pop());)
        if (t(n), (u = n.children) && (r = u.length))
          for (var r, u; --r >= 0;) e.push(u[r])
    }

    function Bu(n, t) {
      for (var e = [n], r = []; null != (n = e.pop());)
        if (r.push(n), (i = n.children) && (u = i.length))
          for (var u, i, o = -1; ++o < u;) e.push(i[o]);
      for (; null != (n = r.pop());) t(n)
    }

    function Wu(n) {
      return n.children
    }

    function Ju(n) {
      return n.value
    }

    function Gu(n, t) {
      return t.value - n.value
    }

    function Ku(n) {
      return Zo.merge(n.map(function(n) {
        return (n.children || []).map(function(t) {
          return {
            source: n,
            target: t
          }
        })
      }))
    }

    function Qu(n) {
      return n.x
    }

    function ni(n) {
      return n.y
    }

    function ti(n, t, e) {
      n.y0 = t, n.y = e
    }

    function ei(n) {
      return Zo.range(n.length)
    }

    function ri(n) {
      for (var t = -1, e = n[0].length, r = []; ++t < e;) r[t] = 0;
      return r
    }

    function ui(n) {
      for (var t, e = 1, r = 0, u = n[0][1], i = n.length; i > e; ++e)(t = n[e][1]) > u && (r = e, u = t);
      return r
    }

    function ii(n) {
      return n.reduce(oi, 0)
    }

    function oi(n, t) {
      return n + t[1]
    }

    function ai(n, t) {
      return ci(n, Math.ceil(Math.log(t.length) / Math.LN2 + 1))
    }

    function ci(n, t) {
      for (var e = -1, r = +n[0], u = (n[1] - r) / t, i = []; ++e <= t;) i[e] = u * e + r;
      return i
    }

    function si(n) {
      return [Zo.min(n), Zo.max(n)]
    }

    function li(n, t) {
      return n.value - t.value
    }

    function fi(n, t) {
      var e = n._pack_next;
      n._pack_next = t, t._pack_prev = n, t._pack_next = e, e._pack_prev = t
    }

    function hi(n, t) {
      n._pack_next = t, t._pack_prev = n
    }

    function gi(n, t) {
      var e = t.x - n.x,
        r = t.y - n.y,
        u = n.r + t.r;
      return .999 * u * u > e * e + r * r
    }

    function pi(n) {
      function t(n) {
        l = Math.min(n.x - n.r, l), f = Math.max(n.x + n.r, f), h = Math.min(n.y - n.r, h), g = Math.max(n.y + n.r, g)
      }
      if ((e = n.children) && (s = e.length)) {
        var e, r, u, i, o, a, c, s, l = 1 / 0,
          f = -1 / 0,
          h = 1 / 0,
          g = -1 / 0;
        if (e.forEach(vi), r = e[0], r.x = -r.r, r.y = 0, t(r), s > 1 && (u = e[1], u.x = u.r, u.y = 0, t(u), s > 2))
          for (i = e[2], yi(r, u, i), t(i), fi(r, i), r._pack_prev = i, fi(i, u), u = r._pack_next, o = 3; s > o; o++) {
            yi(r, u, i = e[o]);
            var p = 0,
              v = 1,
              d = 1;
            for (a = u._pack_next; a !== u; a = a._pack_next, v++)
              if (gi(a, i)) {
                p = 1;
                break
              }
            if (1 == p)
              for (c = r._pack_prev; c !== a._pack_prev && !gi(c, i); c = c._pack_prev, d++);
            p ? (d > v || v == d && u.r < r.r ? hi(r, u = a) : hi(r = c, u), o--) : (fi(r, i), u = i, t(i))
          }
        var m = (l + f) / 2,
          y = (h + g) / 2,
          x = 0;
        for (o = 0; s > o; o++) i = e[o], i.x -= m, i.y -= y, x = Math.max(x, i.r + Math.sqrt(i.x * i.x + i.y * i.y));
        n.r = x, e.forEach(di)
      }
    }

    function vi(n) {
      n._pack_next = n._pack_prev = n
    }

    function di(n) {
      delete n._pack_next, delete n._pack_prev
    }

    function mi(n, t, e, r) {
      var u = n.children;
      if (n.x = t += r * n.x, n.y = e += r * n.y, n.r *= r, u)
        for (var i = -1, o = u.length; ++i < o;) mi(u[i], t, e, r)
    }

    function yi(n, t, e) {
      var r = n.r + e.r,
        u = t.x - n.x,
        i = t.y - n.y;
      if (r && (u || i)) {
        var o = t.r + e.r,
          a = u * u + i * i;
        o *= o, r *= r;
        var c = .5 + (r - o) / (2 * a),
          s = Math.sqrt(Math.max(0, 2 * o * (r + a) - (r -= a) * r - o * o)) / (2 * a);
        e.x = n.x + c * u + s * i, e.y = n.y + c * i - s * u
      } else e.x = n.x + r, e.y = n.y
    }

    function xi(n, t) {
      return n.parent == t.parent ? 1 : 2
    }

    function Mi(n) {
      var t = n.children;
      return t.length ? t[0] : n.t
    }

    function _i(n) {
      var t, e = n.children;
      return (t = e.length) ? e[t - 1] : n.t
    }

    function bi(n, t, e) {
      var r = e / (t.i - n.i);
      t.c -= r, t.s += e, n.c += r, t.z += e, t.m += e
    }

    function wi(n) {
      for (var t, e = 0, r = 0, u = n.children, i = u.length; --i >= 0;) t = u[i], t.z += e, t.m += e, e += t.s + (r += t.c)
    }

    function Si(n, t, e) {
      return n.a.parent === t.parent ? n.a : e
    }

    function ki(n) {
      return 1 + Zo.max(n, function(n) {
        return n.y
      })
    }

    function Ei(n) {
      return n.reduce(function(n, t) {
        return n + t.x
      }, 0) / n.length
    }

    function Ai(n) {
      var t = n.children;
      return t && t.length ? Ai(t[0]) : n
    }

    function Ci(n) {
      var t, e = n.children;
      return e && (t = e.length) ? Ci(e[t - 1]) : n
    }

    function Ni(n) {
      return {
        x: n.x,
        y: n.y,
        dx: n.dx,
        dy: n.dy
      }
    }

    function zi(n, t) {
      var e = n.x + t[3],
        r = n.y + t[0],
        u = n.dx - t[1] - t[3],
        i = n.dy - t[0] - t[2];
      return 0 > u && (e += u / 2, u = 0), 0 > i && (r += i / 2, i = 0), {
        x: e,
        y: r,
        dx: u,
        dy: i
      }
    }

    function Li(n) {
      var t = n[0],
        e = n[n.length - 1];
      return e > t ? [t, e] : [e, t]
    }

    function Ti(n) {
      return n.rangeExtent ? n.rangeExtent() : Li(n.range())
    }

    function qi(n, t, e, r) {
      var u = e(n[0], n[1]),
        i = r(t[0], t[1]);
      return function(n) {
        return i(u(n))
      }
    }

    function Ri(n, t) {
      var e, r = 0,
        u = n.length - 1,
        i = n[r],
        o = n[u];
      return i > o && (e = r, r = u, u = e, e = i, i = o, o = e), n[r] = t.floor(i), n[u] = t.ceil(o), n
    }

    function Di(n) {
      return n ? {
        floor: function(t) {
          return Math.floor(t / n) * n
        },
        ceil: function(t) {
          return Math.ceil(t / n) * n
        }
      } : ss
    }

    function Pi(n, t, e, r) {
      var u = [],
        i = [],
        o = 0,
        a = Math.min(n.length, t.length) - 1;
      for (n[a] < n[0] && (n = n.slice().reverse(), t = t.slice().reverse()); ++o <= a;) u.push(e(n[o - 1], n[o])), i.push(r(t[o - 1], t[o]));
      return function(t) {
        var e = Zo.bisect(n, t, 1, a) - 1;
        return i[e](u[e](t))
      }
    }

    function Ui(n, t, e, r) {
      function u() {
        var u = Math.min(n.length, t.length) > 2 ? Pi : qi,
          c = r ? Uu : Pu;
        return o = u(n, t, c, e), a = u(t, n, c, hu), i
      }

      function i(n) {
        return o(n)
      }
      var o, a;
      return i.invert = function(n) {
        return a(n)
      }, i.domain = function(t) {
        return arguments.length ? (n = t.map(Number), u()) : n
      }, i.range = function(n) {
        return arguments.length ? (t = n, u()) : t
      }, i.rangeRound = function(n) {
        return i.range(n).interpolate(zu)
      }, i.clamp = function(n) {
        return arguments.length ? (r = n, u()) : r
      }, i.interpolate = function(n) {
        return arguments.length ? (e = n, u()) : e
      }, i.ticks = function(t) {
        return Oi(n, t)
      }, i.tickFormat = function(t, e) {
        return Yi(n, t, e)
      }, i.nice = function(t) {
        return Hi(n, t), u()
      }, i.copy = function() {
        return Ui(n, t, e, r)
      }, u()
    }

    function ji(n, t) {
      return Zo.rebind(n, t, "range", "rangeRound", "interpolate", "clamp")
    }

    function Hi(n, t) {
      return Ri(n, Di(Fi(n, t)[2]))
    }

    function Fi(n, t) {
      null == t && (t = 10);
      var e = Li(n),
        r = e[1] - e[0],
        u = Math.pow(10, Math.floor(Math.log(r / t) / Math.LN10)),
        i = t / r * u;
      return .15 >= i ? u *= 10 : .35 >= i ? u *= 5 : .75 >= i && (u *= 2), e[0] = Math.ceil(e[0] / u) * u, e[1] = Math.floor(e[1] / u) * u + .5 * u, e[2] = u, e
    }

    function Oi(n, t) {
      return Zo.range.apply(Zo, Fi(n, t))
    }

    function Yi(n, t, e) {
      var r = Fi(n, t);
      if (e) {
        var u = Ga.exec(e);
        if (u.shift(), "s" === u[8]) {
          var i = Zo.formatPrefix(Math.max(ua(r[0]), ua(r[1])));
          return u[7] || (u[7] = "." + Ii(i.scale(r[2]))), u[8] = "f", e = Zo.format(u.join("")),
            function(n) {
              return e(i.scale(n)) + i.symbol
            }
        }
        u[7] || (u[7] = "." + Zi(u[8], r)), e = u.join("")
      } else e = ",." + Ii(r[2]) + "f";
      return Zo.format(e)
    }

    function Ii(n) {
      return -Math.floor(Math.log(n) / Math.LN10 + .01)
    }

    function Zi(n, t) {
      var e = Ii(t[2]);
      return n in ls ? Math.abs(e - Ii(Math.max(ua(t[0]), ua(t[1])))) + +("e" !== n) : e - 2 * ("%" === n)
    }

    function Vi(n, t, e, r) {
      function u(n) {
        return (e ? Math.log(0 > n ? 0 : n) : -Math.log(n > 0 ? 0 : -n)) / Math.log(t)
      }

      function i(n) {
        return e ? Math.pow(t, n) : -Math.pow(t, -n)
      }

      function o(t) {
        return n(u(t))
      }
      return o.invert = function(t) {
        return i(n.invert(t))
      }, o.domain = function(t) {
        return arguments.length ? (e = t[0] >= 0, n.domain((r = t.map(Number)).map(u)), o) : r
      }, o.base = function(e) {
        return arguments.length ? (t = +e, n.domain(r.map(u)), o) : t
      }, o.nice = function() {
        var t = Ri(r.map(u), e ? Math : hs);
        return n.domain(t), r = t.map(i), o
      }, o.ticks = function() {
        var n = Li(r),
          o = [],
          a = n[0],
          c = n[1],
          s = Math.floor(u(a)),
          l = Math.ceil(u(c)),
          f = t % 1 ? 2 : t;
        if (isFinite(l - s)) {
          if (e) {
            for (; l > s; s++)
              for (var h = 1; f > h; h++) o.push(i(s) * h);
            o.push(i(s))
          } else
            for (o.push(i(s)); s++ < l;)
              for (var h = f - 1; h > 0; h--) o.push(i(s) * h);
          for (s = 0; o[s] < a; s++);
          for (l = o.length; o[l - 1] > c; l--);
          o = o.slice(s, l)
        }
        return o
      }, o.tickFormat = function(n, t) {
        if (!arguments.length) return fs;
        arguments.length < 2 ? t = fs : "function" != typeof t && (t = Zo.format(t));
        var r, a = Math.max(.1, n / o.ticks().length),
          c = e ? (r = 1e-12, Math.ceil) : (r = -1e-12, Math.floor);
        return function(n) {
          return n / i(c(u(n) + r)) <= a ? t(n) : ""
        }
      }, o.copy = function() {
        return Vi(n.copy(), t, e, r)
      }, ji(o, n)
    }

    function Xi(n, t, e) {
      function r(t) {
        return n(u(t))
      }
      var u = $i(t),
        i = $i(1 / t);
      return r.invert = function(t) {
        return i(n.invert(t))
      }, r.domain = function(t) {
        return arguments.length ? (n.domain((e = t.map(Number)).map(u)), r) : e
      }, r.ticks = function(n) {
        return Oi(e, n)
      }, r.tickFormat = function(n, t) {
        return Yi(e, n, t)
      }, r.nice = function(n) {
        return r.domain(Hi(e, n))
      }, r.exponent = function(o) {
        return arguments.length ? (u = $i(t = o), i = $i(1 / t), n.domain(e.map(u)), r) : t
      }, r.copy = function() {
        return Xi(n.copy(), t, e)
      }, ji(r, n)
    }

    function $i(n) {
      return function(t) {
        return 0 > t ? -Math.pow(-t, n) : Math.pow(t, n)
      }
    }

    function Bi(n, t) {
      function e(e) {
        return i[((u.get(e) || ("range" === t.t ? u.set(e, n.push(e)) : 0 / 0)) - 1) % i.length]
      }

      function r(t, e) {
        return Zo.range(n.length).map(function(n) {
          return t + e * n
        })
      }
      var u, i, a;
      return e.domain = function(r) {
        if (!arguments.length) return n;
        n = [], u = new o;
        for (var i, a = -1, c = r.length; ++a < c;) u.has(i = r[a]) || u.set(i, n.push(i));
        return e[t.t].apply(e, t.a)
      }, e.range = function(n) {
        return arguments.length ? (i = n, a = 0, t = {
          t: "range",
          a: arguments
        }, e) : i
      }, e.rangePoints = function(u, o) {
        arguments.length < 2 && (o = 0);
        var c = u[0],
          s = u[1],
          l = (s - c) / (Math.max(1, n.length - 1) + o);
        return i = r(n.length < 2 ? (c + s) / 2 : c + l * o / 2, l), a = 0, t = {
          t: "rangePoints",
          a: arguments
        }, e
      }, e.rangeBands = function(u, o, c) {
        arguments.length < 2 && (o = 0), arguments.length < 3 && (c = o);
        var s = u[1] < u[0],
          l = u[s - 0],
          f = u[1 - s],
          h = (f - l) / (n.length - o + 2 * c);
        return i = r(l + h * c, h), s && i.reverse(), a = h * (1 - o), t = {
          t: "rangeBands",
          a: arguments
        }, e
      }, e.rangeRoundBands = function(u, o, c) {
        arguments.length < 2 && (o = 0), arguments.length < 3 && (c = o);
        var s = u[1] < u[0],
          l = u[s - 0],
          f = u[1 - s],
          h = Math.floor((f - l) / (n.length - o + 2 * c)),
          g = f - l - (n.length - o) * h;
        return i = r(l + Math.round(g / 2), h), s && i.reverse(), a = Math.round(h * (1 - o)), t = {
          t: "rangeRoundBands",
          a: arguments
        }, e
      }, e.rangeBand = function() {
        return a
      }, e.rangeExtent = function() {
        return Li(t.a[0])
      }, e.copy = function() {
        return Bi(n, t)
      }, e.domain(n)
    }

    function Wi(e, r) {
      function u() {
        var n = 0,
          t = r.length;
        for (o = []; ++n < t;) o[n - 1] = Zo.quantile(e, n / t);
        return i
      }

      function i(n) {
        return isNaN(n = +n) ? void 0 : r[Zo.bisect(o, n)]
      }
      var o;
      return i.domain = function(r) {
        return arguments.length ? (e = r.filter(t).sort(n), u()) : e
      }, i.range = function(n) {
        return arguments.length ? (r = n, u()) : r
      }, i.quantiles = function() {
        return o
      }, i.invertExtent = function(n) {
        return n = r.indexOf(n), 0 > n ? [0 / 0, 0 / 0] : [n > 0 ? o[n - 1] : e[0], n < o.length ? o[n] : e[e.length - 1]]
      }, i.copy = function() {
        return Wi(e, r)
      }, u()
    }

    function Ji(n, t, e) {
      function r(t) {
        return e[Math.max(0, Math.min(o, Math.floor(i * (t - n))))]
      }

      function u() {
        return i = e.length / (t - n), o = e.length - 1, r
      }
      var i, o;
      return r.domain = function(e) {
        return arguments.length ? (n = +e[0], t = +e[e.length - 1], u()) : [n, t]
      }, r.range = function(n) {
        return arguments.length ? (e = n, u()) : e
      }, r.invertExtent = function(t) {
        return t = e.indexOf(t), t = 0 > t ? 0 / 0 : t / i + n, [t, t + 1 / i]
      }, r.copy = function() {
        return Ji(n, t, e)
      }, u()
    }

    function Gi(n, t) {
      function e(e) {
        return e >= e ? t[Zo.bisect(n, e)] : void 0
      }
      return e.domain = function(t) {
        return arguments.length ? (n = t, e) : n
      }, e.range = function(n) {
        return arguments.length ? (t = n, e) : t
      }, e.invertExtent = function(e) {
        return e = t.indexOf(e), [n[e - 1], n[e]]
      }, e.copy = function() {
        return Gi(n, t)
      }, e
    }

    function Ki(n) {
      function t(n) {
        return +n
      }
      return t.invert = t, t.domain = t.range = function(e) {
        return arguments.length ? (n = e.map(t), t) : n
      }, t.ticks = function(t) {
        return Oi(n, t)
      }, t.tickFormat = function(t, e) {
        return Yi(n, t, e)
      }, t.copy = function() {
        return Ki(n)
      }, t
    }

    function Qi(n) {
      return n.innerRadius
    }

    function no(n) {
      return n.outerRadius
    }

    function to(n) {
      return n.startAngle
    }

    function eo(n) {
      return n.endAngle
    }

    function ro(n) {
      function t(t) {
        function o() {
          s.push("M", i(n(l), a))
        }
        for (var c, s = [], l = [], f = -1, h = t.length, g = bt(e), p = bt(r); ++f < h;) u.call(this, c = t[f], f) ? l.push([+g.call(this, c, f), +p.call(this, c, f)]) : l.length && (o(), l = []);
        return l.length && o(), s.length ? s.join("") : null
      }
      var e = wr,
        r = Sr,
        u = we,
        i = uo,
        o = i.key,
        a = .7;
      return t.x = function(n) {
        return arguments.length ? (e = n, t) : e
      }, t.y = function(n) {
        return arguments.length ? (r = n, t) : r
      }, t.defined = function(n) {
        return arguments.length ? (u = n, t) : u
      }, t.interpolate = function(n) {
        return arguments.length ? (o = "function" == typeof n ? i = n : (i = xs.get(n) || uo).key, t) : o
      }, t.tension = function(n) {
        return arguments.length ? (a = n, t) : a
      }, t
    }

    function uo(n) {
      return n.join("L")
    }

    function io(n) {
      return uo(n) + "Z"
    }

    function oo(n) {
      for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("H", (r[0] + (r = n[t])[0]) / 2, "V", r[1]);
      return e > 1 && u.push("H", r[0]), u.join("")
    }

    function ao(n) {
      for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("V", (r = n[t])[1], "H", r[0]);
      return u.join("")
    }

    function co(n) {
      for (var t = 0, e = n.length, r = n[0], u = [r[0], ",", r[1]]; ++t < e;) u.push("H", (r = n[t])[0], "V", r[1]);
      return u.join("")
    }

    function so(n, t) {
      return n.length < 4 ? uo(n) : n[1] + ho(n.slice(1, n.length - 1), go(n, t))
    }

    function lo(n, t) {
      return n.length < 3 ? uo(n) : n[0] + ho((n.push(n[0]), n), go([n[n.length - 2]].concat(n, [n[1]]), t))
    }

    function fo(n, t) {
      return n.length < 3 ? uo(n) : n[0] + ho(n, go(n, t))
    }

    function ho(n, t) {
      if (t.length < 1 || n.length != t.length && n.length != t.length + 2) return uo(n);
      var e = n.length != t.length,
        r = "",
        u = n[0],
        i = n[1],
        o = t[0],
        a = o,
        c = 1;
      if (e && (r += "Q" + (i[0] - 2 * o[0] / 3) + "," + (i[1] - 2 * o[1] / 3) + "," + i[0] + "," + i[1], u = n[1], c = 2), t.length > 1) {
        a = t[1], i = n[c], c++, r += "C" + (u[0] + o[0]) + "," + (u[1] + o[1]) + "," + (i[0] - a[0]) + "," + (i[1] - a[1]) + "," + i[0] + "," + i[1];
        for (var s = 2; s < t.length; s++, c++) i = n[c], a = t[s], r += "S" + (i[0] - a[0]) + "," + (i[1] - a[1]) + "," + i[0] + "," + i[1]
      }
      if (e) {
        var l = n[c];
        r += "Q" + (i[0] + 2 * a[0] / 3) + "," + (i[1] + 2 * a[1] / 3) + "," + l[0] + "," + l[1]
      }
      return r
    }

    function go(n, t) {
      for (var e, r = [], u = (1 - t) / 2, i = n[0], o = n[1], a = 1, c = n.length; ++a < c;) e = i, i = o, o = n[a], r.push([u * (o[0] - e[0]), u * (o[1] - e[1])]);
      return r
    }

    function po(n) {
      if (n.length < 3) return uo(n);
      var t = 1,
        e = n.length,
        r = n[0],
        u = r[0],
        i = r[1],
        o = [u, u, u, (r = n[1])[0]],
        a = [i, i, i, r[1]],
        c = [u, ",", i, "L", xo(bs, o), ",", xo(bs, a)];
      for (n.push(n[e - 1]); ++t <= e;) r = n[t], o.shift(), o.push(r[0]), a.shift(), a.push(r[1]), Mo(c, o, a);
      return n.pop(), c.push("L", r), c.join("")
    }

    function vo(n) {
      if (n.length < 4) return uo(n);
      for (var t, e = [], r = -1, u = n.length, i = [0], o = [0]; ++r < 3;) t = n[r], i.push(t[0]), o.push(t[1]);
      for (e.push(xo(bs, i) + "," + xo(bs, o)), --r; ++r < u;) t = n[r], i.shift(), i.push(t[0]), o.shift(), o.push(t[1]), Mo(e, i, o);
      return e.join("")
    }

    function mo(n) {
      for (var t, e, r = -1, u = n.length, i = u + 4, o = [], a = []; ++r < 4;) e = n[r % u], o.push(e[0]), a.push(e[1]);
      for (t = [xo(bs, o), ",", xo(bs, a)], --r; ++r < i;) e = n[r % u], o.shift(), o.push(e[0]), a.shift(), a.push(e[1]), Mo(t, o, a);
      return t.join("")
    }

    function yo(n, t) {
      var e = n.length - 1;
      if (e)
        for (var r, u, i = n[0][0], o = n[0][1], a = n[e][0] - i, c = n[e][1] - o, s = -1; ++s <= e;) r = n[s], u = s / e, r[0] = t * r[0] + (1 - t) * (i + u * a), r[1] = t * r[1] + (1 - t) * (o + u * c);
      return po(n)
    }

    function xo(n, t) {
      return n[0] * t[0] + n[1] * t[1] + n[2] * t[2] + n[3] * t[3]
    }

    function Mo(n, t, e) {
      n.push("C", xo(Ms, t), ",", xo(Ms, e), ",", xo(_s, t), ",", xo(_s, e), ",", xo(bs, t), ",", xo(bs, e))
    }

    function _o(n, t) {
      return (t[1] - n[1]) / (t[0] - n[0])
    }

    function bo(n) {
      for (var t = 0, e = n.length - 1, r = [], u = n[0], i = n[1], o = r[0] = _o(u, i); ++t < e;) r[t] = (o + (o = _o(u = i, i = n[t + 1]))) / 2;
      return r[t] = o, r
    }

    function wo(n) {
      for (var t, e, r, u, i = [], o = bo(n), a = -1, c = n.length - 1; ++a < c;) t = _o(n[a], n[a + 1]), ua(t) < ka ? o[a] = o[a + 1] = 0 : (e = o[a] / t, r = o[a + 1] / t, u = e * e + r * r, u > 9 && (u = 3 * t / Math.sqrt(u), o[a] = u * e, o[a + 1] = u * r));
      for (a = -1; ++a <= c;) u = (n[Math.min(c, a + 1)][0] - n[Math.max(0, a - 1)][0]) / (6 * (1 + o[a] * o[a])), i.push([u || 0, o[a] * u || 0]);
      return i
    }

    function So(n) {
      return n.length < 3 ? uo(n) : n[0] + ho(n, wo(n))
    }

    function ko(n) {
      for (var t, e, r, u = -1, i = n.length; ++u < i;) t = n[u], e = t[0], r = t[1] + ms, t[0] = e * Math.cos(r), t[1] = e * Math.sin(r);
      return n
    }

    function Eo(n) {
      function t(t) {
        function c() {
          v.push("M", a(n(m), f), l, s(n(d.reverse()), f), "Z")
        }
        for (var h, g, p, v = [], d = [], m = [], y = -1, x = t.length, M = bt(e), _ = bt(u), b = e === r ? function() {
            return g
          } : bt(r), w = u === i ? function() {
            return p
          } : bt(i); ++y < x;) o.call(this, h = t[y], y) ? (d.push([g = +M.call(this, h, y), p = +_.call(this, h, y)]), m.push([+b.call(this, h, y), +w.call(this, h, y)])) : d.length && (c(), d = [], m = []);
        return d.length && c(), v.length ? v.join("") : null
      }
      var e = wr,
        r = wr,
        u = 0,
        i = Sr,
        o = we,
        a = uo,
        c = a.key,
        s = a,
        l = "L",
        f = .7;
      return t.x = function(n) {
        return arguments.length ? (e = r = n, t) : r
      }, t.x0 = function(n) {
        return arguments.length ? (e = n, t) : e
      }, t.x1 = function(n) {
        return arguments.length ? (r = n, t) : r
      }, t.y = function(n) {
        return arguments.length ? (u = i = n, t) : i
      }, t.y0 = function(n) {
        return arguments.length ? (u = n, t) : u
      }, t.y1 = function(n) {
        return arguments.length ? (i = n, t) : i
      }, t.defined = function(n) {
        return arguments.length ? (o = n, t) : o
      }, t.interpolate = function(n) {
        return arguments.length ? (c = "function" == typeof n ? a = n : (a = xs.get(n) || uo).key, s = a.reverse || a, l = a.closed ? "M" : "L", t) : c
      }, t.tension = function(n) {
        return arguments.length ? (f = n, t) : f
      }, t
    }

    function Ao(n) {
      return n.radius
    }

    function Co(n) {
      return [n.x, n.y]
    }

    function No(n) {
      return function() {
        var t = n.apply(this, arguments),
          e = t[0],
          r = t[1] + ms;
        return [e * Math.cos(r), e * Math.sin(r)]
      }
    }

    function zo() {
      return 64
    }

    function Lo() {
      return "circle"
    }

    function To(n) {
      var t = Math.sqrt(n / ba);
      return "M0," + t + "A" + t + "," + t + " 0 1,1 0," + -t + "A" + t + "," + t + " 0 1,1 0," + t + "Z"
    }

    function qo(n, t) {
      return sa(n, Cs), n.id = t, n
    }

    function Ro(n, t, e, r) {
      var u = n.id;
      return P(n, "function" == typeof e ? function(n, i, o) {
        n.__transition__[u].tween.set(t, r(e.call(n, n.__data__, i, o)))
      } : (e = r(e), function(n) {
        n.__transition__[u].tween.set(t, e)
      }))
    }

    function Do(n) {
      return null == n && (n = ""),
        function() {
          this.textContent = n
        }
    }

    function Po(n, t, e, r) {
      var u = n.__transition__ || (n.__transition__ = {
          active: 0,
          count: 0
        }),
        i = u[e];
      if (!i) {
        var a = r.time;
        i = u[e] = {
          tween: new o,
          time: a,
          ease: r.ease,
          delay: r.delay,
          duration: r.duration
        }, ++u.count, Zo.timer(function(r) {
          function o(r) {
            return u.active > e ? s() : (u.active = e, i.event && i.event.start.call(n, l, t), i.tween.forEach(function(e, r) {
              (r = r.call(n, l, t)) && v.push(r)
            }), Zo.timer(function() {
              return p.c = c(r || 1) ? we : c, 1
            }, 0, a), void 0)
          }

          function c(r) {
            if (u.active !== e) return s();
            for (var o = r / g, a = f(o), c = v.length; c > 0;) v[--c].call(n, a);
            return o >= 1 ? (i.event && i.event.end.call(n, l, t), s()) : void 0
          }

          function s() {
            return --u.count ? delete u[e] : delete n.__transition__, 1
          }
          var l = n.__data__,
            f = i.ease,
            h = i.delay,
            g = i.duration,
            p = Ba,
            v = [];
          return p.t = h + a, r >= h ? o(r - h) : (p.c = o, void 0)
        }, 0, a)
      }
    }

    function Uo(n, t) {
      n.attr("transform", function(n) {
        return "translate(" + t(n) + ",0)"
      })
    }

    function jo(n, t) {
      n.attr("transform", function(n) {
        return "translate(0," + t(n) + ")"
      })
    }

    function Ho(n) {
      return n.toISOString()
    }

    function Fo(n, t, e) {
      function r(t) {
        return n(t)
      }

      function u(n, e) {
        var r = n[1] - n[0],
          u = r / e,
          i = Zo.bisect(Us, u);
        return i == Us.length ? [t.year, Fi(n.map(function(n) {
          return n / 31536e6
        }), e)[2]] : i ? t[u / Us[i - 1] < Us[i] / u ? i - 1 : i] : [Fs, Fi(n, e)[2]]
      }
      return r.invert = function(t) {
        return Oo(n.invert(t))
      }, r.domain = function(t) {
        return arguments.length ? (n.domain(t), r) : n.domain().map(Oo)
      }, r.nice = function(n, t) {
        function e(e) {
          return !isNaN(e) && !n.range(e, Oo(+e + 1), t).length
        }
        var i = r.domain(),
          o = Li(i),
          a = null == n ? u(o, 10) : "number" == typeof n && u(o, n);
        return a && (n = a[0], t = a[1]), r.domain(Ri(i, t > 1 ? {
          floor: function(t) {
            for (; e(t = n.floor(t));) t = Oo(t - 1);
            return t
          },
          ceil: function(t) {
            for (; e(t = n.ceil(t));) t = Oo(+t + 1);
            return t
          }
        } : n))
      }, r.ticks = function(n, t) {
        var e = Li(r.domain()),
          i = null == n ? u(e, 10) : "number" == typeof n ? u(e, n) : !n.range && [{
            range: n
          }, t];
        return i && (n = i[0], t = i[1]), n.range(e[0], Oo(+e[1] + 1), 1 > t ? 1 : t)
      }, r.tickFormat = function() {
        return e
      }, r.copy = function() {
        return Fo(n.copy(), t, e)
      }, ji(r, n)
    }

    function Oo(n) {
      return new Date(n)
    }

    function Yo(n) {
      return JSON.parse(n.responseText)
    }

    function Io(n) {
      var t = $o.createRange();
      return t.selectNode($o.body), t.createContextualFragment(n.responseText)
    }
    var Zo = {
      version: "3.4.11"
    };
    Date.now || (Date.now = function() {
      return +new Date
    });
    var Vo = [].slice,
      Xo = function(n) {
        return Vo.call(n)
      },
      $o = document,
      Bo = $o.documentElement,
      Wo = window;
    try {
      Xo(Bo.childNodes)[0].nodeType
    } catch (Jo) {
      Xo = function(n) {
        for (var t = n.length, e = new Array(t); t--;) e[t] = n[t];
        return e
      }
    }
    try {
      $o.createElement("div").style.setProperty("opacity", 0, "")
    } catch (Go) {
      var Ko = Wo.Element.prototype,
        Qo = Ko.setAttribute,
        na = Ko.setAttributeNS,
        ta = Wo.CSSStyleDeclaration.prototype,
        ea = ta.setProperty;
      Ko.setAttribute = function(n, t) {
        Qo.call(this, n, t + "")
      }, Ko.setAttributeNS = function(n, t, e) {
        na.call(this, n, t, e + "")
      }, ta.setProperty = function(n, t, e) {
        ea.call(this, n, t + "", e)
      }
    }
    Zo.ascending = n, Zo.descending = function(n, t) {
      return n > t ? -1 : t > n ? 1 : t >= n ? 0 : 0 / 0
    }, Zo.min = function(n, t) {
      var e, r, u = -1,
        i = n.length;
      if (1 === arguments.length) {
        for (; ++u < i && !(null != (e = n[u]) && e >= e);) e = void 0;
        for (; ++u < i;) null != (r = n[u]) && e > r && (e = r)
      } else {
        for (; ++u < i && !(null != (e = t.call(n, n[u], u)) && e >= e);) e = void 0;
        for (; ++u < i;) null != (r = t.call(n, n[u], u)) && e > r && (e = r)
      }
      return e
    }, Zo.max = function(n, t) {
      var e, r, u = -1,
        i = n.length;
      if (1 === arguments.length) {
        for (; ++u < i && !(null != (e = n[u]) && e >= e);) e = void 0;
        for (; ++u < i;) null != (r = n[u]) && r > e && (e = r)
      } else {
        for (; ++u < i && !(null != (e = t.call(n, n[u], u)) && e >= e);) e = void 0;
        for (; ++u < i;) null != (r = t.call(n, n[u], u)) && r > e && (e = r)
      }
      return e
    }, Zo.extent = function(n, t) {
      var e, r, u, i = -1,
        o = n.length;
      if (1 === arguments.length) {
        for (; ++i < o && !(null != (e = u = n[i]) && e >= e);) e = u = void 0;
        for (; ++i < o;) null != (r = n[i]) && (e > r && (e = r), r > u && (u = r))
      } else {
        for (; ++i < o && !(null != (e = u = t.call(n, n[i], i)) && e >= e);) e = void 0;
        for (; ++i < o;) null != (r = t.call(n, n[i], i)) && (e > r && (e = r), r > u && (u = r))
      }
      return [e, u]
    }, Zo.sum = function(n, t) {
      var e, r = 0,
        u = n.length,
        i = -1;
      if (1 === arguments.length)
        for (; ++i < u;) isNaN(e = +n[i]) || (r += e);
      else
        for (; ++i < u;) isNaN(e = +t.call(n, n[i], i)) || (r += e);
      return r
    }, Zo.mean = function(n, e) {
      var r, u = 0,
        i = n.length,
        o = -1,
        a = i;
      if (1 === arguments.length)
        for (; ++o < i;) t(r = n[o]) ? u += r : --a;
      else
        for (; ++o < i;) t(r = e.call(n, n[o], o)) ? u += r : --a;
      return a ? u / a : void 0
    }, Zo.quantile = function(n, t) {
      var e = (n.length - 1) * t + 1,
        r = Math.floor(e),
        u = +n[r - 1],
        i = e - r;
      return i ? u + i * (n[r] - u) : u
    }, Zo.median = function(e, r) {
      return arguments.length > 1 && (e = e.map(r)), e = e.filter(t), e.length ? Zo.quantile(e.sort(n), .5) : void 0
    };
    var ra = e(n);
    Zo.bisectLeft = ra.left, Zo.bisect = Zo.bisectRight = ra.right, Zo.bisector = function(t) {
      return e(1 === t.length ? function(e, r) {
        return n(t(e), r)
      } : t)
    }, Zo.shuffle = function(n) {
      for (var t, e, r = n.length; r;) e = 0 | Math.random() * r--, t = n[r], n[r] = n[e], n[e] = t;
      return n
    }, Zo.permute = function(n, t) {
      for (var e = t.length, r = new Array(e); e--;) r[e] = n[t[e]];
      return r
    }, Zo.pairs = function(n) {
      for (var t, e = 0, r = n.length - 1, u = n[0], i = new Array(0 > r ? 0 : r); r > e;) i[e] = [t = u, u = n[++e]];
      return i
    }, Zo.zip = function() {
      if (!(u = arguments.length)) return [];
      for (var n = -1, t = Zo.min(arguments, r), e = new Array(t); ++n < t;)
        for (var u, i = -1, o = e[n] = new Array(u); ++i < u;) o[i] = arguments[i][n];
      return e
    }, Zo.transpose = function(n) {
      return Zo.zip.apply(Zo, n)
    }, Zo.keys = function(n) {
      var t = [];
      for (var e in n) t.push(e);
      return t
    }, Zo.values = function(n) {
      var t = [];
      for (var e in n) t.push(n[e]);
      return t
    }, Zo.entries = function(n) {
      var t = [];
      for (var e in n) t.push({
        key: e,
        value: n[e]
      });
      return t
    }, Zo.merge = function(n) {
      for (var t, e, r, u = n.length, i = -1, o = 0; ++i < u;) o += n[i].length;
      for (e = new Array(o); --u >= 0;)
        for (r = n[u], t = r.length; --t >= 0;) e[--o] = r[t];
      return e
    };
    var ua = Math.abs;
    Zo.range = function(n, t, e) {
      if (arguments.length < 3 && (e = 1, arguments.length < 2 && (t = n, n = 0)), 1 / 0 === (t - n) / e) throw new Error("infinite range");
      var r, i = [],
        o = u(ua(e)),
        a = -1;
      if (n *= o, t *= o, e *= o, 0 > e)
        for (;
          (r = n + e * ++a) > t;) i.push(r / o);
      else
        for (;
          (r = n + e * ++a) < t;) i.push(r / o);
      return i
    }, Zo.map = function(n) {
      var t = new o;
      if (n instanceof o) n.forEach(function(n, e) {
        t.set(n, e)
      });
      else
        for (var e in n) t.set(e, n[e]);
      return t
    }, i(o, {
      has: a,
      get: function(n) {
        return this[ia + n]
      },
      set: function(n, t) {
        return this[ia + n] = t
      },
      remove: c,
      keys: s,
      values: function() {
        var n = [];
        return this.forEach(function(t, e) {
          n.push(e)
        }), n
      },
      entries: function() {
        var n = [];
        return this.forEach(function(t, e) {
          n.push({
            key: t,
            value: e
          })
        }), n
      },
      size: l,
      empty: f,
      forEach: function(n) {
        for (var t in this) t.charCodeAt(0) === oa && n.call(this, t.substring(1), this[t])
      }
    });
    var ia = "\x00",
      oa = ia.charCodeAt(0);
    Zo.nest = function() {
      function n(t, a, c) {
        if (c >= i.length) return r ? r.call(u, a) : e ? a.sort(e) : a;
        for (var s, l, f, h, g = -1, p = a.length, v = i[c++], d = new o; ++g < p;)(h = d.get(s = v(l = a[g]))) ? h.push(l) : d.set(s, [l]);
        return t ? (l = t(), f = function(e, r) {
          l.set(e, n(t, r, c))
        }) : (l = {}, f = function(e, r) {
          l[e] = n(t, r, c)
        }), d.forEach(f), l
      }

      function t(n, e) {
        if (e >= i.length) return n;
        var r = [],
          u = a[e++];
        return n.forEach(function(n, u) {
          r.push({
            key: n,
            values: t(u, e)
          })
        }), u ? r.sort(function(n, t) {
          return u(n.key, t.key)
        }) : r
      }
      var e, r, u = {},
        i = [],
        a = [];
      return u.map = function(t, e) {
        return n(e, t, 0)
      }, u.entries = function(e) {
        return t(n(Zo.map, e, 0), 0)
      }, u.key = function(n) {
        return i.push(n), u
      }, u.sortKeys = function(n) {
        return a[i.length - 1] = n, u
      }, u.sortValues = function(n) {
        return e = n, u
      }, u.rollup = function(n) {
        return r = n, u
      }, u
    }, Zo.set = function(n) {
      var t = new h;
      if (n)
        for (var e = 0, r = n.length; r > e; ++e) t.add(n[e]);
      return t
    }, i(h, {
      has: a,
      add: function(n) {
        return this[ia + n] = !0, n
      },
      remove: function(n) {
        return n = ia + n, n in this && delete this[n]
      },
      values: s,
      size: l,
      empty: f,
      forEach: function(n) {
        for (var t in this) t.charCodeAt(0) === oa && n.call(this, t.substring(1))
      }
    }), Zo.behavior = {}, Zo.rebind = function(n, t) {
      for (var e, r = 1, u = arguments.length; ++r < u;) n[e = arguments[r]] = g(n, t, t[e]);
      return n
    };
    var aa = ["webkit", "ms", "moz", "Moz", "o", "O"];
    Zo.dispatch = function() {
      for (var n = new d, t = -1, e = arguments.length; ++t < e;) n[arguments[t]] = m(n);
      return n
    }, d.prototype.on = function(n, t) {
      var e = n.indexOf("."),
        r = "";
      if (e >= 0 && (r = n.substring(e + 1), n = n.substring(0, e)), n) return arguments.length < 2 ? this[n].on(r) : this[n].on(r, t);
      if (2 === arguments.length) {
        if (null == t)
          for (n in this) this.hasOwnProperty(n) && this[n].on(r, null);
        return this
      }
    }, Zo.event = null, Zo.requote = function(n) {
      return n.replace(ca, "\\$&")
    };
    var ca = /[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,
      sa = {}.__proto__ ? function(n, t) {
        n.__proto__ = t
      } : function(n, t) {
        for (var e in t) n[e] = t[e]
      },
      la = function(n, t) {
        return t.querySelector(n)
      },
      fa = function(n, t) {
        return t.querySelectorAll(n)
      },
      ha = Bo.matches || Bo[p(Bo, "matchesSelector")],
      ga = function(n, t) {
        return ha.call(n, t)
      };
    "function" == typeof Sizzle && (la = function(n, t) {
      return Sizzle(n, t)[0] || null
    }, fa = Sizzle, ga = Sizzle.matchesSelector), Zo.selection = function() {
      return ma
    };
    var pa = Zo.selection.prototype = [];
    pa.select = function(n) {
      var t, e, r, u, i = [];
      n = b(n);
      for (var o = -1, a = this.length; ++o < a;) {
        i.push(t = []), t.parentNode = (r = this[o]).parentNode;
        for (var c = -1, s = r.length; ++c < s;)(u = r[c]) ? (t.push(e = n.call(u, u.__data__, c, o)), e && "__data__" in u && (e.__data__ = u.__data__)) : t.push(null)
      }
      return _(i)
    }, pa.selectAll = function(n) {
      var t, e, r = [];
      n = w(n);
      for (var u = -1, i = this.length; ++u < i;)
        for (var o = this[u], a = -1, c = o.length; ++a < c;)(e = o[a]) && (r.push(t = Xo(n.call(e, e.__data__, a, u))), t.parentNode = e);
      return _(r)
    };
    var va = {
      svg: "http://www.w3.org/2000/svg",
      xhtml: "http://www.w3.org/1999/xhtml",
      xlink: "http://www.w3.org/1999/xlink",
      xml: "http://www.w3.org/XML/1998/namespace",
      xmlns: "http://www.w3.org/2000/xmlns/"
    };
    Zo.ns = {
      prefix: va,
      qualify: function(n) {
        var t = n.indexOf(":"),
          e = n;
        return t >= 0 && (e = n.substring(0, t), n = n.substring(t + 1)), va.hasOwnProperty(e) ? {
          space: va[e],
          local: n
        } : n
      }
    }, pa.attr = function(n, t) {
      if (arguments.length < 2) {
        if ("string" == typeof n) {
          var e = this.node();
          return n = Zo.ns.qualify(n), n.local ? e.getAttributeNS(n.space, n.local) : e.getAttribute(n)
        }
        for (t in n) this.each(S(t, n[t]));
        return this
      }
      return this.each(S(n, t))
    }, pa.classed = function(n, t) {
      if (arguments.length < 2) {
        if ("string" == typeof n) {
          var e = this.node(),
            r = (n = A(n)).length,
            u = -1;
          if (t = e.classList) {
            for (; ++u < r;)
              if (!t.contains(n[u])) return !1
          } else
            for (t = e.getAttribute("class"); ++u < r;)
              if (!E(n[u]).test(t)) return !1; return !0
        }
        for (t in n) this.each(C(t, n[t]));
        return this
      }
      return this.each(C(n, t))
    }, pa.style = function(n, t, e) {
      var r = arguments.length;
      if (3 > r) {
        if ("string" != typeof n) {
          2 > r && (t = "");
          for (e in n) this.each(z(e, n[e], t));
          return this
        }
        if (2 > r) return Wo.getComputedStyle(this.node(), null).getPropertyValue(n);
        e = ""
      }
      return this.each(z(n, t, e))
    }, pa.property = function(n, t) {
      if (arguments.length < 2) {
        if ("string" == typeof n) return this.node()[n];
        for (t in n) this.each(L(t, n[t]));
        return this
      }
      return this.each(L(n, t))
    }, pa.text = function(n) {
      return arguments.length ? this.each("function" == typeof n ? function() {
        var t = n.apply(this, arguments);
        this.textContent = null == t ? "" : t
      } : null == n ? function() {
        this.textContent = ""
      } : function() {
        this.textContent = n
      }) : this.node().textContent
    }, pa.html = function(n) {
      return arguments.length ? this.each("function" == typeof n ? function() {
        var t = n.apply(this, arguments);
        this.innerHTML = null == t ? "" : t
      } : null == n ? function() {
        this.innerHTML = ""
      } : function() {
        this.innerHTML = n
      }) : this.node().innerHTML
    }, pa.append = function(n) {
      return n = T(n), this.select(function() {
        return this.appendChild(n.apply(this, arguments))
      })
    }, pa.insert = function(n, t) {
      return n = T(n), t = b(t), this.select(function() {
        return this.insertBefore(n.apply(this, arguments), t.apply(this, arguments) || null)
      })
    }, pa.remove = function() {
      return this.each(function() {
        var n = this.parentNode;
        n && n.removeChild(this)
      })
    }, pa.data = function(n, t) {
      function e(n, e) {
        var r, u, i, a = n.length,
          f = e.length,
          h = Math.min(a, f),
          g = new Array(f),
          p = new Array(f),
          v = new Array(a);
        if (t) {
          var d, m = new o,
            y = new o,
            x = [];
          for (r = -1; ++r < a;) d = t.call(u = n[r], u.__data__, r), m.has(d) ? v[r] = u : m.set(d, u), x.push(d);
          for (r = -1; ++r < f;) d = t.call(e, i = e[r], r), (u = m.get(d)) ? (g[r] = u, u.__data__ = i) : y.has(d) || (p[r] = q(i)), y.set(d, i), m.remove(d);
          for (r = -1; ++r < a;) m.has(x[r]) && (v[r] = n[r])
        } else {
          for (r = -1; ++r < h;) u = n[r], i = e[r], u ? (u.__data__ = i, g[r] = u) : p[r] = q(i);
          for (; f > r; ++r) p[r] = q(e[r]);
          for (; a > r; ++r) v[r] = n[r]
        }
        p.update = g, p.parentNode = g.parentNode = v.parentNode = n.parentNode, c.push(p), s.push(g), l.push(v)
      }
      var r, u, i = -1,
        a = this.length;
      if (!arguments.length) {
        for (n = new Array(a = (r = this[0]).length); ++i < a;)(u = r[i]) && (n[i] = u.__data__);
        return n
      }
      var c = U([]),
        s = _([]),
        l = _([]);
      if ("function" == typeof n)
        for (; ++i < a;) e(r = this[i], n.call(r, r.parentNode.__data__, i));
      else
        for (; ++i < a;) e(r = this[i], n);
      return s.enter = function() {
        return c
      }, s.exit = function() {
        return l
      }, s
    }, pa.datum = function(n) {
      return arguments.length ? this.property("__data__", n) : this.property("__data__")
    }, pa.filter = function(n) {
      var t, e, r, u = [];
      "function" != typeof n && (n = R(n));
      for (var i = 0, o = this.length; o > i; i++) {
        u.push(t = []), t.parentNode = (e = this[i]).parentNode;
        for (var a = 0, c = e.length; c > a; a++)(r = e[a]) && n.call(r, r.__data__, a, i) && t.push(r)
      }
      return _(u)
    }, pa.order = function() {
      for (var n = -1, t = this.length; ++n < t;)
        for (var e, r = this[n], u = r.length - 1, i = r[u]; --u >= 0;)(e = r[u]) && (i && i !== e.nextSibling && i.parentNode.insertBefore(e, i), i = e);
      return this
    }, pa.sort = function(n) {
      n = D.apply(this, arguments);
      for (var t = -1, e = this.length; ++t < e;) this[t].sort(n);
      return this.order()
    }, pa.each = function(n) {
      return P(this, function(t, e, r) {
        n.call(t, t.__data__, e, r)
      })
    }, pa.call = function(n) {
      var t = Xo(arguments);
      return n.apply(t[0] = this, t), this
    }, pa.empty = function() {
      return !this.node()
    }, pa.node = function() {
      for (var n = 0, t = this.length; t > n; n++)
        for (var e = this[n], r = 0, u = e.length; u > r; r++) {
          var i = e[r];
          if (i) return i
        }
      return null
    }, pa.size = function() {
      var n = 0;
      return this.each(function() {
        ++n
      }), n
    };
    var da = [];
    Zo.selection.enter = U, Zo.selection.enter.prototype = da, da.append = pa.append, da.empty = pa.empty, da.node = pa.node, da.call = pa.call, da.size = pa.size, da.select = function(n) {
      for (var t, e, r, u, i, o = [], a = -1, c = this.length; ++a < c;) {
        r = (u = this[a]).update, o.push(t = []), t.parentNode = u.parentNode;
        for (var s = -1, l = u.length; ++s < l;)(i = u[s]) ? (t.push(r[s] = e = n.call(u.parentNode, i.__data__, s, a)), e.__data__ = i.__data__) : t.push(null)
      }
      return _(o)
    }, da.insert = function(n, t) {
      return arguments.length < 2 && (t = j(this)), pa.insert.call(this, n, t)
    }, pa.transition = function() {
      for (var n, t, e = Ss || ++Ns, r = [], u = ks || {
          time: Date.now(),
          ease: xu,
          delay: 0,
          duration: 250
        }, i = -1, o = this.length; ++i < o;) {
        r.push(n = []);
        for (var a = this[i], c = -1, s = a.length; ++c < s;)(t = a[c]) && Po(t, c, e, u), n.push(t)
      }
      return qo(r, e)
    }, pa.interrupt = function() {
      return this.each(H)
    }, Zo.select = function(n) {
      var t = ["string" == typeof n ? la(n, $o) : n];
      return t.parentNode = Bo, _([t])
    }, Zo.selectAll = function(n) {
      var t = Xo("string" == typeof n ? fa(n, $o) : n);
      return t.parentNode = Bo, _([t])
    };
    var ma = Zo.select(Bo);
    pa.on = function(n, t, e) {
      var r = arguments.length;
      if (3 > r) {
        if ("string" != typeof n) {
          2 > r && (t = !1);
          for (e in n) this.each(F(e, n[e], t));
          return this
        }
        if (2 > r) return (r = this.node()["__on" + n]) && r._;
        e = !1
      }
      return this.each(F(n, t, e))
    };
    var ya = Zo.map({
      mouseenter: "mouseover",
      mouseleave: "mouseout"
    });
    ya.forEach(function(n) {
      "on" + n in $o && ya.remove(n)
    });
    var xa = "onselectstart" in $o ? null : p(Bo.style, "userSelect"),
      Ma = 0;
    Zo.mouse = function(n) {
      return Z(n, x())
    };
    var _a = /WebKit/.test(Wo.navigator.userAgent) ? -1 : 0;
    Zo.touches = function(n, t) {
      return arguments.length < 2 && (t = x().touches), t ? Xo(t).map(function(t) {
        var e = Z(n, t);
        return e.identifier = t.identifier, e
      }) : []
    }, Zo.behavior.drag = function() {
      function n() {
        this.on("mousedown.drag", u).on("touchstart.drag", i)
      }

      function t(n, t, u, i, o) {
        return function() {
          function a() {
            var n, e, r = t(h, v);
            r && (n = r[0] - x[0], e = r[1] - x[1], p |= n | e, x = r, g({
              type: "drag",
              x: r[0] + s[0],
              y: r[1] + s[1],
              dx: n,
              dy: e
            }))
          }

          function c() {
            t(h, v) && (m.on(i + d, null).on(o + d, null), y(p && Zo.event.target === f), g({
              type: "dragend"
            }))
          }
          var s, l = this,
            f = Zo.event.target,
            h = l.parentNode,
            g = e.of(l, arguments),
            p = 0,
            v = n(),
            d = ".drag" + (null == v ? "" : "-" + v),
            m = Zo.select(u()).on(i + d, a).on(o + d, c),
            y = I(),
            x = t(h, v);
          r ? (s = r.apply(l, arguments), s = [s.x - x[0], s.y - x[1]]) : s = [0, 0], g({
            type: "dragstart"
          })
        }
      }
      var e = M(n, "drag", "dragstart", "dragend"),
        r = null,
        u = t(v, Zo.mouse, $, "mousemove", "mouseup"),
        i = t(V, Zo.touch, X, "touchmove", "touchend");
      return n.origin = function(t) {
        return arguments.length ? (r = t, n) : r
      }, Zo.rebind(n, e, "on")
    };
    var ba = Math.PI,
      wa = 2 * ba,
      Sa = ba / 2,
      ka = 1e-6,
      Ea = ka * ka,
      Aa = ba / 180,
      Ca = 180 / ba,
      Na = Math.SQRT2,
      za = 2,
      La = 4;
    Zo.interpolateZoom = function(n, t) {
      function e(n) {
        var t = n * y;
        if (m) {
          var e = Q(v),
            o = i / (za * h) * (e * nt(Na * t + v) - K(v));
          return [r + o * s, u + o * l, i * e / Q(Na * t + v)]
        }
        return [r + n * s, u + n * l, i * Math.exp(Na * t)]
      }
      var r = n[0],
        u = n[1],
        i = n[2],
        o = t[0],
        a = t[1],
        c = t[2],
        s = o - r,
        l = a - u,
        f = s * s + l * l,
        h = Math.sqrt(f),
        g = (c * c - i * i + La * f) / (2 * i * za * h),
        p = (c * c - i * i - La * f) / (2 * c * za * h),
        v = Math.log(Math.sqrt(g * g + 1) - g),
        d = Math.log(Math.sqrt(p * p + 1) - p),
        m = d - v,
        y = (m || Math.log(c / i)) / Na;
      return e.duration = 1e3 * y, e
    }, Zo.behavior.zoom = function() {
      function n(n) {
        n.on(A, s).on(Ra + ".zoom", f).on("dblclick.zoom", h).on(z, l)
      }

      function t(n) {
        return [(n[0] - S.x) / S.k, (n[1] - S.y) / S.k]
      }

      function e(n) {
        return [n[0] * S.k + S.x, n[1] * S.k + S.y]
      }

      function r(n) {
        S.k = Math.max(E[0], Math.min(E[1], n))
      }

      function u(n, t) {
        t = e(t), S.x += n[0] - t[0], S.y += n[1] - t[1]
      }

      function i() {
        _ && _.domain(x.range().map(function(n) {
          return (n - S.x) / S.k
        }).map(x.invert)), w && w.domain(b.range().map(function(n) {
          return (n - S.y) / S.k
        }).map(b.invert))
      }

      function o(n) {
        n({
          type: "zoomstart"
        })
      }

      function a(n) {
        i(), n({
          type: "zoom",
          scale: S.k,
          translate: [S.x, S.y]
        })
      }

      function c(n) {
        n({
          type: "zoomend"
        })
      }

      function s() {
        function n() {
          l = 1, u(Zo.mouse(r), h), a(s)
        }

        function e() {
          f.on(C, null).on(N, null), g(l && Zo.event.target === i), c(s)
        }
        var r = this,
          i = Zo.event.target,
          s = L.of(r, arguments),
          l = 0,
          f = Zo.select(Wo).on(C, n).on(N, e),
          h = t(Zo.mouse(r)),
          g = I();
        H.call(r), o(s)
      }

      function l() {
        function n() {
          var n = Zo.touches(g);
          return h = S.k, n.forEach(function(n) {
            n.identifier in v && (v[n.identifier] = t(n))
          }), n
        }

        function e() {
          var t = Zo.event.target;
          Zo.select(t).on(M, i).on(_, f), b.push(t);
          for (var e = Zo.event.changedTouches, o = 0, c = e.length; c > o; ++o) v[e[o].identifier] = null;
          var s = n(),
            l = Date.now();
          if (1 === s.length) {
            if (500 > l - m) {
              var h = s[0],
                g = v[h.identifier];
              r(2 * S.k), u(h, g), y(), a(p)
            }
            m = l
          } else if (s.length > 1) {
            var h = s[0],
              x = s[1],
              w = h[0] - x[0],
              k = h[1] - x[1];
            d = w * w + k * k
          }
        }

        function i() {
          for (var n, t, e, i, o = Zo.touches(g), c = 0, s = o.length; s > c; ++c, i = null)
            if (e = o[c], i = v[e.identifier]) {
              if (t) break;
              n = e, t = i
            }
          if (i) {
            var l = (l = e[0] - n[0]) * l + (l = e[1] - n[1]) * l,
              f = d && Math.sqrt(l / d);
            n = [(n[0] + e[0]) / 2, (n[1] + e[1]) / 2], t = [(t[0] + i[0]) / 2, (t[1] + i[1]) / 2], r(f * h)
          }
          m = null, u(n, t), a(p)
        }

        function f() {
          if (Zo.event.touches.length) {
            for (var t = Zo.event.changedTouches, e = 0, r = t.length; r > e; ++e) delete v[t[e].identifier];
            for (var u in v) return void n()
          }
          Zo.selectAll(b).on(x, null), w.on(A, s).on(z, l), k(), c(p)
        }
        var h, g = this,
          p = L.of(g, arguments),
          v = {},
          d = 0,
          x = ".zoom-" + Zo.event.changedTouches[0].identifier,
          M = "touchmove" + x,
          _ = "touchend" + x,
          b = [],
          w = Zo.select(g).on(A, null).on(z, e),
          k = I();
        H.call(g), e(), o(p)
      }

      function f() {
        var n = L.of(this, arguments);
        d ? clearTimeout(d) : (g = t(p = v || Zo.mouse(this)), H.call(this), o(n)), d = setTimeout(function() {
          d = null, c(n)
        }, 50), y(), r(Math.pow(2, .002 * Ta()) * S.k), u(p, g), a(n)
      }

      function h() {
        var n = L.of(this, arguments),
          e = Zo.mouse(this),
          i = t(e),
          s = Math.log(S.k) / Math.LN2;
        o(n), r(Math.pow(2, Zo.event.shiftKey ? Math.ceil(s) - 1 : Math.floor(s) + 1)), u(e, i), a(n), c(n)
      }
      var g, p, v, d, m, x, _, b, w, S = {
          x: 0,
          y: 0,
          k: 1
        },
        k = [960, 500],
        E = qa,
        A = "mousedown.zoom",
        C = "mousemove.zoom",
        N = "mouseup.zoom",
        z = "touchstart.zoom",
        L = M(n, "zoomstart", "zoom", "zoomend");
      return n.event = function(n) {
        n.each(function() {
          var n = L.of(this, arguments),
            t = S;
          Ss ? Zo.select(this).transition().each("start.zoom", function() {
            S = this.__chart__ || {
              x: 0,
              y: 0,
              k: 1
            }, o(n)
          }).tween("zoom:zoom", function() {
            var e = k[0],
              r = k[1],
              u = e / 2,
              i = r / 2,
              o = Zo.interpolateZoom([(u - S.x) / S.k, (i - S.y) / S.k, e / S.k], [(u - t.x) / t.k, (i - t.y) / t.k, e / t.k]);
            return function(t) {
              var r = o(t),
                c = e / r[2];
              this.__chart__ = S = {
                x: u - r[0] * c,
                y: i - r[1] * c,
                k: c
              }, a(n)
            }
          }).each("end.zoom", function() {
            c(n)
          }) : (this.__chart__ = S, o(n), a(n), c(n))
        })
      }, n.translate = function(t) {
        return arguments.length ? (S = {
          x: +t[0],
          y: +t[1],
          k: S.k
        }, i(), n) : [S.x, S.y]
      }, n.scale = function(t) {
        return arguments.length ? (S = {
          x: S.x,
          y: S.y,
          k: +t
        }, i(), n) : S.k
      }, n.scaleExtent = function(t) {
        return arguments.length ? (E = null == t ? qa : [+t[0], +t[1]], n) : E
      }, n.center = function(t) {
        return arguments.length ? (v = t && [+t[0], +t[1]], n) : v
      }, n.size = function(t) {
        return arguments.length ? (k = t && [+t[0], +t[1]], n) : k
      }, n.x = function(t) {
        return arguments.length ? (_ = t, x = t.copy(), S = {
          x: 0,
          y: 0,
          k: 1
        }, n) : _
      }, n.y = function(t) {
        return arguments.length ? (w = t, b = t.copy(), S = {
          x: 0,
          y: 0,
          k: 1
        }, n) : w
      }, Zo.rebind(n, L, "on")
    };
    var Ta, qa = [0, 1 / 0],
      Ra = "onwheel" in $o ? (Ta = function() {
        return -Zo.event.deltaY * (Zo.event.deltaMode ? 120 : 1)
      }, "wheel") : "onmousewheel" in $o ? (Ta = function() {
        return Zo.event.wheelDelta
      }, "mousewheel") : (Ta = function() {
        return -Zo.event.detail
      }, "MozMousePixelScroll");
    Zo.color = et, et.prototype.toString = function() {
      return this.rgb() + ""
    }, Zo.hsl = rt;
    var Da = rt.prototype = new et;
    Da.brighter = function(n) {
      return n = Math.pow(.7, arguments.length ? n : 1), new rt(this.h, this.s, this.l / n)
    }, Da.darker = function(n) {
      return n = Math.pow(.7, arguments.length ? n : 1), new rt(this.h, this.s, n * this.l)
    }, Da.rgb = function() {
      return ut(this.h, this.s, this.l)
    }, Zo.hcl = it;
    var Pa = it.prototype = new et;
    Pa.brighter = function(n) {
      return new it(this.h, this.c, Math.min(100, this.l + Ua * (arguments.length ? n : 1)))
    }, Pa.darker = function(n) {
      return new it(this.h, this.c, Math.max(0, this.l - Ua * (arguments.length ? n : 1)))
    }, Pa.rgb = function() {
      return ot(this.h, this.c, this.l).rgb()
    }, Zo.lab = at;
    var Ua = 18,
      ja = .95047,
      Ha = 1,
      Fa = 1.08883,
      Oa = at.prototype = new et;
    Oa.brighter = function(n) {
      return new at(Math.min(100, this.l + Ua * (arguments.length ? n : 1)), this.a, this.b)
    }, Oa.darker = function(n) {
      return new at(Math.max(0, this.l - Ua * (arguments.length ? n : 1)), this.a, this.b)
    }, Oa.rgb = function() {
      return ct(this.l, this.a, this.b)
    }, Zo.rgb = gt;
    var Ya = gt.prototype = new et;
    Ya.brighter = function(n) {
      n = Math.pow(.7, arguments.length ? n : 1);
      var t = this.r,
        e = this.g,
        r = this.b,
        u = 30;
      return t || e || r ? (t && u > t && (t = u), e && u > e && (e = u), r && u > r && (r = u), new gt(Math.min(255, t / n), Math.min(255, e / n), Math.min(255, r / n))) : new gt(u, u, u)
    }, Ya.darker = function(n) {
      return n = Math.pow(.7, arguments.length ? n : 1), new gt(n * this.r, n * this.g, n * this.b)
    }, Ya.hsl = function() {
      return yt(this.r, this.g, this.b)
    }, Ya.toString = function() {
      return "#" + dt(this.r) + dt(this.g) + dt(this.b)
    };
    var Ia = Zo.map({
      aliceblue: 15792383,
      antiquewhite: 16444375,
      aqua: 65535,
      aquamarine: 8388564,
      azure: 15794175,
      beige: 16119260,
      bisque: 16770244,
      black: 0,
      blanchedalmond: 16772045,
      blue: 255,
      blueviolet: 9055202,
      brown: 10824234,
      burlywood: 14596231,
      cadetblue: 6266528,
      chartreuse: 8388352,
      chocolate: 13789470,
      coral: 16744272,
      cornflowerblue: 6591981,
      cornsilk: 16775388,
      crimson: 14423100,
      cyan: 65535,
      darkblue: 139,
      darkcyan: 35723,
      darkgoldenrod: 12092939,
      darkgray: 11119017,
      darkgreen: 25600,
      darkgrey: 11119017,
      darkkhaki: 12433259,
      darkmagenta: 9109643,
      darkolivegreen: 5597999,
      darkorange: 16747520,
      darkorchid: 10040012,
      darkred: 9109504,
      darksalmon: 15308410,
      darkseagreen: 9419919,
      darkslateblue: 4734347,
      darkslategray: 3100495,
      darkslategrey: 3100495,
      darkturquoise: 52945,
      darkviolet: 9699539,
      deeppink: 16716947,
      deepskyblue: 49151,
      dimgray: 6908265,
      dimgrey: 6908265,
      dodgerblue: 2003199,
      firebrick: 11674146,
      floralwhite: 16775920,
      forestgreen: 2263842,
      fuchsia: 16711935,
      gainsboro: 14474460,
      ghostwhite: 16316671,
      gold: 16766720,
      goldenrod: 14329120,
      gray: 8421504,
      green: 32768,
      greenyellow: 11403055,
      grey: 8421504,
      honeydew: 15794160,
      hotpink: 16738740,
      indianred: 13458524,
      indigo: 4915330,
      ivory: 16777200,
      khaki: 15787660,
      lavender: 15132410,
      lavenderblush: 16773365,
      lawngreen: 8190976,
      lemonchiffon: 16775885,
      lightblue: 11393254,
      lightcoral: 15761536,
      lightcyan: 14745599,
      lightgoldenrodyellow: 16448210,
      lightgray: 13882323,
      lightgreen: 9498256,
      lightgrey: 13882323,
      lightpink: 16758465,
      lightsalmon: 16752762,
      lightseagreen: 2142890,
      lightskyblue: 8900346,
      lightslategray: 7833753,
      lightslategrey: 7833753,
      lightsteelblue: 11584734,
      lightyellow: 16777184,
      lime: 65280,
      limegreen: 3329330,
      linen: 16445670,
      magenta: 16711935,
      maroon: 8388608,
      mediumaquamarine: 6737322,
      mediumblue: 205,
      mediumorchid: 12211667,
      mediumpurple: 9662683,
      mediumseagreen: 3978097,
      mediumslateblue: 8087790,
      mediumspringgreen: 64154,
      mediumturquoise: 4772300,
      mediumvioletred: 13047173,
      midnightblue: 1644912,
      mintcream: 16121850,
      mistyrose: 16770273,
      moccasin: 16770229,
      navajowhite: 16768685,
      navy: 128,
      oldlace: 16643558,
      olive: 8421376,
      olivedrab: 7048739,
      orange: 16753920,
      orangered: 16729344,
      orchid: 14315734,
      palegoldenrod: 15657130,
      palegreen: 10025880,
      paleturquoise: 11529966,
      palevioletred: 14381203,
      papayawhip: 16773077,
      peachpuff: 16767673,
      peru: 13468991,
      pink: 16761035,
      plum: 14524637,
      powderblue: 11591910,
      purple: 8388736,
      red: 16711680,
      rosybrown: 12357519,
      royalblue: 4286945,
      saddlebrown: 9127187,
      salmon: 16416882,
      sandybrown: 16032864,
      seagreen: 3050327,
      seashell: 16774638,
      sienna: 10506797,
      silver: 12632256,
      skyblue: 8900331,
      slateblue: 6970061,
      slategray: 7372944,
      slategrey: 7372944,
      snow: 16775930,
      springgreen: 65407,
      steelblue: 4620980,
      tan: 13808780,
      teal: 32896,
      thistle: 14204888,
      tomato: 16737095,
      turquoise: 4251856,
      violet: 15631086,
      wheat: 16113331,
      white: 16777215,
      whitesmoke: 16119285,
      yellow: 16776960,
      yellowgreen: 10145074
    });
    Ia.forEach(function(n, t) {
      Ia.set(n, pt(t))
    }), Zo.functor = bt, Zo.xhr = St(wt), Zo.dsv = function(n, t) {
      function e(n, e, i) {
        arguments.length < 3 && (i = e, e = null);
        var o = kt(n, t, null == e ? r : u(e), i);
        return o.row = function(n) {
          return arguments.length ? o.response(null == (e = n) ? r : u(n)) : e
        }, o
      }

      function r(n) {
        return e.parse(n.responseText)
      }

      function u(n) {
        return function(t) {
          return e.parse(t.responseText, n)
        }
      }

      function i(t) {
        return t.map(o).join(n)
      }

      function o(n) {
        return a.test(n) ? '"' + n.replace(/\"/g, '""') + '"' : n
      }
      var a = new RegExp('["' + n + "\n]"),
        c = n.charCodeAt(0);
      return e.parse = function(n, t) {
        var r;
        return e.parseRows(n, function(n, e) {
          if (r) return r(n, e - 1);
          var u = new Function("d", "return {" + n.map(function(n, t) {
            return JSON.stringify(n) + ": d[" + t + "]"
          }).join(",") + "}");
          r = t ? function(n, e) {
            return t(u(n), e)
          } : u
        })
      }, e.parseRows = function(n, t) {
        function e() {
          if (l >= s) return o;
          if (u) return u = !1, i;
          var t = l;
          if (34 === n.charCodeAt(t)) {
            for (var e = t; e++ < s;)
              if (34 === n.charCodeAt(e)) {
                if (34 !== n.charCodeAt(e + 1)) break;
                ++e
              }
            l = e + 2;
            var r = n.charCodeAt(e + 1);
            return 13 === r ? (u = !0, 10 === n.charCodeAt(e + 2) && ++l) : 10 === r && (u = !0), n.substring(t + 1, e).replace(/""/g, '"')
          }
          for (; s > l;) {
            var r = n.charCodeAt(l++),
              a = 1;
            if (10 === r) u = !0;
            else if (13 === r) u = !0, 10 === n.charCodeAt(l) && (++l, ++a);
            else if (r !== c) continue;
            return n.substring(t, l - a)
          }
          return n.substring(t)
        }
        for (var r, u, i = {}, o = {}, a = [], s = n.length, l = 0, f = 0;
          (r = e()) !== o;) {
          for (var h = []; r !== i && r !== o;) h.push(r), r = e();
          (!t || (h = t(h, f++))) && a.push(h)
        }
        return a
      }, e.format = function(t) {
        if (Array.isArray(t[0])) return e.formatRows(t);
        var r = new h,
          u = [];
        return t.forEach(function(n) {
          for (var t in n) r.has(t) || u.push(r.add(t))
        }), [u.map(o).join(n)].concat(t.map(function(t) {
          return u.map(function(n) {
            return o(t[n])
          }).join(n)
        })).join("\n")
      }, e.formatRows = function(n) {
        return n.map(i).join("\n")
      }, e
    }, Zo.csv = Zo.dsv(",", "text/csv"), Zo.tsv = Zo.dsv("	", "text/tab-separated-values"), Zo.touch = function(n, t, e) {
      if (arguments.length < 3 && (e = t, t = x().changedTouches), t)
        for (var r, u = 0, i = t.length; i > u; ++u)
          if ((r = t[u]).identifier === e) return Z(n, r)
    };
    var Za, Va, Xa, $a, Ba, Wa = Wo[p(Wo, "requestAnimationFrame")] || function(n) {
      setTimeout(n, 17)
    };
    Zo.timer = function(n, t, e) {
      var r = arguments.length;
      2 > r && (t = 0), 3 > r && (e = Date.now());
      var u = e + t,
        i = {
          c: n,
          t: u,
          f: !1,
          n: null
        };
      Va ? Va.n = i : Za = i, Va = i, Xa || ($a = clearTimeout($a), Xa = 1, Wa(At))
    }, Zo.timer.flush = function() {
      Ct(), Nt()
    }, Zo.round = function(n, t) {
      return t ? Math.round(n * (t = Math.pow(10, t))) / t : Math.round(n)
    };
    var Ja = ["y", "z", "a", "f", "p", "n", "\xb5", "m", "", "k", "M", "G", "T", "P", "E", "Z", "Y"].map(Lt);
    Zo.formatPrefix = function(n, t) {
      var e = 0;
      return n && (0 > n && (n *= -1), t && (n = Zo.round(n, zt(n, t))), e = 1 + Math.floor(1e-12 + Math.log(n) / Math.LN10), e = Math.max(-24, Math.min(24, 3 * Math.floor((e - 1) / 3)))), Ja[8 + e / 3]
    };
    var Ga = /(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,
      Ka = Zo.map({
        b: function(n) {
          return n.toString(2)
        },
        c: function(n) {
          return String.fromCharCode(n)
        },
        o: function(n) {
          return n.toString(8)
        },
        x: function(n) {
          return n.toString(16)
        },
        X: function(n) {
          return n.toString(16).toUpperCase()
        },
        g: function(n, t) {
          return n.toPrecision(t)
        },
        e: function(n, t) {
          return n.toExponential(t)
        },
        f: function(n, t) {
          return n.toFixed(t)
        },
        r: function(n, t) {
          return (n = Zo.round(n, zt(n, t))).toFixed(Math.max(0, Math.min(20, zt(n * (1 + 1e-15), t))))
        }
      }),
      Qa = Zo.time = {},
      nc = Date;
    Rt.prototype = {
      getDate: function() {
        return this._.getUTCDate()
      },
      getDay: function() {
        return this._.getUTCDay()
      },
      getFullYear: function() {
        return this._.getUTCFullYear()
      },
      getHours: function() {
        return this._.getUTCHours()
      },
      getMilliseconds: function() {
        return this._.getUTCMilliseconds()
      },
      getMinutes: function() {
        return this._.getUTCMinutes()
      },
      getMonth: function() {
        return this._.getUTCMonth()
      },
      getSeconds: function() {
        return this._.getUTCSeconds()
      },
      getTime: function() {
        return this._.getTime()
      },
      getTimezoneOffset: function() {
        return 0
      },
      valueOf: function() {
        return this._.valueOf()
      },
      setDate: function() {
        tc.setUTCDate.apply(this._, arguments)
      },
      setDay: function() {
        tc.setUTCDay.apply(this._, arguments)
      },
      setFullYear: function() {
        tc.setUTCFullYear.apply(this._, arguments)
      },
      setHours: function() {
        tc.setUTCHours.apply(this._, arguments)
      },
      setMilliseconds: function() {
        tc.setUTCMilliseconds.apply(this._, arguments)
      },
      setMinutes: function() {
        tc.setUTCMinutes.apply(this._, arguments)
      },
      setMonth: function() {
        tc.setUTCMonth.apply(this._, arguments)
      },
      setSeconds: function() {
        tc.setUTCSeconds.apply(this._, arguments)
      },
      setTime: function() {
        tc.setTime.apply(this._, arguments)
      }
    };
    var tc = Date.prototype;
    Qa.year = Dt(function(n) {
      return n = Qa.day(n), n.setMonth(0, 1), n
    }, function(n, t) {
      n.setFullYear(n.getFullYear() + t)
    }, function(n) {
      return n.getFullYear()
    }), Qa.years = Qa.year.range, Qa.years.utc = Qa.year.utc.range, Qa.day = Dt(function(n) {
      var t = new nc(2e3, 0);
      return t.setFullYear(n.getFullYear(), n.getMonth(), n.getDate()), t
    }, function(n, t) {
      n.setDate(n.getDate() + t)
    }, function(n) {
      return n.getDate() - 1
    }), Qa.days = Qa.day.range, Qa.days.utc = Qa.day.utc.range, Qa.dayOfYear = function(n) {
      var t = Qa.year(n);
      return Math.floor((n - t - 6e4 * (n.getTimezoneOffset() - t.getTimezoneOffset())) / 864e5)
    }, ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"].forEach(function(n, t) {
      t = 7 - t;
      var e = Qa[n] = Dt(function(n) {
        return (n = Qa.day(n)).setDate(n.getDate() - (n.getDay() + t) % 7), n
      }, function(n, t) {
        n.setDate(n.getDate() + 7 * Math.floor(t))
      }, function(n) {
        var e = Qa.year(n).getDay();
        return Math.floor((Qa.dayOfYear(n) + (e + t) % 7) / 7) - (e !== t)
      });
      Qa[n + "s"] = e.range, Qa[n + "s"].utc = e.utc.range, Qa[n + "OfYear"] = function(n) {
        var e = Qa.year(n).getDay();
        return Math.floor((Qa.dayOfYear(n) + (e + t) % 7) / 7)
      }
    }), Qa.week = Qa.sunday, Qa.weeks = Qa.sunday.range, Qa.weeks.utc = Qa.sunday.utc.range, Qa.weekOfYear = Qa.sundayOfYear;
    var ec = {
        "-": "",
        _: " ",
        0: "0"
      },
      rc = /^\s*\d+/,
      uc = /^%/;
    Zo.locale = function(n) {
      return {
        numberFormat: Tt(n),
        timeFormat: Ut(n)
      }
    };
    var ic = Zo.locale({
      decimal: ".",
      thousands: ",",
      grouping: [3],
      currency: ["$", ""],
      dateTime: "%a %b %e %X %Y",
      date: "%m/%d/%Y",
      time: "%H:%M:%S",
      periods: ["AM", "PM"],
      days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
      shortDays: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
      months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
      shortMonths: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
    });
    Zo.format = ic.numberFormat, Zo.geo = {}, ue.prototype = {
      s: 0,
      t: 0,
      add: function(n) {
        ie(n, this.t, oc), ie(oc.s, this.s, this), this.s ? this.t += oc.t : this.s = oc.t
      },
      reset: function() {
        this.s = this.t = 0
      },
      valueOf: function() {
        return this.s
      }
    };
    var oc = new ue;
    Zo.geo.stream = function(n, t) {
      n && ac.hasOwnProperty(n.type) ? ac[n.type](n, t) : oe(n, t)
    };
    var ac = {
        Feature: function(n, t) {
          oe(n.geometry, t)
        },
        FeatureCollection: function(n, t) {
          for (var e = n.features, r = -1, u = e.length; ++r < u;) oe(e[r].geometry, t)
        }
      },
      cc = {
        Sphere: function(n, t) {
          t.sphere()
        },
        Point: function(n, t) {
          n = n.coordinates, t.point(n[0], n[1], n[2])
        },
        MultiPoint: function(n, t) {
          for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) n = e[r], t.point(n[0], n[1], n[2])
        },
        LineString: function(n, t) {
          ae(n.coordinates, t, 0)
        },
        MultiLineString: function(n, t) {
          for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) ae(e[r], t, 0)
        },
        Polygon: function(n, t) {
          ce(n.coordinates, t)
        },
        MultiPolygon: function(n, t) {
          for (var e = n.coordinates, r = -1, u = e.length; ++r < u;) ce(e[r], t)
        },
        GeometryCollection: function(n, t) {
          for (var e = n.geometries, r = -1, u = e.length; ++r < u;) oe(e[r], t)
        }
      };
    Zo.geo.area = function(n) {
      return sc = 0, Zo.geo.stream(n, fc), sc
    };
    var sc, lc = new ue,
      fc = {
        sphere: function() {
          sc += 4 * ba
        },
        point: v,
        lineStart: v,
        lineEnd: v,
        polygonStart: function() {
          lc.reset(), fc.lineStart = se
        },
        polygonEnd: function() {
          var n = 2 * lc;
          sc += 0 > n ? 4 * ba + n : n, fc.lineStart = fc.lineEnd = fc.point = v
        }
      };
    Zo.geo.bounds = function() {
      function n(n, t) {
        x.push(M = [l = n, h = n]), f > t && (f = t), t > g && (g = t)
      }

      function t(t, e) {
        var r = le([t * Aa, e * Aa]);
        if (m) {
          var u = he(m, r),
            i = [u[1], -u[0], 0],
            o = he(i, u);
          ve(o), o = de(o);
          var c = t - p,
            s = c > 0 ? 1 : -1,
            v = o[0] * Ca * s,
            d = ua(c) > 180;
          if (d ^ (v > s * p && s * t > v)) {
            var y = o[1] * Ca;
            y > g && (g = y)
          } else if (v = (v + 360) % 360 - 180, d ^ (v > s * p && s * t > v)) {
            var y = -o[1] * Ca;
            f > y && (f = y)
          } else f > e && (f = e), e > g && (g = e);
          d ? p > t ? a(l, t) > a(l, h) && (h = t) : a(t, h) > a(l, h) && (l = t) : h >= l ? (l > t && (l = t), t > h && (h = t)) : t > p ? a(l, t) > a(l, h) && (h = t) : a(t, h) > a(l, h) && (l = t)
        } else n(t, e);
        m = r, p = t
      }

      function e() {
        _.point = t
      }

      function r() {
        M[0] = l, M[1] = h, _.point = n, m = null
      }

      function u(n, e) {
        if (m) {
          var r = n - p;
          y += ua(r) > 180 ? r + (r > 0 ? 360 : -360) : r
        } else v = n, d = e;
        fc.point(n, e), t(n, e)
      }

      function i() {
        fc.lineStart()
      }

      function o() {
        u(v, d), fc.lineEnd(), ua(y) > ka && (l = -(h = 180)), M[0] = l, M[1] = h, m = null
      }

      function a(n, t) {
        return (t -= n) < 0 ? t + 360 : t
      }

      function c(n, t) {
        return n[0] - t[0]
      }

      function s(n, t) {
        return t[0] <= t[1] ? t[0] <= n && n <= t[1] : n < t[0] || t[1] < n
      }
      var l, f, h, g, p, v, d, m, y, x, M, _ = {
        point: n,
        lineStart: e,
        lineEnd: r,
        polygonStart: function() {
          _.point = u, _.lineStart = i, _.lineEnd = o, y = 0, fc.polygonStart()
        },
        polygonEnd: function() {
          fc.polygonEnd(), _.point = n, _.lineStart = e, _.lineEnd = r, 0 > lc ? (l = -(h = 180), f = -(g = 90)) : y > ka ? g = 90 : -ka > y && (f = -90), M[0] = l, M[1] = h
        }
      };
      return function(n) {
        g = h = -(l = f = 1 / 0), x = [], Zo.geo.stream(n, _);
        var t = x.length;
        if (t) {
          x.sort(c);
          for (var e, r = 1, u = x[0], i = [u]; t > r; ++r) e = x[r], s(e[0], u) || s(e[1], u) ? (a(u[0], e[1]) > a(u[0], u[1]) && (u[1] = e[1]), a(e[0], u[1]) > a(u[0], u[1]) && (u[0] = e[0])) : i.push(u = e);
          for (var o, e, p = -1 / 0, t = i.length - 1, r = 0, u = i[t]; t >= r; u = e, ++r) e = i[r], (o = a(u[1], e[0])) > p && (p = o, l = e[0], h = u[1])
        }
        return x = M = null, 1 / 0 === l || 1 / 0 === f ? [
          [0 / 0, 0 / 0],
          [0 / 0, 0 / 0]
        ] : [
          [l, f],
          [h, g]
        ]
      }
    }(), Zo.geo.centroid = function(n) {
      hc = gc = pc = vc = dc = mc = yc = xc = Mc = _c = bc = 0, Zo.geo.stream(n, wc);
      var t = Mc,
        e = _c,
        r = bc,
        u = t * t + e * e + r * r;
      return Ea > u && (t = mc, e = yc, r = xc, ka > gc && (t = pc, e = vc, r = dc), u = t * t + e * e + r * r, Ea > u) ? [0 / 0, 0 / 0] : [Math.atan2(e, t) * Ca, G(r / Math.sqrt(u)) * Ca]
    };
    var hc, gc, pc, vc, dc, mc, yc, xc, Mc, _c, bc, wc = {
        sphere: v,
        point: ye,
        lineStart: Me,
        lineEnd: _e,
        polygonStart: function() {
          wc.lineStart = be
        },
        polygonEnd: function() {
          wc.lineStart = Me
        }
      },
      Sc = Ae(we, Te, Re, [-ba, -ba / 2]),
      kc = 1e9;
    Zo.geo.clipExtent = function() {
      var n, t, e, r, u, i, o = {
        stream: function(n) {
          return u && (u.valid = !1), u = i(n), u.valid = !0, u
        },
        extent: function(a) {
          return arguments.length ? (i = Ue(n = +a[0][0], t = +a[0][1], e = +a[1][0], r = +a[1][1]), u && (u.valid = !1, u = null), o) : [
            [n, t],
            [e, r]
          ]
        }
      };
      return o.extent([
        [0, 0],
        [960, 500]
      ])
    }, (Zo.geo.conicEqualArea = function() {
      return He(Fe)
    }).raw = Fe, Zo.geo.albers = function() {
      return Zo.geo.conicEqualArea().rotate([96, 0]).center([-.6, 38.7]).parallels([29.5, 45.5]).scale(1070)
    }, Zo.geo.albersUsa = function() {
      function n(n) {
        var i = n[0],
          o = n[1];
        return t = null, e(i, o), t || (r(i, o), t) || u(i, o), t
      }
      var t, e, r, u, i = Zo.geo.albers(),
        o = Zo.geo.conicEqualArea().rotate([154, 0]).center([-2, 58.5]).parallels([55, 65]),
        a = Zo.geo.conicEqualArea().rotate([157, 0]).center([-3, 19.9]).parallels([8, 18]),
        c = {
          point: function(n, e) {
            t = [n, e]
          }
        };
      return n.invert = function(n) {
        var t = i.scale(),
          e = i.translate(),
          r = (n[0] - e[0]) / t,
          u = (n[1] - e[1]) / t;
        return (u >= .12 && .234 > u && r >= -.425 && -.214 > r ? o : u >= .166 && .234 > u && r >= -.214 && -.115 > r ? a : i).invert(n)
      }, n.stream = function(n) {
        var t = i.stream(n),
          e = o.stream(n),
          r = a.stream(n);
        return {
          point: function(n, u) {
            t.point(n, u), e.point(n, u), r.point(n, u)
          },
          sphere: function() {
            t.sphere(), e.sphere(), r.sphere()
          },
          lineStart: function() {
            t.lineStart(), e.lineStart(), r.lineStart()
          },
          lineEnd: function() {
            t.lineEnd(), e.lineEnd(), r.lineEnd()
          },
          polygonStart: function() {
            t.polygonStart(), e.polygonStart(), r.polygonStart()
          },
          polygonEnd: function() {
            t.polygonEnd(), e.polygonEnd(), r.polygonEnd()
          }
        }
      }, n.precision = function(t) {
        return arguments.length ? (i.precision(t), o.precision(t), a.precision(t), n) : i.precision()
      }, n.scale = function(t) {
        return arguments.length ? (i.scale(t), o.scale(.35 * t), a.scale(t), n.translate(i.translate())) : i.scale()
      }, n.translate = function(t) {
        if (!arguments.length) return i.translate();
        var s = i.scale(),
          l = +t[0],
          f = +t[1];
        return e = i.translate(t).clipExtent([
          [l - .455 * s, f - .238 * s],
          [l + .455 * s, f + .238 * s]
        ]).stream(c).point, r = o.translate([l - .307 * s, f + .201 * s]).clipExtent([
          [l - .425 * s + ka, f + .12 * s + ka],
          [l - .214 * s - ka, f + .234 * s - ka]
        ]).stream(c).point, u = a.translate([l - .205 * s, f + .212 * s]).clipExtent([
          [l - .214 * s + ka, f + .166 * s + ka],
          [l - .115 * s - ka, f + .234 * s - ka]
        ]).stream(c).point, n
      }, n.scale(1070)
    };
    var Ec, Ac, Cc, Nc, zc, Lc, Tc = {
        point: v,
        lineStart: v,
        lineEnd: v,
        polygonStart: function() {
          Ac = 0, Tc.lineStart = Oe
        },
        polygonEnd: function() {
          Tc.lineStart = Tc.lineEnd = Tc.point = v, Ec += ua(Ac / 2)
        }
      },
      qc = {
        point: Ye,
        lineStart: v,
        lineEnd: v,
        polygonStart: v,
        polygonEnd: v
      },
      Rc = {
        point: Ve,
        lineStart: Xe,
        lineEnd: $e,
        polygonStart: function() {
          Rc.lineStart = Be
        },
        polygonEnd: function() {
          Rc.point = Ve, Rc.lineStart = Xe, Rc.lineEnd = $e
        }
      };
    Zo.geo.path = function() {
      function n(n) {
        return n && ("function" == typeof a && i.pointRadius(+a.apply(this, arguments)), o && o.valid || (o = u(i)), Zo.geo.stream(n, o)), i.result()
      }

      function t() {
        return o = null, n
      }
      var e, r, u, i, o, a = 4.5;
      return n.area = function(n) {
        return Ec = 0, Zo.geo.stream(n, u(Tc)), Ec
      }, n.centroid = function(n) {
        return pc = vc = dc = mc = yc = xc = Mc = _c = bc = 0, Zo.geo.stream(n, u(Rc)), bc ? [Mc / bc, _c / bc] : xc ? [mc / xc, yc / xc] : dc ? [pc / dc, vc / dc] : [0 / 0, 0 / 0]
      }, n.bounds = function(n) {
        return zc = Lc = -(Cc = Nc = 1 / 0), Zo.geo.stream(n, u(qc)), [
          [Cc, Nc],
          [zc, Lc]
        ]
      }, n.projection = function(n) {
        return arguments.length ? (u = (e = n) ? n.stream || Ge(n) : wt, t()) : e
      }, n.context = function(n) {
        return arguments.length ? (i = null == (r = n) ? new Ie : new We(n), "function" != typeof a && i.pointRadius(a), t()) : r
      }, n.pointRadius = function(t) {
        return arguments.length ? (a = "function" == typeof t ? t : (i.pointRadius(+t), +t), n) : a
      }, n.projection(Zo.geo.albersUsa()).context(null)
    }, Zo.geo.transform = function(n) {
      return {
        stream: function(t) {
          var e = new Ke(t);
          for (var r in n) e[r] = n[r];
          return e
        }
      }
    }, Ke.prototype = {
      point: function(n, t) {
        this.stream.point(n, t)
      },
      sphere: function() {
        this.stream.sphere()
      },
      lineStart: function() {
        this.stream.lineStart()
      },
      lineEnd: function() {
        this.stream.lineEnd()
      },
      polygonStart: function() {
        this.stream.polygonStart()
      },
      polygonEnd: function() {
        this.stream.polygonEnd()
      }
    }, Zo.geo.projection = nr, Zo.geo.projectionMutator = tr, (Zo.geo.equirectangular = function() {
      return nr(rr)
    }).raw = rr.invert = rr, Zo.geo.rotation = function(n) {
      function t(t) {
        return t = n(t[0] * Aa, t[1] * Aa), t[0] *= Ca, t[1] *= Ca, t
      }
      return n = ir(n[0] % 360 * Aa, n[1] * Aa, n.length > 2 ? n[2] * Aa : 0), t.invert = function(t) {
        return t = n.invert(t[0] * Aa, t[1] * Aa), t[0] *= Ca, t[1] *= Ca, t
      }, t
    }, ur.invert = rr, Zo.geo.circle = function() {
      function n() {
        var n = "function" == typeof r ? r.apply(this, arguments) : r,
          t = ir(-n[0] * Aa, -n[1] * Aa, 0).invert,
          u = [];
        return e(null, null, 1, {
          point: function(n, e) {
            u.push(n = t(n, e)), n[0] *= Ca, n[1] *= Ca
          }
        }), {
          type: "Polygon",
          coordinates: [u]
        }
      }
      var t, e, r = [0, 0],
        u = 6;
      return n.origin = function(t) {
        return arguments.length ? (r = t, n) : r
      }, n.angle = function(r) {
        return arguments.length ? (e = sr((t = +r) * Aa, u * Aa), n) : t
      }, n.precision = function(r) {
        return arguments.length ? (e = sr(t * Aa, (u = +r) * Aa), n) : u
      }, n.angle(90)
    }, Zo.geo.distance = function(n, t) {
      var e, r = (t[0] - n[0]) * Aa,
        u = n[1] * Aa,
        i = t[1] * Aa,
        o = Math.sin(r),
        a = Math.cos(r),
        c = Math.sin(u),
        s = Math.cos(u),
        l = Math.sin(i),
        f = Math.cos(i);
      return Math.atan2(Math.sqrt((e = f * o) * e + (e = s * l - c * f * a) * e), c * l + s * f * a)
    }, Zo.geo.graticule = function() {
      function n() {
        return {
          type: "MultiLineString",
          coordinates: t()
        }
      }

      function t() {
        return Zo.range(Math.ceil(i / d) * d, u, d).map(h).concat(Zo.range(Math.ceil(s / m) * m, c, m).map(g)).concat(Zo.range(Math.ceil(r / p) * p, e, p).filter(function(n) {
          return ua(n % d) > ka
        }).map(l)).concat(Zo.range(Math.ceil(a / v) * v, o, v).filter(function(n) {
          return ua(n % m) > ka
        }).map(f))
      }
      var e, r, u, i, o, a, c, s, l, f, h, g, p = 10,
        v = p,
        d = 90,
        m = 360,
        y = 2.5;
      return n.lines = function() {
        return t().map(function(n) {
          return {
            type: "LineString",
            coordinates: n
          }
        })
      }, n.outline = function() {
        return {
          type: "Polygon",
          coordinates: [h(i).concat(g(c).slice(1), h(u).reverse().slice(1), g(s).reverse().slice(1))]
        }
      }, n.extent = function(t) {
        return arguments.length ? n.majorExtent(t).minorExtent(t) : n.minorExtent()
      }, n.majorExtent = function(t) {
        return arguments.length ? (i = +t[0][0], u = +t[1][0], s = +t[0][1], c = +t[1][1], i > u && (t = i, i = u, u = t), s > c && (t = s, s = c, c = t), n.precision(y)) : [
          [i, s],
          [u, c]
        ]
      }, n.minorExtent = function(t) {
        return arguments.length ? (r = +t[0][0], e = +t[1][0], a = +t[0][1], o = +t[1][1], r > e && (t = r, r = e, e = t), a > o && (t = a, a = o, o = t), n.precision(y)) : [
          [r, a],
          [e, o]
        ]
      }, n.step = function(t) {
        return arguments.length ? n.majorStep(t).minorStep(t) : n.minorStep()
      }, n.majorStep = function(t) {
        return arguments.length ? (d = +t[0], m = +t[1], n) : [d, m]
      }, n.minorStep = function(t) {
        return arguments.length ? (p = +t[0], v = +t[1], n) : [p, v]
      }, n.precision = function(t) {
        return arguments.length ? (y = +t, l = fr(a, o, 90), f = hr(r, e, y), h = fr(s, c, 90), g = hr(i, u, y), n) : y
      }, n.majorExtent([
        [-180, -90 + ka],
        [180, 90 - ka]
      ]).minorExtent([
        [-180, -80 - ka],
        [180, 80 + ka]
      ])
    }, Zo.geo.greatArc = function() {
      function n() {
        return {
          type: "LineString",
          coordinates: [t || r.apply(this, arguments), e || u.apply(this, arguments)]
        }
      }
      var t, e, r = gr,
        u = pr;
      return n.distance = function() {
        return Zo.geo.distance(t || r.apply(this, arguments), e || u.apply(this, arguments))
      }, n.source = function(e) {
        return arguments.length ? (r = e, t = "function" == typeof e ? null : e, n) : r
      }, n.target = function(t) {
        return arguments.length ? (u = t, e = "function" == typeof t ? null : t, n) : u
      }, n.precision = function() {
        return arguments.length ? n : 0
      }, n
    }, Zo.geo.interpolate = function(n, t) {
      return vr(n[0] * Aa, n[1] * Aa, t[0] * Aa, t[1] * Aa)
    }, Zo.geo.length = function(n) {
      return Dc = 0, Zo.geo.stream(n, Pc), Dc
    };
    var Dc, Pc = {
        sphere: v,
        point: v,
        lineStart: dr,
        lineEnd: v,
        polygonStart: v,
        polygonEnd: v
      },
      Uc = mr(function(n) {
        return Math.sqrt(2 / (1 + n))
      }, function(n) {
        return 2 * Math.asin(n / 2)
      });
    (Zo.geo.azimuthalEqualArea = function() {
      return nr(Uc)
    }).raw = Uc;
    var jc = mr(function(n) {
      var t = Math.acos(n);
      return t && t / Math.sin(t)
    }, wt);
    (Zo.geo.azimuthalEquidistant = function() {
      return nr(jc)
    }).raw = jc, (Zo.geo.conicConformal = function() {
      return He(yr)
    }).raw = yr, (Zo.geo.conicEquidistant = function() {
      return He(xr)
    }).raw = xr;
    var Hc = mr(function(n) {
      return 1 / n
    }, Math.atan);
    (Zo.geo.gnomonic = function() {
      return nr(Hc)
    }).raw = Hc, Mr.invert = function(n, t) {
      return [n, 2 * Math.atan(Math.exp(t)) - Sa]
    }, (Zo.geo.mercator = function() {
      return _r(Mr)
    }).raw = Mr;
    var Fc = mr(function() {
      return 1
    }, Math.asin);
    (Zo.geo.orthographic = function() {
      return nr(Fc)
    }).raw = Fc;
    var Oc = mr(function(n) {
      return 1 / (1 + n)
    }, function(n) {
      return 2 * Math.atan(n)
    });
    (Zo.geo.stereographic = function() {
      return nr(Oc)
    }).raw = Oc, br.invert = function(n, t) {
      return [-t, 2 * Math.atan(Math.exp(n)) - Sa]
    }, (Zo.geo.transverseMercator = function() {
      var n = _r(br),
        t = n.center,
        e = n.rotate;
      return n.center = function(n) {
        return n ? t([-n[1], n[0]]) : (n = t(), [n[1], -n[0]])
      }, n.rotate = function(n) {
        return n ? e([n[0], n[1], n.length > 2 ? n[2] + 90 : 90]) : (n = e(), [n[0], n[1], n[2] - 90])
      }, e([0, 0, 90])
    }).raw = br, Zo.geom = {}, Zo.geom.hull = function(n) {
      function t(n) {
        if (n.length < 3) return [];
        var t, u = bt(e),
          i = bt(r),
          o = n.length,
          a = [],
          c = [];
        for (t = 0; o > t; t++) a.push([+u.call(this, n[t], t), +i.call(this, n[t], t), t]);
        for (a.sort(Er), t = 0; o > t; t++) c.push([a[t][0], -a[t][1]]);
        var s = kr(a),
          l = kr(c),
          f = l[0] === s[0],
          h = l[l.length - 1] === s[s.length - 1],
          g = [];
        for (t = s.length - 1; t >= 0; --t) g.push(n[a[s[t]][2]]);
        for (t = +f; t < l.length - h; ++t) g.push(n[a[l[t]][2]]);
        return g
      }
      var e = wr,
        r = Sr;
      return arguments.length ? t(n) : (t.x = function(n) {
        return arguments.length ? (e = n, t) : e
      }, t.y = function(n) {
        return arguments.length ? (r = n, t) : r
      }, t)
    }, Zo.geom.polygon = function(n) {
      return sa(n, Yc), n
    };
    var Yc = Zo.geom.polygon.prototype = [];
    Yc.area = function() {
      for (var n, t = -1, e = this.length, r = this[e - 1], u = 0; ++t < e;) n = r, r = this[t], u += n[1] * r[0] - n[0] * r[1];
      return .5 * u
    }, Yc.centroid = function(n) {
      var t, e, r = -1,
        u = this.length,
        i = 0,
        o = 0,
        a = this[u - 1];
      for (arguments.length || (n = -1 / (6 * this.area())); ++r < u;) t = a, a = this[r], e = t[0] * a[1] - a[0] * t[1], i += (t[0] + a[0]) * e, o += (t[1] + a[1]) * e;
      return [i * n, o * n]
    }, Yc.clip = function(n) {
      for (var t, e, r, u, i, o, a = Nr(n), c = -1, s = this.length - Nr(this), l = this[s - 1]; ++c < s;) {
        for (t = n.slice(), n.length = 0, u = this[c], i = t[(r = t.length - a) - 1], e = -1; ++e < r;) o = t[e], Ar(o, l, u) ? (Ar(i, l, u) || n.push(Cr(i, o, l, u)), n.push(o)) : Ar(i, l, u) && n.push(Cr(i, o, l, u)), i = o;
        a && n.push(n[0]), l = u
      }
      return n
    };
    var Ic, Zc, Vc, Xc, $c, Bc = [],
      Wc = [];
    Ur.prototype.prepare = function() {
      for (var n, t = this.edges, e = t.length; e--;) n = t[e].edge, n.b && n.a || t.splice(e, 1);
      return t.sort(Hr), t.length
    }, Wr.prototype = {
      start: function() {
        return this.edge.l === this.site ? this.edge.a : this.edge.b
      },
      end: function() {
        return this.edge.l === this.site ? this.edge.b : this.edge.a
      }
    }, Jr.prototype = {
      insert: function(n, t) {
        var e, r, u;
        if (n) {
          if (t.P = n, t.N = n.N, n.N && (n.N.P = t), n.N = t, n.R) {
            for (n = n.R; n.L;) n = n.L;
            n.L = t
          } else n.R = t;
          e = n
        } else this._ ? (n = nu(this._), t.P = null, t.N = n, n.P = n.L = t, e = n) : (t.P = t.N = null, this._ = t, e = null);
        for (t.L = t.R = null, t.U = e, t.C = !0, n = t; e && e.C;) r = e.U, e === r.L ? (u = r.R, u && u.C ? (e.C = u.C = !1, r.C = !0, n = r) : (n === e.R && (Kr(this, e), n = e, e = n.U), e.C = !1, r.C = !0, Qr(this, r))) : (u = r.L, u && u.C ? (e.C = u.C = !1, r.C = !0, n = r) : (n === e.L && (Qr(this, e), n = e, e = n.U), e.C = !1, r.C = !0, Kr(this, r))), e = n.U;
        this._.C = !1
      },
      remove: function(n) {
        n.N && (n.N.P = n.P), n.P && (n.P.N = n.N), n.N = n.P = null;
        var t, e, r, u = n.U,
          i = n.L,
          o = n.R;
        if (e = i ? o ? nu(o) : i : o, u ? u.L === n ? u.L = e : u.R = e : this._ = e, i && o ? (r = e.C, e.C = n.C, e.L = i, i.U = e, e !== o ? (u = e.U, e.U = n.U, n = e.R, u.L = n, e.R = o, o.U = e) : (e.U = u, u = e, n = e.R)) : (r = n.C, n = e), n && (n.U = u), !r) {
          if (n && n.C) return n.C = !1, void 0;
          do {
            if (n === this._) break;
            if (n === u.L) {
              if (t = u.R, t.C && (t.C = !1, u.C = !0, Kr(this, u), t = u.R), t.L && t.L.C || t.R && t.R.C) {
                t.R && t.R.C || (t.L.C = !1, t.C = !0, Qr(this, t), t = u.R), t.C = u.C, u.C = t.R.C = !1, Kr(this, u), n = this._;
                break
              }
            } else if (t = u.L, t.C && (t.C = !1, u.C = !0, Qr(this, u), t = u.L), t.L && t.L.C || t.R && t.R.C) {
              t.L && t.L.C || (t.R.C = !1, t.C = !0, Kr(this, t), t = u.L), t.C = u.C, u.C = t.L.C = !1, Qr(this, u), n = this._;
              break
            }
            t.C = !0, n = u, u = u.U
          } while (!n.C);
          n && (n.C = !1)
        }
      }
    }, Zo.geom.voronoi = function(n) {
      function t(n) {
        var t = new Array(n.length),
          r = a[0][0],
          u = a[0][1],
          i = a[1][0],
          o = a[1][1];
        return tu(e(n), a).cells.forEach(function(e, a) {
          var c = e.edges,
            s = e.site,
            l = t[a] = c.length ? c.map(function(n) {
              var t = n.start();
              return [t.x, t.y]
            }) : s.x >= r && s.x <= i && s.y >= u && s.y <= o ? [
              [r, o],
              [i, o],
              [i, u],
              [r, u]
            ] : [];
          l.point = n[a]
        }), t
      }

      function e(n) {
        return n.map(function(n, t) {
          return {
            x: Math.round(i(n, t) / ka) * ka,
            y: Math.round(o(n, t) / ka) * ka,
            i: t
          }
        })
      }
      var r = wr,
        u = Sr,
        i = r,
        o = u,
        a = Jc;
      return n ? t(n) : (t.links = function(n) {
        return tu(e(n)).edges.filter(function(n) {
          return n.l && n.r
        }).map(function(t) {
          return {
            source: n[t.l.i],
            target: n[t.r.i]
          }
        })
      }, t.triangles = function(n) {
        var t = [];
        return tu(e(n)).cells.forEach(function(e, r) {
          for (var u, i, o = e.site, a = e.edges.sort(Hr), c = -1, s = a.length, l = a[s - 1].edge, f = l.l === o ? l.r : l.l; ++c < s;) u = l, i = f, l = a[c].edge, f = l.l === o ? l.r : l.l, r < i.i && r < f.i && ru(o, i, f) < 0 && t.push([n[r], n[i.i], n[f.i]])
        }), t
      }, t.x = function(n) {
        return arguments.length ? (i = bt(r = n), t) : r
      }, t.y = function(n) {
        return arguments.length ? (o = bt(u = n), t) : u
      }, t.clipExtent = function(n) {
        return arguments.length ? (a = null == n ? Jc : n, t) : a === Jc ? null : a
      }, t.size = function(n) {
        return arguments.length ? t.clipExtent(n && [
          [0, 0], n
        ]) : a === Jc ? null : a && a[1]
      }, t)
    };
    var Jc = [
      [-1e6, -1e6],
      [1e6, 1e6]
    ];
    Zo.geom.delaunay = function(n) {
      return Zo.geom.voronoi().triangles(n)
    }, Zo.geom.quadtree = function(n, t, e, r, u) {
      function i(n) {
        function i(n, t, e, r, u, i, o, a) {
          if (!isNaN(e) && !isNaN(r))
            if (n.leaf) {
              var c = n.x,
                l = n.y;
              if (null != c)
                if (ua(c - e) + ua(l - r) < .01) s(n, t, e, r, u, i, o, a);
                else {
                  var f = n.point;
                  n.x = n.y = n.point = null, s(n, f, c, l, u, i, o, a), s(n, t, e, r, u, i, o, a)
                }
              else n.x = e, n.y = r, n.point = t
            } else s(n, t, e, r, u, i, o, a)
        }

        function s(n, t, e, r, u, o, a, c) {
          var s = .5 * (u + a),
            l = .5 * (o + c),
            f = e >= s,
            h = r >= l,
            g = (h << 1) + f;
          n.leaf = !1, n = n.nodes[g] || (n.nodes[g] = ou()), f ? u = s : a = s, h ? o = l : c = l, i(n, t, e, r, u, o, a, c)
        }
        var l, f, h, g, p, v, d, m, y, x = bt(a),
          M = bt(c);
        if (null != t) v = t, d = e, m = r, y = u;
        else if (m = y = -(v = d = 1 / 0), f = [], h = [], p = n.length, o)
          for (g = 0; p > g; ++g) l = n[g], l.x < v && (v = l.x), l.y < d && (d = l.y), l.x > m && (m = l.x), l.y > y && (y = l.y), f.push(l.x), h.push(l.y);
        else
          for (g = 0; p > g; ++g) {
            var _ = +x(l = n[g], g),
              b = +M(l, g);
            v > _ && (v = _), d > b && (d = b), _ > m && (m = _), b > y && (y = b), f.push(_), h.push(b)
          }
        var w = m - v,
          S = y - d;
        w > S ? y = d + w : m = v + S;
        var k = ou();
        if (k.add = function(n) {
            i(k, n, +x(n, ++g), +M(n, g), v, d, m, y)
          }, k.visit = function(n) {
            au(n, k, v, d, m, y)
          }, g = -1, null == t) {
          for (; ++g < p;) i(k, n[g], f[g], h[g], v, d, m, y);
          --g
        } else n.forEach(k.add);
        return f = h = n = l = null, k
      }
      var o, a = wr,
        c = Sr;
      return (o = arguments.length) ? (a = uu, c = iu, 3 === o && (u = e, r = t, e = t = 0), i(n)) : (i.x = function(n) {
        return arguments.length ? (a = n, i) : a
      }, i.y = function(n) {
        return arguments.length ? (c = n, i) : c
      }, i.extent = function(n) {
        return arguments.length ? (null == n ? t = e = r = u = null : (t = +n[0][0], e = +n[0][1], r = +n[1][0], u = +n[1][1]), i) : null == t ? null : [
          [t, e],
          [r, u]
        ]
      }, i.size = function(n) {
        return arguments.length ? (null == n ? t = e = r = u = null : (t = e = 0, r = +n[0], u = +n[1]), i) : null == t ? null : [r - t, u - e]
      }, i)
    }, Zo.interpolateRgb = cu, Zo.interpolateObject = su, Zo.interpolateNumber = lu, Zo.interpolateString = fu;
    var Gc = /[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,
      Kc = new RegExp(Gc.source, "g");
    Zo.interpolate = hu, Zo.interpolators = [function(n, t) {
      var e = typeof t;
      return ("string" === e ? Ia.has(t) || /^(#|rgb\(|hsl\()/.test(t) ? cu : fu : t instanceof et ? cu : Array.isArray(t) ? gu : "object" === e && isNaN(t) ? su : lu)(n, t)
    }], Zo.interpolateArray = gu;
    var Qc = function() {
        return wt
      },
      ns = Zo.map({
        linear: Qc,
        poly: Mu,
        quad: function() {
          return mu
        },
        cubic: function() {
          return yu
        },
        sin: function() {
          return _u
        },
        exp: function() {
          return bu
        },
        circle: function() {
          return wu
        },
        elastic: Su,
        back: ku,
        bounce: function() {
          return Eu
        }
      }),
      ts = Zo.map({
        "in": wt,
        out: vu,
        "in-out": du,
        "out-in": function(n) {
          return du(vu(n))
        }
      });
    Zo.ease = function(n) {
      var t = n.indexOf("-"),
        e = t >= 0 ? n.substring(0, t) : n,
        r = t >= 0 ? n.substring(t + 1) : "in";
      return e = ns.get(e) || Qc, r = ts.get(r) || wt, pu(r(e.apply(null, Vo.call(arguments, 1))))
    }, Zo.interpolateHcl = Au, Zo.interpolateHsl = Cu, Zo.interpolateLab = Nu, Zo.interpolateRound = zu, Zo.transform = function(n) {
      var t = $o.createElementNS(Zo.ns.prefix.svg, "g");
      return (Zo.transform = function(n) {
        if (null != n) {
          t.setAttribute("transform", n);
          var e = t.transform.baseVal.consolidate()
        }
        return new Lu(e ? e.matrix : es)
      })(n)
    }, Lu.prototype.toString = function() {
      return "translate(" + this.translate + ")rotate(" + this.rotate + ")skewX(" + this.skew + ")scale(" + this.scale + ")"
    };
    var es = {
      a: 1,
      b: 0,
      c: 0,
      d: 1,
      e: 0,
      f: 0
    };
    Zo.interpolateTransform = Du, Zo.layout = {}, Zo.layout.bundle = function() {
      return function(n) {
        for (var t = [], e = -1, r = n.length; ++e < r;) t.push(ju(n[e]));
        return t
      }
    }, Zo.layout.chord = function() {
      function n() {
        var n, s, f, h, g, p = {},
          v = [],
          d = Zo.range(i),
          m = [];
        for (e = [], r = [], n = 0, h = -1; ++h < i;) {
          for (s = 0, g = -1; ++g < i;) s += u[h][g];
          v.push(s), m.push(Zo.range(i)), n += s
        }
        for (o && d.sort(function(n, t) {
            return o(v[n], v[t])
          }), a && m.forEach(function(n, t) {
            n.sort(function(n, e) {
              return a(u[t][n], u[t][e])
            })
          }), n = (wa - l * i) / n, s = 0, h = -1; ++h < i;) {
          for (f = s, g = -1; ++g < i;) {
            var y = d[h],
              x = m[y][g],
              M = u[y][x],
              _ = s,
              b = s += M * n;
            p[y + "-" + x] = {
              index: y,
              subindex: x,
              startAngle: _,
              endAngle: b,
              value: M
            }
          }
          r[y] = {
            index: y,
            startAngle: f,
            endAngle: s,
            value: (s - f) / n
          }, s += l
        }
        for (h = -1; ++h < i;)
          for (g = h - 1; ++g < i;) {
            var w = p[h + "-" + g],
              S = p[g + "-" + h];
            (w.value || S.value) && e.push(w.value < S.value ? {
              source: S,
              target: w
            } : {
              source: w,
              target: S
            })
          }
        c && t()
      }

      function t() {
        e.sort(function(n, t) {
          return c((n.source.value + n.target.value) / 2, (t.source.value + t.target.value) / 2)
        })
      }
      var e, r, u, i, o, a, c, s = {},
        l = 0;
      return s.matrix = function(n) {
        return arguments.length ? (i = (u = n) && u.length, e = r = null, s) : u
      }, s.padding = function(n) {
        return arguments.length ? (l = n, e = r = null, s) : l
      }, s.sortGroups = function(n) {
        return arguments.length ? (o = n, e = r = null, s) : o
      }, s.sortSubgroups = function(n) {
        return arguments.length ? (a = n, e = null, s) : a
      }, s.sortChords = function(n) {
        return arguments.length ? (c = n, e && t(), s) : c
      }, s.chords = function() {
        return e || n(), e
      }, s.groups = function() {
        return r || n(), r
      }, s
    }, Zo.layout.force = function() {
      function n(n) {
        return function(t, e, r, u) {
          if (t.point !== n) {
            var i = t.cx - n.x,
              o = t.cy - n.y,
              a = u - e,
              c = i * i + o * o;
            if (c > a * a / d) {
              if (p > c) {
                var s = t.charge / c;
                n.px -= i * s, n.py -= o * s
              }
              return !0
            }
            if (t.point && c && p > c) {
              var s = t.pointCharge / c;
              n.px -= i * s, n.py -= o * s
            }
          }
          return !t.charge
        }
      }

      function t(n) {
        n.px = Zo.event.x, n.py = Zo.event.y, a.resume()
      }
      var e, r, u, i, o, a = {},
        c = Zo.dispatch("start", "tick", "end"),
        s = [1, 1],
        l = .9,
        f = rs,
        h = us,
        g = -30,
        p = is,
        v = .1,
        d = .64,
        m = [],
        y = [];
      return a.tick = function() {
        if ((r *= .99) < .005) return c.end({
          type: "end",
          alpha: r = 0
        }), !0;
        var t, e, a, f, h, p, d, x, M, _ = m.length,
          b = y.length;
        for (e = 0; b > e; ++e) a = y[e], f = a.source, h = a.target, x = h.x - f.x, M = h.y - f.y, (p = x * x + M * M) && (p = r * i[e] * ((p = Math.sqrt(p)) - u[e]) / p, x *= p, M *= p, h.x -= x * (d = f.weight / (h.weight + f.weight)), h.y -= M * d, f.x += x * (d = 1 - d), f.y += M * d);
        if ((d = r * v) && (x = s[0] / 2, M = s[1] / 2, e = -1, d))
          for (; ++e < _;) a = m[e], a.x += (x - a.x) * d, a.y += (M - a.y) * d;
        if (g)
          for (Vu(t = Zo.geom.quadtree(m), r, o), e = -1; ++e < _;)(a = m[e]).fixed || t.visit(n(a));
        for (e = -1; ++e < _;) a = m[e], a.fixed ? (a.x = a.px, a.y = a.py) : (a.x -= (a.px - (a.px = a.x)) * l, a.y -= (a.py - (a.py = a.y)) * l);
        c.tick({
          type: "tick",
          alpha: r
        })
      }, a.nodes = function(n) {
        return arguments.length ? (m = n, a) : m
      }, a.links = function(n) {
        return arguments.length ? (y = n, a) : y
      }, a.size = function(n) {
        return arguments.length ? (s = n, a) : s
      }, a.linkDistance = function(n) {
        return arguments.length ? (f = "function" == typeof n ? n : +n, a) : f
      }, a.distance = a.linkDistance, a.linkStrength = function(n) {
        return arguments.length ? (h = "function" == typeof n ? n : +n, a) : h
      }, a.friction = function(n) {
        return arguments.length ? (l = +n, a) : l
      }, a.charge = function(n) {
        return arguments.length ? (g = "function" == typeof n ? n : +n, a) : g
      }, a.chargeDistance = function(n) {
        return arguments.length ? (p = n * n, a) : Math.sqrt(p)
      }, a.gravity = function(n) {
        return arguments.length ? (v = +n, a) : v
      }, a.theta = function(n) {
        return arguments.length ? (d = n * n, a) : Math.sqrt(d)
      }, a.alpha = function(n) {
        return arguments.length ? (n = +n, r ? r = n > 0 ? n : 0 : n > 0 && (c.start({
          type: "start",
          alpha: r = n
        }), Zo.timer(a.tick)), a) : r
      }, a.start = function() {
        function n(n, r) {
          if (!e) {
            for (e = new Array(c), a = 0; c > a; ++a) e[a] = [];
            for (a = 0; s > a; ++a) {
              var u = y[a];
              e[u.source.index].push(u.target), e[u.target.index].push(u.source)
            }
          }
          for (var i, o = e[t], a = -1, s = o.length; ++a < s;)
            if (!isNaN(i = o[a][n])) return i;
          return Math.random() * r
        }
        var t, e, r, c = m.length,
          l = y.length,
          p = s[0],
          v = s[1];
        for (t = 0; c > t; ++t)(r = m[t]).index = t, r.weight = 0;
        for (t = 0; l > t; ++t) r = y[t], "number" == typeof r.source && (r.source = m[r.source]), "number" == typeof r.target && (r.target = m[r.target]), ++r.source.weight, ++r.target.weight;
        for (t = 0; c > t; ++t) r = m[t], isNaN(r.x) && (r.x = n("x", p)), isNaN(r.y) && (r.y = n("y", v)), isNaN(r.px) && (r.px = r.x), isNaN(r.py) && (r.py = r.y);
        if (u = [], "function" == typeof f)
          for (t = 0; l > t; ++t) u[t] = +f.call(this, y[t], t);
        else
          for (t = 0; l > t; ++t) u[t] = f;
        if (i = [], "function" == typeof h)
          for (t = 0; l > t; ++t) i[t] = +h.call(this, y[t], t);
        else
          for (t = 0; l > t; ++t) i[t] = h;
        if (o = [], "function" == typeof g)
          for (t = 0; c > t; ++t) o[t] = +g.call(this, m[t], t);
        else
          for (t = 0; c > t; ++t) o[t] = g;
        return a.resume()
      }, a.resume = function() {
        return a.alpha(.1)
      }, a.stop = function() {
        return a.alpha(0)
      }, a.drag = function() {
        return e || (e = Zo.behavior.drag().origin(wt).on("dragstart.force", Ou).on("drag.force", t).on("dragend.force", Yu)), arguments.length ? (this.on("mouseover.force", Iu).on("mouseout.force", Zu).call(e), void 0) : e
      }, Zo.rebind(a, c, "on")
    };
    var rs = 20,
      us = 1,
      is = 1 / 0;
    Zo.layout.hierarchy = function() {
      function n(u) {
        var i, o = [u],
          a = [];
        for (u.depth = 0; null != (i = o.pop());)
          if (a.push(i), (s = e.call(n, i, i.depth)) && (c = s.length)) {
            for (var c, s, l; --c >= 0;) o.push(l = s[c]), l.parent = i, l.depth = i.depth + 1;
            r && (i.value = 0), i.children = s
          } else r && (i.value = +r.call(n, i, i.depth) || 0), delete i.children;
        return Bu(u, function(n) {
          var e, u;
          t && (e = n.children) && e.sort(t), r && (u = n.parent) && (u.value += n.value)
        }), a
      }
      var t = Gu,
        e = Wu,
        r = Ju;
      return n.sort = function(e) {
        return arguments.length ? (t = e, n) : t
      }, n.children = function(t) {
        return arguments.length ? (e = t, n) : e
      }, n.value = function(t) {
        return arguments.length ? (r = t, n) : r
      }, n.revalue = function(t) {
        return r && ($u(t, function(n) {
          n.children && (n.value = 0)
        }), Bu(t, function(t) {
          var e;
          t.children || (t.value = +r.call(n, t, t.depth) || 0), (e = t.parent) && (e.value += t.value)
        })), t
      }, n
    }, Zo.layout.partition = function() {
      function n(t, e, r, u) {
        var i = t.children;
        if (t.x = e, t.y = t.depth * u, t.dx = r, t.dy = u, i && (o = i.length)) {
          var o, a, c, s = -1;
          for (r = t.value ? r / t.value : 0; ++s < o;) n(a = i[s], e, c = a.value * r, u), e += c
        }
      }

      function t(n) {
        var e = n.children,
          r = 0;
        if (e && (u = e.length))
          for (var u, i = -1; ++i < u;) r = Math.max(r, t(e[i]));
        return 1 + r
      }

      function e(e, i) {
        var o = r.call(this, e, i);
        return n(o[0], 0, u[0], u[1] / t(o[0])), o
      }
      var r = Zo.layout.hierarchy(),
        u = [1, 1];
      return e.size = function(n) {
        return arguments.length ? (u = n, e) : u
      }, Xu(e, r)
    }, Zo.layout.pie = function() {
      function n(i) {
        var o = i.map(function(e, r) {
            return +t.call(n, e, r)
          }),
          a = +("function" == typeof r ? r.apply(this, arguments) : r),
          c = (("function" == typeof u ? u.apply(this, arguments) : u) - a) / Zo.sum(o),
          s = Zo.range(i.length);
        null != e && s.sort(e === os ? function(n, t) {
          return o[t] - o[n]
        } : function(n, t) {
          return e(i[n], i[t])
        });
        var l = [];
        return s.forEach(function(n) {
          var t;
          l[n] = {
            data: i[n],
            value: t = o[n],
            startAngle: a,
            endAngle: a += t * c
          }
        }), l
      }
      var t = Number,
        e = os,
        r = 0,
        u = wa;
      return n.value = function(e) {
        return arguments.length ? (t = e, n) : t
      }, n.sort = function(t) {
        return arguments.length ? (e = t, n) : e
      }, n.startAngle = function(t) {
        return arguments.length ? (r = t, n) : r
      }, n.endAngle = function(t) {
        return arguments.length ? (u = t, n) : u
      }, n
    };
    var os = {};
    Zo.layout.stack = function() {
      function n(a, c) {
        var s = a.map(function(e, r) {
            return t.call(n, e, r)
          }),
          l = s.map(function(t) {
            return t.map(function(t, e) {
              return [i.call(n, t, e), o.call(n, t, e)]
            })
          }),
          f = e.call(n, l, c);
        s = Zo.permute(s, f), l = Zo.permute(l, f);
        var h, g, p, v = r.call(n, l, c),
          d = s.length,
          m = s[0].length;
        for (g = 0; m > g; ++g)
          for (u.call(n, s[0][g], p = v[g], l[0][g][1]), h = 1; d > h; ++h) u.call(n, s[h][g], p += l[h - 1][g][1], l[h][g][1]);
        return a
      }
      var t = wt,
        e = ei,
        r = ri,
        u = ti,
        i = Qu,
        o = ni;
      return n.values = function(e) {
        return arguments.length ? (t = e, n) : t
      }, n.order = function(t) {
        return arguments.length ? (e = "function" == typeof t ? t : as.get(t) || ei, n) : e
      }, n.offset = function(t) {
        return arguments.length ? (r = "function" == typeof t ? t : cs.get(t) || ri, n) : r
      }, n.x = function(t) {
        return arguments.length ? (i = t, n) : i
      }, n.y = function(t) {
        return arguments.length ? (o = t, n) : o
      }, n.out = function(t) {
        return arguments.length ? (u = t, n) : u
      }, n
    };
    var as = Zo.map({
        "inside-out": function(n) {
          var t, e, r = n.length,
            u = n.map(ui),
            i = n.map(ii),
            o = Zo.range(r).sort(function(n, t) {
              return u[n] - u[t]
            }),
            a = 0,
            c = 0,
            s = [],
            l = [];
          for (t = 0; r > t; ++t) e = o[t], c > a ? (a += i[e], s.push(e)) : (c += i[e], l.push(e));
          return l.reverse().concat(s)
        },
        reverse: function(n) {
          return Zo.range(n.length).reverse()
        },
        "default": ei
      }),
      cs = Zo.map({
        silhouette: function(n) {
          var t, e, r, u = n.length,
            i = n[0].length,
            o = [],
            a = 0,
            c = [];
          for (e = 0; i > e; ++e) {
            for (t = 0, r = 0; u > t; t++) r += n[t][e][1];
            r > a && (a = r), o.push(r)
          }
          for (e = 0; i > e; ++e) c[e] = (a - o[e]) / 2;
          return c
        },
        wiggle: function(n) {
          var t, e, r, u, i, o, a, c, s, l = n.length,
            f = n[0],
            h = f.length,
            g = [];
          for (g[0] = c = s = 0, e = 1; h > e; ++e) {
            for (t = 0, u = 0; l > t; ++t) u += n[t][e][1];
            for (t = 0, i = 0, a = f[e][0] - f[e - 1][0]; l > t; ++t) {
              for (r = 0, o = (n[t][e][1] - n[t][e - 1][1]) / (2 * a); t > r; ++r) o += (n[r][e][1] - n[r][e - 1][1]) / a;
              i += o * n[t][e][1]
            }
            g[e] = c -= u ? i / u * a : 0, s > c && (s = c)
          }
          for (e = 0; h > e; ++e) g[e] -= s;
          return g
        },
        expand: function(n) {
          var t, e, r, u = n.length,
            i = n[0].length,
            o = 1 / u,
            a = [];
          for (e = 0; i > e; ++e) {
            for (t = 0, r = 0; u > t; t++) r += n[t][e][1];
            if (r)
              for (t = 0; u > t; t++) n[t][e][1] /= r;
            else
              for (t = 0; u > t; t++) n[t][e][1] = o
          }
          for (e = 0; i > e; ++e) a[e] = 0;
          return a
        },
        zero: ri
      });
    Zo.layout.histogram = function() {
      function n(n, i) {
        for (var o, a, c = [], s = n.map(e, this), l = r.call(this, s, i), f = u.call(this, l, s, i), i = -1, h = s.length, g = f.length - 1, p = t ? 1 : 1 / h; ++i < g;) o = c[i] = [], o.dx = f[i + 1] - (o.x = f[i]), o.y = 0;
        if (g > 0)
          for (i = -1; ++i < h;) a = s[i], a >= l[0] && a <= l[1] && (o = c[Zo.bisect(f, a, 1, g) - 1], o.y += p, o.push(n[i]));
        return c
      }
      var t = !0,
        e = Number,
        r = si,
        u = ai;
      return n.value = function(t) {
        return arguments.length ? (e = t, n) : e
      }, n.range = function(t) {
        return arguments.length ? (r = bt(t), n) : r
      }, n.bins = function(t) {
        return arguments.length ? (u = "number" == typeof t ? function(n) {
          return ci(n, t)
        } : bt(t), n) : u
      }, n.frequency = function(e) {
        return arguments.length ? (t = !!e, n) : t
      }, n
    }, Zo.layout.pack = function() {
      function n(n, i) {
        var o = e.call(this, n, i),
          a = o[0],
          c = u[0],
          s = u[1],
          l = null == t ? Math.sqrt : "function" == typeof t ? t : function() {
            return t
          };
        if (a.x = a.y = 0, Bu(a, function(n) {
            n.r = +l(n.value)
          }), Bu(a, pi), r) {
          var f = r * (t ? 1 : Math.max(2 * a.r / c, 2 * a.r / s)) / 2;
          Bu(a, function(n) {
            n.r += f
          }), Bu(a, pi), Bu(a, function(n) {
            n.r -= f
          })
        }
        return mi(a, c / 2, s / 2, t ? 1 : 1 / Math.max(2 * a.r / c, 2 * a.r / s)), o
      }
      var t, e = Zo.layout.hierarchy().sort(li),
        r = 0,
        u = [1, 1];
      return n.size = function(t) {
        return arguments.length ? (u = t, n) : u
      }, n.radius = function(e) {
        return arguments.length ? (t = null == e || "function" == typeof e ? e : +e, n) : t
      }, n.padding = function(t) {
        return arguments.length ? (r = +t, n) : r
      }, Xu(n, e)
    }, Zo.layout.tree = function() {
      function n(n, u) {
        var l = o.call(this, n, u),
          f = l[0],
          h = t(f);
        if (Bu(h, e), h.parent.m = -h.z, $u(h, r), s) $u(f, i);
        else {
          var g = f,
            p = f,
            v = f;
          $u(f, function(n) {
            n.x < g.x && (g = n), n.x > p.x && (p = n), n.depth > v.depth && (v = n)
          });
          var d = a(g, p) / 2 - g.x,
            m = c[0] / (p.x + a(p, g) / 2 + d),
            y = c[1] / (v.depth || 1);
          $u(f, function(n) {
            n.x = (n.x + d) * m, n.y = n.depth * y
          })
        }
        return l
      }

      function t(n) {
        for (var t, e = {
            A: null,
            children: [n]
          }, r = [e]; null != (t = r.pop());)
          for (var u, i = t.children, o = 0, a = i.length; a > o; ++o) r.push((i[o] = u = {
            _: i[o],
            parent: t,
            children: (u = i[o].children) && u.slice() || [],
            A: null,
            a: null,
            z: 0,
            m: 0,
            c: 0,
            s: 0,
            t: null,
            i: o
          }).a = u);
        return e.children[0]
      }

      function e(n) {
        var t = n.children,
          e = n.parent.children,
          r = n.i ? e[n.i - 1] : null;
        if (t.length) {
          wi(n);
          var i = (t[0].z + t[t.length - 1].z) / 2;
          r ? (n.z = r.z + a(n._, r._), n.m = n.z - i) : n.z = i
        } else r && (n.z = r.z + a(n._, r._));
        n.parent.A = u(n, r, n.parent.A || e[0])
      }

      function r(n) {
        n._.x = n.z + n.parent.m, n.m += n.parent.m
      }

      function u(n, t, e) {
        if (t) {
          for (var r, u = n, i = n, o = t, c = u.parent.children[0], s = u.m, l = i.m, f = o.m, h = c.m; o = _i(o), u = Mi(u), o && u;) c = Mi(c), i = _i(i), i.a = n, r = o.z + f - u.z - s + a(o._, u._), r > 0 && (bi(Si(o, n, e), n, r), s += r, l += r), f += o.m, s += u.m, h += c.m, l += i.m;
          o && !_i(i) && (i.t = o, i.m += f - l), u && !Mi(c) && (c.t = u, c.m += s - h, e = n)
        }
        return e
      }

      function i(n) {
        n.x *= c[0], n.y = n.depth * c[1]
      }
      var o = Zo.layout.hierarchy().sort(null).value(null),
        a = xi,
        c = [1, 1],
        s = null;
      return n.separation = function(t) {
        return arguments.length ? (a = t, n) : a
      }, n.size = function(t) {
        return arguments.length ? (s = null == (c = t) ? i : null, n) : s ? null : c
      }, n.nodeSize = function(t) {
        return arguments.length ? (s = null == (c = t) ? null : i, n) : s ? c : null
      }, Xu(n, o)
    }, Zo.layout.cluster = function() {
      function n(n, i) {
        var o, a = t.call(this, n, i),
          c = a[0],
          s = 0;
        Bu(c, function(n) {
          var t = n.children;
          t && t.length ? (n.x = Ei(t), n.y = ki(t)) : (n.x = o ? s += e(n, o) : 0, n.y = 0, o = n)
        });
        var l = Ai(c),
          f = Ci(c),
          h = l.x - e(l, f) / 2,
          g = f.x + e(f, l) / 2;
        return Bu(c, u ? function(n) {
          n.x = (n.x - c.x) * r[0], n.y = (c.y - n.y) * r[1]
        } : function(n) {
          n.x = (n.x - h) / (g - h) * r[0], n.y = (1 - (c.y ? n.y / c.y : 1)) * r[1]
        }), a
      }
      var t = Zo.layout.hierarchy().sort(null).value(null),
        e = xi,
        r = [1, 1],
        u = !1;
      return n.separation = function(t) {
        return arguments.length ? (e = t, n) : e
      }, n.size = function(t) {
        return arguments.length ? (u = null == (r = t), n) : u ? null : r
      }, n.nodeSize = function(t) {
        return arguments.length ? (u = null != (r = t), n) : u ? r : null
      }, Xu(n, t)
    }, Zo.layout.treemap = function() {
      function n(n, t) {
        for (var e, r, u = -1, i = n.length; ++u < i;) r = (e = n[u]).value * (0 > t ? 0 : t), e.area = isNaN(r) || 0 >= r ? 0 : r
      }

      function t(e) {
        var i = e.children;
        if (i && i.length) {
          var o, a, c, s = f(e),
            l = [],
            h = i.slice(),
            p = 1 / 0,
            v = "slice" === g ? s.dx : "dice" === g ? s.dy : "slice-dice" === g ? 1 & e.depth ? s.dy : s.dx : Math.min(s.dx, s.dy);
          for (n(h, s.dx * s.dy / e.value), l.area = 0;
            (c = h.length) > 0;) l.push(o = h[c - 1]), l.area += o.area, "squarify" !== g || (a = r(l, v)) <= p ? (h.pop(), p = a) : (l.area -= l.pop().area, u(l, v, s, !1), v = Math.min(s.dx, s.dy), l.length = l.area = 0, p = 1 / 0);
          l.length && (u(l, v, s, !0), l.length = l.area = 0), i.forEach(t)
        }
      }

      function e(t) {
        var r = t.children;
        if (r && r.length) {
          var i, o = f(t),
            a = r.slice(),
            c = [];
          for (n(a, o.dx * o.dy / t.value), c.area = 0; i = a.pop();) c.push(i), c.area += i.area, null != i.z && (u(c, i.z ? o.dx : o.dy, o, !a.length), c.length = c.area = 0);
          r.forEach(e)
        }
      }

      function r(n, t) {
        for (var e, r = n.area, u = 0, i = 1 / 0, o = -1, a = n.length; ++o < a;)(e = n[o].area) && (i > e && (i = e), e > u && (u = e));
        return r *= r, t *= t, r ? Math.max(t * u * p / r, r / (t * i * p)) : 1 / 0
      }

      function u(n, t, e, r) {
        var u, i = -1,
          o = n.length,
          a = e.x,
          s = e.y,
          l = t ? c(n.area / t) : 0;
        if (t == e.dx) {
          for ((r || l > e.dy) && (l = e.dy); ++i < o;) u = n[i], u.x = a, u.y = s, u.dy = l, a += u.dx = Math.min(e.x + e.dx - a, l ? c(u.area / l) : 0);
          u.z = !0, u.dx += e.x + e.dx - a, e.y += l, e.dy -= l
        } else {
          for ((r || l > e.dx) && (l = e.dx); ++i < o;) u = n[i], u.x = a, u.y = s, u.dx = l, s += u.dy = Math.min(e.y + e.dy - s, l ? c(u.area / l) : 0);
          u.z = !1, u.dy += e.y + e.dy - s, e.x += l, e.dx -= l
        }
      }

      function i(r) {
        var u = o || a(r),
          i = u[0];
        return i.x = 0, i.y = 0, i.dx = s[0], i.dy = s[1], o && a.revalue(i), n([i], i.dx * i.dy / i.value), (o ? e : t)(i), h && (o = u), u
      }
      var o, a = Zo.layout.hierarchy(),
        c = Math.round,
        s = [1, 1],
        l = null,
        f = Ni,
        h = !1,
        g = "squarify",
        p = .5 * (1 + Math.sqrt(5));
      return i.size = function(n) {
        return arguments.length ? (s = n, i) : s
      }, i.padding = function(n) {
        function t(t) {
          var e = n.call(i, t, t.depth);
          return null == e ? Ni(t) : zi(t, "number" == typeof e ? [e, e, e, e] : e)
        }

        function e(t) {
          return zi(t, n)
        }
        if (!arguments.length) return l;
        var r;
        return f = null == (l = n) ? Ni : "function" == (r = typeof n) ? t : "number" === r ? (n = [n, n, n, n], e) : e, i
      }, i.round = function(n) {
        return arguments.length ? (c = n ? Math.round : Number, i) : c != Number
      }, i.sticky = function(n) {
        return arguments.length ? (h = n, o = null, i) : h
      }, i.ratio = function(n) {
        return arguments.length ? (p = n, i) : p
      }, i.mode = function(n) {
        return arguments.length ? (g = n + "", i) : g
      }, Xu(i, a)
    }, Zo.random = {
      normal: function(n, t) {
        var e = arguments.length;
        return 2 > e && (t = 1), 1 > e && (n = 0),
          function() {
            var e, r, u;
            do e = 2 * Math.random() - 1, r = 2 * Math.random() - 1, u = e * e + r * r; while (!u || u > 1);
            return n + t * e * Math.sqrt(-2 * Math.log(u) / u)
          }
      },
      logNormal: function() {
        var n = Zo.random.normal.apply(Zo, arguments);
        return function() {
          return Math.exp(n())
        }
      },
      bates: function(n) {
        var t = Zo.random.irwinHall(n);
        return function() {
          return t() / n
        }
      },
      irwinHall: function(n) {
        return function() {
          for (var t = 0, e = 0; n > e; e++) t += Math.random();
          return t
        }
      }
    }, Zo.scale = {};
    var ss = {
      floor: wt,
      ceil: wt
    };
    Zo.scale.linear = function() {
      return Ui([0, 1], [0, 1], hu, !1)
    };
    var ls = {
      s: 1,
      g: 1,
      p: 1,
      r: 1,
      e: 1
    };
    Zo.scale.log = function() {
      return Vi(Zo.scale.linear().domain([0, 1]), 10, !0, [1, 10])
    };
    var fs = Zo.format(".0e"),
      hs = {
        floor: function(n) {
          return -Math.ceil(-n)
        },
        ceil: function(n) {
          return -Math.floor(-n)
        }
      };
    Zo.scale.pow = function() {
      return Xi(Zo.scale.linear(), 1, [0, 1])
    }, Zo.scale.sqrt = function() {
      return Zo.scale.pow().exponent(.5)
    }, Zo.scale.ordinal = function() {
      return Bi([], {
        t: "range",
        a: [
          []
        ]
      })
    }, Zo.scale.category10 = function() {
      return Zo.scale.ordinal().range(gs)
    }, Zo.scale.category20 = function() {
      return Zo.scale.ordinal().range(ps)
    }, Zo.scale.category20b = function() {
      return Zo.scale.ordinal().range(vs)
    }, Zo.scale.category20c = function() {
      return Zo.scale.ordinal().range(ds)
    };
    var gs = [2062260, 16744206, 2924588, 14034728, 9725885, 9197131, 14907330, 8355711, 12369186, 1556175].map(vt),
      ps = [2062260, 11454440, 16744206, 16759672, 2924588, 10018698, 14034728, 16750742, 9725885, 12955861, 9197131, 12885140, 14907330, 16234194, 8355711, 13092807, 12369186, 14408589, 1556175, 10410725].map(vt),
      vs = [3750777, 5395619, 7040719, 10264286, 6519097, 9216594, 11915115, 13556636, 9202993, 12426809, 15186514, 15190932, 8666169, 11356490, 14049643, 15177372, 8077683, 10834324, 13528509, 14589654].map(vt),
      ds = [3244733, 7057110, 10406625, 13032431, 15095053, 16616764, 16625259, 16634018, 3253076, 7652470, 10607003, 13101504, 7695281, 10394312, 12369372, 14342891, 6513507, 9868950, 12434877, 14277081].map(vt);
    Zo.scale.quantile = function() {
      return Wi([], [])
    }, Zo.scale.quantize = function() {
      return Ji(0, 1, [0, 1])
    }, Zo.scale.threshold = function() {
      return Gi([.5], [0, 1])
    }, Zo.scale.identity = function() {
      return Ki([0, 1])
    }, Zo.svg = {}, Zo.svg.arc = function() {
      function n() {
        var n = t.apply(this, arguments),
          i = e.apply(this, arguments),
          o = r.apply(this, arguments) + ms,
          a = u.apply(this, arguments) + ms,
          c = (o > a && (c = o, o = a, a = c), a - o),
          s = ba > c ? "0" : "1",
          l = Math.cos(o),
          f = Math.sin(o),
          h = Math.cos(a),
          g = Math.sin(a);
        return c >= ys ? n ? "M0," + i + "A" + i + "," + i + " 0 1,1 0," + -i + "A" + i + "," + i + " 0 1,1 0," + i + "M0," + n + "A" + n + "," + n + " 0 1,0 0," + -n + "A" + n + "," + n + " 0 1,0 0," + n + "Z" : "M0," + i + "A" + i + "," + i + " 0 1,1 0," + -i + "A" + i + "," + i + " 0 1,1 0," + i + "Z" : n ? "M" + i * l + "," + i * f + "A" + i + "," + i + " 0 " + s + ",1 " + i * h + "," + i * g + "L" + n * h + "," + n * g + "A" + n + "," + n + " 0 " + s + ",0 " + n * l + "," + n * f + "Z" : "M" + i * l + "," + i * f + "A" + i + "," + i + " 0 " + s + ",1 " + i * h + "," + i * g + "L0,0" + "Z"
      }
      var t = Qi,
        e = no,
        r = to,
        u = eo;
      return n.innerRadius = function(e) {
        return arguments.length ? (t = bt(e), n) : t
      }, n.outerRadius = function(t) {
        return arguments.length ? (e = bt(t), n) : e
      }, n.startAngle = function(t) {
        return arguments.length ? (r = bt(t), n) : r
      }, n.endAngle = function(t) {
        return arguments.length ? (u = bt(t), n) : u
      }, n.centroid = function() {
        var n = (t.apply(this, arguments) + e.apply(this, arguments)) / 2,
          i = (r.apply(this, arguments) + u.apply(this, arguments)) / 2 + ms;
        return [Math.cos(i) * n, Math.sin(i) * n]
      }, n
    };
    var ms = -Sa,
      ys = wa - ka;
    Zo.svg.line = function() {
      return ro(wt)
    };
    var xs = Zo.map({
      linear: uo,
      "linear-closed": io,
      step: oo,
      "step-before": ao,
      "step-after": co,
      basis: po,
      "basis-open": vo,
      "basis-closed": mo,
      bundle: yo,
      cardinal: fo,
      "cardinal-open": so,
      "cardinal-closed": lo,
      monotone: So
    });
    xs.forEach(function(n, t) {
      t.key = n, t.closed = /-closed$/.test(n)
    });
    var Ms = [0, 2 / 3, 1 / 3, 0],
      _s = [0, 1 / 3, 2 / 3, 0],
      bs = [0, 1 / 6, 2 / 3, 1 / 6];
    Zo.svg.line.radial = function() {
      var n = ro(ko);
      return n.radius = n.x, delete n.x, n.angle = n.y, delete n.y, n
    }, ao.reverse = co, co.reverse = ao, Zo.svg.area = function() {
      return Eo(wt)
    }, Zo.svg.area.radial = function() {
      var n = Eo(ko);
      return n.radius = n.x, delete n.x, n.innerRadius = n.x0, delete n.x0, n.outerRadius = n.x1, delete n.x1, n.angle = n.y, delete n.y, n.startAngle = n.y0, delete n.y0, n.endAngle = n.y1, delete n.y1, n
    }, Zo.svg.chord = function() {
      function n(n, a) {
        var c = t(this, i, n, a),
          s = t(this, o, n, a);
        return "M" + c.p0 + r(c.r, c.p1, c.a1 - c.a0) + (e(c, s) ? u(c.r, c.p1, c.r, c.p0) : u(c.r, c.p1, s.r, s.p0) + r(s.r, s.p1, s.a1 - s.a0) + u(s.r, s.p1, c.r, c.p0)) + "Z"
      }

      function t(n, t, e, r) {
        var u = t.call(n, e, r),
          i = a.call(n, u, r),
          o = c.call(n, u, r) + ms,
          l = s.call(n, u, r) + ms;
        return {
          r: i,
          a0: o,
          a1: l,
          p0: [i * Math.cos(o), i * Math.sin(o)],
          p1: [i * Math.cos(l), i * Math.sin(l)]
        }
      }

      function e(n, t) {
        return n.a0 == t.a0 && n.a1 == t.a1
      }

      function r(n, t, e) {
        return "A" + n + "," + n + " 0 " + +(e > ba) + ",1 " + t
      }

      function u(n, t, e, r) {
        return "Q 0,0 " + r
      }
      var i = gr,
        o = pr,
        a = Ao,
        c = to,
        s = eo;
      return n.radius = function(t) {
        return arguments.length ? (a = bt(t), n) : a
      }, n.source = function(t) {
        return arguments.length ? (i = bt(t), n) : i
      }, n.target = function(t) {
        return arguments.length ? (o = bt(t), n) : o
      }, n.startAngle = function(t) {
        return arguments.length ? (c = bt(t), n) : c
      }, n.endAngle = function(t) {
        return arguments.length ? (s = bt(t), n) : s
      }, n
    }, Zo.svg.diagonal = function() {
      function n(n, u) {
        var i = t.call(this, n, u),
          o = e.call(this, n, u),
          a = (i.y + o.y) / 2,
          c = [i, {
            x: i.x,
            y: a
          }, {
            x: o.x,
            y: a
          }, o];
        return c = c.map(r), "M" + c[0] + "C" + c[1] + " " + c[2] + " " + c[3]
      }
      var t = gr,
        e = pr,
        r = Co;
      return n.source = function(e) {
        return arguments.length ? (t = bt(e), n) : t
      }, n.target = function(t) {
        return arguments.length ? (e = bt(t), n) : e
      }, n.projection = function(t) {
        return arguments.length ? (r = t, n) : r
      }, n
    }, Zo.svg.diagonal.radial = function() {
      var n = Zo.svg.diagonal(),
        t = Co,
        e = n.projection;
      return n.projection = function(n) {
        return arguments.length ? e(No(t = n)) : t
      }, n
    }, Zo.svg.symbol = function() {
      function n(n, r) {
        return (ws.get(t.call(this, n, r)) || To)(e.call(this, n, r))
      }
      var t = Lo,
        e = zo;
      return n.type = function(e) {
        return arguments.length ? (t = bt(e), n) : t
      }, n.size = function(t) {
        return arguments.length ? (e = bt(t), n) : e
      }, n
    };
    var ws = Zo.map({
      circle: To,
      cross: function(n) {
        var t = Math.sqrt(n / 5) / 2;
        return "M" + -3 * t + "," + -t + "H" + -t + "V" + -3 * t + "H" + t + "V" + -t + "H" + 3 * t + "V" + t + "H" + t + "V" + 3 * t + "H" + -t + "V" + t + "H" + -3 * t + "Z"
      },
      diamond: function(n) {
        var t = Math.sqrt(n / (2 * As)),
          e = t * As;
        return "M0," + -t + "L" + e + ",0" + " 0," + t + " " + -e + ",0" + "Z"
      },
      square: function(n) {
        var t = Math.sqrt(n) / 2;
        return "M" + -t + "," + -t + "L" + t + "," + -t + " " + t + "," + t + " " + -t + "," + t + "Z"
      },
      "triangle-down": function(n) {
        var t = Math.sqrt(n / Es),
          e = t * Es / 2;
        return "M0," + e + "L" + t + "," + -e + " " + -t + "," + -e + "Z"
      },
      "triangle-up": function(n) {
        var t = Math.sqrt(n / Es),
          e = t * Es / 2;
        return "M0," + -e + "L" + t + "," + e + " " + -t + "," + e + "Z"
      }
    });
    Zo.svg.symbolTypes = ws.keys();
    var Ss, ks, Es = Math.sqrt(3),
      As = Math.tan(30 * Aa),
      Cs = [],
      Ns = 0;
    Cs.call = pa.call, Cs.empty = pa.empty, Cs.node = pa.node, Cs.size = pa.size, Zo.transition = function(n) {
      return arguments.length ? Ss ? n.transition() : n : ma.transition()
    }, Zo.transition.prototype = Cs, Cs.select = function(n) {
      var t, e, r, u = this.id,
        i = [];
      n = b(n);
      for (var o = -1, a = this.length; ++o < a;) {
        i.push(t = []);
        for (var c = this[o], s = -1, l = c.length; ++s < l;)(r = c[s]) && (e = n.call(r, r.__data__, s, o)) ? ("__data__" in r && (e.__data__ = r.__data__), Po(e, s, u, r.__transition__[u]), t.push(e)) : t.push(null)
      }
      return qo(i, u)
    }, Cs.selectAll = function(n) {
      var t, e, r, u, i, o = this.id,
        a = [];
      n = w(n);
      for (var c = -1, s = this.length; ++c < s;)
        for (var l = this[c], f = -1, h = l.length; ++f < h;)
          if (r = l[f]) {
            i = r.__transition__[o], e = n.call(r, r.__data__, f, c), a.push(t = []);
            for (var g = -1, p = e.length; ++g < p;)(u = e[g]) && Po(u, g, o, i), t.push(u)
          }
      return qo(a, o)
    }, Cs.filter = function(n) {
      var t, e, r, u = [];
      "function" != typeof n && (n = R(n));
      for (var i = 0, o = this.length; o > i; i++) {
        u.push(t = []);
        for (var e = this[i], a = 0, c = e.length; c > a; a++)(r = e[a]) && n.call(r, r.__data__, a, i) && t.push(r)
      }
      return qo(u, this.id)
    }, Cs.tween = function(n, t) {
      var e = this.id;
      return arguments.length < 2 ? this.node().__transition__[e].tween.get(n) : P(this, null == t ? function(t) {
        t.__transition__[e].tween.remove(n)
      } : function(r) {
        r.__transition__[e].tween.set(n, t)
      })
    }, Cs.attr = function(n, t) {
      function e() {
        this.removeAttribute(a)
      }

      function r() {
        this.removeAttributeNS(a.space, a.local)
      }

      function u(n) {
        return null == n ? e : (n += "", function() {
          var t, e = this.getAttribute(a);
          return e !== n && (t = o(e, n), function(n) {
            this.setAttribute(a, t(n))
          })
        })
      }

      function i(n) {
        return null == n ? r : (n += "", function() {
          var t, e = this.getAttributeNS(a.space, a.local);
          return e !== n && (t = o(e, n), function(n) {
            this.setAttributeNS(a.space, a.local, t(n))
          })
        })
      }
      if (arguments.length < 2) {
        for (t in n) this.attr(t, n[t]);
        return this
      }
      var o = "transform" == n ? Du : hu,
        a = Zo.ns.qualify(n);
      return Ro(this, "attr." + n, t, a.local ? i : u)
    }, Cs.attrTween = function(n, t) {
      function e(n, e) {
        var r = t.call(this, n, e, this.getAttribute(u));
        return r && function(n) {
          this.setAttribute(u, r(n))
        }
      }

      function r(n, e) {
        var r = t.call(this, n, e, this.getAttributeNS(u.space, u.local));
        return r && function(n) {
          this.setAttributeNS(u.space, u.local, r(n))
        }
      }
      var u = Zo.ns.qualify(n);
      return this.tween("attr." + n, u.local ? r : e)
    }, Cs.style = function(n, t, e) {
      function r() {
        this.style.removeProperty(n)
      }

      function u(t) {
        return null == t ? r : (t += "", function() {
          var r, u = Wo.getComputedStyle(this, null).getPropertyValue(n);
          return u !== t && (r = hu(u, t), function(t) {
            this.style.setProperty(n, r(t), e)
          })
        })
      }
      var i = arguments.length;
      if (3 > i) {
        if ("string" != typeof n) {
          2 > i && (t = "");
          for (e in n) this.style(e, n[e], t);
          return this
        }
        e = ""
      }
      return Ro(this, "style." + n, t, u)
    }, Cs.styleTween = function(n, t, e) {
      function r(r, u) {
        var i = t.call(this, r, u, Wo.getComputedStyle(this, null).getPropertyValue(n));
        return i && function(t) {
          this.style.setProperty(n, i(t), e)
        }
      }
      return arguments.length < 3 && (e = ""), this.tween("style." + n, r)
    }, Cs.text = function(n) {
      return Ro(this, "text", n, Do)
    }, Cs.remove = function() {
      return this.each("end.transition", function() {
        var n;
        this.__transition__.count < 2 && (n = this.parentNode) && n.removeChild(this)
      })
    }, Cs.ease = function(n) {
      var t = this.id;
      return arguments.length < 1 ? this.node().__transition__[t].ease : ("function" != typeof n && (n = Zo.ease.apply(Zo, arguments)), P(this, function(e) {
        e.__transition__[t].ease = n
      }))
    }, Cs.delay = function(n) {
      var t = this.id;
      return arguments.length < 1 ? this.node().__transition__[t].delay : P(this, "function" == typeof n ? function(e, r, u) {
        e.__transition__[t].delay = +n.call(e, e.__data__, r, u)
      } : (n = +n, function(e) {
        e.__transition__[t].delay = n
      }))
    }, Cs.duration = function(n) {
      var t = this.id;
      return arguments.length < 1 ? this.node().__transition__[t].duration : P(this, "function" == typeof n ? function(e, r, u) {
        e.__transition__[t].duration = Math.max(1, n.call(e, e.__data__, r, u))
      } : (n = Math.max(1, n), function(e) {
        e.__transition__[t].duration = n
      }))
    }, Cs.each = function(n, t) {
      var e = this.id;
      if (arguments.length < 2) {
        var r = ks,
          u = Ss;
        Ss = e, P(this, function(t, r, u) {
          ks = t.__transition__[e], n.call(t, t.__data__, r, u)
        }), ks = r, Ss = u
      } else P(this, function(r) {
        var u = r.__transition__[e];
        (u.event || (u.event = Zo.dispatch("start", "end"))).on(n, t)
      });
      return this
    }, Cs.transition = function() {
      for (var n, t, e, r, u = this.id, i = ++Ns, o = [], a = 0, c = this.length; c > a; a++) {
        o.push(n = []);
        for (var t = this[a], s = 0, l = t.length; l > s; s++)(e = t[s]) && (r = Object.create(e.__transition__[u]), r.delay += r.duration, Po(e, s, i, r)), n.push(e)
      }
      return qo(o, i)
    }, Zo.svg.axis = function() {
      function n(n) {
        n.each(function() {
          var n, s = Zo.select(this),
            l = this.__chart__ || e,
            f = this.__chart__ = e.copy(),
            h = null == c ? f.ticks ? f.ticks.apply(f, a) : f.domain() : c,
            g = null == t ? f.tickFormat ? f.tickFormat.apply(f, a) : wt : t,
            p = s.selectAll(".tick").data(h, f),
            v = p.enter().insert("g", ".domain").attr("class", "tick").style("opacity", ka),
            d = Zo.transition(p.exit()).style("opacity", ka).remove(),
            m = Zo.transition(p.order()).style("opacity", 1),
            y = Ti(f),
            x = s.selectAll(".domain").data([0]),
            M = (x.enter().append("path").attr("class", "domain"), Zo.transition(x));
          v.append("line"), v.append("text");
          var _ = v.select("line"),
            b = m.select("line"),
            w = p.select("text").text(g),
            S = v.select("text"),
            k = m.select("text");
          switch (r) {
            case "bottom":
              n = Uo, _.attr("y2", u), S.attr("y", Math.max(u, 0) + o), b.attr("x2", 0).attr("y2", u), k.attr("x", 0).attr("y", Math.max(u, 0) + o), w.attr("dy", ".71em").style("text-anchor", "middle"), M.attr("d", "M" + y[0] + "," + i + "V0H" + y[1] + "V" + i);
              break;
            case "top":
              n = Uo, _.attr("y2", -u), S.attr("y", -(Math.max(u, 0) + o)), b.attr("x2", 0).attr("y2", -u), k.attr("x", 0).attr("y", -(Math.max(u, 0) + o)), w.attr("dy", "0em").style("text-anchor", "middle"), M.attr("d", "M" + y[0] + "," + -i + "V0H" + y[1] + "V" + -i);
              break;
            case "left":
              n = jo, _.attr("x2", -u), S.attr("x", -(Math.max(u, 0) + o)), b.attr("x2", -u).attr("y2", 0), k.attr("x", -(Math.max(u, 0) + o)).attr("y", 0), w.attr("dy", ".32em").style("text-anchor", "end"), M.attr("d", "M" + -i + "," + y[0] + "H0V" + y[1] + "H" + -i);
              break;
            case "right":
              n = jo, _.attr("x2", u), S.attr("x", Math.max(u, 0) + o), b.attr("x2", u).attr("y2", 0), k.attr("x", Math.max(u, 0) + o).attr("y", 0), w.attr("dy", ".32em").style("text-anchor", "start"), M.attr("d", "M" + i + "," + y[0] + "H0V" + y[1] + "H" + i)
          }
          if (f.rangeBand) {
            var E = f,
              A = E.rangeBand() / 2;
            l = f = function(n) {
              return E(n) + A
            }
          } else l.rangeBand ? l = f : d.call(n, f);
          v.call(n, l), m.call(n, f)
        })
      }
      var t, e = Zo.scale.linear(),
        r = zs,
        u = 6,
        i = 6,
        o = 3,
        a = [10],
        c = null;
      return n.scale = function(t) {
        return arguments.length ? (e = t, n) : e
      }, n.orient = function(t) {
        return arguments.length ? (r = t in Ls ? t + "" : zs, n) : r
      }, n.ticks = function() {
        return arguments.length ? (a = arguments, n) : a
      }, n.tickValues = function(t) {
        return arguments.length ? (c = t, n) : c
      }, n.tickFormat = function(e) {
        return arguments.length ? (t = e, n) : t
      }, n.tickSize = function(t) {
        var e = arguments.length;
        return e ? (u = +t, i = +arguments[e - 1], n) : u
      }, n.innerTickSize = function(t) {
        return arguments.length ? (u = +t, n) : u
      }, n.outerTickSize = function(t) {
        return arguments.length ? (i = +t, n) : i
      }, n.tickPadding = function(t) {
        return arguments.length ? (o = +t, n) : o
      }, n.tickSubdivide = function() {
        return arguments.length && n
      }, n
    };
    var zs = "bottom",
      Ls = {
        top: 1,
        right: 1,
        bottom: 1,
        left: 1
      };
    Zo.svg.brush = function() {
      function n(i) {
        i.each(function() {
          var i = Zo.select(this).style("pointer-events", "all").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)").on("mousedown.brush", u).on("touchstart.brush", u),
            o = i.selectAll(".background").data([0]);
          o.enter().append("rect").attr("class", "background").style("visibility", "hidden").style("cursor", "crosshair"), i.selectAll(".extent").data([0]).enter().append("rect").attr("class", "extent").style("cursor", "move");
          var a = i.selectAll(".resize").data(p, wt);
          a.exit().remove(), a.enter().append("g").attr("class", function(n) {
            return "resize " + n
          }).style("cursor", function(n) {
            return Ts[n]
          }).append("rect").attr("x", function(n) {
            return /[ew]$/.test(n) ? -3 : null
          }).attr("y", function(n) {
            return /^[ns]/.test(n) ? -3 : null
          }).attr("width", 6).attr("height", 6).style("visibility", "hidden"), a.style("display", n.empty() ? "none" : null);
          var l, f = Zo.transition(i),
            h = Zo.transition(o);
          c && (l = Ti(c), h.attr("x", l[0]).attr("width", l[1] - l[0]), e(f)), s && (l = Ti(s), h.attr("y", l[0]).attr("height", l[1] - l[0]), r(f)), t(f)
        })
      }

      function t(n) {
        n.selectAll(".resize").attr("transform", function(n) {
          return "translate(" + l[+/e$/.test(n)] + "," + f[+/^s/.test(n)] + ")"
        })
      }

      function e(n) {
        n.select(".extent").attr("x", l[0]), n.selectAll(".extent,.n>rect,.s>rect").attr("width", l[1] - l[0])
      }

      function r(n) {
        n.select(".extent").attr("y", f[0]), n.selectAll(".extent,.e>rect,.w>rect").attr("height", f[1] - f[0])
      }

      function u() {
        function u() {
          32 == Zo.event.keyCode && (C || (x = null, z[0] -= l[1], z[1] -= f[1], C = 2), y())
        }

        function p() {
          32 == Zo.event.keyCode && 2 == C && (z[0] += l[1], z[1] += f[1], C = 0, y())
        }

        function v() {
          var n = Zo.mouse(_),
            u = !1;
          M && (n[0] += M[0], n[1] += M[1]), C || (Zo.event.altKey ? (x || (x = [(l[0] + l[1]) / 2, (f[0] + f[1]) / 2]), z[0] = l[+(n[0] < x[0])], z[1] = f[+(n[1] < x[1])]) : x = null), E && d(n, c, 0) && (e(S), u = !0), A && d(n, s, 1) && (r(S), u = !0), u && (t(S), w({
            type: "brush",
            mode: C ? "move" : "resize"
          }))
        }

        function d(n, t, e) {
          var r, u, a = Ti(t),
            c = a[0],
            s = a[1],
            p = z[e],
            v = e ? f : l,
            d = v[1] - v[0];
          return C && (c -= p, s -= d + p), r = (e ? g : h) ? Math.max(c, Math.min(s, n[e])) : n[e], C ? u = (r += p) + d : (x && (p = Math.max(c, Math.min(s, 2 * x[e] - r))), r > p ? (u = r, r = p) : u = p), v[0] != r || v[1] != u ? (e ? o = null : i = null, v[0] = r, v[1] = u, !0) : void 0
        }

        function m() {
          v(), S.style("pointer-events", "all").selectAll(".resize").style("display", n.empty() ? "none" : null), Zo.select("body").style("cursor", null), L.on("mousemove.brush", null).on("mouseup.brush", null).on("touchmove.brush", null).on("touchend.brush", null).on("keydown.brush", null).on("keyup.brush", null), N(), w({
            type: "brushend"
          })
        }
        var x, M, _ = this,
          b = Zo.select(Zo.event.target),
          w = a.of(_, arguments),
          S = Zo.select(_),
          k = b.datum(),
          E = !/^(n|s)$/.test(k) && c,
          A = !/^(e|w)$/.test(k) && s,
          C = b.classed("extent"),
          N = I(),
          z = Zo.mouse(_),
          L = Zo.select(Wo).on("keydown.brush", u).on("keyup.brush", p);
        if (Zo.event.changedTouches ? L.on("touchmove.brush", v).on("touchend.brush", m) : L.on("mousemove.brush", v).on("mouseup.brush", m), S.interrupt().selectAll("*").interrupt(), C) z[0] = l[0] - z[0], z[1] = f[0] - z[1];
        else if (k) {
          var T = +/w$/.test(k),
            q = +/^n/.test(k);
          M = [l[1 - T] - z[0], f[1 - q] - z[1]], z[0] = l[T], z[1] = f[q]
        } else Zo.event.altKey && (x = z.slice());
        S.style("pointer-events", "none").selectAll(".resize").style("display", null), Zo.select("body").style("cursor", b.style("cursor")), w({
          type: "brushstart"
        }), v()
      }
      var i, o, a = M(n, "brushstart", "brush", "brushend"),
        c = null,
        s = null,
        l = [0, 0],
        f = [0, 0],
        h = !0,
        g = !0,
        p = qs[0];
      return n.event = function(n) {
        n.each(function() {
          var n = a.of(this, arguments),
            t = {
              x: l,
              y: f,
              i: i,
              j: o
            },
            e = this.__chart__ || t;
          this.__chart__ = t, Ss ? Zo.select(this).transition().each("start.brush", function() {
            i = e.i, o = e.j, l = e.x, f = e.y, n({
              type: "brushstart"
            })
          }).tween("brush:brush", function() {
            var e = gu(l, t.x),
              r = gu(f, t.y);
            return i = o = null,
              function(u) {
                l = t.x = e(u), f = t.y = r(u), n({
                  type: "brush",
                  mode: "resize"
                })
              }
          }).each("end.brush", function() {
            i = t.i, o = t.j, n({
              type: "brush",
              mode: "resize"
            }), n({
              type: "brushend"
            })
          }) : (n({
            type: "brushstart"
          }), n({
            type: "brush",
            mode: "resize"
          }), n({
            type: "brushend"
          }))
        })
      }, n.x = function(t) {
        return arguments.length ? (c = t, p = qs[!c << 1 | !s], n) : c
      }, n.y = function(t) {
        return arguments.length ? (s = t, p = qs[!c << 1 | !s], n) : s
      }, n.clamp = function(t) {
        return arguments.length ? (c && s ? (h = !!t[0], g = !!t[1]) : c ? h = !!t : s && (g = !!t), n) : c && s ? [h, g] : c ? h : s ? g : null
      }, n.extent = function(t) {
        var e, r, u, a, h;
        return arguments.length ? (c && (e = t[0], r = t[1], s && (e = e[0], r = r[0]), i = [e, r], c.invert && (e = c(e), r = c(r)), e > r && (h = e, e = r, r = h), (e != l[0] || r != l[1]) && (l = [e, r])), s && (u = t[0], a = t[1], c && (u = u[1], a = a[1]), o = [u, a], s.invert && (u = s(u), a = s(a)), u > a && (h = u, u = a, a = h), (u != f[0] || a != f[1]) && (f = [u, a])), n) : (c && (i ? (e = i[0], r = i[1]) : (e = l[0], r = l[1], c.invert && (e = c.invert(e), r = c.invert(r)), e > r && (h = e, e = r, r = h))), s && (o ? (u = o[0], a = o[1]) : (u = f[0], a = f[1], s.invert && (u = s.invert(u), a = s.invert(a)), u > a && (h = u, u = a, a = h))), c && s ? [
          [e, u],
          [r, a]
        ] : c ? [e, r] : s && [u, a])
      }, n.clear = function() {
        return n.empty() || (l = [0, 0], f = [0, 0], i = o = null), n
      }, n.empty = function() {
        return !!c && l[0] == l[1] || !!s && f[0] == f[1]
      }, Zo.rebind(n, a, "on")
    };
    var Ts = {
        n: "ns-resize",
        e: "ew-resize",
        s: "ns-resize",
        w: "ew-resize",
        nw: "nwse-resize",
        ne: "nesw-resize",
        se: "nwse-resize",
        sw: "nesw-resize"
      },
      qs = [
        ["n", "e", "s", "w", "nw", "ne", "se", "sw"],
        ["e", "w"],
        ["n", "s"],
        []
      ],
      Rs = Qa.format = ic.timeFormat,
      Ds = Rs.utc,
      Ps = Ds("%Y-%m-%dT%H:%M:%S.%LZ");
    Rs.iso = Date.prototype.toISOString && +new Date("2000-01-01T00:00:00.000Z") ? Ho : Ps, Ho.parse = function(n) {
      var t = new Date(n);
      return isNaN(t) ? null : t
    }, Ho.toString = Ps.toString, Qa.second = Dt(function(n) {
      return new nc(1e3 * Math.floor(n / 1e3))
    }, function(n, t) {
      n.setTime(n.getTime() + 1e3 * Math.floor(t))
    }, function(n) {
      return n.getSeconds()
    }), Qa.seconds = Qa.second.range, Qa.seconds.utc = Qa.second.utc.range, Qa.minute = Dt(function(n) {
      return new nc(6e4 * Math.floor(n / 6e4))
    }, function(n, t) {
      n.setTime(n.getTime() + 6e4 * Math.floor(t))
    }, function(n) {
      return n.getMinutes()
    }), Qa.minutes = Qa.minute.range, Qa.minutes.utc = Qa.minute.utc.range, Qa.hour = Dt(function(n) {
      var t = n.getTimezoneOffset() / 60;
      return new nc(36e5 * (Math.floor(n / 36e5 - t) + t))
    }, function(n, t) {
      n.setTime(n.getTime() + 36e5 * Math.floor(t))
    }, function(n) {
      return n.getHours()
    }), Qa.hours = Qa.hour.range, Qa.hours.utc = Qa.hour.utc.range, Qa.month = Dt(function(n) {
      return n = Qa.day(n), n.setDate(1), n
    }, function(n, t) {
      n.setMonth(n.getMonth() + t)
    }, function(n) {
      return n.getMonth()
    }), Qa.months = Qa.month.range, Qa.months.utc = Qa.month.utc.range;
    var Us = [1e3, 5e3, 15e3, 3e4, 6e4, 3e5, 9e5, 18e5, 36e5, 108e5, 216e5, 432e5, 864e5, 1728e5, 6048e5, 2592e6, 7776e6, 31536e6],
      js = [
        [Qa.second, 1],
        [Qa.second, 5],
        [Qa.second, 15],
        [Qa.second, 30],
        [Qa.minute, 1],
        [Qa.minute, 5],
        [Qa.minute, 15],
        [Qa.minute, 30],
        [Qa.hour, 1],
        [Qa.hour, 3],
        [Qa.hour, 6],
        [Qa.hour, 12],
        [Qa.day, 1],
        [Qa.day, 2],
        [Qa.week, 1],
        [Qa.month, 1],
        [Qa.month, 3],
        [Qa.year, 1]
      ],
      Hs = Rs.multi([
        [".%L", function(n) {
          return n.getMilliseconds()
        }],
        [":%S", function(n) {
          return n.getSeconds()
        }],
        ["%I:%M", function(n) {
          return n.getMinutes()
        }],
        ["%I %p", function(n) {
          return n.getHours()
        }],
        ["%a %d", function(n) {
          return n.getDay() && 1 != n.getDate()
        }],
        ["%b %d", function(n) {
          return 1 != n.getDate()
        }],
        ["%B", function(n) {
          return n.getMonth()
        }],
        ["%Y", we]
      ]),
      Fs = {
        range: function(n, t, e) {
          return Zo.range(Math.ceil(n / e) * e, +t, e).map(Oo)
        },
        floor: wt,
        ceil: wt
      };
    js.year = Qa.year, Qa.scale = function() {
      return Fo(Zo.scale.linear(), js, Hs)
    };
    var Os = js.map(function(n) {
        return [n[0].utc, n[1]]
      }),
      Ys = Ds.multi([
        [".%L", function(n) {
          return n.getUTCMilliseconds()
        }],
        [":%S", function(n) {
          return n.getUTCSeconds()
        }],
        ["%I:%M", function(n) {
          return n.getUTCMinutes()
        }],
        ["%I %p", function(n) {
          return n.getUTCHours()
        }],
        ["%a %d", function(n) {
          return n.getUTCDay() && 1 != n.getUTCDate()
        }],
        ["%b %d", function(n) {
          return 1 != n.getUTCDate()
        }],
        ["%B", function(n) {
          return n.getUTCMonth()
        }],
        ["%Y", we]
      ]);
    Os.year = Qa.year.utc, Qa.scale.utc = function() {
      return Fo(Zo.scale.linear(), Os, Ys)
    }, Zo.text = St(function(n) {
      return n.responseText
    }), Zo.json = function(n, t) {
      return kt(n, "application/json", Yo, t)
    }, Zo.html = function(n, t) {
      return kt(n, "text/html", Io, t)
    }, Zo.xml = St(function(n) {
      return n.responseXML
    }), "function" == typeof define && define.amd ? define(Zo) : "object" == typeof module && module.exports && (module.exports = Zo), this.d3 = Zo
  }();
} else {
  var d3 = false;
}
/*
   Squiz
 @link
*/
(function(a, b) {
  function c(a) {
    return "string" === typeof a
  }

  function d(a) {
    var b = h.call(arguments, 1);
    return function() {
      return a.apply(this, b.concat(h.call(arguments)))
    }
  }

  function e(d, e, f, g, h) {
    var n;
    g !== j ? (e = f.match(d ? /^([^#]*)\#?(.*)$/ : /^([^#?]*)\??([^#]*)(#?.*)/), f = e[3] || "", 2 === h && c(g) ? g = g.replace(d ? x : z, "") : (n = m(e[2]), g = c(g) ? m[d ? v : w](g) : g, g = 2 === h ? g : 1 === h ? a.extend({}, g, n) : a.extend({}, n, g), g = l(g), d && (g = g.replace(B, k))), d = e[1] + (d ? "#" : g || !e[1] ? "?" : "") + g + f) : d = e(f !== j ? f : b[u][y]);
    return d
  }

  function f(a, b, d) {
    b ===
      j || "boolean" === typeof b ? (d = b, b = l[a ? v : w]()) : b = c(b) ? b.replace(a ? x : z, "") : b;
    return m(b, d)
  }

  function g(b, d, e, f) {
    !c(e) && "object" !== typeof e && (f = e, e = d, d = j);
    return this.each(function() {
      var c = a(this),
        g = d || q()[(this.nodeName || "").toLowerCase()] || "",
        k = g && c.attr(g) || "";
      c.attr(g, l[b](k, e, f))
    })
  }
  "$:nomunge";
  var j, h = Array.prototype.slice,
    k = decodeURIComponent,
    l = a.param,
    n, m, o, r = a.bbq = a.bbq || {},
    p, s, q, t = a.event.special,
    w = "querystring",
    v = "fragment",
    u = "location",
    y = "href",
    z = /^.*\?|#.*$/g,
    x = /^.*\#/,
    B, C = {};
  l[w] = d(e, 0, function(a) {
    return a.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,
      "$1")
  });
  l[v] = n = d(e, 1, function(a) {
    return a.replace(/^[^#]*#?(.*)$/, "$1")
  });
  n.noEscape = function(b) {
    b = a.map((b || "").split(""), encodeURIComponent);
    B = RegExp(b.join("|"), "g")
  };
  n.noEscape(",/");
  a.deparam = m = function(b, c) {
    var d = {},
      e = {
        "true": !0,
        "false": !1,
        "null": null
      };
    a.each(b.replace(/\+/g, " ").split("&"), function(b, f) {
      var g = f.split("="),
        h = k(g[0]),
        l = d,
        n = 0,
        m = h.split("]["),
        r = m.length - 1;
      /\[/.test(m[0]) && /\]$/.test(m[r]) ? (m[r] = m[r].replace(/\]$/, ""), m = m.shift().split("[").concat(m), r = m.length - 1) : r = 0;
      if (2 === g.length)
        if (g =
          k(g[1]), c && (g = g && !isNaN(g) ? +g : "undefined" === g ? j : e[g] !== j ? e[g] : g), r)
          for (; n <= r; n++) h = "" === m[n] ? l.length : m[n], l = l[h] = n < r ? l[h] || (m[n + 1] && isNaN(m[n + 1]) ? {} : []) : g;
        else a.isArray(d[h]) ? d[h].push(g) : d[h] = d[h] !== j ? [d[h], g] : g;
      else h && (d[h] = c ? j : "")
    });
    return d
  };
  m[w] = d(f, 0);
  m[v] = o = d(f, 1);
  a.elemUrlAttr || (a.elemUrlAttr = function(b) {
    return a.extend(C, b)
  })({
    a: y,
    base: y,
    iframe: "src",
    img: "src",
    input: "src",
    form: "action",
    link: y,
    script: "src"
  });
  q = a.elemUrlAttr;
  a.fn[w] = d(g, w);
  a.fn[v] = d(g, v);
  r.pushState = p = function(a, d) {
    c(a) &&
      /^#/.test(a) && d === j && (d = 2);
    var e = a !== j,
      e = n(b[u][y], e ? a : {}, e ? d : 2);
    b[u][y] = e + (/#/.test(e) ? "" : "#")
  };
  r.getState = s = function(a, b) {
    return a === j || "boolean" === typeof a ? o(a) : o(b)[a]
  };
  r.removeState = function(b) {
    var c = {};
    b !== j && (c = s(), a.each(a.isArray(b) ? b : arguments, function(a, b) {
      delete c[b]
    }));
    p(c, 2)
  };
  t.hashchange = a.extend(t.hashchange, {
    add: function(b) {
      function c(a) {
        var b = a[v] = n();
        a.getState = function(a, c) {
          return a === j || "boolean" === typeof a ? m(b, a) : m(b, c)[a]
        };
        d.apply(this, arguments)
      }
      var d;
      if (a.isFunction(b)) return d =
        b, c;
      d = b.handler;
      b.handler = c
    }
  })
})(jQuery, this);
(function(a, b, c) {
  function d(a) {
    a = a || b[g][j];
    return a.replace(/^[^#]*#?(.*)$/, "$1")
  }
  "$:nomunge";
  var e, f = a.event.special,
    g = "location",
    j = "href",
    h = document.documentMode,
    k = -1 !== navigator.userAgent.indexOf("MSIE") && (h === c || 8 > h),
    l = "onhashchange" in b && !k;
  a.hashchangeDelay = 100;
  f.hashchange = a.extend(f.hashchange, {
    setup: function() {
      if (l) return !1;
      a(e.start)
    },
    teardown: function() {
      if (l) return !1;
      a(e.stop)
    }
  });
  e = function() {
    function c() {
      l = s = function(a) {
        return a
      };
      k && (h = a('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow, s =
        function() {
          return d(h.document[g][j])
        }, l = function(a, b) {
          if (a !== b) {
            var c = h.document;
            c.open().close();
            c[g].hash = "#" + a
          }
        }, l(d()))
    }
    var e = {},
      f, h, l, s;
    e.start = function() {
      if (!f) {
        var e = d();
        l || c();
        (function w() {
          var c = d(),
            k = s(e);
          c !== e ? (l(e = c, k), a(b).trigger("hashchange")) : k !== e && (b[g][j] = b[g][j].replace(/#.*/, "") + "#" + k);
          f = setTimeout(w, a.hashchangeDelay)
        })()
      }
    };
    e.stop = function() {
      h || (f && clearTimeout(f), f = 0)
    };
    return e
  }()
})(jQuery, this);
(function(a) {
  function b(a) {
    return "object" == typeof a ? a : {
      top: a,
      left: a
    }
  }
  var c = a.scrollTo = function(b, c, f) {
    a(window).scrollTo(b, c, f)
  };
  c.defaults = {
    axis: "xy",
    duration: 1.3 <= parseFloat(a.fn.jquery) ? 0 : 1,
    limit: !0
  };
  c.window = function() {
    return a(window)._scrollable()
  };
  a.fn._scrollable = function() {
    return this.map(function() {
      if (this.nodeName && -1 == a.inArray(this.nodeName.toLowerCase(), ["iframe", "#document", "html", "body"])) return this;
      var b = (this.contentWindow || this).document || this.ownerDocument || this;
      return /webkit/i.test(navigator.userAgent) ||
        "BackCompat" == b.compatMode ? b.body : b.documentElement
    })
  };
  a.fn.scrollTo = function(d, e, f) {
    "object" == typeof e && (f = e, e = 0);
    "function" == typeof f && (f = {
      onAfter: f
    });
    "max" == d && (d = 9E9);
    f = a.extend({}, c.defaults, f);
    e = e || f.duration;
    f.queue = f.queue && 1 < f.axis.length;
    f.queue && (e /= 2);
    f.offset = b(f.offset);
    f.over = b(f.over);
    return this._scrollable().each(function() {
      function g(a) {
        h.animate(n, e, f.easing, a && function() {
          a.call(this, d, f)
        })
      }
      if (d != null) {
        var j = this,
          h = a(j),
          k = d,
          l, n = {},
          m = h.is("html,body");
        switch (typeof k) {
          case "number":
          case "string":
            if (/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)) {
              k =
                b(k);
              break
            }
            k = a(k, this);
            if (!k.length) return;
          case "object":
            if (k.is || k.style) l = (k = a(k)).offset()
        }
        a.each(f.axis.split(""), function(a, b) {
          var d = b == "x" ? "Left" : "Top",
            e = d.toLowerCase(),
            q = "scroll" + d,
            t = j[q],
            w = c.max(j, b);
          if (l) {
            n[q] = l[e] + (m ? 0 : t - h.offset()[e]);
            if (f.margin) {
              n[q] = n[q] - (parseInt(k.css("margin" + d)) || 0);
              n[q] = n[q] - (parseInt(k.css("border" + d + "Width")) || 0)
            }
            n[q] = n[q] + (f.offset[e] || 0);
            f.over[e] && (n[q] = n[q] + k[b == "x" ? "width" : "height"]() * f.over[e])
          } else {
            d = k[e];
            n[q] = d.slice && d.slice(-1) == "%" ? parseFloat(d) / 100 *
              w : d
          }
          f.limit && /^\d+$/.test(n[q]) && (n[q] = n[q] <= 0 ? 0 : Math.min(n[q], w));
          if (!a && f.queue) {
            t != n[q] && g(f.onAfterFirst);
            delete n[q]
          }
        });
        g(f.onAfter)
      }
    }).end()
  };
  c.max = function(b, c) {
    var f = "x" == c ? "Width" : "Height",
      g = "scroll" + f;
    if (!a(b).is("html,body")) return b[g] - a(b)[f.toLowerCase()]();
    var f = "client" + f,
      j = b.ownerDocument.documentElement,
      h = b.ownerDocument.body;
    return Math.max(j[g], h[g]) - Math.min(j[f], h[f])
  }
})(jQuery);
"object" !== typeof JSON && (JSON = {});
(function() {
  function a(a) {
    return 10 > a ? "0" + a : a
  }

  function b(a) {
    e.lastIndex = 0;
    return e.test(a) ? '"' + a.replace(e, function(a) {
      var b = j[a];
      return "string" === typeof b ? b : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
    }) + '"' : '"' + a + '"'
  }

  function c(a, d) {
    var e, j, o, r, p = f,
      s, q = d[a];
    q && "object" === typeof q && "function" === typeof q.toJSON && (q = q.toJSON(a));
    "function" === typeof h && (q = h.call(d, a, q));
    switch (typeof q) {
      case "string":
        return b(q);
      case "number":
        return isFinite(q) ? "" + q : "null";
      case "boolean":
      case "null":
        return "" +
          q;
      case "object":
        if (!q) return "null";
        f += g;
        s = [];
        if ("[object Array]" === Object.prototype.toString.apply(q)) {
          r = q.length;
          for (e = 0; e < r; e += 1) s[e] = c(e, q) || "null";
          o = 0 === s.length ? "[]" : f ? "[\n" + f + s.join(",\n" + f) + "\n" + p + "]" : "[" + s.join(",") + "]";
          f = p;
          return o
        }
        if (h && "object" === typeof h) {
          r = h.length;
          for (e = 0; e < r; e += 1) "string" === typeof h[e] && (j = h[e], (o = c(j, q)) && s.push(b(j) + (f ? ": " : ":") + o))
        } else
          for (j in q) Object.prototype.hasOwnProperty.call(q, j) && (o = c(j, q)) && s.push(b(j) + (f ? ": " : ":") + o);
        o = 0 === s.length ? "{}" : f ? "{\n" + f + s.join(",\n" +
          f) + "\n" + p + "}" : "{" + s.join(",") + "}";
        f = p;
        return o
    }
  }
  "function" !== typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() {
    return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + a(this.getUTCMonth() + 1) + "-" + a(this.getUTCDate()) + "T" + a(this.getUTCHours()) + ":" + a(this.getUTCMinutes()) + ":" + a(this.getUTCSeconds()) + "Z" : null
  }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function() {
    return this.valueOf()
  });
  var d, e, f, g, j, h;
  "function" !== typeof JSON.stringify && (e = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
    j = {
      "\u0008": "\\b",
      "\t": "\\t",
      "\n": "\\n",
      "\u000c": "\\f",
      "\r": "\\r",
      '"': '\\"',
      "\\": "\\\\"
    }, JSON.stringify = function(a, b, d) {
      var e;
      g = f = "";
      if (typeof d === "number")
        for (e = 0; e < d; e = e + 1) g = g + " ";
      else typeof d === "string" && (g = d);
      if ((h = b) && typeof b !== "function" && (typeof b !== "object" || typeof b.length !== "number")) throw Error("JSON.stringify");
      return c("", {
        "": a
      })
    });
  "function" !== typeof JSON.parse && (d = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, JSON.parse =
    function(a, b) {
      function c(a, d) {
        var e, f, g = a[d];
        if (g && typeof g === "object")
          for (e in g)
            if (Object.prototype.hasOwnProperty.call(g, e)) {
              f = c(g, e);
              f !== void 0 ? g[e] = f : delete g[e]
            }
        return b.call(a, d, g)
      }
      var e, a = "" + a;
      d.lastIndex = 0;
      d.test(a) && (a = a.replace(d, function(a) {
        return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
      }));
      if (/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g,
          ""))) {
        e = eval("(" + a + ")");
        return typeof b === "function" ? c({
          "": e
        }, "") : e
      }
      throw new SyntaxError("JSON.parse");
    })
})();
(function(a, b) {
  if ("object" === typeof exports && exports) b(exports);
  else {
    var c = {};
    b(c);
    "function" === typeof define && define.amd ? define(c) : a.Mustache = c
  }
})(this, function(a) {
  function b(a) {
    return "function" === typeof a
  }

  function c(a) {
    return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
  }

  function d(a) {
    if (!l(a) || 2 !== a.length) throw Error("Invalid tags: " + a);
    return [RegExp(c(a[0]) + "\\s*"), RegExp("\\s*" + c(a[1]))]
  }

  function e(a) {
    this.tail = this.string = a;
    this.pos = 0
  }

  function f(a, b) {
    this.view = null == a ? {} : a;
    this.cache = {
      ".": this.view
    };
    this.parent = b
  }

  function g() {
    this.cache = {}
  }
  var j = RegExp.prototype.test,
    h = /\S/,
    k = Object.prototype.toString,
    l = Array.isArray || function(a) {
      return "[object Array]" === k.call(a)
    },
    n = {
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      '"': "&quot;",
      "'": "&#39;",
      "/": "&#x2F;"
    },
    m = /\s*/,
    o = /\s+/,
    r = /\s*=/,
    p = /\s*\}/,
    s = /#|\^|\/|>|\{|&|=|!/;
  e.prototype.eos = function() {
    return "" === this.tail
  };
  e.prototype.scan = function(a) {
    return (a = this.tail.match(a)) && 0 === a.index ? (a = a[0], this.tail = this.tail.substring(a.length), this.pos += a.length, a) : ""
  };
  e.prototype.scanUntil =
    function(a) {
      var a = this.tail.search(a),
        b;
      switch (a) {
        case -1:
          b = this.tail;
          this.tail = "";
          break;
        case 0:
          b = "";
          break;
        default:
          b = this.tail.substring(0, a), this.tail = this.tail.substring(a)
      }
      this.pos += b.length;
      return b
    };
  f.prototype.push = function(a) {
    return new f(a, this)
  };
  f.prototype.lookup = function(a) {
    var c;
    if (a in this.cache) c = this.cache[a];
    else {
      for (var d = this; d;) {
        if (0 < a.indexOf(".")) {
          c = d.view;
          for (var e = a.split("."), f = 0; null != c && f < e.length;) c = c[e[f++]]
        } else c = d.view[a];
        if (null != c) break;
        d = d.parent
      }
      this.cache[a] = c
    }
    b(c) &&
      (c = c.call(this.view));
    return c
  };
  g.prototype.clearCache = function() {
    this.cache = {}
  };
  g.prototype.parse = function(b, f) {
    var g = this.cache,
      k = g[b];
    if (null == k) {
      var l;
      l = f || a.tags;
      k = b || "";
      "string" === typeof l && (l = l.split(o));
      for (var n = d(l), q = new e(k), B = [], k = [], C = [], E = !1, A = !1, F, D, G, I; !q.eos();) {
        F = q.pos;
        if (G = q.scanUntil(n[0])) {
          I = 0;
          for (var J = G.length; I < J; ++I)
            if (D = G.charAt(I), j.call(h, D) ? A = !0 : C.push(k.length), k.push(["text", D, F, F + 1]), F += 1, "\n" === D) {
              if (E && !A)
                for (; C.length;) delete k[C.pop()];
              else C = [];
              A = E = !1
            }
        }
        if (!q.scan(n[0])) break;
        E = !0;
        D = q.scan(s) || "name";
        q.scan(m);
        "=" === D ? (G = q.scanUntil(r), q.scan(r), q.scanUntil(n[1])) : "{" === D ? (G = q.scanUntil(RegExp("\\s*" + c("}" + l[1]))), q.scan(p), q.scanUntil(n[1]), D = "&") : G = q.scanUntil(n[1]);
        if (!q.scan(n[1])) throw Error("Unclosed tag at " + q.pos);
        I = [D, G, F, q.pos];
        k.push(I);
        if ("#" === D || "^" === D) B.push(I);
        else if ("/" === D) {
          D = B.pop();
          if (!D) throw Error('Unopened section "' + G + '" at ' + F);
          if (D[1] !== G) throw Error('Unclosed section "' + D[1] + '" at ' + F);
        } else "name" === D || "{" === D || "&" === D ? A = !0 : "=" === D && (n = d(l =
          G.split(o)))
      }
      if (D = B.pop()) throw Error('Unclosed section "' + D[1] + '" at ' + q.pos);
      l = [];
      for (var H, q = 0, B = k.length; q < B; ++q)
        if (n = k[q]) "text" === n[0] && H && "text" === H[0] ? (H[1] += n[1], H[3] = n[3]) : (l.push(n), H = n);
      C = H = [];
      k = [];
      q = 0;
      for (B = l.length; q < B; ++q) switch (n = l[q], n[0]) {
        case "#":
        case "^":
          C.push(n);
          k.push(n);
          C = n[4] = [];
          break;
        case "/":
          C = k.pop();
          C[5] = n[2];
          C = 0 < k.length ? k[k.length - 1][4] : H;
          break;
        default:
          C.push(n)
      }
      k = g[b] = H
    }
    return k
  };
  g.prototype.render = function(a, b, c) {
    var d = this.parse(a),
      b = b instanceof f ? b : new f(b);
    return this.renderTokens(d,
      b, c, a)
  };
  g.prototype.renderTokens = function(c, d, e, f) {
    function g(a) {
      return j.render(a, d, e)
    }
    for (var k = "", j = this, h, n, m = 0, r = c.length; m < r; ++m) switch (h = c[m], h[0]) {
      case "#":
        n = d.lookup(h[1]);
        if (!n) continue;
        if (l(n))
          for (var o = 0, p = n.length; o < p; ++o) k += this.renderTokens(h[4], d.push(n[o]), e, f);
        else if ("object" === typeof n || "string" === typeof n) k += this.renderTokens(h[4], d.push(n), e, f);
        else if (b(n)) {
          if ("string" !== typeof f) throw Error("Cannot use higher-order sections without the original template");
          n = n.call(d.view, f.slice(h[3],
            h[5]), g);
          null != n && (k += n)
        } else k += this.renderTokens(h[4], d, e, f);
        break;
      case "^":
        n = d.lookup(h[1]);
        if (!n || l(n) && 0 === n.length) k += this.renderTokens(h[4], d, e, f);
        break;
      case ">":
        if (!e) continue;
        n = b(e) ? e(h[1]) : e[h[1]];
        null != n && (k += this.renderTokens(this.parse(n), d, e, n));
        break;
      case "&":
        n = d.lookup(h[1]);
        null != n && (k += n);
        break;
      case "name":
        n = d.lookup(h[1]);
        null != n && (k += a.escape(n));
        break;
      case "text":
        k += h[1]
    }
    return k
  };
  a.name = "mustache.js";
  a.version = "0.8.1";
  a.tags = ["{{", "}}"];
  var q = new g;
  a.clearCache = function() {
    return q.clearCache()
  };
  a.parse = function(a, b) {
    return q.parse(a, b)
  };
  a.render = function(a, b, c) {
    return q.render(a, b, c)
  };
  a.to_html = function(c, d, e, f) {
    c = a.render(c, d, e);
    if (b(f)) f(c);
    else return c
  };
  a.escape = function(a) {
    return ("" + a).replace(/[&<>"'\/]/g, function(a) {
      return n[a]
    })
  };
  a.Scanner = e;
  a.Context = f;
  a.Writer = g
});
var EasyEditDebug = {
    startTime: null,
    lastLogTime: null,
    start: function() {
      EasyEditConfig.debug && (this.startTime = new Date)
    },
    getLapsed: function() {
      if (EasyEdit.isset(this.startTime)) {
        var a = new Date,
          b = 0,
          b = EasyEdit.isset(this.lastLogTime) ? a.getTime() - this.lastLogTime.getTime() : a.getTime() - this.startTime.getTime();
        return b / 1E3 + "s"
      }
      return "Unknown"
    },
    log: function() {
      var a = Array.prototype.slice.call(arguments),
        b = a.shift();
      EasyEditConfig.debug && "undefined" !== typeof console && (console.log(this.getLapsed() + ": " + b, a), this.lastLogTime =
        new Date)
    }
  },
  EasyEdit = {
    config: {},
    url: null,
    _isLoaded: !1,
    browser: "",
    browserVersion: "",
    supportedBrowsers: {
      Firefox: function(a) {
        return 24 <= a
      },
      Safari: function(a) {
        return 6 <= a
      },
      Explorer: function(a) {
        return 8 <= a && 8 <= Number(document.documentMode)
      },
      Chrome: function() {
        return !0
      }
    },
    plugins: {},
    systemInfo: {},
    embedMode: !1,
    scriptPath: null,
    EES_ProductName: "Edit+ for Squiz Matrix",
    EES_Version: "5.3.3.0",
    initStack: [],
    browserRequirements: function() {
      var a = !1;
      BrowserDetect.init();
      this.browser = BrowserDetect.browser;
      this.browserVersion =
        BrowserDetect.version;
      jQuery("body").addClass(this.browser + this.browserVersion).addClass("plus").attr("spellcheck", "true");
      this.supportedBrowsers.hasOwnProperty(this.browser) && (a = this.supportedBrowsers[this.browser].call(this, this.browserVersion));
      var b = {
        heading: "Unsupported Browser Warning",
        message: EasyEditLocalise._('The web browser you are using is not supported. Supported web browsers are listed on the Squiz Matrix <a href="%1">requirements page</a>. Alternatively, you can still use this web browser but the system may not work as expected.',
          "http://manuals.matrix.squizsuite.net/requirements#web-browser-support")
      };
      if ("undefined" !== typeof sessionStorage) {
        var c = sessionStorage.getItem("browser_warning_accepted");
        EasyEdit.isset(c) && (a = !0);
        b.confirmFn = function() {
          sessionStorage.setItem("browser_warning_accepted", 1)
        }
      }
      return !a ? (EasyEditOverlay.showOverlay("greyOut", b), !1) : !0
    },
    doMatrixVersionMatch: function(a) {
      var b = !1,
        c = function() {
          a()
        };
      "" === EasyEdit.EES_Version || EasyEdit.systemInfo.version === EasyEdit.EES_Version ? a() : ("undefined" !== typeof sessionStorage &&
        (c = sessionStorage.getItem("version_match_warning_accepted"), EasyEdit.isset(c) && (b = !0), c = function() {
          sessionStorage.setItem("version_match_warning_accepted", 1);
          a()
        }), b ? a() : EasyEditOverlay.showOverlay("greyOut", {
          heading: EasyEditLocalise._("Warning: Version Mismatch"),
          message: EasyEditLocalise._("This is Edit+ %1, but you are running Squiz Matrix %2. Starting from Edit+ 5.1.0.0, only matching versions of Squiz Matrix and Edit+ are supported.", EasyEdit.EES_Version, EasyEdit.systemInfo.version),
          confirmFn: c
        }))
    },
    installationCheck: function() {
      if (171 > parseFloat(jQuery().jquery.replace(/\./g, ""))) return EasyEditOverlay.showOverlay("greyOut", {
        heading: "Warning",
        message: EasyEditLocalise._('The jQuery version referenced in the parse file (%1) is not up to date. This version requires 1.7.1. Please refer to the <a href="%2">Manual page</a>', jQuery().jquery, "http://manuals.matrix.squizsuite.net/ees/chapters/installation#Adding-the-Easy-Edit-Suite-to-your-Designs-Parse-File")
      }), !1;
      for (var a = document.getElementsByTagName("script"),
          b = !1, c = !1, d = 0, e = a.length; d < e; d += 1) - 1 !== a[d].src.indexOf("easyedit.min.js") && (b = !0), -1 !== a[d].src.indexOf("Libs/jquery/") && (c = !0);
      if (b && c) return EasyEditOverlay.showOverlay("greyOut", {
        heading: "Warning",
        message: EasyEditLocalise._('We have detected that your site design template requires some changes for this editing suite to work correctly. Please refer to our on-line manuals (<a href="%1">design template section</a>) for the correct approach.', "http://manuals.matrix.squizsuite.net/ees/chapters/installation#Adding-the-Easy-Edit-Suite-to-your-Designs-Parse-File")
      }), !1;
      if (!Squiz_Matrix_API.prototype.hasOwnProperty("getLineageFromUrl") || !Squiz_Matrix_API.prototype.hasOwnProperty("getUrlFromLineage")) return EasyEditOverlay.showOverlay("greyOut", {
        heading: "Warning",
        message: EasyEditLocalise._("We have detected that required JS API functions have not been enabled. Please ensure getLineageFromUrl and getUrlFromLineage are enabled for this version.")
      }), !1;
      if ("undefined" === typeof Viper) return EasyEditOverlay.showOverlay("greyOut", {
        heading: "Warning",
        message: EasyEditLocalise._("Viper is not correctly referenced, or missing from the parse file")
      }), !1;
      if ("undefined" === typeof HTMLCS) return EasyEditOverlay.showOverlay("greyOut", {
        heading: "Warning",
        message: EasyEditLocalise._("HTML Code Sniffer is not correctly referenced, or missing from the parse file")
      }), !1;
      if (EasyEditConfig.hasOwnProperty("contextsEnabled") && EasyEditConfig.contextsEnabled) {
        if (!Squiz_Matrix_API.prototype.hasOwnProperty("getAllContexts") || !Squiz_Matrix_API.prototype.hasOwnProperty("setContext") || !Squiz_Matrix_API.prototype.hasOwnProperty("getMetadataSchema")) return EasyEditOverlay.showOverlay("greyOut", {
          heading: "Warning",
          message: EasyEditLocalise._("We have detected that you are trying to use the context support features and the related JS API functions are not enabled. On the details screen of the JS API, <strong>please enable all functions under the 'Contexts' section<strong>.")
        }), !1;
        if (!Squiz_Matrix_API.prototype.hasOwnProperty("syncing_enabled") || !Squiz_Matrix_API.prototype.syncing_enabled) return EasyEditOverlay.showOverlay("greyOut", {
          heading: "Warning",
          message: EasyEditLocalise._("We have detected that you are trying to use the context support features and a related JS API setting is not enabled. On the details screen of the JS API, <strong>please enable 'Sync Contexts'<strong>.")
        }), !1
      }
      return !0
    },
    token: null,
    getToken: function(a) {
      var b = this;
      if (!b.token) {
        var c = document.getElementById("token");
        c && (b.token = c.value)
      }
      if (EasyEdit.isset(b.token)) return a.call(this, b.token), !1;
      c = EasyEditUrl.getURL().url;
      jQuery.ajax({
        type: "GET",
        url: c + "?SQ_ACTION=getToken",
        success: function(c) {
          b.token = c;
          a.call(b, b.token)
        }
      })
    },
    init: function() {
      var a = this;
      EasyEditEventManager.init();
      EasyEditEventManager.bind("EasyEditError", function() {
        var a = jQuery("#ees_errorNotification");
        a.length || (a = jQuery(EasyEdit.tmpl.render("id_tag", {
          tag: "a",
          id: "ees_errorNotification",
          content: EasyEditLocalise._("An error has occurred")
        })), a.hide().appendTo("body").fadeIn(500));
        var b = EasyEditErrorStack.getStack().slice().pop();
        a.text(b.getMessage());
        a.unbind("click").bind("click", function(a) {
          a.preventDefault();
          b.display()
        })
      });
      EasyEditUrl.init();
      a.browserRequirements();
      for (var b in a.plugins) "function" === typeof a.plugins[b].init && a.plugins[b].init.call(a.plugins[b]);
      EasyEditEventManager.trigger("EasyEditBeforeLoad");
      a.tmpl = new EasyEditTemplate;
      for (var c in EasyEditGlobalTemplates) EasyEditGlobalTemplates.hasOwnProperty(c) && a.tmpl.set(c, EasyEditGlobalTemplates[c]);
      a.tip = new EasyEditToolTipManager;
      a.wizard = EasyEditConfig.hasOwnProperty("createWizardCategories") ? new EasyEditAssetWizardManager(EasyEditConfig.createWizardCategories) : new EasyEditAssetWizardManager;
      if (!a.installationCheck()) return !1;
      var d = EasyEdit.getURL();
      if ("string" === typeof d.params.load_easy_edit && ("0" === d.params.load_easy_edit || "false" === d.params.load_easy_edit)) return !1;
      if ("string" === typeof d.params.mode) switch (d.params.mode) {
        case "embedded":
          a.embedMode = !0;
          jQuery("body").addClass("embedMode");
          EasyEditOverlay.hideOverlay();
          break;
        case "script":
          return jQuery("body").prepend('<div id="ees_greyOut"></div>'), this._executeScriptMode(), !1
      }
      a.embedMode || EasyEditOverlay.showOverlay("loading");
      b = [];
      b.push(function(b) {
        if (!EasyEditConfig.JSAPI || !(EasyEditConfig.JSAPI.key && "" !== EasyEditConfig.JSAPI.key)) {
          var c = new EasyEditError(EasyEditLocalise._("The JS API key is missing from the Edit+ configuration file. This must be fixed before Edit+ can load."));
          c.display()
        } else c = new EasyEditAPI, c.JSAPI && (c.JSAPI.getSystemInformation ? (c.queue("getSystemInformation", {}), c.expect(1).run(function(c) {
          if (c[0].data.error) {
            var f = c[0].data.error;
            "authError" === c[0].data.errorCode && (f = EasyEditLocalise._('The CSRF token does not seem to be available to Edit+, which is required for communication with Matrix. A "csrf_token" design area must be added to the Design file before Edit+ can load.'));
            (new EasyEditError(f)).display()
          } else EasyEdit.systemInfo = c[0].data, d = EasyEdit.getURL(),
            c = EasyEditUrl.getBaseSiteURL(), jQuery("head").append('<link rel="shortcut icon" href="' + c + '/__lib/web/images/icons/favicon.ico"/>'), a.doMatrixVersionMatch(b)
        }, c.runMode.BATCH)) : (c = new EasyEditError(EasyEditLocalise._('The "Get System Information" service has not been enabled in the JS API asset. This must be enabled before Edit+ can load.')), c.display()))
      });
      b.push(function(a) {
        EasyEditAssetManager.getCurrentAsset(function(b) {
          EasyEdit.isError(b) || a(b);
          EasyEditAssetManager.designStyleClasses(b, function(a) {
            void 0 !==
              a.wysiwygClasses && (EasyEditConfig.wysiwygClasses = a.wysiwygClasses);
            if (void 0 !== a.divClasses) {
              var b = EasyEditConfig.hasOwnProperty("classSelect") ? EasyEditConfig.classSelect : [];
              EasyEditConfig.classSelect = [];
              for (var b = b.concat(a.divClasses), a = [], c = 0; c < b.length; c++) void 0 !== b[c].value && void 0 === a[b[c].value] && (a[b[c].value] = 1, EasyEditConfig.classSelect.push(b[c]))
            }
          })
        })
      });
      b.push(function(a, b) {
        document.title = EasyEditConfig.titleBar.replace("@asset_name@", b.attribute("name"));
        jQuery("body[class*=Explorer]").length &&
          EasyEditEventManager.bind("EasyEditUrlChange", function() {
            document.title = EasyEditConfig.titleBar.replace("@asset_name@", b.attribute("name"))
          });
        a(b)
      });
      b = b.concat(a.initStack);
      b.push(function(a, b) {
        EasyEditComponents.init(b, a)
      });
      b.push(function() {
        a.browserRequirements();
        jQuery("body").append('<div id="ees_buildNumber">' + a.EES_ProductName + " v" + a.EES_Version + "</div>");
        EasyEdit._isLoaded = !0;
        EasyEditOverlay.hideOverlay("loading");
        EasyEditEventManager.trigger("EasyEditAfterLoad")
      });
      EasyEdit.util.async.series(b)
    },
    _getScriptPath: function() {
      var a = document.getElementsByTagName("script"),
        b = /\/__data\/ees\//;
      if (null !== this.scriptPath) return this.scriptPath;
      for (var c = 0, d = a.length; c < d; c += 1)
        if (a[c].src && a[c].src.match(b)) {
          filePath = a[c].src.split(b)[1];
          this.scriptPath = a[c].src.replace(filePath, "");
          break
        }
      return this.scriptPath
    },
    loadScripts: function(a, b) {
      var c = this;
      if (1 <= a.length) {
        var d = a.shift(),
          e = document.createElement("script");
        e.onreadystatechange = function() {
          !0 === /^(loaded|complete)$/.test(this.readyState) && c.loadScripts(a,
            b)
        };
        e.onload = function() {
          c.loadScripts(a, b)
        }; - 1 === d.indexOf("http") && (d = c._getScriptPath() + d);
        e.src = d;
        document.head ? document.head.appendChild(e) : document.getElementsByTagName("head")[0].appendChild(e)
      } else b.call(c)
    },
    _executeScriptMode: function() {
      var a = EasyEdit.getURL();
      "string" === typeof a.params.script && "" !== a.params.script && eval(unescape(a.params.script));
      "string" === typeof a.params.background && "none" === a.params.background && jQuery("body").addClass("noBackground")
    },
    sendRemoteCommand: function(a, b) {
      var c =
        this,
        d = c.getURL();
      if ("string" === typeof d.params.mode && "embedded" === d.params.mode && "string" === typeof document.referrer && "" !== document.referrer) {
        var d = document.referrer,
          e = "?"; - 1 !== d.indexOf("?") && (e = "&");
        d += e + "widget=MySourceMatrixIFrameWidget&script=" + a;
        e = jQuery('<iframe src="javascript:false;" name="remoteCommand" id="remoteCommand" style="display: none;" width="1" height="1" />');
        jQuery("body").append(e);
        jQuery("#remoteCommand").bind("load", function() {
          b.call(c);
          setTimeout(function() {
              jQuery("#remoteCommand").remove()
            },
            100)
        });
        e.attr("src", d)
      }
    },
    isLoaded: function() {
      return this._isLoaded
    },
    isError: function(a, b) {
      var c = "boolean" === typeof b ? b : !1,
        d = null;
      return null === a ? (c || (d = new EasyEditError(EasyEditLocalise._("Edit+ was unable to process this request. Please check your JS API configuration.")), d.display()), !0) : "object" === typeof a && (a instanceof EasyEditError || "undefined" !== typeof a.error) ? (c || (d = new EasyEditError(EasyEdit.getError(a)), d.display()), !0) : !1
    },
    getError: function(a) {
      if ("object" === typeof a) {
        if (a instanceof EasyEditError) return a.getMessage();
        if ("undefined" !== typeof a.error) return a.error
      }
      return null
    },
    cleanURL: function(a) {
      return EasyEditUrl.cleanURL(a)
    },
    getURL: function() {
      return this.url = EasyEditUrl.getURL()
    },
    getURLFromString: function(a) {
      return EasyEditUrl.getURLFromString(a)
    },
    buildEditURL: function(a) {
      return EasyEditUrl.buildEditURL(a)
    },
    getParam: function(a) {
      return EasyEditUrl.getParam(a)
    },
    filterErrorArray: function(a) {
      for (var b = [], c = 0, d = a.length; c < d; c++) EasyEdit.isError(a[c]) && b.push(a[c]);
      return b
    },
    getSimpleEditPostInfo: function(a, b, c) {
      var d =
        "process_form=1&backend_section=am&am_section=limbo&am_form_submitted=1&assetid=" + a + "&backend_assetid=" + a + "&asset_action=edit&asset_ei_screen=" + b.toLowerCase() + "&sq_lock_release=0&sq_lock_type=all",
        e;
      for (e in c) d += "&" + e + "=" + c[e];
      a = EasyEditUrl.getURL().url + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + a + "&SQ_BACKEND_PAGE=main&sq_link_path=&sq_asset_path=&asset_ei_screen=" + b;
      return {
        data: d,
        url: a
      }
    },
    filterScriptSrc: function(a) {
      return a = a.replace(RegExp('src="([^"]+)(var_serialise|general|debug|layer_handler|html_form|detect)".js',
        "gi"), "")
    },
    escapeRegExp: function(a) {
      return a.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\$|\\^|\\(|\\)|\\[|\\]|\\{|\\}|\\\\)", "g"), "\\$1")
    },
    loadViper: function(a) {
      var b = null,
        c = {
          toolbarContainer: jQuery(".ees_viperContent:first, #ees_viperContent", "#ees_mainContent"),
          standard: "WCAG2AA",
          editableDivs: [],
          scrollable: !0,
          scrollThreshold: 118,
          corePlugins: ["ViperCursorAssistPlugin", "ViperInlineToolbarPlugin", "ViperToolbarPlugin"],
          plugins: "ViperCoreStylesPlugin,ViperHistoryPlugin,ViperListPlugin,ViperFormatPlugin,ViperTableEditorPlugin,MatrixCopyPastePlugin,MatrixImagePlugin,MatrixLinkPlugin,MatrixCommentsPlugin,MatrixKeywordsPlugin,ViperAccessibilityPlugin,ViperSourceViewPlugin,ViperSearchReplacePlugin,ViperLangToolsPlugin,ViperCharMapPlugin".split(","),
          viperName: "content-screen",
          buttons: ["bold,italic,subscript,superscript,strikethrough,class".split(","), "removeFormat", ["justify", "formats", "headings"],
            ["undo", "redo"],
            ["unorderedList", "orderedList", "indentList", "outdentList"], "insertTable", "image", "hr", ["insertLink", "removeLink", "anchor"], "insertCharacter", "searchReplace", "langTools", "accessibility", "sourceEditor", ["insertKeywords", "insertSnippets"]
          ],
          inlineButtons: [
            ["bold", "italic", "class"],
            ["justify", "formats", "headings"],
            ["unorderedList", "orderedList",
              "indentList", "outdentList"
            ],
            ["insertLink", "removeLink", "anchor"],
            ["matrixComments"],
            ["image", "imageMove"]
          ]
        },
        d = {
          bold: "ViperCoreStylesPlugin",
          italic: "ViperCoreStylesPlugin",
          removeFormat: "ViperCoreStylesPlugin",
          subscript: "ViperCoreStylesPlugin",
          superscript: "ViperCoreStylesPlugin",
          strikethrough: "ViperCoreStylesPlugin",
          "class": "ViperFormatPlugin",
          justify: "ViperFormatPlugin",
          formats: "ViperFormatPlugin",
          headings: "ViperFormatPlugin",
          undo: "ViperHistoryPlugin",
          redo: "ViperHistoryPlugin",
          unorderedList: "ViperListPlugin",
          orderedList: "ViperListPlugin",
          indentList: "ViperListPlugin",
          outdentList: "ViperListPlugin",
          insertTable: "ViperTableEditorPlugin",
          image: "MatrixImagePlugin",
          imageMove: "MatrixImagePlugin",
          hr: "ViperCoreStylesPlugin",
          insertLink: "MatrixLinkPlugin",
          removeLink: "MatrixLinkPlugin",
          anchor: "ViperFormatPlugin",
          insertCharacter: "ViperCharMapPlugin",
          searchReplace: "ViperSearchReplacePlugin",
          langTools: "ViperLangToolsPlugin",
          accessibility: "ViperAccessibilityPlugin",
          sourceEditor: "ViperSourceViewPlugin",
          insertKeywords: "MatrixKeywordsPlugin",
          insertSnippets: "MatrixKeywordsPlugin",
          matrixComments: "MatrixCommentsPlugin"
        },
        e = jQuery.extend(c, a),
        a = {};
      EasyEditLocalise.language && (a.language = EasyEditLocalise.language);
      1 <= e.editableDivs.length && "undefined" !== typeof Viper && (b = new Viper(e.viperName, a, function(a) {
        var b = a.getPluginManager();
        if (e.scrollable) {
          var j = jQuery("body");
          jQuery(window).unbind("scroll.ees").bind("scroll.ees", function() {
            var a = false;
            if (jQuery(window).scrollTop() >= e.scrollThreshold) {
              if (j.hasClass("fixedScroll") === false) {
                j.addClass("fixedScroll");
                a = true
              }
            } else if (j.hasClass("fixedScroll") === true) {
              j.removeClass("fixedScroll");
              a = true
            }
            a === true && b.getPlugin("ViperToolbarPlugin").positionUpdated()
          })
        }
        b.setPlugins(c.corePlugins.concat(c.plugins));
        b.setPluginSettings("ViperInlineToolbarPlugin", {
          buttons: c.inlineButtons
        });
        b.setPluginSettings("ViperToolbarPlugin", {
          buttons: c.buttons
        });
        if (EasyEditConfig.hasOwnProperty("viperPlugins")) e.plugins = EasyEditConfig.viperPlugins;
        else {
          var h = EasyEdit.systemInfo.preferences.content_type_wysiwyg.SQ_VIPER_PLUGINS;
          if (h ===
            "all") e.plugins = c.plugins;
          else {
            for (var k = [], l = 0; l < c.plugins.length; l++) h.indexOf(c.plugins[l]) !== -1 && k.push(c.plugins[l]);
            e.plugins = k
          }
        }
        if (e.plugins.length > 0)
          for (l = 0; l < c.corePlugins.length; l++) e.plugins.unshift(c.corePlugins[l]);
        if (EasyEditConfig.hasOwnProperty("viperButtons")) e.buttons = EasyEditConfig.viperButtons;
        l = false;
        if (jQuery.inArray("MatrixCommentsPlugin", e.plugins) == -1) {
          e.plugins.push("MatrixCommentsPlugin");
          l = true
        }
        b.setPlugins(e.plugins);
        l && b.setPluginSettings("MatrixCommentsPlugin", {
          readOnly: true
        });
        h = e.buttons.concat([]);
        k = e.inlineButtons.concat([]);
        for (l = 0; l < h.length; l++)
          if (h[l] instanceof Array) {
            for (var n = 0; n < h[l].length; n++)
              if (EasyEdit.util.indexOf(e.plugins, d[h[l][n]]) === -1) {
                h[l].splice(n, 1);
                n--
              }
            if (h[l].length === 0) {
              h.splice(l, 1);
              l--
            }
          } else if (EasyEdit.util.indexOf(e.plugins, d[h[l]]) === -1) {
          h.splice(l, 1);
          l--
        }
        for (l = 0; l < k.length; l++)
          if (k[l] instanceof Array) {
            for (n = 0; n < k[l].length; n++)
              if (EasyEdit.util.indexOf(e.plugins, d[k[l][n]]) === -1) {
                k[l].splice(n, 1);
                n--
              }
            if (k[l].length === 0) {
              k.splice(l, 1);
              l--
            }
          } else if (EasyEdit.util.indexOf(e.plugins,
            d[k[l]]) === -1) {
          k.splice(l, 1);
          l--
        }
        b.setPluginSettings("ViperInlineToolbarPlugin", {
          buttons: k
        });
        b.setPluginSettings("ViperToolbarPlugin", {
          buttons: h
        });
        EasyEditConfig.hasOwnProperty("accessibilityStandard") ? b.setPluginSettings("ViperAccessibilityPlugin", {
          standard: EasyEditConfig.accessibilityStandard
        }) : b.setPluginSettings("ViperAccessibilityPlugin", {
          standard: e.standard
        });
        EasyEditConfig.hasOwnProperty("wysiwygClasses") !== void 0 && EasyEditConfig.wysiwygClasses && b.setPluginSettings("ViperFormatPlugin", {
          styles: EasyEditConfig.wysiwygClasses
        });
        (l = EasyEditUrl.getBaseSiteURL()) ? l.indexOf("://") === -1 && (l = "//" + l): l = "";
        b.setPluginSettings("ViperSourceViewPlugin", {
          jqueryURL: l + "/__lib/web/dfx/jquery.js"
        });
        (l = b.getPlugin("ViperToolbarPlugin")) && l.setParentElement(e.toolbarContainer.get(0));
        a.registerCallback("Viper:nodesChanged", "EES", function() {
          EasyEditComponentsToolbar.enableSaveButton()
        });
        e.editableDivs.each(function() {
          EasyEdit.addViperEditableElement(this, a)
        })
      }));
      return b
    },
    addViperEditableElement: function(a, b) {
      b.registerEditableElement(a);
      var c = jQuery(a),
        d = c.html();
      if (null !== d.match(/^\s+$/) || "" === d || null !== d.match(/^<p>[\s\n(&nbsp;)(<br\/>)]*<\/p>$/i)) c.html("<p></p>"), d = jQuery(EasyEdit.tmpl.render("simple_tag", {
          tag: "div",
          "class": "ees_viperEditCallToAction",
          content: EasyEditLocalise._("This area contains no content yet. Click here to start editing.")
        })), d.bind("mousedown", function(a) {
          a = Viper.Util.getMouseEventTarget(a);
          Viper.Util.remove(a);
          c.show();
          b.setEditableElement(c.get(0));
          b.setMemberElements([a]);
          b.setEnabled(!0)
        }), c.after(d),
        c.hide();
      c.bind("mousedown", function() {
        b.getViperElement() !== c.get(0) && b.setEditableElement(c.get(0))
      })
    },
    redirect: function(a) {
      var b = a.asset,
        c = new EasyEditAPI,
        d = EasyEditUrl.getURL();
      if (a.hasOwnProperty("lineage")) {
        var e = a.lineage.length;
        a.lineage = b.filterLineageToClosestSite(a.lineage);
        e !== a.lineage.length && a.hasOwnProperty("url") && delete a.url
      }
      EasyEditAssetManager.getCurrentAsset(function(e) {
        EasyEditOverlay.showOverlay("loading");
        var g = b.attribute("web_path"),
          j = location.href.replace(location.hash,
            ""),
          h = EasyEditUrl.getBaseSiteURL() + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + b.id,
          k = [];
        a.hasOwnProperty("screen") && (k.push("mode=edit"), k.push("screen=" + a.screen));
        "" !== g && !b.isFile() && (h = EasyEditUrl.buildEditURL(g));
        var l = !1;
        h === j && (l = !0);
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Redirecting") + "..."
        });
        if ("site" === b.attribute("type_code")) return 0 < k.length && (h += "#" + k.join("&")), window.location = h, l && EasyEditOverlay.hideOverlay("loading"), !1;
        if (a.hasOwnProperty("lineage")) {
          j =
            b.getTreeIdFromLineage(a.lineage);
          (b.isFile() || "poll_question" === b.attribute("type_code")) && EasyEdit.isset(j) && k.push("tree_id=" + encodeURIComponent(j));
          if (!b.isFile() && "poll_question" !== b.attribute("type_code")) return j = {
            lineage: a.lineage
          }, a.hasOwnProperty("url") && "" !== a.url && (j.root_url = a.url), c.queue("getUrlFromLineage", j).run(function(a) {
            if (EasyEdit.isset(a[0]))
              if (a[0].data.hasOwnProperty("error")) {
                if (a[0].data.errorCode === "notFound") {
                  (new EasyEditError(a[0].data.error)).display();
                  return false
                }
              } else {
                a =
                  a[0].data;
                if (a.length >= 2) {
                  var b = [],
                    c = EasyEditUrl.getBaseSiteURL();
                  if (c === "") c = d.host;
                  jQuery.each(a, function(a, e) {
                    var f = false;
                    e.indexOf(c) !== -1 && (f = true);
                    e.indexOf(d.url) !== -1 && (f = true);
                    f && b.push(e)
                  });
                  if (b.length >= 1) {
                    a = jQuery.map(b, function(a) {
                      if (a.indexOf(g) !== -1) return a
                    });
                    if (a.length > 0) h = a[0];
                    else {
                      a = jQuery.map(b, function(a) {
                        if (a.indexOf(location.protocol) === 0) return a
                      });
                      h = a.length > 0 ? a[0] : b[0]
                    }
                  } else h = a[0]
                } else h = a[0];
                if (h === d.url) {
                  EasyEditOverlay.hideOverlay();
                  return false
                }
                e.releaseLock("all", function() {
                  var a =
                    EasyEditUrl.buildEditURL(h);
                  k.length > 0 && (a = a + ("#" + k.join("&")));
                  window.location = a
                })
              }
          }), !1;
          if (e.id === b.id) return EasyEdit.isset(j) && b.isFile() ? EasyEditUrl.hash.push({
            tree_id: encodeURIComponent(j)
          }) : EasyEditUrl.hash.remove("tree_id"), EasyEditOverlay.hideOverlay("loading"), !1
        }
        j = e.getPrimarySite();
        if ((b.isFile() || "poll_question" === b.attribute("type_code")) && EasyEdit.isset(j) && j.hasOwnProperty("assetid")) return EasyEditAssetManager.getAsset(j.assetid, function(a) {
          h = a.attribute("web_path") + "/" + EasyEdit.systemInfo.suffixes.edit +
            "?limbo_assetid=" + b.id;
          e.releaseLock("all", function() {
            k.length > 0 && (h = h + ("#" + k.join("&")));
            window.location = h;
            l && EasyEditOverlay.hideOverlay("loading")
          })
        }), !1;
        e.releaseLock("all", function() {
          k.length > 0 && (h = h + ("#" + k.join("&")));
          window.location = h;
          l && EasyEditOverlay.hideOverlay("loading")
        })
      })
    },
    entitiesArray: {
      160: "&nbsp;",
      161: "&iexcl;",
      162: "&cent;",
      163: "&pound;",
      164: "&curren;",
      165: "&yen;",
      166: "&brvbar;",
      167: "&sect;",
      168: "&uml;",
      169: "&copy;",
      170: "&ordf;",
      171: "&laquo;",
      172: "&not;",
      173: "&shy;",
      174: "&reg;",
      175: "&macr;",
      176: "&deg;",
      177: "&plusmn;",
      178: "&sup2;",
      179: "&sup3;",
      180: "&acute;",
      181: "&micro;",
      182: "&para;",
      183: "&middot;",
      184: "&cedil;",
      185: "&sup1;",
      186: "&ordm;",
      187: "&raquo;",
      188: "&frac14;",
      189: "&frac12;",
      190: "&frac34;",
      191: "&iquest;",
      192: "&Agrave;",
      193: "&Aacute;",
      194: "&Acirc;",
      195: "&Atilde;",
      196: "&Auml;",
      197: "&Aring;",
      198: "&AElig;",
      199: "&Ccedil;",
      200: "&Egrave;",
      201: "&Eacute;",
      202: "&Ecirc;",
      203: "&Euml;",
      204: "&Igrave;",
      205: "&Iacute;",
      206: "&Icirc;",
      207: "&Iuml;",
      208: "&ETH;",
      209: "&Ntilde;",
      210: "&Ograve;",
      211: "&Oacute;",
      212: "&Ocirc;",
      213: "&Otilde;",
      214: "&Ouml;",
      215: "&times;",
      216: "&Oslash;",
      217: "&Ugrave;",
      218: "&Uacute;",
      219: "&Ucirc;",
      220: "&Uuml;",
      221: "&Yacute;",
      222: "&THORN;",
      223: "&szlig;",
      224: "&agrave;",
      225: "&aacute;",
      226: "&acirc;",
      227: "&atilde;",
      228: "&auml;",
      229: "&aring;",
      230: "&aelig;",
      231: "&ccedil;",
      232: "&egrave;",
      233: "&eacute;",
      234: "&ecirc;",
      235: "&euml;",
      236: "&igrave;",
      237: "&iacute;",
      238: "&icirc;",
      239: "&iuml;",
      240: "&eth;",
      241: "&ntilde;",
      242: "&ograve;",
      243: "&oacute;",
      244: "&ocirc;",
      245: "&otilde;",
      246: "&ouml;",
      247: "&divide;",
      248: "&oslash;",
      249: "&ugrave;",
      250: "&uacute;",
      251: "&ucirc;",
      252: "&uuml;",
      253: "&yacute;",
      254: "&thorn;",
      255: "&yuml;",
      402: "&fnof;",
      913: "&Alpha;",
      914: "&Beta;",
      915: "&Gamma;",
      916: "&Delta;",
      917: "&Epsilon;",
      918: "&Zeta;",
      919: "&Eta;",
      920: "&Theta;",
      921: "&Iota;",
      922: "&Kappa;",
      923: "&Lambda;",
      924: "&Mu;",
      925: "&Nu;",
      926: "&Xi;",
      927: "&Omicron;",
      928: "&Pi;",
      929: "&Rho;",
      931: "&Sigma;",
      932: "&Tau;",
      933: "&Upsilon;",
      934: "&Phi;",
      935: "&Chi;",
      936: "&Psi;",
      937: "&Omega;",
      945: "&alpha;",
      946: "&beta;",
      947: "&gamma;",
      948: "&delta;",
      949: "&epsilon;",
      950: "&zeta;",
      951: "&eta;",
      952: "&theta;",
      953: "&iota;",
      954: "&kappa;",
      955: "&lambda;",
      956: "&mu;",
      957: "&nu;",
      958: "&xi;",
      959: "&omicron;",
      960: "&pi;",
      961: "&rho;",
      962: "&sigmaf;",
      963: "&sigma;",
      964: "&tau;",
      965: "&upsilon;",
      966: "&phi;",
      967: "&chi;",
      968: "&psi;",
      969: "&omega;",
      977: "&thetasym;",
      978: "&upsih;",
      982: "&piv;",
      8226: "&bull;",
      8230: "&hellip;",
      8242: "&prime;",
      8243: "&Prime;",
      8254: "&oline;",
      8260: "&frasl;",
      8472: "&weierp;",
      8465: "&image;",
      8476: "&real;",
      8482: "&trade;",
      8501: "&alefsym;",
      8592: "&larr;",
      8593: "&uarr;",
      8594: "&rarr;",
      8595: "&darr;",
      8596: "&harr;",
      8629: "&crarr;",
      8656: "&lArr;",
      8657: "&uArr;",
      8658: "&rArr;",
      8659: "&dArr;",
      8660: "&hArr;",
      8704: "&forall;",
      8706: "&part;",
      8707: "&exist;",
      8709: "&empty;",
      8711: "&nabla;",
      8712: "&isin;",
      8713: "&notin;",
      8715: "&ni;",
      8719: "&prod;",
      8721: "&sum;",
      8722: "&minus;",
      8727: "&lowast;",
      8730: "&radic;",
      8733: "&prop;",
      8734: "&infin;",
      8736: "&ang;",
      8743: "&and;",
      8744: "&or;",
      8745: "&cap;",
      8746: "&cup;",
      8747: "&int;",
      8756: "&there4;",
      8764: "&sim;",
      8773: "&cong;",
      8776: "&asymp;",
      8800: "&ne;",
      8801: "&equiv;",
      8804: "&le;",
      8805: "&ge;",
      8834: "&sub;",
      8835: "&sup;",
      8836: "&nsub;",
      8838: "&sube;",
      8839: "&supe;",
      8853: "&oplus;",
      8855: "&otimes;",
      8869: "&perp;",
      8901: "&sdot;",
      8968: "&lceil;",
      8969: "&rceil;",
      8970: "&lfloor;",
      8971: "&rfloor;",
      9001: "&lang;",
      9002: "&rang;",
      9674: "&loz;",
      9824: "&spades;",
      9827: "&clubs;",
      9829: "&hearts;",
      9830: "&diams;"
    },
    fixHtml: function(a) {
      var b = "",
        c = a.length;
      for (i = 0; i < c; i++) code = a.charCodeAt(i), 127 < code ? b = (entity = this.entitiesArray[code]) ? b + entity : b + ("&#" + code + ";") : b += a.charAt(i);
      return b
    },
    statusChanges: {
      1: [0, 2, 0, 0, 0, 0, 0, 0, 0],
      2: [2, 2, 1, 0, 1, 0, 0, 0, 0],
      4: [0, 0, 0, 3, 0, 0, 0, 0, 0],
      8: [0, 0, 0, 0, 2, 0, 0, 0, 0],
      16: [2, 2, 0, 0, 0, 1, 1, 0, 0],
      32: [2, 0, 0, 0, 3, 0, 0, 0, 0],
      64: [0, 0, 0, 0, 0, 0, 0, 1, 2],
      128: [0, 0, 0, 0, 0, 0, 0, 0, 3],
      256: [0, 0, 0, 0, 2, 0, 0, 0, 0]
    },
    getRequirementForStatusChange: function(a, b) {
      var c = ["Invalid", "Write", "Admin", "Approver"];
      if (this.statusChanges.hasOwnProperty(a)) {
        var d = Math.log(b) / Math.log(2);
        return c[this.statusChanges[a][d]]
      }
      return c[0]
    },
    getStatusFromCode: function(a) {
      var b = {
          1: EasyEditLocalise._("Archived"),
          2: EasyEditLocalise._("Under Construction"),
          4: EasyEditLocalise._("Pending Approval"),
          8: EasyEditLocalise._("Approved To Go Live"),
          16: EasyEditLocalise._("Live"),
          32: EasyEditLocalise._("Up for Review"),
          64: EasyEditLocalise._("Safe Editing"),
          128: EasyEditLocalise._("Safe Editing Pending Approval"),
          256: EasyEditLocalise._("Safe Edit Approved To Go Live")
        },
        c = {
          className: "unknown",
          description: EasyEditLocalise._("Unknown")
        };
      b.hasOwnProperty(a) && (c = {
        className: b[a].toLowerCase().replace(/\s/g, ""),
        description: b[a]
      });
      return c
    },
    isset: function(a) {
      return "undefined" !==
        typeof a && null !== a ? !0 : !1
    },
    isFileAsset: function(a) {
      var b = !1;
      switch (a) {
        case "file":
        case "css_file":
        case "excel_doc":
        case "flv_file":
        case "image":
        case "data_source_graph":
        case "thumbnail":
        case "js_file":
        case "mp3_file":
        case "pdf_file":
        case "powerpoint_doc":
        case "rtf_file":
        case "text_file":
        case "video_file":
        case "word_doc":
        case "xml_file":
        case "xsl_file":
          b = !0
      }
      return b
    }
  };
document.write = function() {
  EasyEditDebug.log("document.write used", arguments)
};
window.onerror = function(a, b, c) {
  var d = ["this._iframe.contentWindow", "HTTPRequest call failed", "'null' is not an object"];
  "Safari" === EasyEdit.browser && d.push("INDEX_SIZE_ERR");
  0 === parseFloat(c) && d.push("Script error.");
  if (b.indexOf("Viper")) return !1;
  for (var e = 0, f = d.length; e < f; e += 1)
    if (-1 !== a.indexOf(d[e])) return !1;
  new EasyEditError({
    message: a,
    url: b,
    num: c
  })
};
jQuery(document).ready(function() {
  var a = jQuery('link[href$="limbo.css"]');
  0 < a.length && (a[0].disabled = !0);
  EasyEditDebug.start();
  EasyEdit.init()
});
var EasyEditUrl = {
  url: null,
  assetSiteUrls: {},
  init: function() {
    EasyEditEventManager.bind("EasyEditUrlChange", function() {})
  },
  hash: {
    pluginPresent: function() {
      if ("object" !== typeof jQuery.bbq) throw "Required jQuery plugin missing: jquery.ba-bbq.min.js";
      return !0
    },
    push: function() {
      EasyEditUrl.hash.pluginPresent() && jQuery.bbq.pushState.apply(jQuery, arguments)
    },
    get: function() {
      return EasyEditUrl.hash.pluginPresent() ? jQuery.bbq.getState.apply(jQuery, arguments) : null
    },
    remove: function() {
      EasyEditUrl.hash.pluginPresent() &&
        jQuery.bbq.removeState.apply(this, arguments)
    },
    isset: function() {
      return "undefined" === typeof EasyEditUrl.hash.get.apply(this, arguments) ? !1 : !0
    }
  },
  getClosestAssetUrl: function(a, b) {
    if (null !== b) {
      var c = null,
        d = null,
        e = null,
        f = null;
      for (i = 0; i < a.length; i++) {
        if (b === a[i]) return b;
        if (-1 !== a[i].indexOf("://")) {
          var g = a[i].split("://"),
            j = g[0],
            g = g[1].split("/"),
            c = b.split("://"),
            h = c[0],
            k = c[1].split("/"),
            d = a[i],
            c = 0;
          j === h && (c += 30);
          k.length === g.length && (c += 3);
          for (var l in g) g[l] === k[l] && (c = "0" === l ? c + 50 : c + 5);
          c > f && (f = c, e = d)
        }
      }
      return e
    }
  },
  cleanURL: function(a) {
    var b = null,
      a = (a + "").replace("/" + EasyEdit.systemInfo.suffixes.edit, ""),
      a = a.replace("/" + EasyEdit.systemInfo.suffixes.admin, ""),
      a = a.replace("/" + EasyEdit.systemInfo.suffixes.nocache, ""),
      a = a.replace("/" + EasyEdit.systemInfo.suffixes.recache, ""),
      a = a.replace("/" + EasyEdit.systemInfo.suffixes.login, ""); - 1 !== a.indexOf("?") && (b = a.split("?"), a = b[0]); - 1 !== a.indexOf("#") && (b = a.split("#"), a = b[0]);
    return a
  },
  isBaseSiteURL: function(a) {
    if ("string" === typeof a) return !1;
    var b = this.getURLFromString(a),
      c = this.getBaseSiteURL(),
      d = a.url + "/";
    return a.url === c || d === c || null !== b.protocol && 3 >= (a.length - a.replace(RegExp("/", "g"), "").length) / 1 ? !0 : !1
  },
  getURL: function() {
    return this.url = this.getURLFromString(document.location.href)
  },
  getURLFromString: function(a) {
    a = {
      full: a,
      url: a,
      host: null,
      protocol: null,
      relative: !1,
      query: null,
      params: {},
      anchor: null,
      origin: a.split("#")[0],
      assetid: null,
      simple_edit_url: !1,
      admin_url: !1,
      shadow_assetid: !1
    }; - 1 !== a.full.indexOf("://") && (a.protocol = a.full.split("://")[0], a.host = a.full.split("://",
      2)[1].split("/")[0]);
    !RegExp("^(http|https)", "gi").test(a.full) && null === a.protocol && (a.relative = !0);
    var b = null;
    if (-1 !== a.full.indexOf("?")) {
      b = a.full.split("?", 2);
      a.query = b[1];
      a.url = b[0]; - 1 !== b[1].indexOf("#") && (a.anchor = b[1].split("#")[1], a.query = b[1].split("#")[0]);
      for (var b = b[1].split("#")[0].split("&") || 0, c = 0, d = b.length; c < d; c++)
        if (-1 !== b[c].indexOf("=")) {
          var e = b[c].split("="),
            f = e.shift();
          a.params[f] = e.join("=").replace("+", " ")
        }
    } else -1 !== a.full.indexOf("#") ? (b = a.full.split("#", 2), a.url = b[0], a.anchor =
      b[1]) : a.url = a.full;
    if (EasyEdit.systemInfo.suffixes && (-1 !== a.full.indexOf("/" + EasyEdit.systemInfo.suffixes.edit) && (a.simple_edit_url = !0, a.url = a.full.split("/" + EasyEdit.systemInfo.suffixes.edit)[0]), -1 !== a.full.indexOf("/" + EasyEdit.systemInfo.suffixes.admin) && (a.admin_url = !0, a.url = a.full.split("/" + EasyEdit.systemInfo.suffixes.admin)[0]), -1 !== a.full.indexOf("/" + EasyEdit.systemInfo.suffixes.nocache) && (a.url = a.full.split("/" + EasyEdit.systemInfo.suffixes.nocache)[0]), -1 !== a.full.indexOf("/" + EasyEdit.systemInfo.suffixes.recache) &&
        (a.url = a.full.split("/" + EasyEdit.systemInfo.suffixes.recache)[0]), -1 !== a.full.indexOf("/" + EasyEdit.systemInfo.suffixes.login))) a.url = a.full.split("/" + EasyEdit.systemInfo.suffixes.login)[0]; - 1 !== a.full.indexOf("/__data") && (b = RegExp("/__data/assets/([^/]+)/([0-9]+)/([0-9]+)/(.*)$", "gi").exec(a.full), null !== b && 5 === b.length && (a.file = {}, a.file.type_code = b[1], a.assetid = b[3], a.file.name = b[4]), a.url = a.full.split("/__data")[0]);
    "undefined" !== typeof a.params.a && a.params.a.match(":") && (a.shadow_assetid = !0);
    "undefined" !== typeof a.params.a && /^[0-9]+$/.test(a.params.a) ? a.assetid = a.params.a : "undefined" !== typeof a.params.limbo_assetid && /^[0-9]+$/.test(a.params.limbo_assetid) && (a.assetid = a.params.limbo_assetid);
    /\/$/g.test(a.url) && (a.url = a.url.substring(0, a.url.length - 1));
    return a
  },
  buildEditURL: function(a) {
    var b = this.getURLFromString(a);
    return b.simple_edit_url ? a : "undefined" !== typeof b.file ? this.getBaseSiteURL() + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + b.assetid : a + ("/" === a.charAt(a.length -
      1) ? "" : "/") + EasyEdit.systemInfo.suffixes.edit
  },
  getParam: function(a) {
    null === this.url && this.getURL();
    return "object" === typeof this.url.params && "string" === typeof this.url.params[a] ? this.url.params[a] : null
  },
  getBaseSiteURL: function() {
    var a = "",
      b = this.getURL();
    if (EasyEditConfig.hasOwnProperty("baseSiteUrls") && 1 <= EasyEditConfig.baseSiteUrls.length)
      for (var c = 0, d = EasyEditConfig.baseSiteUrls.length; c < d; c += 1) - 1 !== b.url.indexOf(EasyEditConfig.baseSiteUrls[c]) && (a = EasyEditConfig.baseSiteUrls[c]);
    return a
  },
  getSiteUrlForAsset: function(a,
    b) {
    var c = this,
      d = new EasyEditAPI;
    if (c.assetSiteUrls.hasOwnProperty(a.id)) return b.call(this, c.assetSiteUrls[a.id]), !1;
    var e = a.getPrimarySite(a.attribute("web_path"));
    e.hasOwnProperty("assetid") ? (d.queue("getKeywordsReplacements", {
      asset_id: e.assetid,
      keywords_array: ["%asset_url%"]
    }), d.expect(1).run(function() {
      c.assetSiteUrls[a.id] = d.getResult(0, "asset_url");
      b.call(this, c.assetSiteUrls[a.id])
    })) : b.call(this, null)
  }
};

function EasyEditAPI() {
  if ("function" !== typeof Squiz_Matrix_API) {
    var a = new EasyEditError(EasyEditLocalise._("Squiz Matrix JS API not found. Please check configuration."));
    a.display();
    return !1
  }
  try {
    this.JSAPI = new Squiz_Matrix_API({
      key: EasyEditConfig.JSAPI.key
    })
  } catch (b) {
    return a = new EasyEditError(EasyEditLocalise._("Failed to initialise JS API client: %1", b)), a.display(), !1
  }
  this.queued = [];
  this.results = null;
  for (a in this.JSAPI) "function" === typeof this.JSAPI[a] && 1 !== a.indexOf("_") && (this.JSAPI[a] = this.buildDeferred(a,
    this.JSAPI[a]));
  this.events = new ObservableEvents(this)
}
EasyEditAPI.instance = null;
EasyEditAPI.getInstance = function() {
  null === EasyEditAPI.instance && (EasyEditAPI.instance = new EasyEditAPI);
  return EasyEditAPI.instance
};
EasyEditAPI.prototype = {
  runMode: {
    ASYNC: 1,
    SYNC: 2,
    BATCH: 3
  },
  queue: function(a, b, c) {
    var c = "boolean" === typeof c ? c : !1,
      d = null;
    if ("function" !== typeof this.JSAPI[a]) return d = new EasyEditError(EasyEditLocalise._("JSAPI function queued does not exist: %1", a)), d.display(), !1;
    for (var d = this.JSAPI[a].call(Squiz_Matrix_API.prototype), e = [], f = 0, g = d.required.length; f < g; f += 1) b.hasOwnProperty(d.required[f]) || e.push(d.required[f]);
    if (!b.hasOwnProperty("dataCallback")) {
      var j = jQuery.Deferred();
      b.dataCallback = function() {
        j.resolve()
      }
    }
    if (1 <=
      e.length) throw d = new EasyEditError(EasyEditLocalise._("JSAPI function call queued (%1) was missing required arguments: %2", a, e.join(", "))), d.display(), d.getMessage();
    a = {
      fnName: a,
      args: b,
      block: c
    };
    EasyEditDebug.log("API queue", a);
    this.queued.push(a);
    this.events.trigger("queue", a);
    return this
  },
  getQueued: function() {
    return this.queued
  },
  getQueueLength: function() {
    return this.queued.length
  },
  expect: function(a) {
    var b = this;
    return "function" === typeof a && a.call(b) || "number" === typeof a && a === b.queued.length ? b : {
      run: function(a) {
        var d =
          new EasyEditError(EasyEditLocalise._("The API could not run() the function correctly because the queue length was unexpected"));
        d.display();
        b.reset();
        a.call(b, d.getObject())
      }
    }
  },
  run: function(a, b) {
    var c = this,
      d = "function" === typeof a ? a : function() {};
    mode = b;
    c.results = null;
    if (0 === c.queued.length) return d.call(c, null), !1;
    switch (mode) {
      case c.runMode.BATCH:
        c.callNextBatch(function() {
          c.reset();
          c.events.trigger("run_batch_complete");
          d.call(c, c.results)
        });
        EasyEditDebug.log("API batch start", c.queued);
        c.events.trigger("run_batch");
        break;
      case c.runMode.SYNC:
        var e = function(a) {
          a ? c.callNextSynchronous(e) : (c.reset(), c.events.trigger("run_sync_complete"), d.call(c, c.results))
        };
        e(!0);
        EasyEditDebug.log("API sync start", c.queued);
        c.events.trigger("run_sync");
        break;
      default:
      case c.runMode.ASYNC:
        c.callNextAsynchronous(function() {
          c.reset();
          c.events.trigger("run_async_complete");
          d.call(c, c.results)
        }), EasyEditDebug.log("API async start", c.queued), c.events.trigger("run_async")
    }
  },
  reset: function() {
    this.queued = [];
    this.events.trigger("reset");
    EasyEditDebug.log("API reset")
  },
  createKeyword: function(a, b) {
    return "%results_" + a + "_" + b + "%"
  },
  parseKeyword: function(a) {
    var b = RegExp("%results_([0-9]+)_([^%]+)%", "gi").exec(a);
    return null !== a ? {
      keyword: b[0],
      index: b[1],
      property: b[2]
    } : null
  },
  hasKeyword: function(a) {
    return "string" === typeof a && -1 !== a.indexOf("%results_") ? !0 : !1
  },
  filterBatchArguments: function(a, b) {
    var c = jQuery.extend({}, b, !0);
    c.hasOwnProperty("asset_id") && (c.id = c.asset_id);
    c.hasOwnProperty("assetid") && (c.id = c.assetid);
    switch (a) {
      case "getKeywordsReplacements":
        c.hasOwnProperty("keywords_array") &&
          (c.keywords = c.keywords_array.join("\\,"), delete c.keywords_array);
        break;
      case "getChildCount":
        c.hasOwnProperty("level") && (c.levels = c.level, delete c.level);
        break;
      case "setMultipleAttributes":
        if (c.hasOwnProperty("field_info")) {
          var d = [],
            e = [],
            f;
          for (f in c.field_info) c.field_info.hasOwnProperty(f) && (d.push(f), e.push(c.field_info[f]));
          c.attr_name = d.join("\\,");
          c.attr_val = e.join("\\,");
          delete c.field_info
        }
        break;
      case "setWebPath":
        c.hasOwnProperty("paths") && (c.webpath = c.paths.join("\\,"), delete c.paths);
        break;
      case "acquireLock":
        c.hasOwnProperty("screen_name") && (c.screen = c.screen_name, delete c.screen_name);
        break;
      case "createFileAsset":
        c.hasOwnProperty("parentID") && (c.id = c.parentID, delete c.parentID);
        break;
      case "removeLink":
      case "createLink":
      case "moveLink":
        c.hasOwnProperty("child_id") && (c.id = c.child_id, delete c.child_id);
        break;
      case "createAsset":
        c.hasOwnProperty("attributes") && c.hasOwnProperty("extra_attributes") && (c.extra_attributes = c.extra_attributes + "&" + c.attributes, delete c.attributes);
        c.hasOwnProperty("parent_id") &&
          (c.id = c.parent_id, delete c.parent_id);
        break;
      case "updateMultipleLinks":
        if (c.hasOwnProperty("link_info") && c.link_info.hasOwnProperty("links")) {
          var e = c.link_info.links,
            g = [],
            j = [],
            h = [],
            k = [],
            l = [],
            n = [],
            m = [],
            o = [];
          f = 0;
          for (d = e.length; f < d; f += 1) g.push(e[f].child), j.push(e[f].parent), h.push(e[f].link_type), k.push(e[f].link_value), l.push(e[f].existing_link_type), n.push(e[f].existing_link_value), m.push(e[f].sort_order), o.push(e[f].link_lock);
          delete c.link_info;
          c.child_id = g.join("\\,");
          c.parent_id = j.join("\\,");
          c.link_type = h.join("\\,");
          c.link_value = k.join("\\,");
          c.existing_link_type = l.join("\\,");
          c.existing_link_value = n.join("\\,");
          c.sort_order = m.join("\\,");
          c.locked = o.join("\\,")
        }
        break;
      case "removeMultipleLinks":
        if (c.hasOwnProperty("link_info") && c.link_info.hasOwnProperty("links")) {
          e = c.link_info.links;
          g = [];
          j = [];
          h = [];
          k = [];
          f = 0;
          for (d = e.length; f < d; f += 1) g.push(e[f].child), j.push(e[f].parent), h.push(e[f].link_type), k.push(e[f].link_value);
          delete c.link_info;
          c.child_id = g.join("\\,");
          c.parent_id = j.join("\\,");
          c.link_type = h.join("\\,");
          c.link_value = k.join("\\,")
        }
        break;
      case "getUrlFromLineage":
        if (c.hasOwnProperty("lineage")) {
          e = [];
          f = 0;
          for (d = options.lineage.length; f < d; f += 1) c.lineage[assetid].hasOwnProperty("assetid") ? e.push(c.lineage[assetid].assetid) : e.push(c.lineage[assetid]);
          c.lineage = e
        }
        break;
      case "updateQuestionOrder":
        c.sort_order = c.sort_order.join("\\,");
        break;
      case "updateQuestion":
        d = "";
        for (f in c.field_info) d = "[object Array]" === Object.prototype.toString.call(c.field_info[f]) ? d + ("&" + encodeURIComponent(f) +
          "=" + encodeURIComponent(c.field_info[f].join("\\,"))) : d + ("&" + encodeURIComponent(f) + "=" + encodeURIComponent(c.field_info[f]));
        delete c.field_info;
        c.question_data = d
    }
    return c
  },
  callNextBatch: function(a) {
    if (1 <= this.queued.length) {
      for (var b = {
          functions: {}
        }, c = 0, d = this.queued.length; c < d; c += 1) b.functions[c] = {
        "function": this.queued[c].fnName,
        args: this.filterBatchArguments(this.queued[c].fnName, this.queued[c].args),
        block: this.queued[c].block
      };
      jQuery.when(this.JSAPI.batchRequest(b)).done(function() {
        a.call(this, !0)
      })
    } else a.call(this, !1)
  },
  callNextAsynchronous: function(a) {
    if (1 <= this.queued.length) {
      for (var b = [], c = 0, d = this.queued.length; c < d; c += 1) b.push(this.JSAPI[this.queued[c].fnName].call(this.JSAPI, this.queued[c].args));
      this.queued = [];
      jQuery.when.apply(this, b).done(function() {
        a.call(this, !0)
      })
    } else a.call(this, !1)
  },
  callNextSynchronous: function(a) {
    var b = this;
    if (1 <= b.queued.length) {
      var c = b.queued.shift(),
        d = "",
        e = null,
        f;
      for (f in c.args) b.hasKeyword(c.args[f]) && (d = b.parseKeyword(c.args[f]), null !== d && (e = b.getResult(d.index,
        d.property), c.args[f] = c.args[f].replace(d.keyword, null !== e ? e : "")));
      jQuery.when(b.JSAPI[c.fnName].call(b.JSAPI, c.args)).done(function() {
        a.call(b, 1 <= b.queued.length)
      }).fail(function() {
        c.block ? a.call(b, !1) : a.call(b, !0)
      })
    } else a.call(b, !1)
  },
  getResult: function(a, b) {
    return "undefined" !== typeof this.results[a] && "undefined" !== typeof this.results[a].data[b] ? this.results[a].data[b] : null
  },
  pushResult: function(a, b) {
    null === this.results && (this.results = []);
    this.results.push({
      fnName: a,
      data: b,
      remainingFns: this.queued.length
    })
  },
  buildDeferred: function(a, b) {
    var c = this,
      d = Squiz_Matrix_API.prototype;
    Squiz_Matrix_API.prototype.key = EasyEditConfig.JSAPI.key;
    return function(e) {
      if ("object" !== typeof e) return b.call(d);
      EasyEditDebug.log("API CALL: ", a);
      var f = jQuery.Deferred();
      e.dataCallback = function(b) {
        if ("batchRequest" !== a) c.pushResult(a, b);
        else {
          b.hasOwnProperty("error") && c.pushResult(a, b);
          for (var d in b) b.hasOwnProperty(d) && c.queued.hasOwnProperty(d) && c.pushResult(c.queued[d].fnName, b[d])
        }
        f.resolve()
      };
      b.call(d, e);
      return f.promise()
    }
  }
};
(function(a, b) {
  var c = Array.prototype.slice,
    d = EasyEdit.util = {};
  d.partial = function(a) {
    var b = c.call(arguments, 1);
    return function() {
      return a.apply(this, b.concat(c.call(arguments, 0)))
    }
  };
  d.unique = function() {
    for (var a = {}, b = [], c = 0, d = this.length; c < d; ++c) a.hasOwnProperty(this[c]) || (b.push(this[c]), a[this[c]] = 1);
    return b
  };
  var e = d.isArray = function(a) {
      return "[object Array]" === Object.prototype.toString.call(a)
    },
    f = d.isString = function(a) {
      return "string" === typeof a
    },
    g = d.isFunction = function(a) {
      return "function" === typeof a
    },
    j = d.isNumber = function(a) {
      return "number" === typeof a
    },
    h = d.isUndefined = function(a) {
      return a === b
    },
    k = d.isNull = function(a) {
      return null === a
    };
  d.isEmpty = function(a) {
    return e(a) ? 0 === a.length : f(a) ? "" === a || /^\s+$/.test(a) : h(a) || k(a)
  };
  var l = d.has = function(a, b) {
    return a.hasOwnProperty(b)
  };
  d.formatNumber = function(a, c) {
    c === b && (c = 0);
    var a = "" + Math.round(a * Math.pow(10, c)),
      d = 3;
    0 < c && (a.length < c + 1 && (a = Array(2 + c - a.length).join("0") + a), a = a.substr(0, a.length - c) + "." + a.substr(a.length - c), d += c + 1);
    for (; d < a.length;) a = a.substr(0,
      a.length - d) + "," + a.substr(a.length - d), d += 4;
    return a
  };
  d.setText = function(a, c) {
    a.innerText !== b ? a.innerText = c : a.textContent !== b && (a.textContent = c)
  };
  d.getText = function(a) {
    if (a.innerText !== b) return a.innerText;
    if (a.textContent !== b) return a.textContent
  };
  d.ordinal = function(a) {
    var b = a = Math.floor(a),
      a = a % 100;
    return 11 <= a && 20 >= a ? b + "th" : 3 === a % 10 ? b + "rd" : 2 === a % 10 ? b + "nd" : 1 === a % 10 ? b + "st" : b + "th"
  };
  d.ucWords = function(a) {
    return a.split(" ").map(function(a) {
      return 0 < a.length ? a.substr(0, 1).toUpperCase() + a.substr(1) : ""
    }).join(" ")
  };
  var n = d.utf8ByteLength = function(a) {
      var b = ("" + a).length;
      try {
        var c = a.match(/[\uD800-\uDBFF]/g);
        null !== c && (b -= c.length);
        var d = encodeURIComponent(a).match(/%[89AB]/g);
        null !== d && (b += d.length)
      } catch (e) {
        b = null
      }
      return b
    },
    m = d.size = function(a) {
      if (e(a) || f(a)) return a.length;
      var b = 0;
      p(a, function() {
        b += 1
      });
      return b
    };
  d.difference = function(a, b) {
    var c = [];
    p(a, function(a, d) {
      var e = !1;
      p(b, function(a, b) {
        d == b && (e = !0)
      });
      e || c.push(d)
    });
    return c
  };
  var o = d.serialise = function(a) {
      var b = "";
      switch (null === a ? "null" : !1 === a || !0 === a ?
        "boolean" : e(a) ? "array" : f(a) ? "string" : g(a) ? "function" : h(a) ? "undefined" : k(a) ? "null" : j(a) ? "number" : "object") {
        case "null":
          b += "N;";
          break;
        case "boolean":
          b += "b:" + (!0 === a ? 1 : 0) + ";";
          break;
        case "array":
          var c = m(a),
            b = b + ("a:" + c + ":{");
          p(a, function(a, c) {
            b += o(a) + o(c)
          });
          b += "}";
          break;
        case "number":
          b = Math.floor(a) === a ? b + ("i:" + a + ";") : b + ("d:" + a + ";");
          break;
        case "string":
          b += "s:" + n(a) + ':"' + a + '";';
          break;
        case "object":
          b += "a:" + m(a) + ":{", p(a, function(a, c) {
            b += o(a) + o(c)
          }), b += "}"
      }
      return b
    },
    r = d.unserialise = function(a) {
      if ("string" !==
        typeof a) return a;
      if (/^\s*$/.test(a)) return [];
      var b = [],
        c = null;
      switch (a.charAt(0)) {
        case "a":
          var b = /\{([^\}]*)\}/.exec(a),
            a = [],
            d = [];
          if (null !== b && -1 !== b[1].indexOf(";")) {
            options = b[1].split(";").slice(0, -1);
            for (var b = 0, e = options.length; b < e; b += 1) 0 === b % 2 ? a.push(r(options[b])) : d.push(r(options[b]));
            c = s(a, function(a, b) {
              return j(b)
            }).length === a.length ? [] : {};
            p(a, function(a, b) {
              "undefined" !== typeof d[a] && (c[b] = d[a])
            })
          } else c = [];
          break;
        case "s":
          b = /^s:([0-9]+):\"(.*)\"$/i.exec(a);
          null !== b && (c = b[2]);
          break;
        case "i":
          b =
            /^i:([+-]?[0-9]+)$/i.exec(a);
          null !== b && (c = parseFloat(b[1]));
          break;
        case "N":
          c = null;
          break;
        case "b":
          b = /^b:(0|1)$/i.exec(a);
          null !== b && (c = "1" === b[1] ? !0 : !1);
          break;
        case "d":
          b = /^d:([0-9]+(\.[0-9]+)?)$/.exec(a);
          null !== b && (c = parseFloat(b[1]));
          break;
        default:
          throw EasyEditLocalise._("Unable to parse serialised data");
      }
      return c
    },
    p = d.each = function(a, b, c) {
      c = h(c) ? this : c;
      if (e(a))
        for (var d = 0, f = a.length; d < f; d += 1) b.call(c, d, a[d]);
      else
        for (d in a) l(a, d) && b.call(c, d, a[d])
    };
  Array.prototype.map || (Array.prototype.map = function(a,
    b) {
    var c, d, e;
    if (null == this) throw new TypeError("this is null or not defined");
    var f = Object(this),
      k = f.length >>> 0;
    if ("function" !== typeof a) throw new TypeError(a + " is not a function");
    1 < arguments.length && (c = b);
    d = Array(k);
    for (e = 0; e < k;) {
      var g;
      e in f && (g = f[e], g = a.call(c, g, e, f), d[e] = g);
      e++
    }
    return d
  });
  d.range = function(a, b) {
    var c = Array.apply(null, Array(b));
    return q(c, function(b) {
      return b + a
    })
  };
  d.indexOf = function(a, b) {
    if (Array.prototype.hasOwnProperty("indexOf") && e(a)) return a.indexOf(b);
    var c = -1;
    p(a, function(a,
      d) {
      c === -1 && d === b && (c = a)
    });
    return c
  };
  d.contains = function(a, b) {
    var c = false;
    p(a, function(a, d) {
      b === d && (c = true)
    });
    return c
  };
  var s = d.filter = function(a, b) {
      var c = [];
      p(a, function(a, d) {
        b(a, d) && c.push(d)
      });
      return c
    },
    q = d.map = function(a, b) {
      var c = [];
      p(a, function(a, d) {
        c.push(b.call(this, a, d))
      });
      return c
    };
  d.async = {};
  d.async.series = function() {
    var a = e(arguments[0]) ? arguments[0] : c.call(arguments),
      b = this,
      d = function() {
        var e = c.call(arguments),
          f = function() {
            d.apply(this, c.call(arguments))
          };
        a.length >= 1 && a.shift().apply(b, [f].concat(e))
      },
      f = [];
    if (e(arguments[0]) === true) {
      f = c.call(arguments);
      f.shift()
    }
    d.apply(b, f)
  };
  d.async.parallel = function() {
    var a = e(arguments[0]) ? arguments[0] : c.call(arguments),
      b = this,
      d = a.pop();
    if (!g(d)) return false;
    var f = 0,
      k = a.length;
    p(a, function(a, c) {
      c.call(b, function() {
        f = f + 1;
        f >= k && d.call(b)
      })
    })
  };
  (function(a) {
    var b = a(window);
    a.fn.visible = function(a, c, d) {
      if (!(this.length < 1)) {
        var e = this.length > 1 ? this.eq(0) : this,
          f = e.get(0),
          k = b.width(),
          g = b.height(),
          d = d ? d : "both",
          c = c === true ? f.offsetWidth * f.offsetHeight : true;
        if (typeof f.getBoundingClientRect === "function") {
          var h = f.getBoundingClientRect(),
            f = h.top >= 0 && h.top < g,
            e = h.bottom > 0 && h.bottom <= g,
            g = h.left >= 0 && h.left < k,
            h = h.right > 0 && h.right <= k,
            f = a ? f || e : f && e,
            a = a ? g || h : g && h;
          if (d === "both") return c && f && a;
          if (d === "vertical") return c && f;
          if (d === "horizontal") return c && a
        } else {
          var f = b.scrollTop(),
            g = f + g,
            h = b.scrollLeft(),
            k = h + k,
            j = e.offset(),
            l = j.top,
            n = l + e.height(),
            j = j.left,
            m = j + e.width(),
            e = a === true ? n : l,
            l = a === true ? l : n,
            n = a === true ? m : j,
            a = a === true ? j : m;
          if (d === "both") return !!c && l <= g && e >= f &&
            a <= k && n >= h;
          if (d === "vertical") return !!c && l <= g && e >= f;
          if (d === "horizontal") return !!c && a <= k && n >= h
        }
      }
    }
  })(jQuery)
})("undefined" !== typeof window ? window : this);
var BrowserDetect = {
  init: function() {
    this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
    this.version = this.searchVersion(navigator.userAgent) || this.searchVersion(navigator.appVersion) || "an unknown version"
  },
  searchString: function(a) {
    for (var b = 0; b < a.length; b++) {
      var c = a[b].string,
        d = a[b].prop;
      this.versionSearchString = a[b].versionSearch || a[b].identity;
      if (c) {
        if (-1 !== c.indexOf(a[b].subString)) return a[b].identity
      } else if (d) return a[b].identity
    }
  },
  searchVersion: function(a) {
    var b = a.indexOf(this.versionSearchString);
    if (-1 !== b) return parseFloat(a.substring(b + this.versionSearchString.length + 1))
  },
  dataBrowser: [{
    string: navigator.vendor,
    subString: "Apple",
    identity: "Safari",
    versionSearch: "Version"
  }, {
    string: navigator.userAgent,
    subString: "Firefox",
    identity: "Firefox"
  }, {
    string: navigator.userAgent,
    subString: "Chrome",
    identity: "Chrome"
  }, {
    string: navigator.userAgent,
    subString: "MSIE",
    identity: "Explorer",
    versionSearch: "MSIE"
  }, {
    string: navigator.userAgent,
    subString: "Trident",
    identity: "Explorer",
    versionSearch: "rv"
  }]
};

function EasyEditAsset(a, b) {
  this.parentIds = this.metadataValues = null;
  this.attr = {
    short_name: null,
    name: null,
    type_code: null,
    link_type: 1,
    link_value: "",
    status: null,
    web_path: null,
    created: null,
    updated: null,
    published: null,
    thumbnail: null,
    sort_order: -1,
    can_live_edit: null,
    effective_write: null
  };
  this.events = new ObservableEvents(this, ["saved", "updated"]);
  this.screen_features = {
    attribute: !1,
    publishing: !1
  };
  this.hasWorkflowApplied = null;
  this.runningWorkflow = !1;
  this.statusCascade = this.statusChange = 0;
  this.changedAttributes = [];
  this.primaryLineage = this.rawLineageData = this.lineageOrdered = this.lineage = null;
  this.linkedInTrash = !1;
  this.siteId = null;
  this.id = "object" !== typeof a ? a : null;
  "object" === typeof b && (this.attributes(b), this.resetChangedAttributes())
}
EasyEditAsset.prototype = {
  attribute: function() {
    return 1 < arguments.length ? (this._flagScreenFeatureChange("attribute"), this.changedAttributes.push(arguments[0]), this.attr[arguments[0]] = arguments[1], this.events.trigger("updated", {
      updated: "attribute",
      args: {
        name: arguments[0],
        value: arguments[1]
      }
    }), null) : "undefined" === typeof this.attr[arguments[0]] ? null : this.attr[arguments[0]]
  },
  attributes: function(a) {
    if ("object" === typeof a) {
      for (var b in a) this.changedAttributes.push(b), this.attribute(b, a[b]);
      this.events.trigger("updated", {
        updated: "attribute",
        args: a
      })
    } else return this.attr
  },
  _getAssetInfoFromLineageIndex: function(a) {
    return "undefined" !== typeof this.rawLineageData[a] ? this.rawLineageData[a] : null
  },
  setLineage: function(a) {
    function b(d, e) {
      for (var f = 4 * (d.length / 4 + 1), g = 0, j = a.length; g < j; g += 1) a[g].tree_id.length === f && 0 === a[g].tree_id.indexOf(d) && (e[a[g].assetid] = {
        tree_id: a[g].tree_id,
        lineageData: function() {
          return c._getAssetInfoFromLineageIndex(g)
        },
        children: b(a[g].tree_id, {})
      });
      return e
    }
    var c = this,
      d = {},
      e = [];
    c.rawLineageData = a;
    c.getCurrentLinks();
    for (var f = 0, g = a.length; f < g; f += 1) {
      if ("trash_folder" === a[f].type_code || "trash_folder" === a[f].parent_type_code) c.linkedInTrash = !0;
      ("site" === a[f].type_code || "web_folder_media" === a[f].type_code) && e.push(a[f]);
      4 === a[f].tree_id.length && "trash_folder" !== a[f].type_code && (d[a[f].assetid] = {
        tree_id: a[f].tree_id,
        lineageData: function() {
          return c._getAssetInfoFromLineageIndex(f)
        },
        children: {}
      })
    }
    for (var j in d) b(d[j].tree_id, d[j].children);
    c.lineage = d;
    c.lineageOrdered = c.lineagesToArray();
    $dfr = jQuery.Deferred();
    $dfr.done(function(a, b) {
      var c = a.getPrimarySite();
      EasyEdit.isset(c) && (a.siteId = c.assetid);
      if (c = a.getPrimaryLineage()) c = c.slice().pop(), EasyEdit.isset(c) && (a.attribute("link_type", c.link_type), a.attribute("link_value", c.link_value), a.attribute("parent_id", c.parent_assetid), a.attribute("tree_id", c.tree_id), a.attribute("parent_type_code", c.parent_type_code), a.attribute("link_info", c.linkid));
      a.events.trigger("updated", {
        updated: "lineage",
        args: b
      })
    });
    null !== c.siteId || 0 === e.length ? $dfr.resolve(c, a) : 1 === e.length ?
      (c.siteId = e[0].assetid, $dfr.resolve(c, a)) : EasyEditAssetManager.getCurrentAsset(function(b) {
        for (var d = 0; d < e.length; d++)
          if ("" + e[d].assetid === "" + b.siteId) {
            c.siteId = b.siteId;
            break
          }
        $dfr.resolve(c, a)
      })
  },
  setPrimaryLineage: function(a) {
    for (var b = [], c = 0, d = a.length; c < d; c += 1) a[c].hasOwnProperty("assetid") && b.push(parseFloat(a[c].assetid));
    1 <= b.length && (a = this.getTreeIdFromLineage(b), EasyEdit.isset(a) && (this.primaryLineage = this.getLineageFromTreeId(a)));
    a = this.getPrimarySite();
    EasyEdit.isset(a) && (this.siteId =
      a.assetid)
  },
  getCurrentLinks: function() {
    var a = [];
    this.parentIds = {};
    for (var b in this.rawLineageData) this.rawLineageData[b].assetid === this.id ? a.push(this.rawLineageData[b]) : this.parentIds[this.rawLineageData[b].assetid] = this.rawLineageData[b];
    return a
  },
  hasMultipleLineages: function() {
    return 1 < this.getCurrentLinks().length
  },
  getLineageRootIds: function() {
    return jQuery.map(this.lineage, function(a, b) {
      return b
    })
  },
  getTreeIdFromLineage: function(a) {
    function b(a, d) {
      if (!EasyEdit.isset(a)) return null;
      var e = parseFloat(a.splice(0,
          1)),
        f = d.hasOwnProperty(e) ? d[e] : null;
      return 1 <= a.length && EasyEdit.isset(f) ? b(a, f.children) : e === parseFloat(c.id) ? f.tree_id : null
    }
    var c = this,
      a = a.slice(),
      d = c.findLineageDataByProperty("assetid", a[0]);
    if (null !== d) {
      var d = d.tree_id,
        e = d.length / 4;
      if (1 < e)
        for (; 1 < e;) {
          var e = e - 1,
            f = c.findLineageDataByProperty("tree_id", d.substr(0, 4 * e));
          null !== f && f.hasOwnProperty("assetid") && a.splice(0, 0, parseFloat(f.assetid))
        }
    }
    return b(a, c.lineage)
  },
  getLineageFromTreeId: function(a) {
    var b = this,
      c = null;
    (function(a) {
      for (var c = 0, f = b.lineageOrdered.length; c <
        f; c += 1) a.call(b, b.lineageOrdered[c])
    })(function(b) {
      for (var e = 0, f = b.length; e < f; e += 1) b[e].tree_id === a && (c = b)
    });
    return c
  },
  getPrimaryLineage: function() {
    function a(a) {
      if (EasyEditUrl.hash.isset("tree_id")) {
        if (a = decodeURIComponent(EasyEditUrl.hash.get("tree_id")), a = b.getLineageFromTreeId(a), EasyEdit.isset(a)) return a
      } else {
        if (EasyEdit.isset(b.primaryLineage)) return b.primaryLineage;
        a = b.findLineageDataByProperty("assetid", a);
        if (EasyEdit.isset(a)) return b.getLineageFromTreeId(a.tree_id)
      }
      return b.lineageOrdered[0]
    }
    var b = this;
    if (null !== b.siteId) return a(b.siteId);
    var c = b.getLineageRootIds();
    rootNode = "";
    for (var d = 0, e = c.length; d < e; d += 1) 10 !== parseFloat(c[d]) && (rootNode = parseFloat(c[d]));
    if ("" !== rootNode) return a(rootNode);
    (new EasyEditError(EasyEditLocalise._("Unable to determine a root lineage for this site from potential list of nodes: [%1]", c.join(",")))).display()
  },
  lineagesToArray: function() {
    function a(b, d, e) {
      var f = b.length,
        g = 4 * d,
        j = c.findLineageDataByProperty("tree_id", b.substring(0, g));
      if (null === j || "trash_folder" ===
        j.type_code) return e;
      e.push(j);
      return f === g ? e : a(b, d + 1, e)
    }
    for (var b = [], c = this, d = c.getCurrentLinks(), e = {}, f = 0, g = d.length; f < g; f += 1)
      if (d[f].hasOwnProperty("tree_id") && !e.hasOwnProperty(d[f].tree_id)) {
        var j = a(d[f].tree_id, 1, []);
        null !== j && 1 <= j.length && b.push(j);
        e[d[f].tree_id] = !0
      }
    return b
  },
  findLineageDataByProperty: function(a, b) {
    for (var c = 0, d = this.rawLineageData.length; c < d; c += 1)
      if (this.rawLineageData[c][a] === b + "") return this.rawLineageData[c];
    return null
  },
  filterLineageToClosestSite: function(a) {
    var b = null;
    a.reverse();
    for (var c = 0, d = a.length; c < d; c += 1)
      if (b = this.findLineageDataByProperty("assetid", a[c]), EasyEdit.isset(b) && b.hasOwnProperty("type_code") && ("site" === b.type_code || "web_folder_media" === b.type_code)) {
        a = a.slice(0, c + 1);
        break
      }
    return a.reverse()
  },
  getPrimarySite: function() {
    var a = this.getPrimaryLineage();
    if (EasyEdit.isset(a)) {
      for (var b = a.length - 1; 0 < b; b -= 1)
        if ("site" === a[b].type_code || "web_folder_media" === a[b].type_code) return a[b];
      return a[0]
    }
    return null
  },
  getChangedAttributes: function() {
    for (var a = [],
        b = 0, c = this.changedAttributes.length; b < c; b++) a.push({
      key: this.changedAttributes[b],
      value: this.attribute(this.changedAttributes[b])
    });
    return a
  },
  resetChangedAttributes: function() {
    this.changedAttributes = []
  },
  refreshAttributes: function(a) {
    EasyEditAssetManager.refreshAttributes(this, a)
  },
  hasWorkflow: function(a) {
    null === this.hasWorkflowApplied ? EasyEditAssetManager.hasWorkflow(this, a) : a.call(this, this.hasWorkflow)
  },
  setStatus: function(a, b) {
    this._flagScreenFeatureChange("publishing");
    this.statusChange = a;
    this.statusCascade = !0 === b ? 1 : 0;
    this.events.trigger("updated", {
      updated: "status",
      args: arguments
    })
  },
  save: function(a) {
    null !== this.id && EasyEditAssetManager.saveAsset(this, a)
  },
  trash: function(a) {
    a = "function" === typeof a ? a : function() {};
    if (null !== this.id) EasyEditAssetManager.trashAsset(this, a);
    else {
      var b = new EasyEditError(EasyEditLocalise._("Cannot trash an asset that doesn't exist"));
      a.call(this, b)
    }
  },
  getMetadata: function(a) {
    if (null === this.metadataValues) {
      var b = this;
      EasyEditAssetManager.getMetadata(this, function(c) {
        EasyEdit.isError(c) ||
          (b.metadataValues = c);
        a.call(this, c)
      })
    } else a.call(this, this.metadataValues)
  },
  _flagScreenFeatureChange: function(a) {
    this.screen_features[a] = !0
  },
  resetScreenFeatureFlags: function() {
    for (var a in this.screen_features) this.screen_features[a] = !1
  },
  acquireLock: function(a, b) {
    EasyEditAssetManager.acquireLock(this, {
      screen: a,
      dependantsOnly: !0,
      force: !1
    }, "undefined" !== typeof b ? b : null)
  },
  releaseLock: function(a, b) {
    EasyEditAssetManager.releaseLock(this, "string" === typeof a ? a : "all", "undefined" !== typeof b ? b : null)
  },
  getParents: function(a) {
    if (null ===
      this.parentIds) {
      var b = this;
      EasyEditAssetManager.getParents(this, 0, function(c) {
        b.parentIds = c;
        a.call(this, b.parentIds)
      })
    } else a.call(this, this.parentIds)
  },
  move: function(a, b, c) {
    if (void 0 === this.id) return c.call(this, new EasyEditError(EasyEditLocalise._("The asset being referenced does not have an asset id"))), !1;
    this.hasParent(a, function(d) {
      d ? (d = this.attribute("link_type") + "", EasyEditAssetManager.moveAsset({
        new_parent_id: b,
        old_parent_id: a,
        link_value: this.attribute("link_value"),
        link_type: -1 === d.indexOf("SQ_") ?
          "SQ_LINK_TYPE_" + d : d,
        asset: this
      }, c)) : c.call(this, new EasyEditError(EasyEditLocalise._("Failed to match parent id")))
    })
  },
  link: function(a, b) {
    function c(e, g) {
      if ("undefined" === typeof a[e]) return b.call(d, g), !1;
      var j = {
        parent_id: a[e],
        child_id: d.id,
        link_type: d.attribute("link_type"),
        link_value: d.attribute("link_value"),
        sort_order: -1,
        is_dependant: d.attribute("is_dependant"),
        is_exclusive: d.attribute("is_exclusive")
      };
      e++;
      EasyEditAssetManager.createLink(j, function(a) {
        EasyEdit.isError(a) ? b.call(d, new EasyEditError(EasyEdit.getError(a))) :
          (g.push(a), c(e, g))
      })
    }
    var d = this;
    if (void 0 === d.id) return b.call(this, new EasyEditError(EasyEditLocalise._("The asset being referenced does not have an asset id"))), !1;
    if ("string" === typeof a) {
      var e = {
        parent_id: a,
        child_id: d.id,
        link_type: d.attribute("link_type"),
        link_value: d.attribute("link_value"),
        sort_order: -1,
        is_dependant: d.attribute("is_dependant"),
        is_exclusive: d.attribute("is_exclusive")
      };
      EasyEditAssetManager.createLink(e, b)
    } else if ("undefined" !== typeof a.length) {
      if (0 === a.length) return b.call(d, null), !1;
      c(0, [])
    } else b.call(d, new EasyEditError(EasyEditLocalise._("Invalid parent argument supplied to asset.link()")))
  },
  create: function(a, b) {
    null === this.id ? EasyEditAssetManager.createAsset(this, a, b) : b.call(this, new EasyEditError(EasyEditLocalise._("An attempt was made to create an asset that already exists as asset #") + this.id))
  },
  clone: function(a, b, c, d) {
    EasyEditAssetManager.cloneAsset(this, a, b, c, d)
  },
  hasParent: function(a, b) {
    EasyEditAssetManager.hasParent(this, a, b)
  },
  getChildren: function(a) {
    EasyEditAssetManager.getChildren(this,
      a)
  },
  hasRunningWorkflow: function() {
    return !0 === this.runningWorkflow ? !0 : !1
  },
  getFormattedDate: function(a) {
    var b = null;
    switch (a) {
      case "created":
        b = this.attribute("created");
        break;
      case "published":
        b = this.attribute("published");
        break;
      default:
        b = this.attribute("updated")
    }
    a = new Date(1E3 * b);
    b = "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",")[a.getMonth()];
    return a.getDate() + " " + b + " " + a.getFullYear()
  },
  childCount: function(a) {
    EasyEditAssetManager.childCount(this, a)
  },
  isFile: function() {
    var a = this.attribute("type_code");
    return EasyEdit.isFileAsset(a)
  }
};
var EasyEditErrorStack = {
  stack: [],
  push: function(a) {
    this.stack.push(a)
  },
  count: function() {
    return this.stack.length
  },
  getStack: function() {
    return this.stack
  }
};

function EasyEditError(a) {
  this.num = this.url = this.message = null;
  switch (typeof a) {
    case "object":
      this.message = a.hasOwnProperty("message") ? a.message : null;
      this.url = a.hasOwnProperty("url") ? a.url : null;
      this.num = a.hasOwnProperty("num") ? a.num : null;
      break;
    case "string":
      this.message = "" !== a ? a : null
  }
  EasyEditErrorStack.push(this);
  this.events = new ObservableEvents(this);
  EasyEditEventManager.trigger("EasyEditError")
}
EasyEditError.prototype = {
  getMessage: function() {
    return this.message
  },
  getObject: function() {
    return {
      error: this.message
    }
  },
  display: function() {
    var a = this;
    null === a.url && (a.url = window.location.href);
    var b = '<div class="message section">' + (null !== a.message ? a.message : EasyEditLocalise._("Unknown error")) + "</div>",
      b = b + (null !== a.url && "" !== a.url ? '<div class="url section"><strong>' + EasyEditLocalise._("URL") + ":</strong> " + a.url + "</div>" : ""),
      b = b + (null !== a.num && ("" !== a.num || 0 !== a.num) ? '<div class="num section"><strong>' +
        EasyEditLocalise._("Line") + ":</strong> " + a.num + "</div>" : ""),
      b = b + ('<div class="trace section"><a href="#" class="guiButton light alignLeft">' + EasyEditLocalise._("Show More Information") + '</a><textarea cols="58" rows="10" class="screenHide" name="traceText"></textarea></div>');
    EasyEditOverlay.showOverlay("error", {
      message: b,
      continueFn: function() {
        EasyEditOverlay.hideOverlay("error");
        a.events.trigger("continue")
      },
      onLoad: function() {
        function b(a) {
          return EasyEdit.tmpl.render("error_section", {
            name: a
          })
        }

        function d(a,
          b) {
          var c = EasyEdit.tmpl.render("error_item", {
            name: a,
            item: b
          });
          return e + c
        }
        var e = "\r\n",
          f = e + e;
        jQuery("#ees_errorOverlay").find(".trace a").click(function(e) {
          e.preventDefault();
          e = jQuery(this).next("textarea");
          if (jQuery(this).text().indexOf(EasyEditLocalise._("Show More Information")) !== -1) {
            e.removeClass("screenHide");
            var j = "";
            EasyEditAssetManager.hasOwnProperty("_currentUserAsset") && EasyEditAssetManager._currentUserAsset !== null && (j = j + (f + b("User details") + d("Username", EasyEditAssetManager._currentUserAsset.attr.username) +
              d("First Name", EasyEditAssetManager._currentUserAsset.attr.first_name) + d("Last Name", EasyEditAssetManager._currentUserAsset.attr.last_name) + d("User Type", EasyEditAssetManager._currentUserAsset.attr.type)));
            var h = f + b("EES Version details");
            EasyEdit.hasOwnProperty("EES_Version") && (h = h + d("Revision", EasyEdit.EES_Version.replace("<br/>", " ")));
            h = h + (f + b("Loaded plugins"));
            pluginCount = 0;
            for (var k in EasyEdit.plugins)
              if (EasyEdit.plugins.hasOwnProperty(k)) {
                h = h + d("Plugin", k);
                pluginCount = pluginCount + 1
              }
            h = h + d("Total",
              "(" + pluginCount + ") Plugin" + (pluginCount > 1 || pluginCount === 0 ? "s" : ""));
            h = h + (f + b("Interface details"));
            EasyEditScreens.hasOwnProperty("currentScreenName") && (h = h + d("Current Screen", EasyEditScreens.currentScreenName));
            k = "";
            if (EasyEditAssetManager.hasOwnProperty("_currentAsset") && EasyEditAssetManager._currentAsset !== null) {
              k = k + (f + b("Asset details"));
              var l = EasyEditAssetManager._currentAsset.attributes(),
                n;
              for (n in l) k = k + d(n, l[n]);
              k = k + (f + b("Lineage details"));
              k = k + d("Site ID", EasyEditAssetManager._currentAsset.siteId);
              if (EasyEditAssetManager._currentAsset.lineageOrdered.hasOwnProperty("length")) {
                n = 0;
                for (l = EasyEditAssetManager._currentAsset.lineageOrdered.length; n < l; n = n + 1) {
                  for (var m = [], o = 0, r = EasyEditAssetManager._currentAsset.lineageOrdered[n].length; o < r; o = o + 1) m.push(EasyEditAssetManager._currentAsset.lineageOrdered[n][o].assetid);
                  k = k + d("Lineage #" + n, m.join("->"))
                }
              }
              k = k + d("Linked in trash", EasyEditAssetManager._currentAsset.linkedInTrash ? "Yes" : "No");
              k = k + (f + b("Workflow"));
              k = k + d("Workflow applied", EasyEditAssetManager._currentAsset.hasWorkflowApplied ?
                "Yes" : "No");
              k = k + d("Workflow running", EasyEditAssetManager._currentAsset.workflowRunning ? "Yes" : "No")
            }
            var p = f + b("Scripts");
            jQuery("script", "head").each(function() {
              p = p + d("src", jQuery(this).attr("src"))
            });
            var s = f + b("CSS");
            jQuery('link[rel="stylesheet"]', "head").each(function() {
              s = s + d("href", jQuery(this).attr("href"))
            });
            n = new Date;
            e.text(b("Error") + d("Timestamp", n) + d("Error", a.message !== null ? a.message : "Unknown error") + (a.url !== null ? d("Url", a.url) : "") + (a.num !== null ? d("Line", a.num) : "") + d("Browser", BrowserDetect.browser +
              " " + BrowserDetect.version) + d("User Agent", navigator.userAgent ? navigator.userAgent : navigator.vendor) + h + j + k + p + s);
            a.events.trigger("details_show");
            jQuery(this).text(EasyEditLocalise._("Hide More Information"))
          } else {
            a.events.trigger("details_hide");
            e.addClass("screenHide");
            jQuery(this).text(EasyEditLocalise._("Show More Information"))
          }
        })
      }
    });
    a.events.trigger("display");
    EasyEditEventManager.trigger("EasyEditErrorDisplayed")
  }
};

function EasyEditSlider(a) {
  var b = {
      bindElem: "#somedivid",
      defaultVal: EasyEditLocalise._("Yes"),
      options: [
        [EasyEditLocalise._("Yes"), "", function() {}],
        [EasyEditLocalise._("No"), "", function() {}]
      ]
    },
    c = this;
  c.events = new ObservableEvents(this);
  c.opt = jQuery.extend({}, b, a);
  c.$bind = "string" === typeof c.opt.bindElem ? jQuery(c.opt.bindElem) : c.opt.bindElem;
  if (!c.$bind.length) return (new EasyEditError(EasyEditLocalise._("Asset slider unable to initiate on element: %1", c.opt.bindElem))).display(), !1;
  for (var d = c.opt.options,
      a = '<div class="slider">', b = 0; b < d.length; b++) {
    var e = [];
    d[b][0] === c.opt.defaultVal && e.push("selected");
    b === d.length - 1 && e.push("last");
    a += '<a href="#" data-id="' + b + '" class="' + e.join(" ") + '" title="' + d[b][1] + '">' + d[b][0] + "</a>"
  }
  c.$bind.html(a + "</div>");
  jQuery(".slider a", c.$bind).click(function(a) {
    var b = jQuery(this);
    if (b.hasClass("selected")) return !1;
    b.parent().children("a").removeClass("selected");
    b.addClass("selected");
    var e = b.attr("data-id");
    !0 === jQuery.isFunction(d[e][2]) && d[e][2].call(b);
    a.preventDefault();
    c.events.trigger("change")
  })
}
EasyEditSlider.prototype = {
  getSelected: function() {
    return this.opt.options[this.$bind.find("a.selected").attr("data-id")][0]
  },
  getSelectedIndex: function() {
    var a = this.$bind.find("a.selected").attr("data-id");
    return Number(a)
  },
  isTrue: function() {
    return this.opt.options[0][0] === this.getSelected() ? !0 : !1
  },
  setSelected: function(a) {
    a = jQuery('a:contains("' + a + '")', this.$bind);
    a.length && (this.$bind.find("a").removeClass("selected"), a.addClass("selected"))
  }
};
var EasyEditOverlay = {
    overlays: {},
    hideOverlay: function(a) {
      a = "string" === typeof a ? a : null;
      null !== a && this.overlays.hasOwnProperty(a) ? EasyEditOverlay.overlays[a].hide() : jQuery.each(EasyEditOverlay.overlays, function(a, c) {
        c.hide()
      });
      this.handleDoubleOverlays()
    },
    handleDoubleOverlays: function() {
      var a = jQuery("body>div.overlay:visible");
      2 <= a.length && (a.hide(), a.is("#" + this.overlays.error.id) ? jQuery("#" + this.overlays.error.id).show() : jQuery(a.get(0)).show())
    },
    showOverlay: function(a, b, c, d) {
      var e = "string" === typeof a ?
        a : "defaultOverlay",
        f = "object" === typeof b ? b : {},
        a = "function" === typeof c ? c : function() {},
        d = "boolean" === typeof d ? d : !0;
      !0 === f.scrollTop && jQuery("html").scrollTop(0);
      if (!this.overlays.hasOwnProperty(e)) return !1;
      d && ("number" === typeof f.timeout ? function(a) {
        setTimeout(function() {
          a.hideOverlay(e)
        }, f.timeout)
      }(this) : this.hideOverlay(e));
      this.overlays[e].show(f, a);
      d && this.handleDoubleOverlays()
    }
  },
  EasyEditLocalise = {
    language: null,
    translations: {},
    availableLanguages: {},
    storeUntranslatable: !1,
    translationsNotAvailable: {},
    setLanguage: function(a) {
      "undefined" !== typeof this.availableLanguages[a] && (this.language = a)
    },
    addLanguage: function(a, b, c) {
      this.translations[a] = {
        strings: c
      };
      this.availableLanguages[a] = b
    },
    _: function() {
      var a = Array.prototype.slice.call(arguments);
      if (this.hasTranslation(a[0])) return this._parseArgs(this.translations[this.language].strings[a[0]], a.slice(1));
      this.storeUntranslatable && (this.translationsNotAvailable[a[0]] = this.language);
      return this._parseArgs(a[0], a.slice(1))
    },
    _n: function(a, b, c) {
      var d = Array.prototype.slice.call(arguments);
      if (this.hasTranslation(a)) {
        var e = this.translations[this.language].plural(c);
        return this._parseArgs(this.translations[this.language].strings[a][e], d.slice(3))
      }
      if (this.storeUntranslatable && (!1 === this.hasTranslation(a) && (this.translationsNotAvailable[a] = this.language), !1 === this.hasTranslation(b))) this.translationsNotAvailable[b] = this.language;
      return 1 === c ? this._parseArgs(a, d.slice(3)) : this._parseArgs(b, d.slice(3))
    },
    _parseArgs: function(a, b) {
      return 1 <= b.length ? a.replace(RegExp("%([1-" + b.length + "])", "g"),
        function(a, d) {
          return b[d - 1]
        }) : a
    },
    hasTranslation: function(a) {
      return null !== this.language && "undefined" !== typeof this.translations[this.language] && "undefined" !== typeof this.translations[this.language].strings && "undefined" !== typeof this.translations[this.language].strings[a] && "" !== this.translations[this.language].strings[a]
    },
    languageCode: function(a) {
      var b = {
        aa: EasyEditLocalise._("Afar"),
        ab: EasyEditLocalise._("Abkhazian"),
        ae: EasyEditLocalise._("Avestan"),
        af: EasyEditLocalise._("Afrikaans"),
        ak: EasyEditLocalise._("Akan"),
        am: EasyEditLocalise._("Amharic"),
        an: EasyEditLocalise._("Aragonese"),
        ar: EasyEditLocalise._("Arabic"),
        as: EasyEditLocalise._("Assamese"),
        av: EasyEditLocalise._("Avaric"),
        ay: EasyEditLocalise._("Aymara"),
        az: EasyEditLocalise._("Azerbaijani"),
        ba: EasyEditLocalise._("Bashkir"),
        be: EasyEditLocalise._("Belarusian"),
        bg: EasyEditLocalise._("Bulgarian"),
        bh: EasyEditLocalise._("Bihari languages"),
        bi: EasyEditLocalise._("Bislama"),
        bm: EasyEditLocalise._("Bambara"),
        bn: EasyEditLocalise._("Bengali"),
        bo: EasyEditLocalise._("Tibetan"),
        br: EasyEditLocalise._("Breton"),
        bs: EasyEditLocalise._("Bosnian"),
        ca: EasyEditLocalise._("Valencian"),
        ce: EasyEditLocalise._("Chechen"),
        ch: EasyEditLocalise._("Chamorro"),
        co: EasyEditLocalise._("Corsican"),
        cr: EasyEditLocalise._("Cree"),
        cs: EasyEditLocalise._("Czech"),
        cu: EasyEditLocalise._("Old Slavonic"),
        cv: EasyEditLocalise._("Chuvash"),
        cy: EasyEditLocalise._("Welsh"),
        da: EasyEditLocalise._("Danish"),
        de: EasyEditLocalise._("German"),
        dv: EasyEditLocalise._("Maldivian"),
        dz: EasyEditLocalise._("Dzongkha"),
        ee: EasyEditLocalise._("Ewe"),
        el: EasyEditLocalise._("Greek"),
        en: EasyEditLocalise._("English"),
        eo: EasyEditLocalise._("Esperanto"),
        es: EasyEditLocalise._("Spanish"),
        et: EasyEditLocalise._("Estonian"),
        eu: EasyEditLocalise._("Basque"),
        fa: EasyEditLocalise._("Persian"),
        ff: EasyEditLocalise._("Fulah"),
        fi: EasyEditLocalise._("Finnish"),
        fj: EasyEditLocalise._("Fijian"),
        fo: EasyEditLocalise._("Faroese"),
        fr: EasyEditLocalise._("French"),
        fy: EasyEditLocalise._("Western Frisian"),
        ga: EasyEditLocalise._("Irish"),
        gd: EasyEditLocalise._("Gaelic"),
        gl: EasyEditLocalise._("Galician"),
        gn: EasyEditLocalise._("Guarani"),
        gu: EasyEditLocalise._("Gujarati"),
        gv: EasyEditLocalise._("Manx"),
        ha: EasyEditLocalise._("Hausa"),
        he: EasyEditLocalise._("Hebrew"),
        hi: EasyEditLocalise._("Hindi"),
        ho: EasyEditLocalise._("Hiri Motu"),
        hr: EasyEditLocalise._("Croatian"),
        ht: EasyEditLocalise._("Haitian Creole"),
        hu: EasyEditLocalise._("Hungarian"),
        hy: EasyEditLocalise._("Armenian"),
        hz: EasyEditLocalise._("Herero"),
        ia: EasyEditLocalise._("Interlingua"),
        id: EasyEditLocalise._("Indonesian"),
        ie: EasyEditLocalise._("Occidental"),
        ig: EasyEditLocalise._("Igbo"),
        ii: EasyEditLocalise._("Nuosu"),
        ik: EasyEditLocalise._("Inupiaq"),
        "in": EasyEditLocalise._("Indonesian"),
        io: EasyEditLocalise._("Ido"),
        is: EasyEditLocalise._("Icelandic"),
        it: EasyEditLocalise._("Italian"),
        iu: EasyEditLocalise._("Inuktitut"),
        iw: EasyEditLocalise._("Hebrew"),
        ja: EasyEditLocalise._("Japanese"),
        ji: EasyEditLocalise._("Yiddish"),
        jv: EasyEditLocalise._("Javanese"),
        jw: EasyEditLocalise._("Javanese"),
        ka: EasyEditLocalise._("Georgian"),
        kg: EasyEditLocalise._("Kongo"),
        ki: EasyEditLocalise._("Gikuyu"),
        kj: EasyEditLocalise._("Kwanyama"),
        kk: EasyEditLocalise._("Kazakh"),
        kl: EasyEditLocalise._("Greenlandic"),
        km: EasyEditLocalise._("Central Khmer"),
        kn: EasyEditLocalise._("Kannada"),
        ko: EasyEditLocalise._("Korean"),
        kr: EasyEditLocalise._("Kanuri"),
        ks: EasyEditLocalise._("Kashmiri"),
        ku: EasyEditLocalise._("Kurdish"),
        kv: EasyEditLocalise._("Komi"),
        kw: EasyEditLocalise._("Cornish"),
        ky: EasyEditLocalise._("Kyrgyz"),
        la: EasyEditLocalise._("Latin"),
        lb: EasyEditLocalise._("Letzeburgesch"),
        lg: EasyEditLocalise._("Ganda"),
        li: EasyEditLocalise._("Limburgish"),
        ln: EasyEditLocalise._("Lingala"),
        lo: EasyEditLocalise._("Lao"),
        lt: EasyEditLocalise._("Lithuanian"),
        lu: EasyEditLocalise._("Luba-Katanga"),
        lv: EasyEditLocalise._("Latvian"),
        mg: EasyEditLocalise._("Malagasy"),
        mh: EasyEditLocalise._("Marshallese"),
        mi: EasyEditLocalise._("Maori"),
        mk: EasyEditLocalise._("Macedonian"),
        ml: EasyEditLocalise._("Malayalam"),
        mn: EasyEditLocalise._("Mongolian"),
        mo: EasyEditLocalise._("Moldovan"),
        mr: EasyEditLocalise._("Marathi"),
        ms: EasyEditLocalise._("Malay"),
        mt: EasyEditLocalise._("Maltese"),
        my: EasyEditLocalise._("Burmese"),
        na: EasyEditLocalise._("Nauru"),
        nb: EasyEditLocalise._("Norwegian Bokm\u00e5l"),
        nd: EasyEditLocalise._("North Ndebele"),
        ne: EasyEditLocalise._("Nepali"),
        ng: EasyEditLocalise._("Ndonga"),
        nl: EasyEditLocalise._("Flemish"),
        nn: EasyEditLocalise._("Norwegian Nynorsk"),
        no: EasyEditLocalise._("Norwegian"),
        nr: EasyEditLocalise._("South Ndebele"),
        nv: EasyEditLocalise._("Navaho"),
        ny: EasyEditLocalise._("Chichewa"),
        oc: EasyEditLocalise._("Occitan"),
        oj: EasyEditLocalise._("Ojibwa"),
        om: EasyEditLocalise._("Oromo"),
        or: EasyEditLocalise._("Oriya"),
        os: EasyEditLocalise._("Ossetic"),
        pa: EasyEditLocalise._("Punjabi"),
        pi: EasyEditLocalise._("Pali"),
        pl: EasyEditLocalise._("Polish"),
        ps: EasyEditLocalise._("Pashto"),
        pt: EasyEditLocalise._("Portuguese"),
        qu: EasyEditLocalise._("Quechua"),
        rm: EasyEditLocalise._("Romansh"),
        rn: EasyEditLocalise._("Rundi"),
        ro: EasyEditLocalise._("Moldovan"),
        ru: EasyEditLocalise._("Russian"),
        rw: EasyEditLocalise._("Kinyarwanda"),
        sa: EasyEditLocalise._("Sanskrit"),
        sc: EasyEditLocalise._("Sardinian"),
        sd: EasyEditLocalise._("Sindhi"),
        se: EasyEditLocalise._("Northern Sami"),
        sg: EasyEditLocalise._("Sango"),
        sh: EasyEditLocalise._("Serbo-Croatian"),
        si: EasyEditLocalise._("Sinhalese"),
        sk: EasyEditLocalise._("Slovak"),
        sl: EasyEditLocalise._("Slovenian"),
        sm: EasyEditLocalise._("Samoan"),
        sn: EasyEditLocalise._("Shona"),
        so: EasyEditLocalise._("Somali"),
        sq: EasyEditLocalise._("Albanian"),
        sr: EasyEditLocalise._("Serbian"),
        ss: EasyEditLocalise._("Swati"),
        st: EasyEditLocalise._("Southern Sotho"),
        su: EasyEditLocalise._("Sundanese"),
        sv: EasyEditLocalise._("Swedish"),
        sw: EasyEditLocalise._("Swahili (macrolanguage)"),
        ta: EasyEditLocalise._("Tamil"),
        te: EasyEditLocalise._("Telugu"),
        tg: EasyEditLocalise._("Tajik"),
        th: EasyEditLocalise._("Thai"),
        ti: EasyEditLocalise._("Tigrinya"),
        tk: EasyEditLocalise._("Turkmen"),
        tl: EasyEditLocalise._("Tagalog"),
        tn: EasyEditLocalise._("Tswana"),
        to: EasyEditLocalise._("Tonga (Tonga Islands)"),
        tr: EasyEditLocalise._("Turkish"),
        ts: EasyEditLocalise._("Tsonga"),
        tt: EasyEditLocalise._("Tatar"),
        tw: EasyEditLocalise._("Twi"),
        ty: EasyEditLocalise._("Tahitian"),
        ug: EasyEditLocalise._("Uyghur"),
        uk: EasyEditLocalise._("Ukrainian"),
        ur: EasyEditLocalise._("Urdu"),
        uz: EasyEditLocalise._("Uzbek"),
        ve: EasyEditLocalise._("Venda"),
        vi: EasyEditLocalise._("Vietnamese"),
        vo: EasyEditLocalise._("Volap\u00fck"),
        wa: EasyEditLocalise._("Walloon"),
        wo: EasyEditLocalise._("Wolof"),
        xh: EasyEditLocalise._("Xhosa"),
        yi: EasyEditLocalise._("Yiddish"),
        yo: EasyEditLocalise._("Yoruba"),
        za: EasyEditLocalise._("Chuang"),
        zh: EasyEditLocalise._("Chinese"),
        zu: EasyEditLocalise._("Zulu"),
        csb: EasyEditLocalise._("Kashubian"),
        dsb: EasyEditLocalise._("Lower Sorbian"),
        fur: EasyEditLocalise._("Friulian"),
        haw: EasyEditLocalise._("Hawaiian"),
        hil: EasyEditLocalise._("Hiligaynon"),
        hsb: EasyEditLocalise._("Upper Sorbian"),
        kok: EasyEditLocalise._("Konkani"),
        nso: EasyEditLocalise._("Sepedi"),
        son: EasyEditLocalise._("Songhai"),
        tig: EasyEditLocalise._("Tigre"),
        tlh: EasyEditLocalise._("Klingon")
      };
      return b[a] ? b[a] : null
    },
    langRegionCode: function(a) {
      var b = {
        AC: EasyEditLocalise._("Ascension Island"),
        AD: EasyEditLocalise._("Andorra"),
        AE: EasyEditLocalise._("United Arab Emirates"),
        AF: EasyEditLocalise._("Afghanistan"),
        AG: EasyEditLocalise._("Antigua and Barbuda"),
        AI: EasyEditLocalise._("Anguilla"),
        AL: EasyEditLocalise._("Albania"),
        AM: EasyEditLocalise._("Armenia"),
        AN: EasyEditLocalise._("Netherlands Antilles"),
        AO: EasyEditLocalise._("Angola"),
        AQ: EasyEditLocalise._("Antarctica"),
        AR: EasyEditLocalise._("Argentina"),
        AS: EasyEditLocalise._("American Samoa"),
        AT: EasyEditLocalise._("Austria"),
        AU: EasyEditLocalise._("Australia"),
        AW: EasyEditLocalise._("Aruba"),
        AX: EasyEditLocalise._("\u00c5land Islands"),
        AZ: EasyEditLocalise._("Azerbaijan"),
        BA: EasyEditLocalise._("Bosnia and Herzegovina"),
        BB: EasyEditLocalise._("Barbados"),
        BD: EasyEditLocalise._("Bangladesh"),
        BE: EasyEditLocalise._("Belgium"),
        BF: EasyEditLocalise._("Burkina Faso"),
        BG: EasyEditLocalise._("Bulgaria"),
        BH: EasyEditLocalise._("Bahrain"),
        BI: EasyEditLocalise._("Burundi"),
        BJ: EasyEditLocalise._("Benin"),
        BL: EasyEditLocalise._("Saint Barth\u00e9lemy"),
        BM: EasyEditLocalise._("Bermuda"),
        BN: EasyEditLocalise._("Brunei Darussalam"),
        BO: EasyEditLocalise._("Bolivia"),
        BQ: EasyEditLocalise._("Bonaire, Sint Eustatius and Saba"),
        BR: EasyEditLocalise._("Brazil"),
        BS: EasyEditLocalise._("Bahamas"),
        BT: EasyEditLocalise._("Bhutan"),
        BU: EasyEditLocalise._("Burma"),
        BV: EasyEditLocalise._("Bouvet Island"),
        BW: EasyEditLocalise._("Botswana"),
        BY: EasyEditLocalise._("Belarus"),
        BZ: EasyEditLocalise._("Belize"),
        CA: EasyEditLocalise._("Canada"),
        CC: EasyEditLocalise._("Cocos (Keeling) Islands"),
        CD: EasyEditLocalise._("The Democratic Republic of the Congo"),
        CF: EasyEditLocalise._("Central African Republic"),
        CG: EasyEditLocalise._("Congo"),
        CH: EasyEditLocalise._("Switzerland"),
        CI: EasyEditLocalise._("C\u00f4te d'Ivoire"),
        CK: EasyEditLocalise._("Cook Islands"),
        CL: EasyEditLocalise._("Chile"),
        CM: EasyEditLocalise._("Cameroon"),
        CN: EasyEditLocalise._("China"),
        CO: EasyEditLocalise._("Colombia"),
        CP: EasyEditLocalise._("Clipperton Island"),
        CR: EasyEditLocalise._("Costa Rica"),
        CS: EasyEditLocalise._("Serbia and Montenegro"),
        CU: EasyEditLocalise._("Cuba"),
        CV: EasyEditLocalise._("Cape Verde"),
        CW: EasyEditLocalise._("Cura\u00e7ao"),
        CX: EasyEditLocalise._("Christmas Island"),
        CY: EasyEditLocalise._("Cyprus"),
        CZ: EasyEditLocalise._("Czech Republic"),
        DD: EasyEditLocalise._("German Democratic Republic"),
        DE: EasyEditLocalise._("Germany"),
        DG: EasyEditLocalise._("Diego Garcia"),
        DJ: EasyEditLocalise._("Djibouti"),
        DK: EasyEditLocalise._("Denmark"),
        DM: EasyEditLocalise._("Dominica"),
        DO: EasyEditLocalise._("Dominican Republic"),
        DZ: EasyEditLocalise._("Algeria"),
        EA: EasyEditLocalise._("Ceuta, Melilla"),
        EC: EasyEditLocalise._("Ecuador"),
        EE: EasyEditLocalise._("Estonia"),
        EG: EasyEditLocalise._("Egypt"),
        EH: EasyEditLocalise._("Western Sahara"),
        ER: EasyEditLocalise._("Eritrea"),
        ES: EasyEditLocalise._("Spain"),
        ET: EasyEditLocalise._("Ethiopia"),
        EU: EasyEditLocalise._("European Union"),
        FI: EasyEditLocalise._("Finland"),
        FJ: EasyEditLocalise._("Fiji"),
        FK: EasyEditLocalise._("Falkland Islands (Malvinas)"),
        FM: EasyEditLocalise._("Federated States of Micronesia"),
        FO: EasyEditLocalise._("Faroe Islands"),
        FR: EasyEditLocalise._("France"),
        FX: EasyEditLocalise._("Metropolitan France"),
        GA: EasyEditLocalise._("Gabon"),
        GB: EasyEditLocalise._("United Kingdom"),
        GD: EasyEditLocalise._("Grenada"),
        GE: EasyEditLocalise._("Georgia"),
        GF: EasyEditLocalise._("French Guiana"),
        GG: EasyEditLocalise._("Guernsey"),
        GH: EasyEditLocalise._("Ghana"),
        GI: EasyEditLocalise._("Gibraltar"),
        GL: EasyEditLocalise._("Greenland"),
        GM: EasyEditLocalise._("Gambia"),
        GN: EasyEditLocalise._("Guinea"),
        GP: EasyEditLocalise._("Guadeloupe"),
        GQ: EasyEditLocalise._("Equatorial Guinea"),
        GR: EasyEditLocalise._("Greece"),
        GS: EasyEditLocalise._("South Georgia and the South Sandwich Islands"),
        GT: EasyEditLocalise._("Guatemala"),
        GU: EasyEditLocalise._("Guam"),
        GW: EasyEditLocalise._("Guinea-Bissau"),
        GY: EasyEditLocalise._("Guyana"),
        HK: EasyEditLocalise._("Hong Kong"),
        HM: EasyEditLocalise._("Heard Island and McDonald Islands"),
        HN: EasyEditLocalise._("Honduras"),
        HR: EasyEditLocalise._("Croatia"),
        HT: EasyEditLocalise._("Haiti"),
        HU: EasyEditLocalise._("Hungary"),
        IC: EasyEditLocalise._("Canary Islands"),
        ID: EasyEditLocalise._("Indonesia"),
        IE: EasyEditLocalise._("Ireland"),
        IL: EasyEditLocalise._("Israel"),
        IM: EasyEditLocalise._("Isle of Man"),
        IN: EasyEditLocalise._("India"),
        IO: EasyEditLocalise._("British Indian Ocean Territory"),
        IQ: EasyEditLocalise._("Iraq"),
        IR: EasyEditLocalise._("Islamic Republic of Iran"),
        IS: EasyEditLocalise._("Iceland"),
        IT: EasyEditLocalise._("Italy"),
        JE: EasyEditLocalise._("Jersey"),
        JM: EasyEditLocalise._("Jamaica"),
        JO: EasyEditLocalise._("Jordan"),
        JP: EasyEditLocalise._("Japan"),
        KE: EasyEditLocalise._("Kenya"),
        KG: EasyEditLocalise._("Kyrgyzstan"),
        KH: EasyEditLocalise._("Cambodia"),
        KI: EasyEditLocalise._("Kiribati"),
        KM: EasyEditLocalise._("Comoros"),
        KN: EasyEditLocalise._("Saint Kitts and Nevis"),
        KP: EasyEditLocalise._("Democratic People's Republic of Korea"),
        KR: EasyEditLocalise._("Republic of Korea"),
        KW: EasyEditLocalise._("Kuwait"),
        KY: EasyEditLocalise._("Cayman Islands"),
        KZ: EasyEditLocalise._("Kazakhstan"),
        LA: EasyEditLocalise._("Lao People's Democratic Republic"),
        LB: EasyEditLocalise._("Lebanon"),
        LC: EasyEditLocalise._("Saint Lucia"),
        LI: EasyEditLocalise._("Liechtenstein"),
        LK: EasyEditLocalise._("Sri Lanka"),
        LR: EasyEditLocalise._("Liberia"),
        LS: EasyEditLocalise._("Lesotho"),
        LT: EasyEditLocalise._("Lithuania"),
        LU: EasyEditLocalise._("Luxembourg"),
        LV: EasyEditLocalise._("Latvia"),
        LY: EasyEditLocalise._("Libya"),
        MA: EasyEditLocalise._("Morocco"),
        MC: EasyEditLocalise._("Monaco"),
        MD: EasyEditLocalise._("Moldova"),
        ME: EasyEditLocalise._("Montenegro"),
        MF: EasyEditLocalise._("Saint Martin (French part)"),
        MG: EasyEditLocalise._("Madagascar"),
        MH: EasyEditLocalise._("Marshall Islands"),
        MK: EasyEditLocalise._("The Former Yugoslav Republic of Macedonia"),
        ML: EasyEditLocalise._("Mali"),
        MM: EasyEditLocalise._("Myanmar"),
        MN: EasyEditLocalise._("Mongolia"),
        MO: EasyEditLocalise._("Macao"),
        MP: EasyEditLocalise._("Northern Mariana Islands"),
        MQ: EasyEditLocalise._("Martinique"),
        MR: EasyEditLocalise._("Mauritania"),
        MS: EasyEditLocalise._("Montserrat"),
        MT: EasyEditLocalise._("Malta"),
        MU: EasyEditLocalise._("Mauritius"),
        MV: EasyEditLocalise._("Maldives"),
        MW: EasyEditLocalise._("Malawi"),
        MX: EasyEditLocalise._("Mexico"),
        MY: EasyEditLocalise._("Malaysia"),
        MZ: EasyEditLocalise._("Mozambique"),
        NA: EasyEditLocalise._("Namibia"),
        NC: EasyEditLocalise._("New Caledonia"),
        NE: EasyEditLocalise._("Niger"),
        NF: EasyEditLocalise._("Norfolk Island"),
        NG: EasyEditLocalise._("Nigeria"),
        NI: EasyEditLocalise._("Nicaragua"),
        NL: EasyEditLocalise._("Netherlands"),
        NO: EasyEditLocalise._("Norway"),
        NP: EasyEditLocalise._("Nepal"),
        NR: EasyEditLocalise._("Nauru"),
        NT: EasyEditLocalise._("Neutral Zone"),
        NU: EasyEditLocalise._("Niue"),
        NZ: EasyEditLocalise._("New Zealand"),
        OM: EasyEditLocalise._("Oman"),
        PA: EasyEditLocalise._("Panama"),
        PE: EasyEditLocalise._("Peru"),
        PF: EasyEditLocalise._("French Polynesia"),
        PG: EasyEditLocalise._("Papua New Guinea"),
        PH: EasyEditLocalise._("Philippines"),
        PK: EasyEditLocalise._("Pakistan"),
        PL: EasyEditLocalise._("Poland"),
        PM: EasyEditLocalise._("Saint Pierre and Miquelon"),
        PN: EasyEditLocalise._("Pitcairn"),
        PR: EasyEditLocalise._("Puerto Rico"),
        PS: EasyEditLocalise._("State of Palestine"),
        PT: EasyEditLocalise._("Portugal"),
        PW: EasyEditLocalise._("Palau"),
        PY: EasyEditLocalise._("Paraguay"),
        QA: EasyEditLocalise._("Qatar"),
        RE: EasyEditLocalise._("R\u00e9union"),
        RO: EasyEditLocalise._("Romania"),
        RS: EasyEditLocalise._("Serbia"),
        RU: EasyEditLocalise._("Russian Federation"),
        RW: EasyEditLocalise._("Rwanda"),
        SA: EasyEditLocalise._("Saudi Arabia"),
        SB: EasyEditLocalise._("Solomon Islands"),
        SC: EasyEditLocalise._("Seychelles"),
        SD: EasyEditLocalise._("Sudan"),
        SE: EasyEditLocalise._("Sweden"),
        SG: EasyEditLocalise._("Singapore"),
        SH: EasyEditLocalise._("Saint Helena, Ascension and Tristan da Cunha"),
        SI: EasyEditLocalise._("Slovenia"),
        SJ: EasyEditLocalise._("Svalbard and Jan Mayen"),
        SK: EasyEditLocalise._("Slovakia"),
        SL: EasyEditLocalise._("Sierra Leone"),
        SM: EasyEditLocalise._("San Marino"),
        SN: EasyEditLocalise._("Senegal"),
        SO: EasyEditLocalise._("Somalia"),
        SR: EasyEditLocalise._("Suriname"),
        SS: EasyEditLocalise._("South Sudan"),
        ST: EasyEditLocalise._("Sao Tome and Principe"),
        SU: EasyEditLocalise._("Union of Soviet Socialist Republics"),
        SV: EasyEditLocalise._("El Salvador"),
        SX: EasyEditLocalise._("Sint Maarten (Dutch part)"),
        SY: EasyEditLocalise._("Syrian Arab Republic"),
        SZ: EasyEditLocalise._("Swaziland"),
        TA: EasyEditLocalise._("Tristan da Cunha"),
        TC: EasyEditLocalise._("Turks and Caicos Islands"),
        TD: EasyEditLocalise._("Chad"),
        TF: EasyEditLocalise._("French Southern Territories"),
        TG: EasyEditLocalise._("Togo"),
        TH: EasyEditLocalise._("Thailand"),
        TJ: EasyEditLocalise._("Tajikistan"),
        TK: EasyEditLocalise._("Tokelau"),
        TL: EasyEditLocalise._("Timor-Leste"),
        TM: EasyEditLocalise._("Turkmenistan"),
        TN: EasyEditLocalise._("Tunisia"),
        TO: EasyEditLocalise._("Tonga"),
        TP: EasyEditLocalise._("East Timor"),
        TR: EasyEditLocalise._("Turkey"),
        TT: EasyEditLocalise._("Trinidad and Tobago"),
        TV: EasyEditLocalise._("Tuvalu"),
        TW: EasyEditLocalise._("Taiwan"),
        TZ: EasyEditLocalise._("United Republic of Tanzania"),
        UA: EasyEditLocalise._("Ukraine"),
        UG: EasyEditLocalise._("Uganda"),
        UM: EasyEditLocalise._("United States Minor Outlying Islands"),
        US: EasyEditLocalise._("United States"),
        UY: EasyEditLocalise._("Uruguay"),
        UZ: EasyEditLocalise._("Uzbekistan"),
        VA: EasyEditLocalise._("Holy See (Vatican City State)"),
        VC: EasyEditLocalise._("Saint Vincent and the Grenadines"),
        VE: EasyEditLocalise._("Venezuela"),
        VG: EasyEditLocalise._("British Virgin Islands"),
        VI: EasyEditLocalise._("U.S. Virgin Islands"),
        VN: EasyEditLocalise._("Viet Nam"),
        VU: EasyEditLocalise._("Vanuatu"),
        WF: EasyEditLocalise._("Wallis and Futuna"),
        WS: EasyEditLocalise._("Samoa"),
        YD: EasyEditLocalise._("Democratic Yemen"),
        YE: EasyEditLocalise._("Yemen"),
        YT: EasyEditLocalise._("Mayotte"),
        YU: EasyEditLocalise._("Yugoslavia"),
        ZA: EasyEditLocalise._("South Africa"),
        ZM: EasyEditLocalise._("Zambia"),
        ZR: EasyEditLocalise._("Zaire"),
        ZW: EasyEditLocalise._("Zimbabwe"),
        "001": EasyEditLocalise._("World"),
        "002": EasyEditLocalise._("Africa"),
        "003": EasyEditLocalise._("North America"),
        "005": EasyEditLocalise._("South America"),
        "009": EasyEditLocalise._("Oceania"),
        "011": EasyEditLocalise._("Western Africa"),
        "013": EasyEditLocalise._("Central America"),
        "014": EasyEditLocalise._("Eastern Africa"),
        "015": EasyEditLocalise._("Northern Africa"),
        "017": EasyEditLocalise._("Middle Africa"),
        "018": EasyEditLocalise._("Southern Africa"),
        "019": EasyEditLocalise._("Americas"),
        "021": EasyEditLocalise._("Northern America"),
        "029": EasyEditLocalise._("Caribbean"),
        "030": EasyEditLocalise._("Eastern Asia"),
        "034": EasyEditLocalise._("Southern Asia"),
        "035": EasyEditLocalise._("South-Eastern Asia"),
        "039": EasyEditLocalise._("Southern Europe"),
        "053": EasyEditLocalise._("Australia and New Zealand"),
        "054": EasyEditLocalise._("Melanesia"),
        "057": EasyEditLocalise._("Micronesia"),
        "061": EasyEditLocalise._("Polynesia"),
        142: EasyEditLocalise._("Asia"),
        143: EasyEditLocalise._("Central Asia"),
        145: EasyEditLocalise._("Western Asia"),
        150: EasyEditLocalise._("Europe"),
        151: EasyEditLocalise._("Eastern Europe"),
        154: EasyEditLocalise._("Northern Europe"),
        155: EasyEditLocalise._("Western Europe"),
        419: EasyEditLocalise._("Latin America and the Caribbean")
      };
      return b[a] ? b[a] : null
    }
  };
jQuery.fn.localise = function() {
  return jQuery(this).each(function() {
    var a = jQuery(this).text();
    jQuery(this).text(EasyEditLocalise._(a))
  })
};
EasyEditValidationErrorInline = function(a) {
  var b = {
    element: null,
    position: "after",
    tag: "span",
    className: "fieldWarning",
    defaultMessage: EasyEditLocalise._("A problem has occurred")
  };
  this.options = jQuery.extend(b, a);
  this.$errorElement = jQuery(EasyEdit.tmpl.render("simple_tag", {
    tag: this.options.tag,
    "class": this.options.className,
    content: this.options.defaultMessage
  }));
  this.events = new ObservableEvents(this, ["show", "hide"]);
  this.show = function(a) {
    this.$errorElement.text(a);
    this.options.element[this.options.position](this.$errorElement);
    this.events.trigger("show", {
      message: a
    })
  };
  this.hide = function() {
    this.$errorElement.detach();
    this.events.trigger("hide")
  }
};
EasyEditValidationController = function() {
  var a = this;
  a.fails = {};
  a.validator = new EasyEditValidator;
  a.validator.events.observe("before_run", function() {
    a.fails = {}
  });
  a.rules = {};
  a.tests = 0;
  a.views = []
};
EasyEditValidationController.prototype = {
  addTest: function(a, b, c) {
    var d = this,
      e = 0,
      f = a;
    d.views.push(c);
    "function" !== typeof a && "function" === typeof a.val && (f = function() {
      return a.val()
    }, a.bind("change keyup", function() {
      1 <= d.validator.fails && d.validator.validate()
    }));
    if ("function" === typeof f) {
      for (var g in b) {
        var j = b[g].hasOwnProperty("args") ? b[g].args : null,
          e = d.validator.queue(g, j, f);
        d.rules[e] = b[g].message;
        d.validator.events.observe("test_" + e, function(a) {
          if (!a.result) {
            d.fails[e] = a;
            c.show(d.rules[a.index])
          }
          d.fails.hasOwnProperty(e) ||
            c.hide()
        })
      }
      d.tests += 1
    }
    return e
  },
  removeTestByIndex: function(a) {
    this.rules[a] = null;
    this.fails[a] = null;
    this.validator.remove(a)
  },
  getFailCount: function() {
    return this.validator.fails
  },
  valid: function() {
    return 0 === this.validator.tests.length ? !0 : this.validator.validate()
  },
  hideAllErrors: function() {
    for (var a = 0, b = this.views.length; a < b; a += 1) this.views[a].hasOwnProperty("hide") && this.views[a].hide()
  }
};
var EasyEditValidator = function() {
  this.rules = {};
  this.tests = [];
  this.fails = 0;
  this.events = new ObservableEvents(this, ["test", "run", "fail", "success"])
};
EasyEditValidator.prototype = {
  test: function(a, b, c) {
    return !this.rules.hasOwnProperty(a) ? ((new EasyEditError(EasyEditLocalise._('The validation rule "%1" does not exist', a))).display(), !1) : this.rules[a].test(b, c)
  },
  remove: function(a) {
    "undefined" !== typeof this.tests[a] && (this.tests[a] = null)
  },
  reset: function() {
    this.tests = [];
    this.fails = 0;
    return this
  },
  run: function() {
    this.events.trigger("before_run");
    for (var a = this.fails = 0, b = this.tests.length; a < b; a += 1) {
      var c = this.tests[a];
      if (null !== c) {
        var d = c.value.call(this),
          e = this.test(c.rule, c.args, d),
          c = {
            index: a,
            test: c,
            value: d,
            result: e
          };
        this.events.trigger("test_" + a, c);
        this.events.trigger("text", c);
        e || (this.fails += 1)
      }
    }
    this.events.trigger("run", {
      tests: this.tests
    })
  },
  addRule: function(a) {
    if (this.rules.hasOwnProperty(a)) return !1;
    var b = "EasyEditValidatorRule_" + a;
    "function" === typeof window[b] && (this.rules[a] = new window[b])
  },
  queue: function(a, b, c) {
    this.rules.hasOwnProperty(a) || this.addRule(a);
    if ("function" !== typeof c) return (new EasyEditError(EasyEditLocalise._("The validation queue expects value to be a function"))).display(), !1;
    var d = this.tests.length;
    this.events.register("test_" + d);
    this.tests.push({
      rule: a,
      args: b,
      value: c
    });
    return d
  },
  validate: function() {
    this.run();
    var a = this.valid();
    a ? this.events.trigger("success") : this.events.trigger("fail");
    return a
  },
  valid: function() {
    return 0 === this.fails
  }
};
EasyEditValidatorRule_required = function() {
  this.test = function(a, b) {
    return "undefined" !== typeof b && "" !== b
  }
};
EasyEditValidatorRule_test = function() {
  this.test = function(a, b) {
    var c = a(b);
    return void 0 === c || !0 === Boolean(c) ? !0 : !1
  }
};
EasyEditValidatorRule_accept = function() {
  this.test = function(a, b) {
    if (EasyEdit.isset(b) && "" === b) return !0;
    for (var c = a.split("|"), d = !1, e = 0, f = c.length; e < f; e += 1) null !== RegExp("." + EasyEdit.escapeRegExp(c[e]) + "$", "i").exec(b) && (d = !0);
    return d
  }
};
var Observable = function(a) {
  this.observed = a;
  this.listeners = []
};
Observable.prototype = {
  attach: function(a) {
    this.listeners.push(a)
  },
  detach: function(a) {
    this.each(function(b, c) {
      a === c && this.listeners.splice(b, 1)
    })
  },
  notify: function() {
    var a = arguments;
    this.each(function(b, c) {
      c.apply(this.observed, a)
    })
  },
  each: function(a) {
    for (var b = 0, c = this.listeners.length; b < c; b += 1) a.apply(this, [b, this.listeners[b]])
  }
};
var ObservableEvents = function(a, b) {
  this.observed = a;
  this.events = {};
  var c = [];
  "undefined" !== typeof b && (c = b);
  for (var d = 0, e = c.length; d < e; d += 1) this.register(c[d])
};
ObservableEvents.prototype = {
  register: function(a) {
    this.events[a] = new Observable(this.observed)
  },
  observe: function(a, b) {
    this.eventExists(a) || this.register(a);
    this.events[a].attach(b)
  },
  trigger: function() {
    if (0 === arguments.length) return !1;
    arguments = Array.prototype.slice.call(arguments);
    var a = Array.prototype.splice.apply(arguments, [0, 1]);
    this.eventExists(a) || this.register(a);
    this.events[a].notify.apply(this.events[a], arguments)
  },
  eventExists: function(a) {
    return this.events.hasOwnProperty(a)
  }
};
var EasyEditTemplate = function() {
  this.templates = {};
  this.events = new ObservableEvents(this, ["set", "render"])
};
EasyEditTemplate.prototype = {
  set: function(a, b) {
    this.events.trigger("set", {
      templateName: a,
      template: b
    });
    this.templates[a] = b;
    return this
  },
  exists: function(a) {
    return this.templates.hasOwnProperty(a)
  },
  render: function(a, b, c) {
    if (!this.templates.hasOwnProperty(a)) return (new EasyEditError(EasyEditLocalise._('Unable to locate template "%1"', a))).display(), "";
    var d = [this.templates[a]];
    "undefined" !== typeof b && d.push(b);
    "undefined" !== typeof c && d.push(c);
    b = Mustache.render.apply(this, d);
    this.events.trigger("render", {
      templateName: a,
      template: this.templates[a],
      renderedTemplate: b
    });
    return b
  },
  clearCache: function() {
    Mustache.clearCache();
    return this
  }
};
$.fn.selectRange = function(a, b) {
  return this.each(function() {
    if (this.setSelectionRange) this.focus(), this.setSelectionRange(a, b);
    else if (this.createTextRange) {
      var c = this.createTextRange();
      c.collapse(!0);
      c.moveEnd("character", b);
      c.moveStart("character", a);
      c.select()
    }
  })
};

function EasyEditDatePicker(a) {
  this.months = [EasyEditLocalise._("January"), EasyEditLocalise._("February"), EasyEditLocalise._("March"), EasyEditLocalise._("April"), EasyEditLocalise._("May"), EasyEditLocalise._("June"), EasyEditLocalise._("July"), EasyEditLocalise._("August"), EasyEditLocalise._("September"), EasyEditLocalise._("October"), EasyEditLocalise._("November"), EasyEditLocalise._("December")];
  this.settings = jQuery.extend({}, {
    time: !0,
    bindElem: "#id",
    minimumDate: function() {
      var a = new Date;
      a.setHours(0);
      a.setMinutes(0);
      return a
    },
    maximumDate: function() {
      return new Date("31 Dec " + ((new Date).getFullYear() + 10))
    },
    defaultDate: null,
    matrixDateElem: null,
    minuteIncrement: 1,
    onChange: function() {},
    onLoad: function() {},
    invalidHandler: function() {}
  }, a, !0);
  this.$bindElem = "string" === typeof this.settings.bindElem ? jQuery(this.settings.bindElem) : this.settings.bindElem;
  this.events = new ObservableEvents(this);
  this.init()
}
EasyEditDatePicker.prototype = {
  slider: null,
  initialised: !1,
  init: function() {
    var a = jQuery('<div class="datePicker"><div class="datePickerSelection screenHide"></div></div>');
    a.append(this.getTemplate());
    this.$bindElem.html(a);
    this._attachEvents();
    this.setSpinnerStyles(this.getDate());
    this.settings.onLoad.call(this);
    this.initialised = !0;
    this.events.trigger("init")
  },
  getTemplate: function() {
    function a(a, b, c) {
      return '<div class="widgetGroup ' + a + '"><div class="valueContainer"><a class="value" href="#">' + b + "</a></div>" +
        (c ? '<div class="scrollUp"><span>' + EasyEditLocalise._("Scroll up") + "</span></div>" : "") + (c ? '<div class="scrollDown"><span>' + EasyEditLocalise._("Scroll down") + "</span></div>" : "") + "</div>"
    }
    var b = "",
      c = new Date;
    if (null !== this.settings.matrixDateElem) {
      var d = jQuery(this.settings.matrixDateElem),
        b = b + a("day", this.ordinalise(d.find("input[id$=_day]").val()), !0),
        b = b + a("month", this.months[d.find("select[id$=_month]").val() - 1], !0),
        b = b + a("year", d.find("input[id$=_year]").val(), !0),
        c = d.find("input[id$=_hours]").val(),
        e = d.find("input[id$=_minutes]").val(),
        d = d.find("select[id$=_is_pm] option:selected").text(),
        b = b + (this.settings.time ? a("time", (12 < c ? c - 12 : c) + ":" + this.addLeadingZero(e), !0) : "");
      this.settings.time && (b += '<div class="widgetGroup pm">' + d + "</div>")
    } else null !== this.settings.defaultDate && (c = this.settings.defaultDate), b += a("day", this.ordinalise(c.getDate()), !0), b += a("month", this.months[c.getMonth()], !0), b += a("year", c.getFullYear(), !0), b += this.settings.time ? a("time", (12 < c.getHours() ? c.getHours() - 12 : c.getHours()) +
      ":" + this.addLeadingZero(c.getMinutes()), !0) : "", this.settings.time && (b += '<div class="widgetGroup pm">' + (11 < c.getHours() ? "pm" : "am") + "</div>");
    return b
  },
  monthNameToIndex: function(a) {
    for (var b = 0, c = this.months.length; b < c; b++)
      if (this.months[b].toLowerCase() === a.toLowerCase()) return b;
    return null
  },
  getDate: function() {
    var a = this.monthNameToIndex(jQuery(".month .value", this.$bindElem).text()) + 1 + "/" + this.deOrdinalise(jQuery(".day .value", this.$bindElem).text()) + "/" + jQuery(".year .value", this.$bindElem).text();
    if (this.settings.time) var b = jQuery(".time .value", this.$bindElem).text().split(":"),
      c = 1 * b[0],
      b = 1 * b[1],
      a = a + (" " + (10 > c ? "0" + c : c) + ":" + (10 > b ? "0" + b : b) + " " + jQuery(".pm .selected", this.$bindElem).text());
    a = new Date(a);
    this.events.trigger("getDate", {
      date: a
    });
    return a
  },
  ordinalise: function(a) {
    a *= 1;
    return a + (1 === a % 10 && 11 !== a ? "st" : 2 === a % 10 && 12 !== a ? "nd" : 3 === a % 10 && 13 !== a ? "rd" : "th")
  },
  deOrdinalise: function(a) {
    return 1 * a.replace(RegExp("(st|rd|th|nd)", "gi"), "")
  },
  addLeadingZero: function(a) {
    var b = 1 * a;
    10 > b && (a = "0" + b);
    return a + ""
  },
  setDate: function(a) {
    jQuery(".day .value", this.$bindElem).text(this.ordinalise(a.getDate()));
    jQuery(".month .value", this.$bindElem).text(this.months[a.getMonth()]);
    jQuery(".year .value", this.$bindElem).text(a.getFullYear());
    this.settings.time && (this.setTime(a.getHours(), a.getMinutes()), 12 < a.getHours() ? this.slider.setSelected("pm") : 11 >= a.getHours() && this.slider.setSelected("am"));
    this.setSpinnerStyles(a);
    this.events.trigger("setDate", {
      date: a
    })
  },
  setTime: function(a, b) {
    var c = 12 < a ? a - 12 : a;
    0 ===
      c && (c = 12);
    jQuery(".time .value", this.$bindElem).text(c + ":" + this.addLeadingZero(b));
    this.events.trigger("setTime")
  },
  onChange: function() {
    var a = this.getDate();
    if (null !== this.settings.matrixDateElem) {
      var b = jQuery(this.settings.matrixDateElem);
      b.find("input[id$=_day]").val(a.getDate());
      b.find("select[id$=_month] option[value=" + (a.getMonth() + 1) + "]").attr("selected", !0);
      b.find("input[id$=_year]").val(a.getFullYear());
      b.find("input[id$=_hours]").val(12 < a.getHours() ? a.getHours() - 12 : a.getHours());
      b.find("input[id$=_minutes]").val(a.getMinutes());
      b.find("select[id$=_is_pm] option[value=" + (12 <= a.getHours() ? 1 : 0) + "]").attr("selected", !0)
    }
    this.setSpinnerStyles(a);
    this.initialised && this.settings.onChange.call(this, a);
    this.events.trigger("change")
  },
  includeTimeComponent: function(a) {
    a ? (this.$bindElem.find(".widgetGroup.time").removeClass("screenHide"), this.$bindElem.find(".widgetGroup.pm").removeClass("screenHide")) : (this.$bindElem.find(".widgetGroup.time").addClass("screenHide"), this.$bindElem.find(".widgetGroup.pm").addClass("screenHide"));
    var b =
      jQuery(this.settings.matrixDateElem);
    b.length && (b.find('input[type="checkbox"][id$="_time_enabled"]').prop("checked", a), b.find('input[type="text"][id$="_hours"]').attr("disabled", !a), b.find('input[type="text"][id$="_minutes"]').attr("disabled", !a), b.find('select[id$="_is_pm"]').attr("disabled", !a))
  },
  _attachEvents: function() {
    var a = this;
    jQuery(".datePickerSelection", a.$bindElem);
    jQuery(".scrollUp span,.scrollDown span", a.$bindElem).bind("mousedown", function() {
      jQuery(this).addClass("clicked")
    });
    jQuery(".scrollUp span,.scrollDown span",
      a.$bindElem).bind("mouseup", function() {
      jQuery(this).removeClass("clicked")
    });
    jQuery(".scrollUp span,.scrollDown span", a.$bindElem).click(function(b) {
      b.preventDefault();
      var c = jQuery(this).parent().parent(),
        b = c.attr("class").replace("widgetGroup ", ""),
        c = jQuery(".value", c).text(),
        d = jQuery(this).parent().attr("class");
      a._doScroll(b, c, d)
    });
    jQuery(".value", a.$bindElem).bind("keyup", function(a) {
      code = a.keyCode ? a.keyCode : a.which;
      a = jQuery(this).parent();
      switch (code) {
        case 38:
          jQuery(".scrollUp span", a).trigger("click");
          break;
        case 40:
          jQuery(".scrollDown span", a).trigger("click")
      }
    });
    jQuery(".value", a.$bindElem).bind("click focus", function(b) {
      function c() {
        !a.testMin(a.getDate()) || !a.testMin(a.getDate()) ? (a.settings.invalidHandler.call(a, a.getDate()), a.setDate(f)) : a.onChange.call(a)
      }
      b.preventDefault();
      var b = jQuery(this).parent().parent(),
        d = b.attr("class").replace("widgetGroup ", ""),
        e = jQuery(this),
        f = a.getDate();
      switch (d) {
        case "time":
          input = jQuery(document.createElement("input")).attr("type", "text").attr("value", e.text()).attr("name",
            "time_input");
          e.addClass("screenHide").after(input);
          var g = /^([0-5])?[0-9]:([0-5])?[0-9]$/;
          jQuery("input", b).blur(function() {
            var b = jQuery(this).val();
            g.test(b) && (b = b.split(":"), 23 >= b[0] && a.setTime(b[0], b[1]));
            e.removeClass("screenHide");
            jQuery(this).remove();
            c()
          });
          jQuery("input", b).keyup(function() {
            var a = jQuery(this).val();
            if (-1 !== a.indexOf(":")) {
              var b = a.split(":"),
                a = 1 * b[1],
                b = 1 * b[0];
              0 <= a && 1 <= b && 59 >= a && 23 >= b ? jQuery(this).removeClass("invalid") : jQuery(this).addClass("invalid")
            } else g.test(a) ? jQuery(this).removeClass("invalid") :
              jQuery(this).addClass("invalid")
          });
          break;
        case "year":
          input = jQuery(document.createElement("input")).attr("type", "text").attr("value", e.text()).attr("name", "year_input");
          e.addClass("screenHide").after(input);
          jQuery("input", b).blur(function() {
            e.removeClass("screenHide");
            var b = 1 * jQuery(this).val(),
              d = 1 * a.settings.maximumDate().getFullYear(),
              f = 1 * a.settings.minimumDate().getFullYear();
            /^[0-9]{4}$/.test(b) && b <= d && b >= f && e.text(b);
            jQuery(this).remove();
            c()
          });
          jQuery("input", b).keyup(function() {
            var b = jQuery(this).val(),
              c = (a.settings.maximumDate().getFullYear() + "").substring(0, 1),
              d = (a.settings.minimumDate().getFullYear() + "").substring(0, 1);
            null !== RegExp("^[^" + (d !== c ? d + "-" + c : d) + "][0-9]$").exec(b) && jQuery(this).val("20" + b).focus().selectRange(0, 4);
            1 <= 1 * b && 9999 >= 1 * b ? jQuery(this).removeClass("invalid") : jQuery(this).addClass("invalid")
          });
          break;
        case "month":
          input = jQuery(document.createElement("input")).attr("type", "text").attr("value", 1 * a.monthNameToIndex(e.text()) + 1).attr("name", "month_input");
          e.addClass("screenHide").after(input);
          jQuery("input", b).blur(function() {
            e.removeClass("screenHide");
            var b = 1 * jQuery(this).val();
            1 <= b && 12 >= b && (date = a.getDate(), date.setMonth(b - 1), a.setDate(date));
            jQuery(this).remove();
            c()
          });
          jQuery("input", b).keyup(function() {
            var a = 1 * jQuery(this).val();
            1 <= a && 12 >= a ? jQuery(this).removeClass("invalid") : jQuery(this).addClass("invalid")
          });
          break;
        case "day":
          input = jQuery(document.createElement("input")).attr("type", "text").attr("value", a.deOrdinalise(e.text())).attr("name", "month_input"), e.addClass("screenHide").after(input),
            jQuery("input", b).blur(function() {
              e.removeClass("screenHide");
              var b = 1 * jQuery(this).val();
              1 <= b && b <= a.getDaysInMonth(a.getDate()) && (date = a.getDate(), date.setDate(b), a.setDate(date));
              jQuery(this).remove();
              c()
            }), jQuery("input", b).keyup(function() {
              var b = 1 * jQuery(this).val();
              1 <= b && b <= a.getDaysInMonth(a.getDate()) ? jQuery(this).removeClass("invalid") : jQuery(this).addClass("invalid")
            })
      }
      jQuery("input", b).each(function() {
        var a = jQuery(this).val();
        jQuery(this).selectRange(0, a.length)
      });
      jQuery("input", b).keyup(function(a) {
        13 ===
          (a.keyCode ? a.keyCode : a.which) && jQuery(this).blur()
      })
    });
    a.settings.time && (a.slider = new EasyEditSlider({
      bindElem: jQuery(".pm", a.$bindElem),
      defaultVal: jQuery(".pm", a.$bindElem).text(),
      options: [
        ["am", EasyEditLocalise._("Morning"), function() {
          a.onChange.call(a)
        }],
        ["pm", EasyEditLocalise._("Afternoon"), function() {
          a.onChange.call(a)
        }]
      ]
    }))
  },
  getValidTimeFormat: function(a, b) {
    12 < a ? a -= 12 : 0 >= a && (a = 12);
    60 <= b ? b = 0 : 0 > b && (b = 60 + b);
    return [a, b]
  },
  testMax: function(a) {
    var b = this.settings.maximumDate();
    this.settings.time ||
      b.setMinutes(b.getMinutes() + 1440);
    return a > b ? (this.events.trigger("max"), !1) : !0
  },
  testMin: function(a) {
    var b = this.settings.minimumDate();
    this.settings.time || b.setMinutes(b.getMinutes() - 1440);
    return a < b ? (this.events.trigger("min"), !1) : !0
  },
  _doScroll: function(a, b, c) {
    function d(a, b) {
      return "number" === typeof b ? "scrollUp" === c ? a + b : a - b : "scrollUp" === c ? a + 1 : a - 1
    }
    var e = jQuery(".day .value", this.$bindElem),
      f = jQuery(".month .value", this.$bindElem),
      g = jQuery(".year .value", this.$bindElem),
      j = jQuery(".time .value", this.$bindElem),
      h = jQuery(".pm .selected", this.$bindElem),
      k = this.getDate(),
      l = this.getDaysInMonth(k);
    switch (a) {
      case "day":
        g = d(1 * this.deOrdinalise(b));
        j = new Date(k);
        1 > g ? (j.setDate(j.getDate() - 1), this.setDate(j)) : g > l ? (j.setDate(j.getDate() + 1), this.setDate(j)) : e.text(this.ordinalise(g));
        this.events.trigger("scroll_day");
        break;
      case "month":
        l = d(this.monthNameToIndex(b));
        j = new Date(k);
        0 >= l ? (j.setMonth(j.getMonth() - 1), this.setDate(j)) : 11 <= l ? (j.setMonth(j.getMonth() + 1), this.setDate(j)) : f.text(this.months[l]);
        f = this._getDaysInMonth(this.monthNameToIndex(f.text()),
          g.text());
        l = this.deOrdinalise(e.text());
        l > f && e.text(this.ordinalise(f));
        this.events.trigger("scroll_month");
        break;
      case "year":
        j = d(1 * b);
        f = this._getDaysInMonth(this.monthNameToIndex(f.text()), g.text());
        l = this.deOrdinalise(e.text());
        l > f && e.text(this.ordinalise(f));
        g.text(j);
        this.events.trigger("scroll_year");
        break;
      case "time":
        g = j.text().split(":");
        e = 1 * g[0];
        g = d(1 * g[1], this.settings.minuteIncrement);
        f = d(e);
        e = this.getValidTimeFormat(60 <= g || 0 > g ? f : e, g);
        g = 0 === e[1] ? "00" : e[1];
        g = 9 >= g ? this.addLeadingZero(g) : g;
        j.text(e[0] + ":" + g);
        this.events.trigger("scroll_time");
        break;
      case "pm":
        jQuery("a", h.parent()).removeClass("selected"), jQuery("a:contains(" + ("pm" === h.text() ? "am" : "pm") + ")", h.parent()).addClass("selected"), this.events.trigger("scroll_pm")
    }!this.testMin(this.getDate()) || !this.testMax(this.getDate()) ? (this.settings.invalidHandler.call(this, this.getDate()), this.setDate(k)) : this.onChange.call(this)
  },
  getDaysInMonth: function(a) {
    return this._getDaysInMonth(a.getMonth(), a.getFullYear())
  },
  monthIndexToName: function(a) {
    return this.months[a]
  },
  _getDaysInMonth: function(a, b) {
    return 32 - (new Date(b, a, 32)).getDate()
  },
  _getAbbr: function(a) {
    return a.slice(0, 3)
  },
  setSpinnerStyles: function(a) {
    function b(a, b, f, g) {
      f.parent().parent().attr("class");
      if (c.testMax(a)) {
        if (c.testMin(b)) return f.removeClass("inactive"), g.removeClass("inactive"), !1;
        f.removeClass("inactive");
        g.addClass("inactive");
        return !0
      }
      f.addClass("inactive");
      g.removeClass("inactive");
      return !0
    }
    var c = this;
    c.settings.minimumDate();
    c.settings.maximumDate();
    (function(a) {
      dateUp = new Date(a);
      dateDown =
        new Date(a);
      dateUp.setDate(dateUp.getDate() + 1);
      dateDown.setDate(dateDown.getDate() - 1);
      var a = jQuery(".day .scrollUp span", c.$bindElem),
        e = jQuery(".day .scrollDown span", c.$bindElem);
      b(dateUp, dateDown, a, e)
    })(a);
    (function(a) {
      dateUp = new Date(a);
      dateDown = new Date(a);
      dateUp.setMonth(dateUp.getMonth() + 1);
      dateDown.setMonth(dateDown.getMonth() - 1);
      var a = jQuery(".month .scrollUp span", c.$bindElem),
        e = jQuery(".month .scrollDown span", c.$bindElem);
      b(dateUp, dateDown, a, e)
    })(a);
    (function(a) {
      dateUp = new Date(a);
      dateDown =
        new Date(a);
      dateUp.setFullYear(dateUp.getFullYear() + 1);
      dateDown.setFullYear(dateDown.getFullYear() - 1);
      var a = jQuery(".year .scrollUp span", c.$bindElem),
        e = jQuery(".year .scrollDown span", c.$bindElem);
      b(dateUp, dateDown, a, e)
    })(a)
  },
  getMatrixDateString: function() {
    var a = this.getDate(),
      b = a.getFullYear() + "-" + this.addLeadingZero(a.getMonth() + 1) + "-" + this.addLeadingZero(a.getDate());
    this.$bindElem.find(".widgetGroup.time").hasClass("screenHide") || (b = b + " " + this.addLeadingZero(a.getHours()) + ":" + this.addLeadingZero(a.getMinutes()) +
      ":00");
    return b
  }
};

function EasyEditFileUpload(a) {
  this.settings = jQuery.extend({}, {
    assetid: null,
    url: null,
    selector: "body",
    position: "absolute",
    left: "-1000px",
    top: "-1000px",
    interfaceFileName: "#ees_inputUpload",
    interfaceFileInput: null,
    filePostName: null,
    keywords: ["%details-S_details%"],
    prefix: "ees_uploader_",
    postParam: null,
    onComplete: function() {},
    onStart: function() {}
  }, "object" === typeof a ? a : {});
  this.settings.id = this._uniqueId();
  this.settings.frameName = this.settings.id + "_frame";
  this.events = new ObservableEvents(this);
  this.bindElem =
    jQuery(this.settings.selector)
}
EasyEditFileUpload.prototype = {
  start: function(a) {
    var b = this;
    b.events.trigger("start");
    var c = b._buildIframe(b.settings.frameName);
    c.css("position", b.settings.position);
    c.css("left", b.settings.left);
    c.css("top", b.settings.top);
    this.bindElem.append(c);
    this._buildForm(function(d) {
      b.bindElem.append(d);
      b.settings.onStart.call(this, b.settings);
      c.bind("load", function() {
        var d = [];
        c.contents().find("div > table").each(function() {
          var a = {};
          a.header = jQuery(this).find("tr:eq(0) td:eq(0)").text();
          "string" === typeof a.header &&
            (a.header = a.header.replace(/^([\s\t]*)/g, ""), a.header = a.header.replace(/([\s\t]*)$/g, ""));
          a.error = jQuery(this).find("tr:eq(1) td:eq(0) tr:eq(1) td:eq(1)").text();
          "string" === typeof a.error && (a.error = a.error.replace(/^([\s\t]*)/g, ""), a.error = a.error.replace(/([\s\t]*)$/g, ""));
          !1 === /\[CORE0324\]/.test(a.error) && d.push(a)
        });
        b.events.trigger("complete", {
          errors: d
        });
        b.settings.onComplete.call(this, d);
        a.call(this, d)
      });
      c.bind("load", function() {
        setTimeout(function() {
          c.remove();
          d.remove()
        }, 1E3)
      });
      d.submit()
    })
  },
  _uniqueId: function() {
    return this.settings.prefix + Math.floor(1.0E19 * Math.random())
  },
  _buildInput: function(a, b, c) {
    return '<input type="' + c + '" value="' + b + '" id="' + a + '" name="' + a + '" />'
  },
  _buildForm: function(a) {
    var b = this;
    (new EasyEditAPI).queue("getKeywordsReplacements", {
      asset_id: b.settings.assetid,
      keywords_array: ["%details-S_details%"]
    }).expect(1).run(function(c) {
      EasyEdit.getToken(function(d) {
        EasyEdit.isError(c[0].data);
        var e = c[0].data,
          f = jQuery('<form action="' + b.settings.url + '" method="post" name="' +
            b.settings.id + '" id="' + b.settings.id + '" target="' + b.settings.frameName + '"></form>');
        f.attr("enctype", "multipart/form-data").attr("encoding", "multipart/form-data");
        f.css("position", b.settings.position);
        f.css("left", b.settings.left);
        f.css("top", b.settings.top);
        if ("undefined" === typeof e["details-S_details"]) return (new EasyEditError(EasyEditLocalise._("There has been a critical error uploading the file. No simple edit keywords were available"))).display(), !1;
        jQuery(e["details-S_details"]["details-S_details"]).find("input,select,textarea").each(function() {
          jQuery(this).attr("name") !==
            b.settings.filePostName && f.append(jQuery(this).clone())
        });
        b.settings.postParam.token = d;
        if (null !== b.settings.postParam)
          for (var g in b.settings.postParam) b.settings.postParam.hasOwnProperty(g) && f.append(b._buildInput(g, b.settings.postParam[g], "hidden"));
        d = null;
        d = EasyEdit.isset(b.settings.interfaceFileInput) ? b.settings.interfaceFileInput : jQuery(b.settings.interfaceFileName);
        e = d.clone(!0);
        d.before(e);
        d.attr("name", b.settings.filePostName);
        d.attr("id", b.settings.filePostName);
        d.appendTo(f);
        a.call(this,
          f)
      })
    })
  },
  _buildIframe: function(a) {
    return jQuery('<iframe src="javascript: false;" name="' + a + '" id="' + a + '" />')
  }
};

function EasyEditAssetPicker(a) {
  var b = {
      bindElem: "#somedivid",
      rootNode: 0,
      prefillNode: null,
      selectText: EasyEditLocalise._("Select"),
      types: [],
      description: EasyEditLocalise._("Enter an ID or click select"),
      cacheMode: EasyEditCacheManager.NO_EXPIRY,
      bindFn: function() {},
      itemRefiner: function(a) {
        return a
      },
      restrictedRootNodes: null,
      groupId: ""
    },
    c = this;
  c.opt = jQuery.extend({}, b, a);
  void 0 == EasyEditAssetPicker.groupedInstances && (EasyEditAssetPicker.groupedInstances = []);
  c.opt.groupId && (void 0 == EasyEditAssetPicker.groupedInstances[c.opt.groupId] &&
    (EasyEditAssetPicker.groupedInstances[c.opt.groupId] = []), EasyEditAssetPicker.groupedInstances[c.opt.groupId].length && (EasyEditAssetPicker.groupedInstances[c.opt.groupId] = jQuery.grep(EasyEditAssetPicker.groupedInstances[c.opt.groupId], function(a) {
      return a.opt.bindElem != c.opt.bindElem
    })), EasyEditAssetPicker.groupedInstances[c.opt.groupId].push(this));
  c.defaultAssetDescription = '<span class="assetIcon default alignLeft">' + c.opt.description + "...</span>";
  c.$bind = jQuery(c.opt.bindElem);
  if (!c.$bind.length) return (new EasyEditError(EasyEditLocalise._("Asset picker unable to initiate on element: %1",
    c.opt.bindElem))).display(), !1;
  EasyEditAssetManager.getCurrentAsset(function(a) {
    if (c.opt.rootNode === 0) {
      var b = EasyEditAssetManager.getSiteDetails(a);
      c.opt.rootNode = b === null ? a.id : b[0]
    }
    a = '<div class="ees_assetPicker' + (c.opt.groupId ? " " + c.opt.groupId : "") + '"><div class="assetDescriptionWrap alignLeft"><div class="assetDescription alignLeft">' + c.defaultAssetDescription + '</div></div><div class="assetChangeButton alignLeft guiButton default assetidMode screenHide">' + EasyEditLocalise._("Change") + '</div><div class="assetChangeButton guiButton default alignLeft selectMode">' +
      c.opt.selectText + "</div></div>";
    c.$bind.html(a);
    c.$description = jQuery(".assetDescription", c.$bind);
    if (c.opt.prefillNode !== null)
      if (typeof c.opt.prefillNode !== "object") c.loadAsset(c.opt.prefillNode, c.defaultAssetDescription, c.opt.bindFn);
      else if (typeof c.opt.prefillNode.name === "string") {
      c.$description.html(c.getDescriptionHTML(c.opt.prefillNode.name, c.opt.prefillNode.assetid, c.opt.prefillNode.type_code, c.opt.prefillNode.type));
      EasyEditAssetManager.getAsset(c.opt.prefillNode.assetid, function(a) {
        EasyEditCacheManager.setCache("EasyEditAssetPicker",
          c.opt.prefillNode.assetid, a)
      }, c.cacheMode)
    }
    c.$bind.find(".selectMode").click(function() {
      if (!jQuery("input", c.$description).length) {
        var a = {
            types: c.opt.types,
            rootNodes: c.opt.restrictedRootNodes,
            itemRefiner: c.opt.itemRefiner,
            sourceKey: c.opt.bindElem,
            multipleSelection: c.opt.groupId != "",
            callback: function(a) {
              jQuery.isArray(a) || (a = [a]);
              var b = [c];
              if (c.opt.groupId && EasyEditAssetPicker.groupedInstances[c.opt.groupId] != void 0 && a.length > 1) {
                var d = EasyEditAssetPicker.groupedInstances[c.opt.groupId],
                  e = jQuery(".ees_assetPicker." +
                    c.opt.groupId).parent();
                if (e.length > 1) {
                  for (var b = [], f = e.length - 1; f >= 0; f--) {
                    for (var g = 0; g < d.length; g++)
                      if (d[g].opt.bindElem == "#" + e[f].id) {
                        b.push(d[g]);
                        break
                      }
                    if (c.opt.bindElem == "#" + e[f].id) break
                  }
                  b.reverse()
                }
              }
              for (f = 0; f < a.length; f++) {
                assetPicker = b[f];
                if (assetPicker == void 0) break;
                d = a[f];
                e = c.getDescriptionHTML(d.attribute("name"), d.id, d.attribute("type_code"), d.attribute("type"));
                assetPicker.$description.html(e);
                assetPicker.$bind.find(".assetId").html(d.id);
                assetPicker.opt.bindFn.call(c, d)
              }
            }
          },
          b = c.$bind.find(".assetId");
        if (b.length && b.text() !== "") a.focusAssetId = b.text();
        else if (a.rootNodes !== null && a.rootNodes.length) a.focusAssetId = a.rootNodes[0];
        EasyEditAssetFinder.init(a)
      }
    });
    c.$bind.on("click", ".assetClearSelection", function(a) {
      if (c.$bind.parents(".cellData").length) {
        var b = c.$bind.parents(".cellData"),
          b = jQuery(".defaultCheckbox", b);
        b.is(":checked") && b.attr("checked", false)
      }
      a.preventDefault();
      c.clear()
    });
    c.$bind.on("click", ".assetDescription span.assetIcon", function() {
      var a = jQuery(this).parent(),
        b = jQuery('<div class="customAssetIdInput"><input type="text" name="assetId" value="' +
          a.find(".assetId").text() + '" /></div>');
      a.before(b);
      var d = b.find("input");
      c.$bind.find(".assetDescription").hide();
      d.focus();
      c.$bind.find(".selectMode").addClass("screenHide");
      c.$bind.find(".assetidMode").removeClass("screenHide");
      d.css("width", a.width() - 4 + "px");
      d.css("height", a.height() - 4 + "px");
      d.bind("keyup", function(a) {
        (a.keyCode ? a.keyCode : a.which) === 13 && jQuery(this).blur()
      });
      d.bind("blur", function() {
        var e = d.val(),
          k = /^([0-9]+)$/.exec(e);
        b.remove();
        c.$bind.find(".assetDescription").show();
        c.$bind.find(".selectMode").removeClass("screenHide");
        c.$bind.find(".assetidMode").addClass("screenHide");
        var l = a.find(".assetId").text();
        if (k !== null && l !== e)
          if (c.opt.hasOwnProperty("restrictedRootNodes") && c.opt.restrictedRootNodes !== null && c.opt.restrictedRootNodes.length > 0) {
            new EasyEditAPI;
            EasyEditAssetManager.getAsset(e, function(b) {
              var d = true;
              for (parent in b.parentIds)
                if (jQuery.inArray(parent, c.opt.restrictedRootNodes) === -1) d = false;
                else {
                  d = true;
                  break
                }
              if (d) {
                EasyEditOverlay.showOverlay("loading", {
                  message: EasyEditLocalise._("Updating selected asset")
                });
                c.loadAsset(e, a.html(), function() {
                  EasyEditAssetManager.getAsset(e, function(a) {
                    EasyEditOverlay.hideOverlay("loading");
                    c.opt.bindFn.call(c, a)
                  })
                })
              } else EasyEditOverlay.showOverlay("error", {
                message: '<p class="message section">' + EasyEditLocalise._("The Asset ID entered is not a child asset of the resticted root nodes set for this field") + '</p><p class="section">' + EasyEditLocalise._("Please select an asset that is a child of one of the following Root Nodes: ") + c.opt.restrictedRootNodes + "</p>",
                continueFn: function() {
                  EasyEditOverlay.hideOverlay("error")
                }
              })
            })
          } else {
            EasyEditOverlay.showOverlay("loading", {
              message: EasyEditLocalise._("Updating selected asset")
            });
            c.loadAsset(e, a.html(), function() {
              EasyEditAssetManager.getAsset(e, function(a) {
                EasyEditOverlay.hideOverlay("loading");
                c.opt.bindFn.call(c, a)
              })
            })
          }
      })
    })
  })
}
EasyEditAssetPicker.prototype = {
  clear: function() {
    this.$bind.find(".assetDescription").html(this.defaultAssetDescription);
    this.opt.bindFn.call(this, null)
  },
  getCurrent: function() {
    return {
      assetid: this.$bind.find(".assetId").text(),
      description: this.$bind.find(".descriptionText").text()
    }
  },
  loadAsset: function(a, b, c) {
    var d = this;
    null === b && (b = d.$description.html());
    d.$description.html(d.getDescriptionHTML(EasyEditLocalise._("loading..."), a, "loading", ""));
    if (!EasyEditCacheManager.hasCache("EasyEditAssetPicker",
        a, !0) || d.opt.cacheMode === EasyEditCacheManager.NOCACHE) EasyEditOverlay.showOverlay("loading", {
      scrollTop: !1
    }), EasyEditAssetManager.getAsset(a, function(e) {
      EasyEdit.isError(e) ? d.$description.html(b) : (d.$description.html(d.getDescriptionHTML(e.attribute("name"), e.id, e.attribute("type_code"), e.attribute("type"))), EasyEditCacheManager.setCache("EasyEditAssetPicker", a, e), EasyEditOverlay.hideOverlay(), c.call(this, e))
    }, d.cacheMode);
    else {
      var e = EasyEditCacheManager.getCache("EasyEditAssetPicker", a);
      d.$description.html(d.getDescriptionHTML(e.attribute("name"),
        e.id, e.attribute("type_code"), e.attribute("type")));
      c.call(this, e)
    }
  },
  getDescriptionHTML: function(a, b, c, d) {
    b += "";
    return '<a href="#" class="assetClearSelection alignRight" title="' + EasyEditLocalise._("Clear selection") + '"></a><span class="assetIcon ' + c + ' alignLeft" title="' + a + " (#" + b + ") - " + d + '"><span class="descriptionText alignLeft">' + a + '</span> <span class="assetIdWrap alignLeft"> #<span class="assetId">' + b + "</span></span></span>"
  }
};
var EasyEditAssetFinder = {
    defaults: {
      focusAssetId: null,
      selectedLineage: null,
      bindElem: "#ees_assetFinderBody",
      types: [],
      rootNodes: [],
      sourceKey: "",
      multipleSelection: !1,
      callback: function() {},
      itemRefiner: function(a) {
        return a
      },
      beforeSelectionCallback: function(a) {
        a.call()
      }
    },
    options: {},
    buttonCollection: null,
    currentNode: null,
    modal: null,
    focusAsset: null,
    events: null,
    selectedAssetIds: [],
    init: function(a) {
      function b() {
        if (!jQuery("#ees_assetFinder").length) return !1;
        c.isSelectable(c.focusAsset.attr.type_code, c.focusAsset.id) &&
          (c.selectedAssetIds = [c.options.focusAssetId]);
        c.interaction.loadingHide();
        c.interaction.enable();
        c.highlightHistory();
        c.buildBreadcrumbs();
        c._attachEvents();
        var a = jQuery(".selected", "#ees_assetFinderBody").parent();
        c.setSelectedAsset(a.hasClass("isAccessible0") || a.hasClass("isDependant1"));
        c.adjustContainerWidth();
        c._doScroll();
        $paneList = jQuery("div[id^='ees_parentGroup_']", "#ees_assetFinderBody");
        for (a = 0; a < $paneList.length; a++) c._adjustResizerHandleHeight(jQuery($paneList[a]));
        c.events.trigger("load");
        EasyEditEventManager.trigger("AssetFinderAfterInit")
      }
      var c = this,
        d = new EasyEditAPI;
      EasyEditEventManager.trigger("AssetFinderBeforeInit");
      null === c.events && (c.events = new ObservableEvents(this));
      c.options = jQuery.extend({}, c.defaults, a);
      var a = c.options.sourceKey.length && null !== c.focusAssetId ? "__" + c.options.sourceKey : !1,
        e = jQuery("#ees_assetFinderOverlay");
      if (null === c.options.focusAssetId && e.hasClass("screenHide") && (!a || e.hasClass(a))) e.removeClass("screenHide");
      else {
        jQuery("#ees_mainOverlay").length && "none" !==
          jQuery("#ees_mainOverlay").css("display") && jQuery("body").addClass("doubleOverlay");
        jQuery("#ees_assetFinderOverlay").remove();
        jQuery("body").prepend('<div id="ees_assetFinderOverlay"></div>');
        jQuery("#ees_assetFinderOverlay").html(c.getTemplate());
        a && jQuery("#ees_assetFinderOverlay").addClass(a);
        jQuery(".closeModal", "#ees_assetFinderOverlay").click(function(a) {
          jQuery("#ees_assetFinderOverlay").addClass("screenHide");
          a.preventDefault();
          c.events.trigger("close");
          c.events.trigger("cancel")
        });
        jQuery("#ees_assetFinder").prepend('<div class="interactionBlocker"></div>');
        jQuery("#ees_assetFinderOverlay");
        var f = jQuery(window).height(),
          g = jQuery(window).width(),
          a = Math.round(0.8 * f),
          e = Math.round(0.8 * g);
        Math.round((f - a) / 2);
        f = Math.round((g - e) / 2);
        jQuery("#ees_assetFinder").css("width", e + "px").css("top", "30px").css("left", f + "px");
        jQuery("#ees_assetFinderBodyContainer").css("height", Math.round(a - 150) + "px");
        a = jQuery(".interactionBlocker");
        a.css("position", "fixed");
        a.css("width", jQuery(".modalBody").width() + "px");
        a.css("height", jQuery(".modalBody").height() + "px");
        a.css("left",
          jQuery(".modalBody").offset().left + "px");
        a.css("top", jQuery(".modalBody").offset().top + "px");
        c.interaction.disable();
        null === c.options.focusAssetId && null !== EasyEditAssetManager._currentAssetId && (c.options.focusAssetId = EasyEditAssetManager._currentAssetId);
        c.options.focusAssetId !== EasyEditAssetManager._currentAssetId ? d.queue("getGeneral", {
          asset_id: c.options.focusAssetId
        }).run(function(a) {
          if (a[0].data.hasOwnProperty("error")) c.options.focusAssetId = EasyEditAssetManager._currentAssetId;
          EasyEditAssetManager.getAsset(c.options.focusAssetId,
            function(a) {
              c.focusAsset = a;
              c.loadDefaultPane(a, function() {
                c.loadLineage(a, function() {
                  b()
                })
              })
            })
        }) : EasyEditAssetManager.getAsset(c.options.focusAssetId, function(a) {
          c.focusAsset = a;
          c.loadDefaultPane(a, function() {
            c.loadLineage(a, function() {
              b()
            })
          })
        })
      }
    },
    _doScroll: function() {
      var a = this,
        b = jQuery("#ees_assetFinderBodyWrapper").find(".selected");
      1 <= b.parent().parent().parent().prevAll().length && jQuery("#ees_assetFinderBodyWrapper").scrollTo(b.eq(0), {
        duration: 800,
        axis: "x",
        onAfter: function() {
          a.autoScroll()
        }
      })
    },
    autoScroll: function() {
      jQuery(".selected", "#ees_assetFinderBodyContainer").parents(".parentGroup:eq(0)").scrollTo(".selected", {
        duration: 800,
        axis: "y",
        onAfter: function() {
          jQuery(".historySelected", "#ees_assetFinderBodyContainer").each(function() {
            jQuery(this).parents(".parentGroup:eq(0)").scrollTo(".historySelected", {
              duration: 800,
              axis: "y"
            })
          })
        }
      })
    },
    highlightHistory: function() {
      var a = null,
        b = this.focusAsset,
        c = jQuery("#ees_assetFinder");
      if (null !== b) {
        a = b.id === EasyEditAssetManager._currentAssetId ? EasyEditUrl.getURL().url :
          b.attribute("web_path");
        a = b.getPrimaryLineage(a);
        this.options.hasOwnProperty("selectedLineage") && EasyEdit.isset(this.options.selectedLineage) && (a = this.options.selectedLineage);
        var d = c.find(".selected"),
          b = "assetid-" + b.id;
        if (!d.length || d.hasClass(b)) {
          for (d = a.length - 1; 0 <= d; d -= 1) {
            var e = jQuery('[class~="assetid-' + a[d].assetid + '"]:last', c);
            e.parents(".parentGroup").find(".historySelected").length || e.addClass("historySelected")
          }
          jQuery('[class~="' + b + '"]', c).removeClass("historySelected");
          jQuery('[class~="' +
            b + '"]:last', c).addClass("selected")
        }
      }
    },
    interaction: {
      enable: function() {
        var a = jQuery("#ees_assetFinder");
        jQuery(".interactionBlocker", a).hide();
        jQuery("#ees_refreshAssetFinder", a).show()
      },
      disable: function() {
        var a = jQuery("#ees_assetFinder");
        jQuery(".interactionBlocker", a).show();
        jQuery("#ees_refreshAssetFinder", a).hide()
      },
      loadingShow: function(a) {
        "undefined" !== typeof a && (a = jQuery("#" + EasyEditAssetFinder.getId(a)), a.addClass("loading"), a.find("li,div.pagination").addClass("screenHide"))
      },
      loadingHide: function(a) {
        "undefined" !==
        typeof a ? (a = jQuery("#" + EasyEditAssetFinder.getId(a)), a.removeClass("loading"), a.find("li,div.pagination").removeClass("screenHide")) : (a = jQuery("#ees_assetFinderBody>div"), a.removeClass("loading"), jQuery("li,div.pagination", a).removeClass("screenHide"))
      }
    },
    buildBreadcrumbs: function() {
      var a = this,
        b = jQuery("#ees_assetFinderBreadcrumb ol");
      b.empty();
      var c = jQuery(this.options.bindElem).find(".historySelected, .selected");
      c.length && c.each(function() {
        var c = jQuery(this).find(".assetid").text(),
          e = jQuery(this).find(".assetInfo").text(),
          f = jQuery("<li>"),
          g = jQuery("<a>").appendTo(f).attr("href", "#");
        g.text(e);
        jQuery("<span></span>").addClass("assetid screenHide").prependTo(g).text(c);
        g.click(function(b) {
          b.preventDefault();
          jQuery(a.options.bindElem).find('span.assetid:contains("' + jQuery(this).find(".assetid").text() + '")').trigger("click");
          a.adjustContainerWidth()
        });
        b.append(f).find("li:first").addClass("first")
      });
      jQuery("li:last", b).addClass("last")
    },
    getId: function(a) {
      if ("string" === typeof a) {
        try {
          a = decodeURIComponent(a)
        } catch (b) {}
        a =
          a.replace(/(:|\.|\[|\]|\/|\=|\%|\@)/g, "_")
      }
      return "ees_parentGroup_" + a
    },
    addPane: function(a) {
      var b = this,
        a = b.getId(a),
        c = '<div id="' + a + '" class="parentGroup loading"><div class="loadingFeedback">' + EasyEditLocalise._("Loading") + "...</div><ul></ul></div>";
      jQuery(b.options.bindElem).append(c);
      $pane = jQuery("#" + a);
      var d = $pane.parent().children().length,
        a = sessionStorage.getItem("paneWidth_" + d);
      isNaN(a) || $pane.css("width", a);
      $pane.resizable({
        handles: "e",
        minWidth: 100,
        resize: function() {
          b.adjustContainerWidth()
        },
        stop: function(a, b) {
          sessionStorage.setItem("paneWidth_" + d, b.element.width() + 1)
        }
      });
      return $pane
    },
    isSelectable: function(a, b) {
      if (this.options.initFromToolbar && b.match(":")) return !1;
      if (0 === this.options.types.length) return !0;
      for (var c = 0, d = this.options.types.length; c < d; c += 1)
        if (this.options.types[c] === a) return !0;
      return !1
    },
    addItem: function(a, b, c) {
      var c = c || !1,
        a = this.getId(a),
        d = jQuery("#" + a);
      if (!d.length) return !1;
      var a = decodeURIComponent(b.name.replace(/\+/g, "%20")),
        e = EasyEdit.getStatusFromCode(b.status),
        d =
        jQuery("ul", d),
        f = b.hasOwnProperty("is_dependant") ? b.is_dependant : "",
        g = b.hasOwnProperty("accessible") ? b.accessible : "1",
        j = this.isSelectable(b.type_code, b.assetid) ? "1" : "0",
        h = !b.hasOwnProperty("link_type") || "1" == f || "1" == b.link_type ? "1" : "0",
        f = jQuery("<li></li>").addClass("screenHide").addClass("isDependant" + f).addClass("isAccessible" + g).addClass("isSelectable" + j).addClass("isLinkVisible" + h),
        g = jQuery("<a></a>").addClass("clearfix").addClass("assetid-" + b.assetid).attr("href", b.web_path).attr("title", a).appendTo(f);
      b.hasOwnProperty("accessible") && jQuery("<span></span>").addClass("screenHide accessible").appendTo(g);
      jQuery("<span></span>").addClass("status").addClass("statusCode" + b.status).addClass(e.className).attr("title", e.description).appendTo(g);
      jQuery("<span></span>").addClass("assetIcon").addClass(b.type_code).attr("title", b.type_code.replace(/_/g, " ")).appendTo(g);
      jQuery("<span></span>").addClass("linkVisibilityIcon").appendTo(g);
      jQuery("<span></span>").addClass("screenHide assetTypeCode").appendTo(g).text(b.type_code);
      jQuery("<span></span>").addClass("screenHide assetid").appendTo(g).text(b.assetid);
      jQuery("<span></span>").addClass("screenHide link").addClass("linkType" + b.link_type).appendTo(g).text(b.linkid);
      jQuery("<span></span>").addClass("screenHide sortOrder").appendTo(g).text(b.sort_order);
      if (b.hasOwnProperty("num_kids") && (1 <= b.num_kids || -1 == b.num_kids)) - 1 == b.num_kids && (b.num_kids = ""), e = jQuery("<span></span>").addClass("childCount").appendTo(g), jQuery("<span></span>").appendTo(e).text(b.num_kids);
      jQuery("<span></span>").addClass("assetInfo").appendTo(g).text(a);
      !0 === c ? f.prependTo(d) : f.appendTo(d)
    },
    loadDefaultPane: function(a, b) {
      function c(a) {
        for (var c = 0, e = a.length; c < e; c += 1) a[c].data.error || "getGeneral" === a[c].fnName && d.addItem(0, {
          assetid: a[c].data.id,
          name: a[c].data.name,
          type_code: a[c].data.type_code,
          num_kids: "undefined" !== typeof a[1 * c + 1] ? a[1 * c + 1].data.child_count : 0,
          web_path: a[c].data.web_path
        });
        b.call(this)
      }
      var d = this,
        e = new EasyEditAPI;
      if (!jQuery("#ees_assetFinder").length) return !1;
      d.addPane(0);
      a.id === EasyEditAssetManager._currentAssetId ? EasyEditUrl.getURL() :
        a.attribute("web_path");
      var f = d.options.hasOwnProperty("selectedLineage") && null !== d.options.selectedLineage && 0 < d.options.selectedLineage.length,
        g = d.options.hasOwnProperty("rootNodes") && null !== d.options.rootNodes && 0 < d.options.rootNodes.length;
      if (null !== a) {
        var j = a.getPrimarySite();
        null === j && (j = EasyEditAssetManager._currentAsset.getPrimarySite());
        if (f) e.queue("getGeneral", {
          asset_id: d.options.selectedLineage[0].assetid
        }), e.queue("getChildCount", {
          asset_id: d.options.selectedLineage[0].assetid,
          level: 1
        });
        else if (g)
          for (g = 0; g < d.options.rootNodes.length; g++) e.queue("getGeneral", {
            asset_id: d.options.rootNodes[g]
          }), e.queue("getChildCount", {
            asset_id: d.options.rootNodes[g],
            level: 0
          });
        else e.queue("getGeneral", {
          asset_id: j.assetid
        }), e.queue("getChildCount", {
          asset_id: j.assetid,
          level: 1
        }), null !== a.siteId && parseFloat(a.siteId) !== parseFloat(j.assetid) && (e.queue("getGeneral", {
          asset_id: a.siteId
        }), e.queue("getChildCount", {
          asset_id: a.siteId,
          level: 1
        }))
      }
      EasyEditConfig.hasOwnProperty("assetFinderLocations") && (!d.options.hasOwnProperty("rootNodes") ||
        !(null !== d.options.rootNodes && 0 < d.options.rootNodes.length)) && jQuery.each(EasyEditConfig.assetFinderLocations, function(b) {
        if (parseFloat(EasyEditConfig.assetFinderLocations[b]) !== parseFloat(a.siteId) && parseFloat(EasyEditConfig.assetFinderLocations[b]) !== parseFloat(j.assetid) && (!f || parseFloat(d.options.selectedLineage[0].assetid) !== parseFloat(EasyEditConfig.assetFinderLocations[b]))) e.queue("getGeneral", {
          asset_id: EasyEditConfig.assetFinderLocations[b]
        }), e.queue("getChildCount", {
          asset_id: EasyEditConfig.assetFinderLocations[b],
          level: 1
        })
      });
      e.run(function(a) {
        if (EasyEdit.isError(a)) return b.call(this), !1;
        c(a)
      }, e.runMode.BATCH)
    },
    loadLineage: function(a, b) {
      var c = this;
      new EasyEditAPI;
      var d = [];
      if (!jQuery("#ees_assetFinder").length) return !1;
      a.id === EasyEditAssetManager._currentAssetId ? EasyEditUrl.getURL() : a.attribute("web_path");
      var e = a.getPrimaryLineage(),
        f = c.options.hasOwnProperty("selectedLineage") && null !== c.options.selectedLineage && 0 < c.options.selectedLineage.length,
        g = c.options.hasOwnProperty("rootNodes") && null !== c.options.rootNodes &&
        0 < c.options.rootNodes.length;
      f && (e = c.options.selectedLineage);
      for (var j = a.getPrimarySite(), h = 0, k = e.length; h < k; h += 1)
        if (f || -1 !== e[h].tree_id.indexOf(j.tree_id)) d.push({
          id: e[h].assetid,
          linkid: e[h].linkid,
          sort_order: h === k - 1 ? 0 : e[h + 1].sort_order,
          centred: !0
        });
      e[h - 1].assetid !== a.id && d.push({
        id: a.id,
        linkid: a.attribute("linkid")
      });
      if (g) {
        e = !1;
        for (f = 0; f < d.length; f++) {
          for (g = 0; g < c.options.rootNodes.length; g++)
            if (d[f].id === c.options.rootNodes[g]) {
              d.splice(0, f);
              e = !0;
              break
            } else if (d[f].id === c.options.focusAssetId) {
            d.splice(0,
              d.length);
            e = !0;
            break
          }
          if (e) break
        }
      }
      var l = [];
      EasyEditAssetManager.getAssetMap({
        assetids: d,
        callback: function(a, d) {
          if (d) {
            var e = c.addPane("errorPane"),
              f = d.indexOf("AMAP0047") !== -1 ? EasyEditLocalise._("Unable to retrieve lineage to this asset. You may not have the correct permissions to all assets in the lineage.") : d,
              f = jQuery(EasyEdit.tmpl.render("simple_tag", {
                tag: "div",
                "class": "inaccessibleMessage",
                content: f
              }));
            e.find(".loadingFeedback").before(f).remove();
            b.call(this);
            return false
          }
          var g = new EasyEditAPI,
            k;
          for (k in a) {
            f = k.replace("ID_", "");
            if (/^\d+$/.test(f)) {
              e = c.addPane(f);
              e.attr("data-parentid", f);
              e.attr("data-start", a[k].start_pos);
              e.attr("data-linkid", a[k].linkid);
              e.attr("data-num-kids", a[k].num_kids);
              jQuery.data(jQuery('[id="ees_parentGroup_' + f + '"]').get(0), "map", a[k]);
              l[k] = [];
              jQuery.each(a[k].children, function(a, b) {
                b.assetid = unescape(b.assetid);
                if (b.assetid.indexOf(":") === -1 && Number(b.num_kids) === -1) {
                  g.queue("getChildCount", {
                    asset_id: b.assetid,
                    level: 0
                  });
                  l.push({
                    parentid: k,
                    childIndex: a
                  })
                }
              })
            }
          }
          g.run(function(d) {
            if (d !==
              null)
              for (var e = 0; e < d.length; e++) {
                var f = l.shift();
                if (d[e].data.child_count) a[f.parentid].children[f.childIndex].num_kids = d[e].data.child_count
              }
            for (var g in a) {
              var k = g.replace("ID_", "");
              jQuery.each(a[g].children, function(a, b) {
                b = c.options.itemRefiner(b);
                c.addItem(k, b)
              });
              if (a[g].children.length > 0) {
                html = jQuery("<div>").append(jQuery('[id="' + c.getId(k) + '"]').eq(0).clone()).html();
                c.doPagination(k)
              } else jQuery('[id="ees_parentGroup_' + k + '"]').remove()
            }
            c.styleInaccessible();
            b.call(this)
          }, g.runMode.BATCH)
        }
      })
    },
    getTemplate: function() {
      this.modal = new EasyEditModal(EasyEditLocalise._("Asset Finder"), EasyEditLocalise._("Select the asset you want to view, edit or use."), "ees_assetFinder", "assetFinder");
      var a = this.options.bindElem.replace("#", ""),
        b = '<a href="#" id="ees_refreshAssetFinder">' + EasyEditLocalise._("Refresh") + "</a>",
        c = EasyEditLocalise._("Select");
      this.modal.addContent('<div id="ees_assetFinderBreadcrumb"><ol></ol>' + b + '</div><div id="ees_assetFinderBodyContainer"><div id="ees_assetFinderBodyWrapper"><div id="' +
        a + '"></div></div></div><div id="ees_assetFinderFooter" class="clearfix"><div id="ees_assetFinderButtons"><a id="ees_assetFinderSelectButton" class="guiButton default alignRight" href="#">' + c + '</a></div><div id="ees_assetFinderCurrentSelection" class="alignRight"></div></div>');
      return this.modal.getTemplate()
    },
    setSelectedAsset: function(a, b) {
      var c = void 0 === b ? jQuery("#ees_assetFinderBody .selected") : jQuery(b);
      "undefined" !== typeof a && null === a ? (jQuery("#ees_assetFinderCurrentSelection").html(""), jQuery("#ees_assetFinderSelectButton").addClass("disabled")) :
        ($currentSel = jQuery("#ees_assetFinderCurrentSelection"), $currentSel.html(""), jQuery("<span></span>").addClass("currentSelectionLabel alignLeft").appendTo($currentSel).text(EasyEditLocalise._("Current Selection")), jQuery("<span></span>").addClass("currentSelectionIcon alignLeft").addClass(jQuery(".assetTypeCode", c).text()).appendTo($currentSel), jQuery("<span></span>").addClass("currentSelectionName alignLeft").appendTo($currentSel).text(jQuery(".assetInfo", c).text()), jQuery("<span></span>").addClass("currentSelectionId alignLeft").appendTo($currentSel).text(" #" +
          jQuery(".assetid", c).text()), void 0 !== a && a ? jQuery("#ees_assetFinderSelectButton").addClass("disabled") : jQuery("#ees_assetFinderSelectButton").removeClass("disabled"), this.events.trigger("selected", c))
    },
    refresh: function() {
      var a = jQuery(".selected", "#ees_assetFinder").find(".assetid").text();
      this._cleanUp();
      EasyEditCacheManager.clearScope("AssetMap");
      this.options.focusAssetId = a;
      this.init(this.options);
      this.events.trigger("refresh")
    },
    adjustContainerWidth: function() {
      var a = jQuery(this.options.bindElem),
        b = a.find(".parentGroup"),
        c = 666;
      1 < b.length && (c = 0, b.each(function(a, b) {
        c += jQuery(b).width() + 1
      }));
      a.css("width", c + "px")
    },
    styleInaccessible: function() {
      jQuery("#ees_assetFinder").find("li.isDependant1").find(".childCount").remove()
    },
    doPagination: function(a) {
      var a = jQuery('[id="ees_parentGroup_' + a + '"]'),
        b = jQuery('<div class="pagination"><a href="#" class="displayBlock genericButton"></a></div>');
      if (!a.length) return !1;
      var c = this.getPaginationInfo(a);
      a.find(".pagination").remove();
      if (0 < c.start) {
        var d = b.clone();
        d.addClass("prev");
        var e = d.find("a");
        e.html(EasyEditLocalise._n("Load %1 More Asset", "Load %1 More Assets", Math.min(c.start, c.group_size), Math.min(c.start, c.group_size)));
        a.prepend(d)
      }
      c.start + c.num_kids < c.total_kids && (d = b.clone(), d.addClass("next"), e = d.find("a"), e.html(EasyEditLocalise._n("Load %1 More Asset", "Load %1 More Assets", c.next_max_kids, c.next_max_kids)), a.append(d))
    },
    getPaginationInfo: function(a) {
      var b = {};
      jQuery("#ees_assetFinder");
      var c = EasyEditConfig.hasOwnProperty("assetFinderMaxAssets") ?
        EasyEditConfig.assetFinderMaxAssets : 100;
      b.num_kids = a.find("li").length;
      b.start = Number(a.attr("data-start"));
      b.total_kids = Number(a.attr("data-num-kids"));
      b.linkid = a.attr("data-linkid") || "";
      b.remaining_kids = b.total_kids - (b.start + b.num_kids);
      b.next_max_kids = b.remaining_kids > c ? c : b.remaining_kids;
      b.group_size = c;
      return b
    },
    triggerNextPaginationSet: function(a, b) {
      var c = this,
        d = a.attr("id").replace("ees_parentGroup_", ""),
        b = b || !1,
        e = c.getPaginationInfo(a);
      EasyEditAssetFinder.interaction.disable();
      var f = a.find("ul");
      !0 === b ? (a.find(".pagination.prev").remove(), f.prepend('<li class="loading">' + EasyEditLocalise._("Loading...") + "</li>")) : (a.find(".pagination.next").remove(), f.append('<li class="loading">' + EasyEditLocalise._("Loading...") + "</li>"));
      var f = Number(e.start) + e.num_kids,
        g = e.next_max_kids;
      b && (f = Number(e.start) - e.group_size, g = e.group_size, a.attr("data-start", f));
      EasyEditAssetManager.getAssetMap({
        assetids: [{
          id: d,
          linkid: e.linkid
        }],
        start: f,
        limit: g,
        total: e.total_kids,
        callback: function(e) {
          if (jQuery("#ees_assetFinderOverlay").length !==
            0) {
            a.find("li.loading").remove();
            for (var f in e) {
              var g = f.replace("ID_", ""),
                l = new EasyEditAPI,
                n = [];
              jQuery.each(e[f].children, function(a, b) {
                b.assetid = unescape(b.assetid);
                if (b.assetid.indexOf(":") === -1 && Number(b.num_kids) === -1) {
                  l.queue("getChildCount", {
                    asset_id: b.assetid,
                    level: 0
                  });
                  n.push(a)
                }
              });
              l.run(function(a) {
                if (a !== null)
                  for (var d = 0; d < a.length; d++) {
                    var l = n.shift();
                    if (a[d].data.child_count) e[f].children[l].num_kids = a[d].data.child_count
                  }
                b && e[f].children.reverse();
                jQuery.each(e[f].children, function(a,
                  d) {
                  d = c.options.itemRefiner(d);
                  c.addItem(g, d, b)
                });
                b && e[f].children.reverse();
                jQuery("<div>").append(jQuery('[id="' + c.getId(g) + '"]').eq(0).clone()).html();
                EasyEditAssetFinder.interaction.loadingHide(g)
              }, l.runMode.BATCH)
            }
            c.highlightHistory();
            c.styleInaccessible();
            c.doPagination(d);
            if (b === true) {
              var m = a.find("li:first")[0];
              a.find(".pagination.prev").length > 0 && (m = a.find(".pagination.prev")[0]);
              a.scrollTo(m, {
                duration: 800,
                axis: "y",
                onAfter: function() {}
              })
            } else a.scrollTo(a.find("li:last").eq(0), {
              duration: 800,
              axis: "y",
              onAfter: function() {}
            });
            EasyEditAssetFinder.interaction.enable()
          }
        }
      })
    },
    getSelectedLineage: function() {
      var a = [];
      jQuery("a.selected,a.historySelected", "#ees_assetFinderBody").each(function() {
        a.push(parseFloat(jQuery(this).find(".assetid").text()))
      });
      return a
    },
    getSelectedRootUrl: function() {
      return jQuery("a.selected,a.historySelected", "#ees_parentGroup_0").attr("href")
    },
    doSelection: function(a, b, c) {
      function d(a) {
        a.length && EasyEditAssetManager.getAsset(a[0], function(j) {
          a.splice(0, 1);
          e.events.trigger("select_confirm", {
            asset: j,
            lineage: b,
            root_url: c
          });
          e.events.trigger("close");
          f.push(j);
          a.length ? d(a) : (EasyEditOverlay.hideOverlay("loading"), 1 < f.length ? e.options.callback.apply(this, [f, b, c]) : e.options.callback.apply(this, [f[0], b, c]))
        }, EasyEditCacheManager.DEFAULT_EXPIRY)
      }
      var e = this;
      EasyEditEventManager.trigger("AssetFinderAssetSelected");
      e._cleanUp();
      EasyEditOverlay.showOverlay("loading", {
        scrollTop: !1
      });
      var f = [];
      d(a)
    },
    _attachEvents: function() {
      var a = this,
        b = jQuery("#ees_assetFinderBody");
      jQuery(".modalContainer").draggable({
        handle: ".modalHeaderContent",
        containment: "document"
      });
      jQuery(b).off("click", ".parentGroup .pagination.prev a").on("click", ".parentGroup .pagination.prev a", function(b) {
        a.triggerNextPaginationSet(jQuery(this).parent().parent(), !0);
        b.preventDefault()
      });
      jQuery(b).off("click", ".parentGroup .pagination.next a").on("click", ".parentGroup .pagination.next a", function(b) {
        a.triggerNextPaginationSet(jQuery(this).parent().parent());
        b.preventDefault()
      });
      jQuery("#ees_refreshAssetFinder").on("click", null, function(b) {
        jQuery("#ees_refreshAssetFinder").off("click");
        b.preventDefault();
        a.refresh()
      });
      b.on("dblclick", ".parentGroup li a", function(b) {
        b.preventDefault();
        b = jQuery(this).parent();
        if (b.hasClass("isDependant1") || b.hasClass("isSelectable0")) return !1;
        a.doSelection([jQuery(this).find(".assetid").text()], a.getSelectedLineage(), a.getSelectedRootUrl())
      });
      b.on("click", ".parentGroup li a", function(c) {
        c.preventDefault();
        EasyEditEventManager.trigger("AssetFinderItemClick");
        var d = jQuery(this).parent();
        if (d.hasClass("isDependant1")) return !1;
        var e = jQuery(this).find(".assetid").text();
        if (a.options.multipleSelection && (c.ctrlKey || c.metaKey)) {
          jQuery("#ees_assetFinderBody .isSelectable0 a.selected").removeClass("selected");
          if (d.hasClass("isSelectable0")) return !1;
          !0 === jQuery(this).hasClass("selected") ? (jQuery(this).removeClass("selected"), a.selectedAssetIds = jQuery.grep(a.selectedAssetIds, function(a) {
            return a != e
          })) : (jQuery(this).addClass("selected"), a.selectedAssetIds.push(e));
          !d.hasClass("isAccessible0") && !d.hasClass("isDependant1") ? a.setSelectedAsset(d.hasClass("isSelectable0"), this) :
            a.setSelectedAsset(null);
          return !1
        }
        d.hasClass("isSelectable0") || (a.selectedAssetIds = [e]);
        if (!0 === jQuery(this).hasClass("selected") && 1 == b.find(".selected").length) return !1;
        b.find(".selected").removeClass("selected").addClass("historySelected");
        jQuery(this).addClass("selected");
        b.find(".lastExpanded").removeClass("lastExpanded").addClass("historySelected");
        jQuery(this).removeClass("historySelected").addClass("lastExpanded");
        c = jQuery(this).parents("div.parentGroup");
        c.find("a").removeClass("historySelected").nextAll("div").find("a").removeClass("selected").removeClass("historySelected");
        c.nextAll(".parentGroup").remove();
        !d.hasClass("isAccessible0") && !d.hasClass("isDependant1") ? a.setSelectedAsset(d.hasClass("isSelectable0")) : a.setSelectedAsset(null);
        a.buildBreadcrumbs();
        if (!jQuery(this).find(".childCount").length) return !1;
        var f = jQuery(".assetid", this).text();
        EasyEditAssetFinder.interaction.disable();
        var g = a.addPane(f);
        a.adjustContainerWidth();
        EasyEditAssetManager.getAssetMap({
          assetids: [{
            id: jQuery(".assetid", this).text(),
            linkid: jQuery(".link", this).text()
          }],
          callback: function(c) {
            if (jQuery("#ees_assetFinderOverlay").length !==
              0) {
              var d = jQuery('[id="' + a.getId(f) + '"]');
              if (!EasyEdit.isset(c)) {
                var e = parseFloat(b.find(".selected").find(".childCount").text()) >= 1 ? EasyEditLocalise._("Unable to retrieve child information, you may not have the correct permissions.") : EasyEditLocalise._("No children to show"),
                  e = jQuery(EasyEdit.tmpl.render("simple_tag", {
                    tag: "div",
                    "class": "inaccessibleMessage",
                    content: e
                  }));
                d.find(".loadingFeedback").before(e).remove();
                EasyEditAssetFinder.interaction.enable();
                return false
              }
              for (var l in c) {
                var n = l.replace("ID_",
                  "");
                g.attr("data-parentid", n);
                g.attr("data-start", c[l].start_pos);
                g.attr("data-linkid", c[l].linkid);
                g.attr("data-num-kids", c[l].num_kids);
                jQuery.data(d.get(0), "map", c[l]);
                var m = new EasyEditAPI,
                  o = [];
                jQuery.each(c[l].children, function(a, b) {
                  b.assetid = unescape(b.assetid);
                  if (b.assetid.indexOf(":") === -1 && Number(b.num_kids) === -1) {
                    m.queue("getChildCount", {
                      asset_id: b.assetid,
                      level: 0
                    });
                    o.push(a)
                  }
                });
                m.run(function(b) {
                  if (b !== null)
                    for (var d = 0; d < b.length; d++) {
                      var e = o.shift();
                      if (b[d].data.child_count) c[l].children[e].num_kids =
                        b[d].data.child_count
                    }
                  jQuery.each(c[l].children, function(b, c) {
                    c = a.options.itemRefiner(c);
                    a.addItem(n, c)
                  });
                  jQuery("<div>").append(jQuery('[id="' + a.getId(n) + '"]').eq(0).clone()).html();
                  EasyEditAssetFinder.interaction.loadingHide(n);
                  a.doPagination(n);
                  a._adjustResizerHandleHeight(g)
                }, m.runMode.BATCH)
              }
              a.styleInaccessible();
              EasyEditAssetFinder.interaction.enable();
              jQuery("#ees_assetFinderBodyWrapper").scrollTo(b.find('[id="' + a.getId(f) + '"]').eq(0), {
                duration: 800,
                axis: "x",
                onAfter: function() {}
              })
            }
          }
        })
      });
      jQuery("#ees_assetFinderSelectButton").click(function(b) {
        b.preventDefault();
        if (jQuery(this).hasClass("disabled")) return !1;
        a.options.beforeSelectionCallback.call(this, function() {
          jQuery(this).hasClass("disabled") || a.selectedAssetIds.length && a.doSelection(a.selectedAssetIds, a.getSelectedLineage(), a.getSelectedRootUrl())
        })
      })
    },
    _adjustResizerHandleHeight: function(a) {
      var b = jQuery(a.find("ul")[0]).height(),
        c = jQuery("#ees_assetFinderBodyWrapper").height();
      b > c && a.find(".ui-resizable-handle").css("height", b)
    },
    _cleanUp: function() {
      EasyEditCacheManager.clearScope("AssetMap");
      jQuery("#ees_assetFinderBody").off("click",
        ".parentGroup li a");
      jQuery("#ees_assetFinderBody").off("click", ".parentGroup .pagination a");
      jQuery("body").removeClass("doubleOverlay");
      jQuery("#ees_assetFinderOverlay").remove()
    }
  },
  EasyEditAssetManager = {
    _currentAsset: null,
    _currentAssetId: null,
    _currentUserAsset: null,
    clearCurrentAssetCache: function() {
      null !== this._currentAssetId && EasyEditCacheManager.clear("EasyEditAssetManager", this._currentAssetId);
      this._currentAssetId = this._currentAsset = null
    },
    getSiteDetails: function(a) {
      if (a instanceof EasyEditAsset) {
        if ("site" ===
          a.attribute("type_code")) return [a.id, a.lineage[a.id]];
        for (var b in a.lineage)
          if ("site" === a.parentIds[b].type_code) return [a.parentIds[b].assetid, a.lineage[b]]
      }
      return null
    },
    getCurrentAsset: function(a) {
      if (null === this._currentAsset) {
        var b = null,
          b = EasyEdit.getURL().full,
          c = EasyEdit.getParam("limbo_assetid"),
          b = null !== c ? c : b,
          c = EasyEdit.getParam("a");
        null !== c && c.match(":") && (c = c.split(":").shift());
        b = null !== c ? c : b;
        null !== this._currentAssetId && (b = this._currentAssetId);
        this.getAsset(b, function(b) {
          EasyEdit.isError(b) ||
            EasyEditAssetManager.setCurrentAsset(b);
          a.call(this, b)
        }, EasyEditCacheManager.DEFAULT_EXPIRY)
      } else a.call(this, this._currentAsset)
    },
    setCurrentAsset: function(a) {
      a instanceof EasyEditAsset && (this._currentAsset = a, this._currentAssetId = a.id, EasyEditCacheManager.setCache("EasyEditAssetManager", a.id, a))
    },
    getAssetMap: function(a) {
      for (var b = {
          assetids: [],
          start: 0,
          limit: EasyEditConfig.hasOwnProperty("assetFinderMaxAssets") ? EasyEditConfig.assetFinderMaxAssets : 100,
          total: 0,
          cache: !0,
          callback: function() {}
        }, c = [], d = jQuery.extend(b,
          a, !0), e = 0, a = 0, b = d.assetids.length; a < b; a += 1) {
        var e = "string" == typeof d.assetids[a].id && d.assetids[a].id.match(":") ? e + d.assetids[a].id : e + parseFloat(d.assetids[a].id),
          f = d.start;
        void 0 !== d.assetids[a].start && (f = d.assetids[a].start);
        var g = null;
        void 0 !== d.assetids[a].sort_order && (g = d.assetids[a].sort_order);
        var j = !1;
        !0 === d.assetids[a].centred && (j = !0);
        var h = '<asset assetid="' + d.assetids[a].id + '" limit="' + d.limit + '" linkid="' + d.assetids[a].linkid + '"';
        null !== g ? (e += "(so=" + g + ")", h += ' sortorder="' + g + '"') : (e +=
          "(st=" + f + ")", h += ' start="' + f + '"');
        !0 === j && (e += "(c)", h += ' centred="1"');
        e += "_";
        h += " />";
        c.push(h)
      }
      e += d.limit + "_" + d.total;
      if (EasyEditCacheManager.hasCache("AssetMap", e, !0) && d.cache) return d.callback.call(this, EasyEditCacheManager.getCache("AssetMap", e)), !1;
      a = EasyEditUrl.getURL();
      jQuery.ajax({
        url: EasyEditUrl.buildEditURL(a.url) + "?SQ_ACTION=asset_map_request",
        type: "POST",
        contentType: "text/xml",
        processData: !1,
        data: '<command action="get assets" >' + c.join("\n") + "</command>",
        success: function(a) {
          var b = {},
            c = jQuery(a);
          if (0 < c.children("error").length) return a = c.children("error").text(), d.callback.call(this, null, a), !1;
          if ("string" === typeof a && null !== /^\s*$/.exec(a)) return d.callback.call(this, null, a), !1;
          c.children().children().each(function(a, c) {
            var e = jQuery(c),
              f = "ID_" + d.assetids[a].id;
            "undefined" === typeof e.attr("assetid") ? b[f] = {
              children: []
            } : (f = "ID_" + e.attr("assetid"), b[f] = {
              children: [],
              accessible: e.attr("accessible"),
              num_kids: e.attr("num_kids"),
              start_pos: e.attr("start"),
              link_type: e.attr("link_type"),
              linkid: e.attr("linkid")
            });
            jQuery(c).children().each(function(a, c) {
              jQuery(c);
              var d = {};
              jQuery.each(c.attributes, function(a, b) {
                d[b.name] = b.value
              });
              b[f].children.push(d)
            })
          });
          EasyEditCacheManager.setCache("AssetMap", e, b);
          d.callback.call(this, b, null)
        }
      })
    },
    checkWorkflow: function(a, b, c) {
      b || (b = new EasyEditAPI);
      var d = a;
      a instanceof EasyEditAsset && (d = a.id);
      b.queue("getWorkflowSchema", {
        asset_id: d,
        granted: !0,
        running: !1
      }, !0);
      b.queue("getWorkflowSchema", {
        asset_id: d,
        granted: !0,
        running: !0
      }, !0);
      "function" === typeof b &&
        (c = b, b.run(function() {
          if (a instanceof EasyEditAsset) {
            a.hasWorklowApplied = b.getResult(0, "hasWorkflowApplied");
            a.hasRunningWorkflow = b.getResult(1, "hasRunningWorkflow");
            c.call(this, a)
          } else c.call(this, results)
        }))
    },
    getAsset: function(a, b, c, d) {
      var e = new EasyEditAPI,
        f = EasyEditCacheManager.DEFAULT_EXPIRY;
      "string" === typeof a && EasyEditUrl.getURLFromString(a);
      var g = !1,
        a = a + "";
      EasyEditDebug.log("getAsset", a);
      "number" === typeof c && (f = c);
      "boolean" === typeof d && (g = d);
      var j = EasyEditUrl.cleanURL(a);
      switch (f) {
        case EasyEditCacheManager.DEFAULT_EXPIRY:
        case EasyEditCacheManager.NO_EXPIRY:
          if (EasyEditCacheManager.hasCache("EasyEditAssetManager",
              a, c === EasyEditCacheManager.DEFAULT_EXPIRY ? !0 : !1)) {
            a = EasyEditCacheManager.getCache("EasyEditAssetManager", a);
            b.call(this, a);
            break
          } else this.doGetAsset(j, function(a) {
            EasyEditCacheManager.setCache("EasyEditAssetManager", j, a);
            b.call(this, a)
          }, e.runMode.BATCH, g);
          break;
        default:
          this.doGetAsset(j, function(a) {
            EasyEditCacheManager.setCache("EasyEditAssetManager", j, a);
            b.call(this, a)
          }, e.runMode.BATCH, g)
      }
    },
    doGetAsset: function(a, b, c, d) {
      var e = this,
        f = new EasyEditAPI;
      f.queue("getGeneral", {
        asset_id: a,
        get_attributes: 1
      });
      f.queue("getLineage", {
        asset_url: a,
        levels: 1
      });
      e.checkWorkflow(a, f);
      f.queue("getKeywordsReplacements", {
        asset_id: a,
        keywords_array: ["%details-F_thumbnail_current%"]
      });
      "string" === typeof a && -1 !== a.indexOf("http") && f.queue("getLineageFromUrl", {
        asset_url: a
      });
      f.run(function(c) {
        if (!EasyEdit.isset(c) || EasyEdit.isError(c[0].data, d)) return d && (c = new EasyEditAsset(a), b.call(this, c)), !1;
        if (!EasyEdit.isset(c[0]) || !EasyEdit.isset(c[1]) || !EasyEdit.isset(c[2]) || !EasyEdit.isset(c[3]) || !EasyEdit.isset(c[4])) return d ?
          (c = new EasyEditAsset(a), b.call(this, c)) : (new EasyEditError({
            message: EasyEditLocalise._("Critical error gathering asset information")
          })).display(), !1;
        var f = c[0].data,
          h = c[1].data,
          k = c[2].data,
          l = c[3].data,
          n = c[4].data;
        !EasyEdit.isError(f, d) && !EasyEdit.isError(h, d) && !EasyEdit.isError(k, d) && !EasyEdit.isError(l, d) && !EasyEdit.isError(n, d) ? (f = new EasyEditAsset(f.id, f), f.hasWorkflowApplied = "undefined" !== typeof k.granted ? !0 : !1, f.runningWorkflow = "undefined" !== typeof l.running ? !0 : !1, f.setLineage(h), EasyEdit.isset(c[5]) &&
          "getLineageFromUrl" === c[5].fnName && !EasyEdit.isError(c[5].data) && f.setPrimaryLineage(c[5].data), n.hasOwnProperty("details-F_thumbnail_current") && f.attribute("thumbnail", e.getThumbnailInfo(n["details-F_thumbnail_current"]["details-F_thumbnail_current"])), f.resetChangedAttributes(), EasyEditCacheManager.setCache("EasyEditAssetManager", a, f), b.call(this, f)) : d && (c = new EasyEditAsset(a), b.call(this, c))
      }, c)
    },
    getThumbnailInfo: function(a) {
      var b = null,
        c = /<span class="sq-info-asset-name sq-tag-line">(.*)\s\(Id: #<span class="sq-info-assetid">([0-9]+(:.*)?)<\/span>\)/i.exec(a),
        d = jQuery(a);
      if (null !== c && (a = /Size:<\/b>\s?([0-9\.]+)\s([a-z]+)/gi.exec(a), b = {
          asset_id: c[2],
          name: c[1],
          height: null,
          width: null,
          path: d.find("a:first").attr("href")
        }, null !== a && (b.size = a[1], b.sizeMod = a[2]), c = /([0-9]+) x ([0-9]+) pixels/i.exec(d.text()), null !== c)) b.width = c[1], b.height = c[2];
      return b
    },
    refreshAttributes: function(a) {
      var b = null,
        c = null;
      1 < arguments.length && ("function" === typeof arguments[1] ? b = arguments[1] : arguments[1] instanceof EasyEditAPI && (c = arguments[1]));
      null === c && (c = new EasyEditAPI);
      c.queue("getGeneral", {
        asset_id: a.id,
        get_attributes: 1
      });
      this.checkWorkflow(a, c);
      "function" === typeof b && c.expect(3).run(function(c) {
        a.attributes(c[0].data);
        a.resetChangedAttributes();
        var e = c[2].data;
        a.hasWorkflowApplied = "undefined" !== typeof c[1].data.granted ? !0 : !1;
        a.runningWorkflow = "undefined" !== typeof e.running ? !0 : !1;
        b.call(this, c[0].data)
      }, c.runMode.BATCH)
    },
    getMetadata: function(a, b) {
      (new EasyEditAPI).queue("getMetadata", {
        asset_id: a.id
      }).run(function(a) {
        b.call(this, a[0].data)
      })
    },
    getCurrentUser: function(a) {
      function b(a) {
        return EasyEdit.isset(a) &&
          null === a ? "" : a
      }
      var c = this,
        d = [];
      null === c._currentUserAsset ? c.getCurrentAsset(function(e) {
        var f = new EasyEditAPI;
        d.push("%globals_user_assetid%");
        d.push("%globals_user_type%");
        d.push("%globals_user_attribute_first_name%");
        d.push("%globals_user_attribute_last_name%");
        d.push("%globals_user_attribute_username%");
        d.push("%globals_user_attribute_email%");
        d.push("%globals_user_short_name%");
        d.push("%globals_user_thumbnail_url%");
        d.push("%globals_user_thumbnail_assetid%");
        f.queue("getKeywordsReplacements", {
          asset_id: e.id,
          keywords_array: d,
          null_if_empty: !0
        }).run(function(d) {
          var d = d[0].data,
            e = b(d.globals_user_attribute_first_name) + "&nbsp;" + b(d.globals_user_attribute_last_name);
          "&nbsp;" === e && (e = b(d.globals_user_attribute_username));
          var f = b(d.globals_user_short_name),
            d = new EasyEditAsset(d.globals_user_assetid, {
              name: e,
              short_name: f,
              username: b(d.globals_user_attribute_username),
              first_name: b(d.globals_user_attribute_first_name),
              last_name: b(d.globals_user_attribute_last_name),
              email: b(d.globals_user_attribute_email),
              type: b(d.globals_user_type),
              thumbnail: b(d.globals_user_thumbnail_url),
              thumbnailId: b(d.globals_user_thumbnail_assetid)
            }),
            e = function(a) {
              (new EasyEditError(EasyEditLocalise._("This function does not exist: %1", a))).display()
            };
          d.save = e;
          d.create = e;
          d.hasWorkflow = e;
          d.trash = e;
          d.hasParent = e;
          c._currentUserAsset = d;
          a.call(this, d)
        }, f.runMode.SYNC)
      }) : a.call(this, this._currentUserAsset)
    },
    saveAsset: function(a, b) {
      if (!a instanceof EasyEditAsset) b.call(this, new EasyEditError(EasyEditLocalise._("Unable to save the asset because it is not a valid EasyEditAsset")));
      else {
        var c = this,
          d = new EasyEditAPI,
          e = a.getChangedAttributes(),
          f = a.statusChange,
          g = a.statusCascade,
          j = "",
          h = "";
        1 <= e.length && (changedAttributes = {}, jQuery.each(e, function(a, b) {
          changedAttributes[b.key] = b.value
        }), d.queue("setMultipleAttributes", {
          asset_id: a.id,
          field_info: changedAttributes
        }));
        if (0 !== 1 * f) {
          e = "_change_status_stream_workflow";
          if (8 === Number(f) || 256 === Number(f)) e = "_change_status_stream_bypass";
          e = jQuery('#main_form select[id$="' + e + '"] option:selected').val();
          if ("string" === typeof e && ("" !== e || "SQ_USE_DEFAULT" !==
              e)) j = e;
          e = jQuery('#main_form input[type="hidden"][name$="_change_status_stream"]').val();
          if ("string" === typeof e && ("" !== e || "SQ_USE_DEFAULT" !== e)) j = e;
          e = jQuery('#main_form textarea[id$="workflow_approval_request_comment"]');
          0 < e.length && (h = e.val());
          d.queue("acquireLock", {
            asset_id: a.id,
            screen_name: "all"
          });
          d.queue("setAssetStatus", {
            asset_id: a.id,
            status: f,
            cascade: g,
            workflow_stream: j,
            userlog: h
          })
        }
        c.refreshAttributes(a, d);
        d.run(function(d) {
          a.statusChange = 0;
          for (var e = a.statusCascade = 0, f = d.length; e < f; e = e + 1) d[e].fnName ===
            "getGeneral" && a.attributes(d[e].data);
          a.resetChangedAttributes();
          if (a.isFile()) {
            e = EasyEdit.getURLFromString(a.attribute("web_path"));
            f = EasyEdit.getParam("limbo_assetid");
            if (typeof e.file === "object" && f === null) {
              EasyEditOverlay.showOverlay("loading", {
                message: EasyEditLocalise._("Reloading page") + "..."
              });
              EasyEditUrl.getSiteUrlForAsset(a, function(b) {
                window.location = b + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + a.id + "#mode=edit&screen=details"
              })
            }
          }
          for (var g in d) {
            d[g].fnName === "setAssetStatus" &&
              typeof d[g].data[0] === "string" && d[g].data[0].indexOf("has been changed successfully") !== -1 && EasyEditEventManager.trigger("EasyEditAssetStatusChange");
            if (d[g].fnName === "getWorkflowSchema" && typeof d[g].data.granted !== "undefined") a.hasWorkflowApplied = true;
            if (d[g].fnName === "getWorkflowSchema" && typeof d[g].data.running !== "undefined") a.runningWorkflow = true
          }
          b.call(c, a)
        }, d.runMode.BATCH)
      }
    },
    createAsset: function(a, b, c) {
      var d = a.attributes(),
        e = a.getChangedAttributes(),
        f = new EasyEditAPI,
        b = {
          parentID: b,
          parent_id: b,
          type_code: d.type_code,
          asset_name: d.name,
          link_value: d.link_value,
          sort_order: -1
        };
      if (1 <= e.length) {
        b.extra_attributes = 1;
        for (var g = 0, j = e.length; g < j; g += 1) b[e[g].key] = e[g].value
      }
      a.isFile() ? (b.friendly_name = d.name, b.link_type = "SQ_LINK_TYPE_" + d.link_type, f.queue("createFileAsset", b)) : (b.link_type = d.link_type, f.queue("createAsset", b));
      f.expect(1).run(function(b) {
        b = b[0].data;
        if (!b.hasOwnProperty("error"))
          if (b.hasOwnProperty("id")) a.id = b.id;
          else
            for (var d in b) a.id = d * 1;
        c.call(this, b)
      }, f.runMode.BATCH)
    },
    getStatuses: function() {
      alert("This functions is deprecated")
    },
    hasWorkflow: function(a, b) {
      null === a.hasWorkflowApplied ? this.checkWorkflow(a, null, function() {
        b.call(this, a.hasWorkflowApplied)
      }) : b.call(this, a.hasWorkflowApplied)
    },
    trashAsset: function(a, b) {
      var c = this;
      (new EasyEditAPI).queue("trashAsset", {
        asset_ids: a.id
      }).expect(1).run(function(a) {
        EasyEdit.isError(a[0].data) || b.call(c, a[0].data)
      })
    },
    acquireLock: function(a, b, c) {
      var d = null;
      if (c instanceof EasyEditAPI) var e = c;
      else e = new EasyEditAPI, "function" === typeof c && (d = c);
      e.queue("acquireLock", {
        asset_id: a.id,
        screen_name: "string" ===
          typeof b.screen ? b.screen : "all",
        dependants_only: "boolean" === typeof b.dependantsOnly && !0 === b.dependantsOnly ? "1" : "0",
        force_acquire: "boolean" === typeof b.force && !0 === b.force ? "1" : "0"
      });
      "function" === typeof d && e.expect(1).run(function(a) {
        d.call(this, a[0].data)
      })
    },
    releaseLock: function(a, b, c) {
      var d = this,
        e = null;
      if (c instanceof EasyEditAPI) var f = c;
      else f = new EasyEditAPI, "function" === typeof c && (e = c);
      f.queue("releaseLock", {
        asset_id: a.id,
        screen: b
      });
      null !== e && f.run(function() {
        e.call(d, !0)
      })
    },
    removeLink: function() {
      alert("This function is deprecated")
    },
    createLink: function(a, b) {
      var c = this,
        d = new EasyEditAPI,
        e = "function" === typeof b ? b : null,
        f = {
          parent_id: null,
          child_id: null,
          link_type: 1,
          link_value: "",
          sort_order: -1,
          is_dependant: 0,
          is_exclusive: 0
        },
        f = jQuery.extend(!0, f, a);
      d.queue("createLink", a);
      null !== e && d.expect(1).run(function(a) {
        EasyEdit.isError(a[0].data) || e.call(c, a[0].data)
      })
    },
    moveAsset: function(a, b) {
      var c = this,
        d = new EasyEditAPI,
        e = "function" === typeof b ? b : null,
        f = {
          new_parent_id: null,
          old_parent_id: null,
          link_type: "SQ_LINK_TYPE_1",
          link_value: "",
          sort_order: -1
        },
        f = jQuery.extend(!0, f, a);
      d.queue("moveLink", a);
      null !== e && d.expect(1).run(function(a) {
        EasyEdit.isError(a[0].data) || e.call(c, a[0].data)
      })
    },
    getParents: function(a, b, c) {
      c.call(this, a.parentIds)
    },
    hasParent: function(a, b, c) {
      var d = !1;
      a.getParents(function(a) {
        d = "undefined" !== typeof a[b];
        c.call(this, d)
      })
    },
    hasPermission: function() {
      alert("This is a deprecated function")
    },
    getChildren: function(a, b) {
      var c = this;
      (new EasyEditAPI).queue("getChildren", {
        asset_id: a.id,
        levels: 1
      }).expect(1).run(function(a) {
        b.call(c, a[0].data)
      })
    },
    getChildrenFiltered: function(a, b, c) {
      var d = new EasyEditAPI,
        a = a + "",
        e = jQuery.extend({}, {
          sort_order: "asc",
          sort_by: "sort_order",
          type_code: {
            blacklist: [],
            whitelist: []
          },
          link_type: [""],
          allowDependents: !1,
          allowShadow: !1,
          customFilters: {}
        }, b),
        f = {
          sort_order: function(a, b) {
            return 1 * a.sort_order - 1 * b.sort_order
          },
          name: function(a, b) {
            var c = a.toLowerCase(),
              d = b.toLowerCase();
            return c < d ? 1 : c > d ? -1 : 0
          },
          created: function(a, b) {
            return 1 * a.created - 1 * b.created
          },
          updated: function(a, b) {
            return 1 * a.updated - 1 * b.updated
          },
          published: function(a,
            b) {
            return ("Never Published" === a.published ? 0 : 1 * a.published) - ("Never Published" === b.published ? 0 : 1 * b.published)
          }
        };
      d.queue("getChildren", {
        asset_id: a,
        levels: 1,
        type_codes: [""],
        link_types: e.link_type,
        link_values: [""],
        get_attributes: 0
      });
      d.expect(1).run(function(b) {
        var d = b[0].data;
        if ("undefined" === typeof d.error) {
          for (var b = [], h = 0, k = d.length; h < k; h += 1) {
            var l = !0;
            !1 === e.allowDependents && "1" === d[h].is_dependant && (l = !1);
            !1 === e.allowShadow && -1 !== a.indexOf(":") && (l = !1);
            if ("undefined" !== typeof e.type_code.blacklist)
              for (var n =
                  0, m = e.type_code.blacklist.length; n < m; n++) d[h].type_code === e.type_code.blacklist[n] && (l = !1);
            if ("undefined" !== typeof e.type_code.whitelist && 1 <= e.type_code.whitelist.length) {
              for (var n = !1, m = 0, o = e.type_code.whitelist.length; m < o; m++) d[h].type_code === e.type_code.whitelist[m] && (n = !0);
              n || (l = !1)
            }
            for (var r in e.customFilters) "function" === typeof e.customFilters[r] && ((0, e.customFilters[r])(d[h]) || (l = !1));
            l && b.push(d[h])
          }
          b.sort(f[e.sort_by]);
          "desc" === e.sort_order && b.reverse();
          r = [];
          h = 0;
          for (k = b.length; h < k; h++) r.push(b[h]);
          c.apply(this, [r, b.length])
        } else c.apply(this, [{}, 0])
      })
    },
    getSortedChildren: function(a, b, c) {
      this.getChildrenFiltered(a, {
        sort_order: b,
        sort_by: "sort_order"
      }, c)
    },
    designStyleClasses: function(a, b) {
      (new EasyEditAPI).queue("getDesignStyleClasses", {
        asset_id: a.id
      }).expect(1).run(function(a) {
        b.call(this, a[0].data)
      })
    },
    childCount: function(a, b) {
      (new EasyEditAPI).queue("getChildCount", {
        asset_id: a.id,
        level: 0
      }).expect(1).run(function(a) {
        b.call(this, a[0].data)
      })
    },
    cloneAsset: function(a, b, c, d, e) {
      var f = new EasyEditAPI;
      f.queue("cloneAsset", {
        asset_id: a.id,
        new_parent: b,
        link_type: 1 === c ? "SQ_LINK_TYPE_1" : "SQ_LINK_TYPE_2",
        clone_name: d
      });
      f.expect(1).run(function(b) {
        b = b[0].data.clonedAssets[0];
        if (!b.hasOwnProperty("error"))
          if (b.hasOwnProperty("id")) a.id = b.id;
          else
            for (var c in b) a.id = 1 * c;
        e.call(this, b)
      }, f.runMode.BATCH)
    }
  },
  EasyEditEventManager = {
    events: {},
    init: function() {
      var a = this;
      jQuery(window).bind("hashchange", function() {
        a.trigger("EasyEditUrlChange")
      })
    },
    register: function(a) {
      this.events[a] = []
    },
    trigger: function(a) {
      var b =
        Array.prototype.slice.call(arguments);
      b.shift();
      "undefined" === typeof this.events[a] && this.register(a);
      for (var c = 0, d = this.events[a].length; c < d; c++) fn = this.events[a][c], "function" === typeof fn && fn.apply(this, b)
    },
    bind: function(a, b) {
      "undefined" === typeof this.events[a] && this.register(a);
      this.events[a].push(b)
    },
    clear: function(a) {
      "undefined" !== typeof this.events[a] && (this.events[a] = [])
    }
  },
  EasyEditCacheManager = {
    _data: {},
    timeout: 60 * ("undefined" !== typeof EasyEditConfig.cacheManagerDefaultExpiry ? EasyEditConfig.cacheManagerDefaultExpiry :
      2),
    NOCACHE: 1,
    DEFAULT_EXPIRY: 2,
    NO_EXPIRY: 3,
    hasCache: function(a, b, c) {
      if ("undefined" !== typeof this._data[a] && "undefined" !== typeof this._data[a][b])
        if (c) {
          if (!this._isExpired(a, b)) return !0
        } else return !0;
      return !1
    },
    _isExpired: function(a, b) {
      var c = (new Date).getTime();
      if ("undefined" !== typeof this._data[a] && "undefined" !== typeof this._data[a][b]) {
        if (this._data[a][b].created < c - this.timeout) return !1;
        delete this._data[a][b];
        return !0
      }
    },
    clear: function(a, b) {
      "undefined" !== typeof this._data[a] && "undefined" !== typeof this._data[a][b] &&
        delete this._data[a][b]
    },
    clearScope: function(a) {
      this._data[a] = {}
    },
    setCache: function(a, b, c) {
      var d = (new Date).getTime();
      "undefined" === typeof this._data[a] && (this._data[a] = {});
      this._data[a][b] = {
        created: d,
        content: c
      }
    },
    clearAll: function() {
      this._data = {}
    },
    getCache: function(a, b) {
      return "undefined" !== typeof this._data[a] && "undefined" !== typeof this._data[a][b] ? this._data[a][b].content : null
    }
  },
  EasyEditViperComments = {
    hasComments: function(a) {
      if (null == a || "" == a) return !1;
      a = JSON.parse(decodeURIComponent(a));
      if ("undefined" !=
        typeof a && "undefined" != typeof a.length && 0 < a.length)
        for (var b = 0; b < a.length; b++)
          if (!0 != a[b].unattached) return !0;
      return !1
    },
    hasOpenComments: function(a) {
      if (null == a || "" == a) return !1;
      a = JSON.parse(decodeURIComponent(a));
      if ("undefined" != typeof a && "undefined" != typeof a.length && 0 < a.length)
        for (var b = 0; b < a.length; b++)
          if ("open" == a[b].status && !0 != a[b].unattached) return !0;
      return !1
    },
    showAllComments: function() {
      jQuery("div[id ^=Matrix-Viper-commentmark-]").show();
      jQuery("div.Matrix-Viper-commentdialog").show();
      jQuery("div.Matrix-Viper-commentdialog-comment-action").show()
    },
    hideAllComments: function() {
      jQuery("div[id ^=Matrix-Viper-commentmark-]").hide();
      jQuery("div.Matrix-Viper-commentdialog").hide();
      jQuery("div.Matrix-Viper-commentdialog-comment-action").hide()
    },
    cleanUpComments: function() {
      jQuery("div[id ^=Matrix-Viper-commentmark-]").remove();
      jQuery("div.Matrix-Viper-commentdialog").remove();
      jQuery("div.Matrix-Viper-commentdialog-comment-action").remove()
    },
    saveComments: function(a, b) {
      a.PluginManager.getPlugin("MatrixCommentsPlugin") && a.PluginManager.getPlugin("MatrixCommentsPlugin").saveComments(function(a) {
        b &&
          jQuery.each(a, function(a, c) {
            b.comments[a] = encodeURIComponent(JSON.stringify(c))
          })
      })
    },
    showComments: function(a, b) {
      $commentMakrs = b.PluginManager.getPlugin("MatrixCommentsPlugin").getSortedCommentMarks(a);
      $commentMarkToOpen = $commentMakrs.get(0);
      for (var c = 0; c < $commentMakrs.length; c++)
        if (!$($commentMakrs[c]).hasClass("Matrix-Viper-commentmark-resolved")) {
          $commentMarkToOpen = $commentMakrs[c];
          break
        }
      jQuery($commentMarkToOpen).mousedown();
      jQuery("html, body").animate({
        scrollTop: jQuery($commentMarkToOpen).offset().top -
          200
      }, 400)
    }
  };

function EasyEditAssetChildList(a) {
  var b = this;
  b.settings = jQuery.extend({
    id: "ees_childList",
    template: "linking_screen_child_list",
    target: "",
    rootNode: null,
    filterOptions: {},
    sortable: {
      axis: "y",
      cancel: "li.markedForDeletion",
      handle: ".dragIcon",
      stop: function() {
        b.events.trigger("sort_stop")
      },
      change: function() {
        b.events.trigger("change")
      }
    },
    draggable: !0
  }, a);
  b.events = new ObservableEvents(b, "fetch,fetch_complete,sort_stop,change,render,save,save_complete".split(","));
  b.$target = jQuery(b.settings.target);
  b.children = [];
  b.$element = null;
  b.events.observe("render", function() {
    b.attachEvents()
  })
}
EasyEditAssetChildList.prototype = {
  fetch: function() {
    var a = this;
    a.events.trigger("fetch");
    EasyEditAssetManager.getChildrenFiltered(a.settings.rootNode, a.settings.filterOptions, function(b) {
      a.children = b;
      for (var b = [], c = 0; c < a.children.length; c++) b.push(function(b, c) {
        EasyEditAssetManager.getAsset(a.children[c].asset_id, function(f) {
          a.children[c].asset = f;
          b(c + 1)
        }, EasyEditCacheManager.DEFAULT_EXPIRY, !0)
      });
      b.push(function() {
        a.events.trigger("fetch_complete")
      });
      EasyEdit.util.async.series(b, 0)
    })
  },
  each: function(a) {
    for (var b =
        0, c = this.children.length; b < c; b += 1) a.call(this.children[b], [b, this.children[b]])
  },
  getChildById: function(a) {
    var b = null;
    this.each(function() {
      parseFloat(this.id) === parseFloat(a) && (b = this)
    });
    return b
  },
  render: function() {
    function a(a) {
      var b = !0;
      !a.maximum_perm_on_asset.match("write") && !a.maximum_perm_on_asset.match("admin") && (b = !1);
      "1" === a.locked && (b = !1);
      return b
    }
    var b = this;
    b.$target.empty();
    var c = [];
    EasyEditAssetManager.getCurrentAsset(function(d) {
      var e = d.getPrimaryLineage();
      b.each(function() {
        this.maximum_perm_on_asset =
          this.maximum_perm_on_asset.toLowerCase();
        this.web_path = EasyEditUrl.buildEditURL(this.web_path);
        if (-1 !== this.web_path.indexOf("limbo_assetid")) {
          for (var d = this.asset.lineagesToArray(), g = null, j = 0, h = 0; h < d.length; h++) {
            for (var k = 0, l = 0; l < Math.min(d[h].length, e.length); l++)
              if (d[h][l].tree_id === e[l].tree_id) k++;
              else break;
            k > j && (j = k, g = d[h])
          }
          g && (this.web_path += "&tree_id=" + g[g.length - 1].tree_id, this.tree_id = g[g.length - 1].tree_id)
        }
        d = {
          child: this,
          status: {
            className: this.status.replace(/\s/g, "").toLowerCase(),
            description: EasyEditLocalise._("Status") +
              ": " + this.status
          }
        };
        b.settings.draggable && (d.drag = {
          className: a(this) ? "dragIcon" : "dragDenied",
          title: a(this) ? EasyEditLocalise._("Drag to re-arrange") : EasyEditLocalise._("You cannot re-order this item, it is locked or you do not have permissions")
        });
        c.push(d)
      });
      b.$element = jQuery(EasyEdit.tmpl.render(b.settings.template, {
        children: c,
        id: b.settings.id
      }));
      b.$target.append(b.$element);
      b.events.trigger("render")
    })
  },
  save: function(a) {
    var b = this,
      c = {
        links: []
      },
      d = new EasyEditAPI;
    b.events.trigger("save");
    jQuery("li",
      b.$element).each(function(a) {
      var d = jQuery(this).find(".assetId").text().replace("#", ""),
        d = b.getChildById(d);
      c.links.push({
        parent: b.settings.rootNode,
        child: d.id,
        link_type: "SQ_LINK_TYPE_" + d.link_type,
        existing_link_type: "SQ_LINK_TYPE_" + d.link_type,
        link_value: d.link_value,
        existing_link_value: d.link_value,
        sort_order: a,
        link_lock: d.locked
      })
    });
    d.queue("updateMultipleLinks", {
      link_info: c
    });
    d.run(function(c) {
      EasyEdit.isError(c[0].data) || (b.events.trigger("save_complete"), a.apply(this, [!0, [], {
        refresh: !0
      }]))
    })
  },
  attachEvents: function() {
    this.$element.find("ul").sortable(this.settings.sortable)
  }
};

function EasyEditModal(a, b, c, d) {
  this.title = a;
  this.description = b;
  this.className = d;
  this.modalContainerId = c;
  this.htmlContent = ""
}
EasyEditModal.prototype = {
  addContent: function(a) {
    this.htmlContent += a
  },
  getTemplate: function() {
    return '<div id="' + this.modalContainerId + '" class="modalContainer ' + this.className + '"><div class="modalHeader"><div class="modalHeaderContent"><a href="#" title="' + EasyEditLocalise._("Close") + '" class="closeModal"><span class="screenHide">' + EasyEditLocalise._("Close") + '</span></a><div class="modalIcon"></div><div class="modalHeaderInner"><div class="modalTitle"><h1>' + this.title + '</h1></div><div class="modalDesc">' +
      this.description + '</div></div></div></div><div class="modalBody"><div class="modalBodyContent">' + this.htmlContent + '</div></div><div class="modalFooter"></div></div>'
  },
  getModalLoadingTemplate: function(a, b, c) {
    return '<div id="' + ("string" === typeof a ? a : "") + '" class="' + ("string" === typeof b ? b : "") + '"><div class="modalLoaderContainer"><div class="modalLoader"><div class="modalLoaderFeebackContainer"><div class="modalLoaderFeeback"></div></div><div class="modalLoaderMessage">' + ("string" === typeof c ? c : "") + "</div></div></div></div>"
  }
};
EasyEditToolTipManager = function() {
  var a = this;
  a.tooltips = [];
  a.events = new ObservableEvents(a);
  jQuery(document).click(function(b) {
    var c = jQuery(b.target).parents(".eesTooltip").length,
      d = function() {
        var c = !1;
        a.each(function() {
          this.$target.get(0) === b.target ? c = !0 : this.$target.find(b.target).length && (c = !0)
        });
        return c
      }();
    !c && !d && a.hideAll()
  })
};
EasyEditToolTipManager.prototype = {
  create: function(a) {
    var b = this,
      c = new EasyEditToolTip(a),
      d = [];
    for (b.each(function(a) {
        this.settings.containerId === c.settings.containerId && d.push(a)
      }); 0 < d.length;) b.remove(d.pop());
    b.store(c);
    c.events.observe("before_show", function() {
      b.hideAll()
    });
    b.events.trigger("create");
    return c
  },
  store: function(a) {
    this.tooltips.push(a)
  },
  showAll: function() {
    this.each(function() {
      this.show()
    });
    this.events.trigger("show")
  },
  hideAll: function() {
    this.each(function() {
      this.hide()
    });
    this.events.trigger("hide")
  },
  remove: function(a) {
    this.tooltips[a].remove();
    this.events.trigger("remove", {
      index: a,
      tip: this.tooltips[a]
    });
    this.tooltips.splice(a, 1)
  },
  removeAll: function() {
    this.each(function() {
      this.remove()
    })
  },
  each: function(a) {
    for (var b = 0, c = this.tooltips.length; b < c; b += 1) a.call(this.tooltips[b], b)
  },
  getTipById: function(a) {
    var b = null;
    "string" === typeof a ? this.each(function() {
      this.settings.targetId === a && (b = this)
    }) : this.each(function() {
      "object" === typeof this.settings.targetId && "object" === typeof a && this.settings.targetId.get(0) ===
        a.get(0) && (b = this)
    });
    return b
  }
};
EasyEditToolTip = function(a) {
  this.settings = jQuery.extend({
    targetId: "",
    containerId: "ees_defaultTooltip",
    position: "north",
    topOffset: 0,
    leftOffset: 0,
    cssPosition: "absolute",
    title: "",
    message: "",
    buttons: "",
    visibility: "hide",
    className: ""
  }, a);
  this.events = new ObservableEvents(this);
  this.$element = jQuery(EasyEdit.tmpl.render("tooltip", {
    id: this.settings.containerId,
    "class": this.settings.className,
    title: this.settings.title,
    message: this.settings.message,
    buttons: this.settings.buttons
  }));
  jQuery("body").prepend(this.$element);
  this.$target = "object" === typeof this.settings.targetId ? this.settings.targetId : jQuery("#" + this.settings.targetId)
};
EasyEditToolTip.prototype = {
  toggle: function() {
    this.$element.is(":visible") ? this.hide() : this.show()
  },
  show: function(a) {
    this.events.trigger("before_show");
    this.$element.prependTo("body");
    "number" === typeof a ? this.$element.fadeIn(a) : this.$element.show();
    this.position();
    this.events.trigger("show")
  },
  hide: function() {
    this.$element.hide();
    this.events.trigger("hide")
  },
  remove: function() {
    this.$element.remove();
    this.events.trigger("remove")
  },
  position: function() {
    var a = this.$target.offset(),
      b = this.$target.outerHeight(),
      c = this.$target.outerWidth();
    "fixed" === this.settings.cssPosition.toLowerCase() && (a.top = parseFloat(this.$target.css("margin-top").replace("px", "")));
    var d = Math.floor(this.$element.outerWidth() / 2),
      e = Math.floor(this.$element.outerHeight() / 2),
      f = 0,
      g = 0,
      j = "";
    this.$element.removeClass("tooltipNorth tooltipSouth tooltipEast tooltipWest");
    switch (this.settings.position) {
      case "north":
        g = a.left + c / 2 - d;
        f = a.top - b - 20;
        j = "tooltipNorth";
        break;
      case "east":
        g = a.left - 2 * d - 20;
        f = a.top - e + b / 2;
        j = "tooltipWest";
        break;
      case "west":
        g =
          a.left + c + 20;
        f = a.top - e + b / 2;
        j = "tooltipEast";
        break;
      default:
        g = a.left + c / 2 - d, f = a.top + b + 20, j = "tooltipSouth"
    }
    0 > f && (f = 0);
    this.$element.css({
      top: Math.round(f),
      left: Math.round(g),
      position: this.settings.cssPosition
    }).addClass(j)
  }
};
var EasyEditWorkspaceManager = {
  getCurrentWorkspace: function(a) {
    var b = this;
    EasyEditAssetManager.getCurrentAsset(function(c) {
      b.isWorkspace(c) ? a.call(this, b.getWorkspaceFromRootNode(c.id)) : EasyEditWorkspaceManager.getWorkspaceForAsset(c, function(b) {
        a.call(this, b)
      })
    })
  },
  getAllWorkspacesForAsset: function(a, b) {
    var c = a.parentIds,
      d = [],
      e = EasyEditWorkspaceManager.getAllWorkspaces(),
      f;
    for (f in e)
      for (var g = 0, j = e[f].length; g < j; g++)
        for (var h in c) h *= 1, e[f][g].rootNode *= 1, h === e[f][g].rootNode && d.push([f, e[f][g].url,
          e[f][g]
        ]);
    b.call(this, d)
  },
  getWorkspaceConfigurationAsset: function(a) {
    var b = jQuery("head").find('script[src$="EasyEditWorkspaceConfig.js"]');
    b.length ? (b = EasyEdit.getURLFromString(b.attr("src")), b = null !== b.assetid ? b.assetid : b.url, EasyEditAssetManager.getAsset(b, function(b) {
      a.call(this, b)
    })) : a.call(this, null)
  },
  addWorkspace: function(a, b) {
    this.getWorkspaceConfigurationAsset(function(c) {
      "Write Access" !== c.attribute("maximum_perm_on_asset") && "Admin Access" !== c.attribute("maximum_perm_on_asset") ? ((new EasyEditError(EasyEditLocalise._("Unable to add workspace, insufficient permissions to edit config file."))).display(5),
        b.call(this, !1)) : EasyEditAssetManager.acquireLock(c, {
        screen: "attributes"
      }, function() {
        EasyEditAssetManager.getCurrentUser(function(d) {
          var d = "/**\n * " + EasyEditLocalise._("Workspace configuration file") + "\n * " + EasyEditLocalise._("Last updated by") + ": " + d.attribute("name") + "\n */\nvar EasyEditWorkspaceConfig = ",
            e;
          for (e in a) "undefined" === typeof EasyEditWorkspaceConfig.workspaces[e] && (EasyEditWorkspaceConfig.workspaces[e] = []), jQuery.each(a[e], function(a, b) {
            EasyEditWorkspaceConfig.workspaces[e].push(b)
          });
          d += JSON.stringify(EasyEditWorkspaceConfig, null, 4);
          setContentOfEditiableFileAsset(c.id, d + ";", function(a) {
            EasyEditAssetManager.releaseLock(c, "attributes", function() {
              EasyEdit.isError(a) ? ((new EasyEditError(EasyEdit.getError(a))).display(5), b.call(this, !1)) : b.call(this, !0)
            })
          })
        })
      })
    })
  },
  getWorkspaceForAsset: function(a, b) {
    var c = {
      category: null,
      details: null
    };
    this.getAllWorkspacesForAsset(a, function(a) {
      1 <= a.length ? (c.category = a[0][0], c.details = a[0][2], b.call(this, c)) : b.call(this, new EasyEditError(EasyEditLocalise._("There is no workspace found for this asset")))
    })
  },
  getRelatedWorkspaces: function(a, b) {
    var c = this.getAllWorkspaces();
    "undefined" !== typeof c[a] ? b.call(this, c[a]) : b.call(this, new EasyEditError(EasyEditLocalise._("The specific workspace category does not exist")))
  },
  getAllWorkspaces: function() {
    return "undefined" !== typeof EasyEditWorkspaceConfig ? EasyEditWorkspaceConfig.workspaces : null
  },
  isWorkspace: function(a) {
    var b = null;
    "object" === typeof a ? a instanceof EasyEditAsset && (b = this.getWorkspaceFromRootNode(a.id)) : b = this.getWorkspaceFromRootNode(a);
    return null ===
      b ? !1 : !0
  },
  getWorkspaceFromRootNode: function(a) {
    var b = this.getAllWorkspaces(),
      c;
    for (c in b)
      for (var d = 0, e = b[c].length; d < e; d++)
        if (1 * b[c][d].rootNode === 1 * a) return b[c][d];
    return null
  }
};
EasyEditSimpleEditRequest = function(a) {
  var b = {
    url: EasyEditUrl.getURL().url,
    assetid: null,
    backend_assetid: null,
    screen: "content"
  };
  this.hasParam = !1;
  this.settings = jQuery.extend(b, a);
  this.events = new ObservableEvents(this, ["sent", "complete", "setParam", "removeParam"]);
  this.params = {
    process_form: "1",
    backend_section: "am",
    am_section: "limbo",
    am_form_submitted: "1",
    assetid: this.settings.assetid,
    backend_assetid: this.settings.backend_assetid,
    asset_action: "edit",
    asset_ei_screen: this.settings.screen.toLowerCase(),
    sq_lock_release: "0",
    sq_lock_release_manual: "0",
    sq_lock_type: "all"
  }
};
EasyEditSimpleEditRequest.prototype = {
  send: function(a) {
    var b = this;
    if (!b.hasParam) return a.call(this, null), !1;
    b.events.trigger("sent");
    var c = EasyEditUrl.buildEditURL(b.settings.url) + "?limbo_assetid=" + b.settings.backend_assetid + "&SQ_BACKEND_PAGE=main&sq_link_path=&sq_asset_path=&asset_ei_screen=" + b.settings.screen;
    EasyEdit.getToken(function(d) {
      b.setParam("token", d);
      d = b._buildPOST();
      jQuery.ajax({
        url: c,
        type: "POST",
        data: d,
        success: function(c) {
          b.events.trigger("complete", {
            data: c
          });
          a.call(this, c)
        }
      })
    })
  },
  setParamsFromElement: function(a,
    b) {
    var c = this;
    jQuery("input,select,textarea", a).filter(function() {
      return "undefined" === typeof jQuery(this).attr("disabled")
    }).each(function() {
      var a = jQuery(this).attr("type"),
        e = jQuery(this).val();
      "string" === typeof a && "checkbox" === a ? jQuery(this).is(":checked") && c.setParam(jQuery(this).attr("name"), e) : "string" === typeof a && "radio" === a ? jQuery(this).is(":checked") && c.setParam(jQuery(this).attr("name"), e) : (b && (e = EasyEdit.fixHtml(e)), c.setParam(jQuery(this).attr("name"), e))
    })
  },
  setParam: function() {
    this.hasParam = !0;
    switch (typeof arguments[0]) {
      case "object":
        var a = arguments[0],
          b;
        for (b in a) this.params[b] = a[b];
        break;
      case "string":
        if (null !== /\[\]$/.exec(arguments[0]))
          if (EasyEdit.isset(this.params[arguments[0]]) || (this.params[arguments[0]] = []), "undefined" === typeof arguments[1] || null === arguments[1]) this.params[arguments[0]] = "";
          else if ("string" !== typeof arguments[1] && arguments[1].hasOwnProperty("length")) {
          a = 0;
          for (b = arguments[1].length; a < b; a += 1) this.params[arguments[0]].push(arguments[1][a])
        } else this.params[arguments[0]].push(arguments[1]);
        else this.params[arguments[0]] = arguments[1]
    }
    this.events.trigger("setParam", {
      args: arguments
    })
  },
  removeParam: function(a) {
    this.params.hasOwnProperty(a) && delete this.params[a];
    this.events.trigger("removeParam", {
      args: arguments
    })
  },
  _buildPOST: function() {
    var a = [],
      b;
    for (b in this.params)
      if (this.params.hasOwnProperty(b) && !("undefined" === typeof this.params[b] || null === this.params[b]))
        if ("string" !== typeof this.params[b] && this.params[b].hasOwnProperty("length"))
          for (var c = 0, d = this.params[b].length; c < d; c += 1) a.push(encodeURIComponent(b) +
            "=" + encodeURIComponent(this.params[b][c]));
        else a.push(encodeURIComponent(b) + "=" + encodeURIComponent(this.params[b]));
    return a.join("&")
  }
};
(function(a) {
  var b = {
      integer: function(a, b) {
        a = parseFloat(a);
        return "number" === typeof a ? Math.round(a) : b
      },
      serialise: function(a) {
        return EasyEdit.util.serialise(a)
      }
    },
    c = {
      text: "Text",
      numeric: "Number input",
      email_address: "Email",
      select: "Selection list",
      tickbox_list: "Checkboxes",
      option_list: "Radio buttons",
      datetime: "Date and Time",
      country: "Country",
      file_upload: "File Upload",
      password: "Password",
      tickbox_table: "Checkbox Table"
    },
    d = function(b, c, d) {
      this.events = new ObservableEvents(this);
      this.options = a.extend({
        id: null,
        parent: null,
        exists: !1,
        type: "text",
        is_morphed: !1,
        morphed_from: null,
        is_cloned: !1,
        cloned_from: null,
        is_deleted: !1,
        createLocations: {},
        template: "custom_form_question"
      }, b);
      this.viper = d;
      this.supported = EasyEditQuestionDecorators.hasOwnProperty(this.options.type);
      this.attributes = c;
      this.updateMap = {};
      this.editMode = !1;
      this.sliders = {};
      EasyEditQuestionDecorators.hasOwnProperty(this.options.type) && EasyEditQuestionDecorators[this.options.type].call(this, this);
      this.render()
    };
  d.prototype = {
    render: function() {
      var b = this,
        d = a.extend({}, this.options, {
          supported: this.supported,
          typeFriendly: c.hasOwnProperty(this.options.type) ? c[this.options.type] : this.options.type,
          attributes: this.attributes
        });
      this.$element = a(EasyEdit.tmpl.render(this.options.template, d)).data("question", this);
      this.attributes.hasOwnProperty("is_required") && 1 === parseFloat(this.attributes.is_required) && this.$element.addClass("custom-form-question__required");
      var g = EasyEdit.tmpl.render("custom_form_modal_question_generic", d);
      EasyEdit.tmpl.exists("custom_form_modal_question_" +
        this.options.type) && (g += EasyEdit.tmpl.render("custom_form_modal_question_" + this.options.type, d));
      this.tips = new EasyEditToolTipManager;
      this.settingsTip = this.tips.create({
        containerId: "ees_settingsToolTip_" + this.options.id + "_" + this.options.parent,
        targetId: a(".custom-form-question__settings-button", this.$element),
        title: EasyEditLocalise._("Settings"),
        message: g,
        className: "eesToolTip_question eesToolTip_question_type_" + this.options.type,
        buttons: EasyEdit.tmpl.render("custom_form_modal_buttons"),
        position: "east"
      });
      this.switchTip = this.tips.create({
        containerId: "ees_switchToolTip_" + this.options.id + "_" + this.options.parent,
        className: "custom-form-modal__type-switch",
        targetId: a(".custom-form-question__type-switcher", this.$element),
        title: EasyEditLocalise._("Change Field Type"),
        buttons: EasyEdit.tmpl.render("custom_form_modal_buttons"),
        message: function() {
          var a = {
            types: []
          };
          jQuery.each(c, function(c, d) {
            c !== b.options.type && a.types.push({
              type: c,
              text: d
            })
          });
          a.types = EasyEdit.util.filter(a.types, function(a, b) {
            return "tickbox_table" !==
              b.type && "password" !== b.type
          });
          return EasyEdit.tmpl.render("custom_form_modal_question_type_list", a)
        }(),
        position: "west"
      });
      a(".custom-form-modal__slider", this.settingsTip.$element).each(function() {
        var c = a(this),
          d = c.data("attribute"),
          f = c.data("id");
        b.sliders[f] = new EasyEditSlider({
          bindElem: c,
          defaultVal: EasyEditLocalise._(b.attributes.hasOwnProperty(d) && b.attribute(d) ? "Yes" : "No")
        })
      });
      a(".live-attr", this.settingsTip.$element).each(function() {
        var c = a(this).data("default"),
          d = a(this).data("attribute");
        "undefined" !==
        typeof c && "undefined" !== typeof d && null === b.attribute(d) && a(this).val(c)
      });
      this.events.trigger("render");
      this.buildPreview(a(".custom-form-question__preview", b.$element), jQuery.extend({}, this.options, {
        attributes: this.attributes
      }));
      this._bindEvents()
    },
    attach: function(a, b) {
      var c = this;
      if ("undefined" === typeof b || "function" !== typeof a[b]) b = "append";
      a[b](this.$element);
      setTimeout(function() {
        c.$element.removeClass("custom-form-question__new")
      }, 200);
      this.events.trigger("attach", a)
    },
    getElement: function() {
      return this.$element
    },
    attribute: function(a, b) {
      if ("undefined" !== typeof b) this.attributes[a] = b, this.events.trigger("attr-change", a, b);
      else if (this.attributes.hasOwnProperty(a)) return this.attributes[a];
      return null
    },
    getSerialisedAttribute: function(a) {
      a = this.attribute(a);
      null !== a && (a = EasyEdit.util.unserialise(a));
      return a
    },
    exists: function() {
      return this.options.exists
    },
    setEditMode: function(a) {
      a ? (this.events.trigger("edit"), this.$element.addClass("custom-form-question__edit-mode")) : (this.events.trigger("edit-disabled"), this.$element.removeClass("custom-form-question__edit-mode"))
    },
    _bindEvents: function() {
      function d(b) {
        b && b.preventDefault();
        if (f.viper.getEditableElement() === this) return !1;
        f.viper.setEditableElement(this);
        f.viper.selectElement(a(this).find("p:first").get(0));
        f.setEditMode(!0)
      }
      var f = this;
      a(".viper-editable", this.$element).click(d);
      f.viper.registerCallback("Viper:clickedOutside", "question-text-" + f.options.parent + "_" + f.attribute("id"), function() {
        var b = a(f.viper.getEditableElement()),
          d = b.parents(".custom-form-question"),
          e = a.trim(b.text());
        b.hasClass("custom-form-question__title") ?
          (EasyEdit.util.isEmpty(e) && (e = EasyEditLocalise._("%1 Question #%2", c[f.options.type], f.options.id), b.text(e)), f.attribute("name", e)) : b.hasClass("custom-form-question__note") && (f.attribute("note", e), EasyEdit.util.isEmpty(e) && (a(".custom-form-question__note", d).hide(), a(".custom-form-question__note-cta", d).show()));
        try {
          f.viper.setEditableElement(null)
        } catch (k) {}
      });
      var g = f.attribute("note"),
        j = a(".custom-form-question__note", this.$element),
        h = a(".custom-form-question__note-cta", this.$element);
      h.on("click",
        function(a) {
          a.preventDefault();
          h.hide();
          j.show();
          d.call(j.get(0), a)
        });
      EasyEdit.util.isEmpty(g) ? (j.hide(), h.show()) : (j.show(), h.hide());
      var k = a(".custom-form-question__settings-button", this.$element);
      k.click(function(a) {
        a.preventDefault();
        f.settingsTip.toggle();
        a = f.$element.find(".custom-form-question__title").text();
        f.settingsTip.$element.find(".custom-form-modal__question-title").text(a);
        f.setEditMode(true)
      });
      a(".custom-form-question__clone-button", this.$element).click(function(a) {
        a.preventDefault();
        f.update();
        f.events.trigger("clone-requested")
      });
      this.events.observe("edit-disabled", function() {
        f.tips.hideAll()
      });
      this.settingsTip.events.observe("show", function() {
        k.addClass("active")
      });
      f.$element.on("click.form-question", function(b) {
        f.tips.each(function() {
          var c = a(b.target).parents();
          this.$element.is(":visible") && !this.$element.find(b.target).length && !c.filter(this.$element.get(0)).length && !this.$target.find(b.target).length && this.$element.get(0) !== b.target && this.$target.get(0) !== b.target && this.hide()
        })
      });
      this.settingsTip.events.observe("hide", function() {
        k.removeClass("active")
      });
      this.settingsTip.$element.find(".button-cancel").click(function(a) {
        a.preventDefault();
        f.settingsTip.hide()
      });
      var l = null;
      this.settingsTip.$element.add(this.$element).on("change keyup", ".live-attr", function() {
        clearTimeout(l);
        var c = a(this);
        l = setTimeout(function() {
          var a = c.data("attribute"),
            d = c.data("parser"),
            e = c.data("default"),
            k = c.val();
          b.hasOwnProperty(d) && (k = b[d].call(f, k, e));
          f.attribute(a, k)
        }, 300)
      });
      this.settingsTip.$element.find(".button-update").click(function(a) {
        a.preventDefault();
        f.update();
        f.settingsTip.hide()
      });
      EasyEdit.util.each(f.sliders, function(a, b) {
        b.events.observe("change", function() {
          var a = b.$bind.data("attribute");
          a && f.attribute(a, b.isTrue() ? 1 : 0);
          f.events.trigger("change")
        })
      });
      a(".custom-form-question__type-switcher-button", this.$element).click(function(a) {
        a.preventDefault();
        f.switchTip.show()
      });
      this.switchTip.$element.find(".button-cancel").click(function(a) {
        a.preventDefault();
        f.switchTip.hide()
      });
      this.switchTip.$element.find(".button-update").click(function(a) {
        a.preventDefault();
        a = f.switchTip.$element.find(".custom-form-modal__question-type-item.selected");
        if (a.length) {
          a = a.data("type");
          if (a === f.options.type) return false;
          f.events.trigger("morph-requested", a)
        } else return false
      });
      var n = f.switchTip.$element.find(".custom-form-modal__question-type-item");
      n.click(function() {
        n.removeClass("selected");
        a(this).addClass("selected")
      });
      n.on("dblclick", function() {
        n.removeClass("selected");
        a(this).addClass("selected");
        f.switchTip.$element.find(".button-update").trigger("click")
      });
      f.switchTip.events.observe("hide",
        function() {
          n.removeClass("selected")
        });
      this.sliders.required.events.observe("change", function() {
        f.sliders.required.isTrue() ? f.$element.addClass("custom-form-question__required") : f.$element.removeClass("custom-form-question__required");
        f.events.trigger("change")
      });
      a(".custom-form-question__remove-button", f.$element).click(function(b) {
        b.preventDefault();
        a(this).toggleClass("active");
        f.$element.toggleClass("custom-form__deleted");
        f.options.is_deleted = f.$element.hasClass("custom-form__deleted");
        f.events.trigger("change")
      });
      var m = null;
      this.events.observe("update-requested", function() {
        clearTimeout(m);
        m = setTimeout(function() {
          f.update()
        }, 300)
      });
      this.events.observe("change", function() {
        var b = a(".custom-form-question__preview", f.$element),
          c = a.extend({}, f.options, {
            attributes: f.attributes
          });
        f.buildPreview(b, c)
      });
      this.events.trigger("bind")
    },
    bindSliderEvent: function(a, b, c) {
      var d = this;
      this.sliders.hasOwnProperty(a) && this.sliders[a].events.observe("change", function() {
        d.sliders[a].isTrue() ? b.call(d) : c.call(d)
      })
    },
    update: function() {
      this.attribute("name",
        a.trim(a(".custom-form-question__title", this.$element).text()));
      var b = a(".custom-form-question__note", this.$element);
      b.parent().hasClass("custom-form-question__note-default") ? this.attribute("note", "") : this.attribute("note", a.trim(b.text()));
      this.events.trigger("update");
      this.events.trigger("change")
    },
    buildPreview: function(b, c) {
      var d = a.extend({}, c, {
          attributes: this.attributes
        }),
        j = "custom_form_question_preview_" + c.type;
      EasyEdit.tmpl.exists(j) && (d = EasyEdit.tmpl.render(j, d), b.html(d))
    },
    remove: function(a) {
      this.$element.addClass("custom-form__deleted");
      this.options.is_deleted = !0;
      a && this.$element.hide();
      this.events.trigger("remove")
    },
    save: function() {
      this.update();
      this.events.trigger("save");
      return this.attributes
    },
    inherit: function(a) {
      var b = "custom_form_question_preview_" + this.options.type,
        c = "custom_form_modal_question_" + this.options.type;
      EasyEdit.tmpl.exists(b) || EasyEdit.tmpl.set(b, EasyEditGlobalTemplates["custom_form_question_preview_" + a]);
      EasyEdit.tmpl.exists(c) || EasyEdit.tmpl.set(c, EasyEditGlobalTemplates["custom_form_modal_question_" + a]);
      EasyEditQuestionDecorators[a](this)
    }
  };
  window.EasyEditQuestion = d;
  window.EasyEditQuestionDecorators = {}
})(jQuery);
var EasyEditAssetWizard = function(a, b) {
  var c = {
      type_code: "",
      display_name: "",
      interface_type: "",
      description: "",
      cat_id: "",
      templateData: {
        default_asset_name: "",
        type_code: "page",
        queue: b,
        title: EasyEditLocalise._("Details"),
        name: {
          label: EasyEditLocalise._("Enter a name"),
          file_label: EasyEditLocalise._("Enter a friendly name")
        },
        link_type: {
          title: EasyEditLocalise._("Show in menu?"),
          description: EasyEditLocalise._("This option will affect all link locations")
        },
        upload: {
          label: EasyEditLocalise._("Upload File"),
          feedback: EasyEditLocalise._("No file selected")
        },
        alt: {
          label: EasyEditLocalise._("Alt Text"),
          description: EasyEditLocalise._("The text to be used in the Alt attribute of the IMG tag"),
          decorativeLabel: EasyEditLocalise._("Decorative only?")
        },
        caption: {
          label: EasyEditLocalise._("Caption"),
          description: EasyEditLocalise._("Some text to be associated with the image and can be accessed and printed out separately if required.")
        },
        label: {
          all_day_event: EasyEditLocalise._("All day event?"),
          use_end_date: EasyEditLocalise._("Use end date?"),
          start_date: EasyEditLocalise._("Start Date"),
          end_date: EasyEditLocalise._("End Date"),
          frequency: EasyEditLocalise._("Frequency"),
          daily: EasyEditLocalise._("Daily"),
          weekly: EasyEditLocalise._("Weekly"),
          monthly: EasyEditLocalise._("Monthly"),
          further_notice: EasyEditLocalise._("Until further notice")
        }
      },
      defaultSelectParentId: null,
      defaultFinderParentId: null
    },
    d = this;
  this.attributes = jQuery.extend(c, a, !0);
  this.createWizardType = this.attributes.type_code ? "create" : "clone";
  this.events = new ObservableEvents(this);
  this.createData = this.defaultCreateData = {
    type_code: this.attributes.type_code,
    asset_name: EasyEditLocalise._("New %1", this.attributes.display_name),
    link_type: null,
    attributes: [],
    extra_attributes: [],
    source_assetid: ""
  };
  this.validator = new EasyEditValidationController;
  this.createdAsset = null;
  this._vMethods = [];
  "clone" === this.createWizardType && EasyEditAssetManager.getCurrentAsset(function(a) {
    d.attributes.templateData.default_asset_name = a.attr.name
  });
  this.attributes.templateData.type_code = this.attributes.type_code;
  this.$element = jQuery(EasyEdit.tmpl.render(this.attributes.interface_type,
    this.attributes.templateData));
  "clone" === this.createWizardType && (this.$sourceAssetSelection = jQuery(EasyEdit.tmpl.render("wizard_source_asset_selection", {
    no_locations: EasyEditLocalise._("No locations are currently set"),
    description: EasyEditLocalise._("Select an asset to clone"),
    select_source_button: EasyEditLocalise._("Select New Asset"),
    select_current_button: EasyEditLocalise._("Select Current Asset"),
    title: EasyEditLocalise._("Source")
  })), this.$sourceAssetSelection.prependTo(this.$element.get(0)), EasyEditAssetManager.getCurrentAsset(function(a) {
    var b =
      a.getPrimaryLineage(),
      c = EasyEditUrl.getBaseSiteURL();
    "" === c && (c = EasyEditUrl.getURL(), c = c.protocol + "://" + c.host);
    for (var e = [], k = 0, l = b.length; k < l; k += 1) e.push(b[k].assetid);
    safe = !0;
    1 === a.attribute("is_dependant") && (safe = !1);
    d.addParent({
      type: a.attribute("type"),
      type_code: a.attribute("type_code"),
      assetid: a.id,
      name: a.attribute("name"),
      lineage: e,
      rootUrl: c,
      safe: safe
    }, !1)
  }));
  var e = "";
  EasyEditAssetManager.getCurrentAsset(function(a) {
    if (a.isFile() || a.attribute("is_dependant") === 1) e = "disabled"
  });
  this.$parentSelection =
    jQuery(EasyEdit.tmpl.render("wizard_parent_selection", {
      no_locations: EasyEditLocalise._("No locations are currently set"),
      description: EasyEditLocalise._("Select the locations to create this asset under"),
      select_parent_button: EasyEditLocalise._("Select New Location"),
      select_current_button: EasyEditLocalise._("Select Current Asset"),
      title: EasyEditLocalise._("Create locations"),
      disabled: e
    }));
  this.$parentSelection.appendTo(this.$element.get(0));
  this.$element.find(".ees_selectAsset").click(function(a) {
    a.preventDefault();
    var b = this.id === "ees_selectParents",
      a = d.attribute("defaultFinderParentId") === null ? EasyEditAssetManager._currentAssetId : d.attribute("defaultFinderParentId");
    EasyEditAssetFinder.init({
      focusAssetId: a,
      callback: function(a, c, e) {
        safe = true;
        b && (a.isFile() || a.attribute("is_dependant") === 1) ? safe = false : !b && a.attribute("is_dependant") === 1 && (safe = false);
        d.addParent({
          type: a.attribute("type"),
          type_code: a.attribute("type_code"),
          assetid: a.id,
          name: a.attribute("name"),
          lineage: c,
          rootUrl: e,
          safe: safe
        }, b)
      }
    })
  });
  this.$element.find(".ees_selectCurrentAsset").click(function(a) {
    a.preventDefault();
    var b = this.id === "ees_addCurrentParent",
      c = jQuery(this);
    EasyEditAssetManager.getCurrentAsset(function(a) {
      var e = true;
      b && (a.isFile() || a.attribute("is_dependant") === 1) ? e = false : !b && a.attribute("is_dependant") === 1 && (e = false);
      var f = a.getPrimaryLineage(),
        n = EasyEditUrl.getBaseSiteURL();
      if (n === "") {
        n = EasyEditUrl.getURL();
        n = n.protocol + "://" + n.host
      }
      for (var m = [], o = 0, r = f.length; o < r; o = o + 1) m.push(f[o].assetid);
      d.addParent({
        type: a.attribute("type"),
        type_code: a.attribute("type_code"),
        assetid: a.id,
        name: a.attribute("name"),
        lineage: m,
        rootUrl: n,
        safe: e
      }, b);
      c.css("visibility", "hidden").parent().find(".spacer").css("visibility", "hidden")
    })
  });
  this.events.observe("select_parent", function() {
    d.validator.getFailCount() >= 1 && d.valid()
  });
  this.$nameField = this.$element.find("#ees_newName");
  this.addValidationMethod(this.$nameField, this.$nameField, {
    required: {
      message: EasyEditLocalise._("A name is required.")
    }
  });
  this.addValidationMethod(this.$parentSelection.find("#ees_createLocations"), function() {
    var a = d.getParents();
    return a.length ?
      a : ""
  }, {
    required: {
      message: EasyEditLocalise._("You must select at least one location to create this under.")
    }
  }, "prepend");
  this.addValidationMethod(this.$parentSelection.find("#ees_createLocations"), this.$parentSelection.find("#ees_createLocations"), {
    test: {
      args: function() {
        for (var a = d.getParents(), b = 0; b < a.length; b++)
          if (a[b].safe === false) return false;
        return true
      },
      message: EasyEditLocalise._("You cannot choose files or 'dependant' assets as new create locations.")
    }
  }, "prepend");
  this.$sourceAssetSelection &&
    this.addValidationMethod(this.$sourceAssetSelection.find("#ees_sourceAssetLocation"), this.$sourceAssetSelection.find("#ees_sourceAssetLocation"), {
      test: {
        args: function() {
          for (var a = d.getParents(false, false), b = 0; b < a.length; b++)
            if (a[b].safe === false) return false;
          return true
        },
        message: EasyEditLocalise._("You cannot choose 'dependant' assets as an asset to clone.")
      }
    });
  this.slider = new EasyEditSlider({
    bindElem: this.$element.find(".showInMenu"),
    options: [
      [EasyEditLocalise._("Yes"), EasyEditLocalise._("Show this item in menus"),
        function() {}
      ],
      [EasyEditLocalise._("No"), EasyEditLocalise._("Hide this item in menus"), function() {}]
    ]
  })
};
EasyEditAssetWizard.prototype = {
  getCreatedAsset: function() {
    return this.createdAsset
  },
  addParent: function(a, b) {
    for (var c = a.type, d = a.type_code, e = a.assetid, f = a.name, g = a.lineage, j = a.rootUrl, h = a.safe, k = this, l = "undefined" === typeof b || b ? this.$parentSelection.find("ul") : this.$sourceAssetSelection.find("ul"), n = this.getParents(!0, b), m = !1, o = 0, r = n.length; o < r; o += 1)
      if (parseFloat(n[o].assetid) === parseFloat(e)) {
        m = n[o];
        break
      }
    if (!1 !== m) {
      if (!1 === m.selected) {
        jQuery(m.element).parent().addClass("selected").removeClass("notSelected");
        k.events.trigger("select_parent");
        return
      }
      return !1
    }
    l.find("li.noneSelected").addClass("screenHide");
    if (!0 === b) var p = EasyEditLocalise._("Disable this create location"),
      s = EasyEditLocalise._("Restore this create location");
    else p = "";
    c = jQuery(EasyEdit.tmpl.render("wizard_parent_item", {
      type_code: d,
      type: c,
      assetid: e,
      asset_name: f,
      lineage: g.join(","),
      rootUrl: j,
      toggleTitle: p,
      safe: h
    }));
    b ? c.find(".toggleSelection").click(function(a) {
      a.preventDefault();
      $(this).parent().toggleClass("selected").toggleClass("notSelected");
      k.events.trigger("select_parent");
      !0 === $(this).parent().hasClass("selected") ? $(this).attr("title", p) : $(this).attr("title", s)
    }) : c.find(".toggleSelection").remove();
    "clone" === this.createWizardType && !b ? (l.html(c), "undefined" !== typeof this.$nameField && (this.$nameField.val(f), jQuery(".wizardQueue li.selected .name").text(f))) : l.append(c);
    this.events.trigger("select_parent")
  },
  getParents: function(a, b) {
    var c = [],
      d = ".selected .assetId";
    !0 === a && (d = ".assetId");
    ("undefined" === typeof b || b ? this.$parentSelection :
      this.$sourceAssetSelection).find(d).each(function() {
      c.push({
        assetid: jQuery(this).text(),
        selected: jQuery(this).is(".selected"),
        element: this,
        safe: "unsafe" !== jQuery(this).parent().children(".safe").text()
      })
    });
    return c
  },
  getAssetToClone: function() {
    var a = "";
    this.$sourceAssetSelection && (a = this.$sourceAssetSelection.find(".assetId").text());
    return a
  },
  getFirstParentLineage: function() {
    return this.$parentSelection.find(".selected .lineage:first").text().split(",")
  },
  getFirstParentRootUrl: function() {
    return this.$parentSelection.find(".selected .rootUrl:first").text()
  },
  addValidationMethod: function(a, b, c, d) {
    var e = "after";
    "undefined" !== typeof d && (e = d);
    errorView = new EasyEditValidationErrorInline({
      element: a,
      tag: "p",
      position: e
    });
    this._vMethods.push({
      index: this.validator.addTest(b, c, errorView),
      elem: a
    })
  },
  removeValidationMethod: function(a) {
    for (var b = 0, c = this._vMethods.length; b < c; b += 1) this._vMethods[b].elem.get(0) === a.get(0) && this.validator.removeTestByIndex(this._vMethods[b].index)
  },
  valid: function() {
    var a = this.validator.valid();
    this.events.trigger("validate", a);
    a ? EasyEditEventManager.trigger("CreationWizardValidationSuccess") :
      EasyEditEventManager.trigger("CreationWizardValidationFailed");
    return a
  },
  create: function(a, b) {
    var c = this,
      d = function(a, b, d) {
        null !== a.id && c.events.trigger("create_complete", {
          asset: a,
          lineage: b,
          url: d
        })
      },
      e = function(a, b) {
        b || (b = EasyEditLocalise._("Asset creation failed"));
        c.events.trigger("create_fail", b)
      };
    "function" === typeof a && (d = a);
    "function" === typeof b && (e = b);
    if (this.valid()) {
      this.gatherCreateData();
      this.events.trigger("create");
      var f = this.getParents(),
        f = f.map(function(a) {
          return a.assetid
        }),
        g = f.shift(),
        j = function(a) {
          var b = c.getFirstParentLineage(),
            e = c.getFirstParentRootUrl();
          b.push(a.id);
          1 <= f.length ? a.link(f, function() {
            d.apply(c, [a, b, e])
          }) : d.apply(c, [a, b, e])
        },
        h = function(a, b) {
          if (b.hasOwnProperty("error")) return e.apply(c, [a, EasyEdit.getError(b)]), !1;
          if (null === a.id) return e.apply(c, [a]), !1;
          EasyEditAssetManager.getAsset(a.id, function(a) {
            c.createdAsset = a;
            var b = c.createData.extra_attributes;
            if (b.length) {
              for (var d = 0, e = b.length; d < e; d += 1) a.attribute(b[d].key, b[d].val);
              a.save(function() {
                j(a)
              })
            } else j(a)
          })
        };
      if ("create" === this.createWizardType) {
        var k = new EasyEditAsset(null);
        k.attribute("name", this.createData.asset_name);
        k.attribute("short_name", this.createData.asset_name);
        k.attribute("type_code", this.attribute("type_code"));
        k.attribute("link_type", this.createData.link_type);
        k.resetChangedAttributes();
        for (var l = c.createData.attributes, n = 0, m = l.length; n < m; n += 1) k.attribute(l[n].key, l[n].val);
        k.create(g, function(a) {
          h(k, a)
        })
      } else EasyEditAssetManager.getAsset(this.createData.source_assetid, function(a) {
        a.clone(g,
          c.createData.link_type, c.createData.asset_name,
          function(a) {
            var b = new EasyEditAsset(a.id);
            h(b, a)
          })
      })
    }
  },
  attribute: function(a, b) {
    var c = "undefined" !== typeof b ? b : null;
    this.events.trigger("attribute", {
      name: a,
      value: c
    });
    if (null !== c) this.attributes[a] = c;
    else if (this.attributes.hasOwnProperty(a)) return this.attributes[a];
    return null
  },
  hide: function() {
    this.$element.hide();
    this.events.trigger("hide")
  },
  show: function() {
    this.$element.show();
    this.events.trigger("show")
  },
  reset: function() {
    this.$nameField.val("");
    this.$parentSelection.find("li.selected,li.notSelected").remove();
    this.$parentSelection.find("li.noneSelected").removeClass("screenHide");
    this.$parentSelection.find("#ees_addCurrentParent").css("visibility", "visible").parent().find(".spacer").css("visibility", "visible");
    this.createData = this.defaultCreateData;
    this.validator.hideAllErrors();
    this.slider.setSelected(EasyEditLocalise._("Yes"))
  },
  gatherCreateData: function() {
    this.createData.asset_name = this.$nameField.val();
    this.createData.link_type = this.slider.getSelected() === EasyEditLocalise._("Yes") ? 1 : 2;
    "clone" === this.createWizardType &&
      (this.createData.source_assetid = this.getAssetToClone())
  }
};
var EasyEditComponents = {
  containerId: "ees_eesUi",
  mainWrapperId: "ees_editMode",
  toolBarId: "ees_toolBar",
  contentWrapperId: "ees_mainContent",
  initialModeFn: "buildEditInterface",
  editInterfaceInit: !1,
  previewURL: "",
  initStack: [],
  init: function(a, b) {
    function c() {
      EasyEditOverlay.showOverlay("loading");
      EasyEditComponents.buildPreview(function() {
        EasyEditOverlay.hideOverlay("loading")
      })
    }
    var d = this,
      e = new EasyEditAPI,
      f = jQuery("body");
    f.append(this.getTemplate());
    d.initialModeFn = "buildEditInterface";
    EasyEditConfig.hasOwnProperty("defaultMode") &&
      (EasyEditConfig.defaultMode = EasyEditConfig.defaultMode.toLowerCase(), "preview" === EasyEditConfig.defaultMode && (d.initialModeFn = "buildPreview"));
    var g = EasyEdit.getURL();
    "string" === typeof g.params.mode && "embedded" === g.params.mode || "string" === typeof g.params.asset_ei_screen && "preview" !== g.params.asset_ei_screen || "string" === typeof g.params.screen && "" !== g.params.screen ? d.initialModeFn = "buildEditInterface" : "string" === typeof g.params.asset_ei_screen && "preview" === g.params.asset_ei_screen && (d.initialModeFn =
      "buildPreview");
    EasyEditUrl.hash.isset("mode") && "preview" === EasyEditUrl.hash.get("mode").toLowerCase() && (d.initialModeFn = "buildPreview");
    EasyEditUrl.hash.isset("mode") && "edit" === EasyEditUrl.hash.get("mode").toLowerCase() && (d.initialModeFn = "buildEditInterface");
    "buildPreview" === d.initialModeFn ? f.addClass("previewMode") : f.addClass("editMode");
    var j = parseFloat(EasyEditUrl.hash.isset("show_diff") ? EasyEditUrl.hash.get("show_diff") : 0),
      h = parseFloat(EasyEditUrl.hash.isset("cache") ? EasyEditUrl.hash.get("cache") :
        0);
    EasyEditEventManager.bind("EasyEditUrlChange", function() {
      if (EasyEditUrl.hash.isset("show_diff") && jQuery("#ees_modePreview").parent().hasClass("current")) {
        var a = parseFloat(EasyEditUrl.hash.get("show_diff"));
        if (a === j) {
          j = a;
          c()
        }
      }
      if (EasyEditUrl.hash.isset("cache") && jQuery("#ees_modePreview").parent().hasClass("current")) {
        a = parseFloat(EasyEditUrl.hash.get("show_diff"));
        if (a === h) {
          h = a;
          c()
        }
      }
    });
    f = [];
    f.push(function(a) {
      EasyEditAssetManager.getCurrentAsset(function(b) {
        a(b)
      })
    });
    f.push(function(a, b) {
      if (b.attribute("type_code") ===
        "site") {
        e.queue("getKeywordsReplacements", {
          asset_id: b.id,
          keywords_array: ["%asset_index_id%"],
          null_if_empty: true
        });
        e.run(function() {
          var c = e.getResult(0, "asset_index_id");
          c !== null ? EasyEditAssetManager.getAsset(c * 1, function(a) {
            EasyEdit.redirect({
              asset: a
            })
          }, e.runMode.BATCH) : a(b)
        }, e.runMode.SYNC)
      } else a(b)
    });
    f.push(function(a) {
      EasyEditComponentsToolbar.init(a)
    });
    f.push(function(a) {
      EasyEditComponentsInfoBox.init(a)
    });
    EasyEditConfig.hasOwnProperty("contextsEnabled") && EasyEditConfig.contextsEnabled && f.push(function(a,
      b) {
      EasyEdit.context = new EasyEditContextSwitcher(function() {
        a(b)
      })
    });
    f.push(function(a, b) {
      EasyEditComponentsToolbar.attachEvents();
      a(b)
    });
    f = f.concat(d.initStack, [function(a, c) {
      d[d.initialModeFn].call(d, function() {
        b.call(d);
        a(c)
      })
    }]);
    EasyEdit.util.async.series(f)
  },
  buildEditInterface: function(a) {
    var b = this;
    jQuery("body").removeClass("modePreviewFile");
    jQuery("body").removeClass("modeResizedPreviewFrame");
    var c = a,
      a = function() {
        EasyEditEventManager.trigger("EasyEditModeLoaded", "edit");
        jQuery.isFunction(c) &&
          c.call(b)
      };
    if (this.editInterfaceInit) return a.call(this), !1;
    EasyEditScreens.init(function() {
      EasyEditComponents.editInterfaceInit = !0;
      "buildPreview" !== b.initialModeFn && EasyEditComponentsToolbar.showEditMode();
      a.call(this)
    })
  },
  getTemplate: function() {
    return '<div id="' + this.containerId + '"><div id="' + this.toolBarId + '"></div><div id="' + this.mainWrapperId + '"><div id="' + this.contentWrapperId + '"></div></div></div>'
  },
  buildPreview: function(a) {
    var b = this,
      c = new EasyEditAPI,
      d = EasyEdit.getURL();
    b.previewURL = d.url;
    var e = a,
      a = function() {
        EasyEditEventManager.trigger("EasyEditModeLoaded", "preview");
        jQuery.isFunction(e) && e.call(b)
      };
    "string" === typeof d.params.mode && "embedded" === d.params.mode ? a.call(this) : (jQuery("#ees_modePreviewFrame,#ees_modePreviewFile").remove(), EasyEditAssetManager.getCurrentAsset(function(e) {
      if (EasyEditWorkspaceManager.isWorkspace(e)) {
        var g = EasyEditWorkspaceManager.getWorkspaceFromRootNode(e.id);
        "string" === typeof g.preview ? b.previewURL = g.preview : null === d && (b.previewURL = e.attribute("web_path"))
      }
      var j =
        e.attribute("type_code"),
        h = "",
        g = jQuery("body");
      if (e.isFile()) "image" === j || "thumbnail" === j ? (h += '<div id="ees_modePreviewFile"><div id="ees_previewImageContainer" style="width:' + (1 * e.attribute("width") + 2) + 'px"><p id="ees_previewImageIntro"><strong></strong> <br/>' + EasyEditScreens.assetTypes.defaultAsset.readablizeBytes(e.attribute("size")) + '</p><p id="ees_previewImage"><img src="' + e.attribute("web_path") + "?bustCache=" + parseInt(99999999 * Math.random(), 10) + '" alt="" /></p></div></div>', g.addClass("modePreviewFile").append(h),
        g.find("#ees_previewImageIntro > strong").text(e.attribute("name")), g.find("#ees_previewImage > img").attr("alt", e.attribute("alt"))) : (h += '<div id="ees_modePreviewFile"><div id="ees_previewFileContainer"><div class="fileWrapper"><div class="preview_icon ' + j + '"><p><span class="name"></span><span class="type"></span><span class="size"></span><a href="' + e.attribute("web_path") + "?bustCache=" + parseInt(99999999 * Math.random(), 10) + '" target="_blank" class="downloadFile hidden guiButton default alignLeft">' +
        EasyEditLocalise._("Download file") + "</a></p></div></div></div></div>", g.addClass("modePreviewFile").append(h), g.find(".name").text(e.attribute("name")), g.find(".type").text(e.attribute("type"))), c.queue("getKeywordsReplacements", {
        asset_id: e.attribute("id"),
        keywords_array: ["%asset_file_size_in_bytes%"],
        null_if_empty: !0
      }).run(function() {
        var a = c.getResult(0, "asset_file_size_in_bytes");
        if (a === null) a = EasyEditLocalise._("File information not available");
        else {
          a = EasyEditScreens.assetTypes.defaultAsset.readablizeBytes(a);
          jQuery("#ees_modePreviewFile .downloadFile").removeClass("hidden")
        }
        jQuery("#ees_modePreviewFile .size").text(a)
      }, c.runMode.SYNC), a.call(this);
      else if ("page_redirect" === j) h = '<div id="ees_modePreviewFile"><div id="ees_previewFileContainer"><div class="fileWrapper"><div class="preview_icon ' + j + '"><p><span class="name"></span><span class="type">' + EasyEditLocalise._("Redirect Page") + '</span><a href="' + e.attribute("web_path") + '" target="_blank" class="guiButton default alignLeft"><span>' + EasyEditLocalise._("View redirect url") +
        "</span><span></span></a></p></div></div></div></div>", g.addClass("modePreviewFile").append(h), g.find(".name").text(e.attribute("name")), a.call(this);
      else {
        var k = "auto",
          j = EasyEdit.systemInfo.preferences.user.SQ_USER_PREVIEW_SCREEN_SIZES.options;
        if (0 < j.length) {
          var k = sessionStorage.getItem("preview_screen_size"),
            l = "auto" == k;
          if (!l && k && "undefined" != k)
            for (h = 0; h < j.length; h++)
              if (k == j[h].width + "px," + j[h].height + "px") {
                l = !0;
                break
              }
          if (!l) {
            k = "auto";
            l = EasyEdit.systemInfo.preferences.user.SQ_USER_PREVIEW_SCREEN_SIZES.selected;
            for (h = 0; h < j.length; h++)
              if (l == h) {
                k = j[h].width + "px," + j[h].height + "px";
                break
              }
            sessionStorage.setItem("preview_screen_size", k)
          }
        }
        var n = jQuery("#ees_PreviewFrameContainer");
        n.length ? n.append('<iframe src="" id="ees_modePreviewFrame" name="ees_modePreviewFrame" frameborder="0">') : (g.removeClass("modePreviewFile").append('<div id="ees_PreviewFrameContainer"><iframe src="" id="ees_modePreviewFrame" name="ees_modePreviewFrame" frameborder="0"></iframe></div>'), n = jQuery("#ees_PreviewFrameContainer"));
        "auto" !=
        k && g.addClass("modeResizedPreviewFrame");
        var m = !1;
        jQuery("#ees_PreviewFrameContainer").resizable({
          start: function() {
            jQuery("iframe").css("pointer-events", "none");
            jQuery("#ees_modePreviewFrame").contents().find("html").css("overflow", "auto");
            m = true;
            EasyEditComponentsToolbar.deselectPreviewScreenSizeOption()
          },
          stop: function() {
            jQuery("#ees_modePreviewFrame").css("pointer-events", "auto");
            m = false
          },
          resize: function(a, b) {
            EasyEditComponentsToolbar.printCustomScreenSizeText(b.size.width, b.size.height)
          }
        });
        jQuery("#ees_PreviewFrameContainer .ui-resizable-e .ui-icon").length ||
          (jQuery("#ees_PreviewFrameContainer .ui-resizable-e").append('<div class="ui-icon ui-resizable-e-icon"></div>'), jQuery("#ees_PreviewFrameContainer .ui-resizable-s").append('<div class="ui-icon ui-resizable-s-icon"></div>'));
        jQuery("#ees_PreviewFrameContainer .ui-icon").hide();
        jQuery("#ees_PreviewFrameContainer").parent().hover(function() {
          jQuery("#ees_PreviewFrameContainer .ui-icon").fadeIn(100)
        }, function() {
          m || jQuery("#ees_PreviewFrameContainer .ui-icon").fadeOut(300)
        });
        var o = jQuery("#ees_modePreviewFrame");
        o.hide();
        var g = EasyEditConfig.hasOwnProperty("showDifferencesInPreviewMode") ? EasyEditConfig.showDifferencesInPreviewMode : !1,
          g = EasyEditUrl.hash.isset("show_diff") && 1 === 1 * EasyEditUrl.hash.get("show_diff") ? !0 : g,
          j = (g = EasyEditUrl.hash.isset("show_diff") && 0 === 1 * EasyEditUrl.hash.get("show_diff") ? !1 : g) ? "?SQ_ACTION=diff" : "",
          h = EasyEditUrl.hash.isset("cache") && "1" === EasyEditUrl.hash.get("cache") ? "" : "/" + EasyEdit.systemInfo.suffixes.nocache,
          l = EasyEditUrl.getURL().params,
          r = [],
          p;
        for (p in l) "SQ_ACTION" !== p && r.push(p +
          "=" + l[p]);
        o.attr("src", b.previewURL + h + j + (g ? "&" : "?") + r.join("&"));
        o.load(function() {
          $iFrameBody = o.contents().find("body");
          $iFrameBody.on("click", "a", function(a) {
            if (a.button === 0) {
              var c = a.target.getAttribute("href");
              c === null && (c = "");
              if (c.substr(0, 1) === "#") {
                a.preventDefault();
                a = $iFrameBody.find(c);
                a.length > 0 && b.scrollIntoView(a[0])
              }
            }
          });
          o.show();
          if (!EasyEditComponentsToolbar.customPreviewScreenSize())
            if (k == "auto") {
              jQuery("div", $iFrameBody).length > 0 ? n.height($iFrameBody.height() + 40 + "px") : n.height(jQuery(window).height() +
                "px");
              var c = o.contents().height() + "px";
              n.css("height", c);
              o.contents().find("html").css("overflow", "hidden")
            } else {
              var d = k.split(","),
                c = d[0],
                d = d[1];
              n.width(c + "px");
              n.height(d + "px");
              n.css("width", c);
              n.css("height", d)
            }
          EasyEditUrl.getSiteUrlForAsset(e, function(a) {
            jQuery('a[href^="#"]', $iFrameBody).click(function(a) {
              if (a.button === 0) {
                var b = a.target.getAttribute("href"),
                  b = jQuery(b, $iFrameBody);
                b.length > 0 && b[0].scrollIntoView();
                a.preventDefault()
              }
            });
            jQuery('a:not([href^="#"])', $iFrameBody).click(function(c) {
              var d =
                EasyEdit.getURL(),
                k = jQuery(this),
                g = k.attr("href");
              new EasyEditAPI;
              var l = EasyEdit.getURLFromString(g),
                h = false;
              if (l.host === d.host || l.relative === true) h = true;
              if (l.full.indexOf("mailto:") !== -1) return true;
              k.attr("onclick") !== void 0 && k.attr("onclick", "");
              if (jQuery(this).attr("target") !== "_blank")
                if (!h || l.simple_edit_url === true || l.admin_url === true || l.shadow_assetid === true) {
                  c.preventDefault();
                  c = g.replace(/^(https?|ftp):\/\//, "");
                  c.indexOf("/") !== -1 ? /^.*\.[^\\]+$/.test(c.substring(c.lastIndexOf("/") + 1)) ? window.open(g,
                    "_blank") : top.location.href = k.attr("href") : top.location.href = k.attr("href")
                } else if (c.button === 0) {
                b._rewritePreviewLink(jQuery(this), e, a);
                c.preventDefault()
              }
            })
          });
          a.call(this)
        })
      }
    }))
  },
  _rewritePreviewLink: function(a, b, c) {
    var d = EasyEdit.getURL(),
      b = a.attr("href");
    if ("undefined" === typeof b || "" === b || "#" === b) return !1;
    var e = EasyEdit.getURLFromString(b);
    if (-1 !== e.full.indexOf("mailto:")) return !0;
    void 0 !== a.attr("onclick") && a.attr("onclick", "");
    EasyEditAssetManager.getCurrentAsset(function(a) {
      EasyEditOverlay.showOverlay("loading", {
        message: EasyEditLocalise._("Redirecting") + "..."
      });
      a.releaseLock("all", function() {
        var a = e.url + "/" + EasyEdit.systemInfo.suffixes.edit;
        null !== e.assetid ? (a = c + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + e.assetid, null !== e.query && (a += e.query)) : null !== e.query && (a += "?" + e.query);
        if (EasyEditUrl.getURLFromString(a).url !== d.url) top.location.href = a + "#mode=preview";
        else {
          a = e.url + "/" + EasyEdit.systemInfo.suffixes.nocache;
          null !== e.query && (a += "?" + e.query);
          var b = jQuery("#ees_modePreviewFrame");
          b.attr("src",
            a);
          b.load(function() {
            EasyEditOverlay.hideOverlay("loading")
          })
        }
      })
    });
    return !0
  },
  openAssetFinder: function(a, b) {
    var c = new EasyEditAPI,
      d = {
        initFromToolbar: !0,
        sourceKey: this.containerId,
        callback: function(a, b, d) {
          EasyEditOverlay.showOverlay("loading");
          var j = "details";
          EasyEditConfig.hasOwnProperty("defaultScreen") && (j = EasyEditConfig.defaultScreen);
          var h = {
            asset: a,
            url: d,
            screen: j,
            lineage: b
          };
          "site" === a.attribute("type_code") ? (c.queue("getKeywordsReplacements", {
              asset_id: a.id,
              keywords_array: ["%asset_index_id%"],
              null_if_empty: !0
            }),
            c.run(function() {
              var a = c.getResult(0, "asset_index_id");
              a !== null ? EasyEditAssetManager.getAsset(a * 1, function(a) {
                h.asset = a;
                delete h.url;
                delete h.lineage;
                EasyEdit.redirect(h)
              }, c.runMode.BATCH) : EasyEdit.redirect(h)
            }, c.runMode.SYNC)) : EasyEdit.redirect(h)
        },
        beforeSelectionCallback: function(a) {
          EasyEditComponentsToolbar.isUnsaved() ? EasyEditOverlay.showOverlay("confirm", {
            message: '<p class="confirmMessage">' + EasyEditLocalise._("You have unsaved changes, please choose how to proceed.") + "</p>",
            cancelText: EasyEditLocalise._("Return to Asset Finder"),
            confirmText: EasyEditLocalise._("Discard Changes"),
            title: EasyEditLocalise._("Unsaved Changes"),
            cssClass: "unsavedChanges",
            confirmFn: function() {
              EasyEditOverlay.hideOverlay("confirm");
              a.call(this)
            },
            cancelFn: function() {
              EasyEditOverlay.hideOverlay("confirm")
            }
          }) : a.call(this)
        }
      };
    a && (d.focusAssetId = a.id);
    EasyEditAssetFinder.init(d);
    b instanceof Function && EasyEditAssetFinder.events.observe("cancel", function f() {
      EasyEditAssetFinder.events.events.cancel.detach(f);
      b()
    })
  },
  scrollIntoView: function(a) {
    var b = jQuery(a).offset().top -
      60,
      c = a.ownerDocument.defaultView;
    c || (c = a.ownerDocument.parentWindow);
    c.scrollTo(0, b)
  }
};
EasyEditOverlay.overlays.error = {
  id: "ees_errorOverlay",
  mainOverlayState: null,
  show: function(a, b) {
    var c = this.getContainer(),
      d = jQuery.extend({
        message: ""
      }, a, !0);
    c.html(this._getTemplate(d.message)).show();
    "function" === typeof a.continueFn && jQuery("#ees_overlayContinue").click(function(b) {
      b.preventDefault();
      a.continueFn.call(this)
    });
    "function" === typeof a.onLoad && a.onLoad.call(this);
    var c = jQuery("#ees_error"),
      d = c.height(),
      e = c.width();
    c.draggable({
      handle: ".ees_BubbleTitle",
      containment: "document"
    });
    c.css("left",
      jQuery(window).width() / 2 - e / 2 + "px");
    c.css("top", jQuery(window).height() / 2 - d / 2 + "px");
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide()
  },
  _getTemplate: function(a) {
    return '<div class="ees_Bubble" id="ees_error"><div class="ees_BubbleTitle">' + EasyEditLocalise._("Error") + '</div><div class="ees_BubbleContent">' + a + '<div class="confirmation section"><a href="#" id="ees_overlayContinue" class="alignRight guiButton light errorContinue">' +
      EasyEditLocalise._("Close") + "</a></div></div></div>"
  }
};
BodycopyDiv = function(a) {
  this.id = a;
  this.attr = {}
};
BodycopyDiv.prototype.attribute = function(a, b) {
  if ("undefined" !== typeof b) this.attr[a] = b;
  else if (this.attr.hasOwnProperty(a)) return this.attr[a]
};
(function(a, b) {
  var c = function(a) {
    this.total = this.completed = 0;
    a !== b && EasyEdit.util.isArray(a) && (a = a.concat(["progress-bar"]));
    this.$bar = jQuery(EasyEdit.tmpl.render("simple_tag", {
      tag: "div",
      "class": a.join(" "),
      content: EasyEdit.tmpl.render("simple_tag", {
        tag: "span",
        "class": "progress-bar-inner"
      })
    }))
  };
  (function(a) {
    a.setTotal = function(a) {
      this.total = a
    };
    a.update = function(a) {
      this.completed += a;
      this.completed >= this.total && (this.completed = this.total);
      this.setBar()
    };
    a.reset = function() {
      this.total = this.completed =
        0;
      this.setBar(0)
    };
    a.getPercentComplete = function() {
      return Math.floor(100 * (this.completed / this.total))
    };
    a.setBar = function(a) {
      a = a === b ? this.getPercentComplete() : a;
      jQuery(">span", this.$bar).css("width", a + "%")
    };
    a.show = function() {
      this.$bar.show()
    };
    a.hide = function() {
      this.$bar.hide()
    }
  })(c.prototype);
  a.EasyEditProgressBar = c
})("undefined" !== typeof window ? window : this);
EasyEditOverlay.overlays.defaultOverlay = {
  id: "ees_mainOverlay",
  show: function(a, b) {
    var c = this.getContainer();
    jQuery.extend({
      message: ""
    }, a, !0);
    c.html(this._getTemplate()).show();
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide()
  },
  _getTemplate: function() {
    return '<div id="ees_overlayImage" class="default"></div><div id="ees_overlayMessage"><span></span></div>'
  }
};
EasyEditOverlay.overlays.loading = {
  id: "ees_loadingOverlay",
  timer: null,
  show: function(a, b) {
    var c = this.getContainer(),
      d = jQuery.extend({
        message: "",
        transparent: !0
      }, a, !0);
    d.transparent || jQuery("body").addClass("loadingOverlayActive");
    c.html(this._getTemplate(d.message)).show();
    (function(a) {
      a.timer = setTimeout(function() {
          c.is(":visible") && EasyEditOverlay.showOverlay("greyOut", {
            heading: EasyEditLocalise._("Warning"),
            message: EasyEditLocalise._("It appears the last GET or POST request to the server from EES may have timed out. This is usually caused by network communication issues. If you continue to see this message please contact your support desk to investigate.")
          })
        },
        1E3 * EasyEditConfig.overlayTimeout)
    })(this);
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    var a = jQuery("#" + this.id);
    clearTimeout(this.timer);
    this.timer = null;
    jQuery("body").removeClass("loadingOverlayActive");
    a.hide()
  },
  _getTemplate: function(a) {
    var b = EasyEditUrl.getBaseSiteURL();
    b ? -1 === b.indexOf("://") && (b = "//" + b) : b = "";
    return '<div id="ees_overlayImage" class="loading"><img src="' +
      b + '/__data/ees/Images/loader-matrix.gif" alt="' + EasyEditLocalise._("Loading") + '" height="80" width="80" /></div><div id="ees_overlayMessage"><span>' + a + "</span></div>"
  }
};
var EasyEditSearchButton = function(a) {
  var b = this;
  this.events = new ObservableEvents(this);
  this.results = {
    full: [],
    filtered: []
  };
  this.offset = 0;
  this.pageSize = 5;
  this.prevSearchText = null;
  var c = EasyEdit.tmpl.render("asset_search_filters", {
      filter_name: EasyEditLocalise._("Filters"),
      file: {
        title: EasyEditLocalise._("Files (Any)"),
        status: "off"
      },
      page: {
        title: EasyEditLocalise._("Standard Pages"),
        status: "off"
      },
      image: {
        title: EasyEditLocalise._("Images"),
        status: "off"
      },
      folder: {
        title: EasyEditLocalise._("Folders"),
        status: "off"
      },
      news: {
        title: EasyEditLocalise._("News Items"),
        status: "off"
      },
      event: {
        title: EasyEditLocalise._("Events (Any)"),
        status: "off"
      }
    }),
    d = EasyEdit.tmpl.render("asset_search_pager", {
      pager_text: "",
      prev: {
        title: EasyEditLocalise._("Previous Page"),
        disabled: "disabled"
      },
      next: {
        title: EasyEditLocalise._("Next Page"),
        disabled: "disabled"
      }
    }),
    e = EasyEdit.tmpl.render("asset_search_results", {
      open_finder_text: EasyEditLocalise._("Locate in Asset Finder"),
      assets: []
    }),
    f = EasyEdit.tmpl.render("asset_search_failed", {}),
    g = EasyEdit.tmpl.render("default_button", {
      "class": "alignRight",
      href: "#",
      title: EasyEditLocalise._("Search"),
      content: EasyEditLocalise._("Search"),
      attr: {
        id: "ees_assetSearch_searchbox_button"
      }
    });
  b.$searchbox = jQuery(EasyEdit.tmpl.render("asset_search_searchbox", {
    search_string: {
      id: "ees_assetSearch_searchbox_query",
      value: "",
      placeholder: EasyEditLocalise._("Search for assets...")
    },
    search_button: g,
    filters: c,
    results: e,
    pager: d,
    failed: f
  }));
  jQuery("#ees_toolBar").append(b.$searchbox);
  b.$searchbox.find(".asset-finder-filters").show();
  b.$searchbox.find(".asset-search-results-wrapper").hide();
  b.$searchbox.find(".asset-search-pagination").hide();
  b.$searchbox.find(".asset-search-failed").hide();
  jQuery("#ees_assetSearch_searchbox_button").addClass("disabled");
  var j = function(a, c) {
    jQuery("#ees_toolBar .asset-search-box").removeClass("searching");
    jQuery("#ees_assetSearch_searchbox_button").removeClass("disabled");
    b.results.full = c;
    b.results.filtered = b.filterResults(c);
    b.offset = 0;
    if (0 === b.results.filtered.length) b.$searchbox.find(".asset-search-summary").html(EasyEditLocalise._("No results found")),
      b.$searchbox.find(".asset-search-results-wrapper").hide(), b.$searchbox.find(".asset-search-pagination").hide(), b.$searchbox.find(".asset-search-failed .search-text").text(a), b.$searchbox.find(".asset-search-failed").show();
    else {
      var d = EasyEdit.tmpl.render("asset_search_results", {
          open_finder_text: EasyEditLocalise._("Locate in Asset Finder"),
          assets: b.results.filtered.slice(0, b.pageSize)
        }),
        e = EasyEditLocalise._n("<strong>%1</strong> result found", "<strong>%1</strong> results found", b.results.filtered.length,
          b.results.filtered.length);
      b.$searchbox.find(".asset-search-summary").html(e);
      b.$searchbox.find(".asset-search-failed").hide();
      b.$searchbox.find(".asset-search-results").replaceWith(jQuery(d));
      b.$searchbox.find(".asset-search-results-wrapper").show();
      b.results.filtered.length > b.pageSize ? (d = EasyEdit.tmpl.render("asset_search_pager", {
          page_number: 1,
          page_total: Math.ceil(b.results.filtered.length / b.pageSize),
          prev: {
            title: EasyEditLocalise._("Previous Page"),
            disable: "disabled"
          },
          next: {
            title: EasyEditLocalise._("Next Page"),
            disable: ""
          }
        }), b.$searchbox.find(".asset-search-pagination").replaceWith(jQuery(d)), b.$searchbox.find(".asset-search-pagination .pagination-next").click(function(a) {
          a.preventDefault();
          !1 === jQuery(this).hasClass("disabled") && b.offset + b.pageSize < b.results.filtered.length && b.nextPage()
        }), b.$searchbox.find(".asset-search-pagination .pagination-previous").click(function(a) {
          a.preventDefault();
          !1 === jQuery(this).hasClass("disabled") && 0 < b.offset && b.previousPage()
        }), b.$searchbox.find(".asset-search-results-wrapper").removeClass("single-page"),
        b.$searchbox.find(".asset-search-pagination").show()) : (b.$searchbox.find(".asset-search-pagination").hide(), b.$searchbox.find(".asset-search-results-wrapper").addClass("single-page"))
    }
    b.attachResultEvents()
  };
  jQuery(document).click(function(a) {
    var c = jQuery(a.target).parents(".asset-search-container, #ees_plusSearchButton"),
      c = jQuery(".asset-search-container, #ees_plusSearchButton, #ees_confirmOverlay").add(c),
      d = !0;
    if (0 < c.length)
      for (var e = 0; e < c.length; e++)
        if (c[e] === a.target) {
          d = !1;
          break
        } else if (jQuery(c[e]).find(a.target).length) {
      d = !1;
      break
    }!0 === d && b.hide()
  });
  jQuery("#ees_assetSearch_searchbox_button").click(function(a) {
    a.preventDefault();
    if (!1 === jQuery(a.target).hasClass("disabled")) {
      b.$searchbox.find(".asset-search-results-wrapper").hide();
      b.$searchbox.find(".asset-search-pagination").hide();
      b.$searchbox.find(".asset-search-failed").hide();
      b.$searchbox.find(".asset-search-summary").html("");
      var a = jQuery("#ees_toolBar .asset-search-box"),
        c = a.val();
      "" !== c && (a.addClass("searching"), jQuery("#ees_assetSearch_searchbox_button").addClass("disabled"),
        b.prevSearchText = c, b.search(c, j))
    }
  });
  jQuery("#ees_toolBar .asset-search-box").keydown(function(a) {
    13 === a.which ? (a.preventDefault(), jQuery("#ees_assetSearch_searchbox_button").click()) : setTimeout(function() {
      0 === jQuery(a.target).val().length ? jQuery("#ees_assetSearch_searchbox_button").addClass("disabled") : jQuery("#ees_assetSearch_searchbox_button").removeClass("disabled")
    }, 50)
  });
  jQuery("#ees_toolBar .asset-finder-filters > .filter-btn").click(function(a) {
    a.preventDefault();
    jQuery(a.target).toggleClass("filter-off filter-active");
    b.prevSearchText && j(b.prevSearchText, b.results.full)
  });
  jQuery.isFunction(a) && a.call(b)
};
EasyEditSearchButton.prototype = {
  search: function(a, b) {
    var c = this,
      d = EasyEditUrl.getURL(),
      e = EasyEditUrl.buildEditURL(d.url) + "?SQ_BACKEND_PAGE=header",
      f = function(d) {
        var e = [],
          d = /(<table[^>]+id=\\"popup-search-results\\">(.*)<\/table>)';\n/.exec(d);
        if (null !== d) {
          for (var d = jQuery(d[1].replace(/\\"/g, '"').replace(/\\'/g, "'")).find(".sq-search-results-entry"), f = [], k = new EasyEditAPI, l = 0; l < d.length; l++) {
            var n = jQuery(d[l]).find(".sq-info-assetid").text(),
              m = jQuery(d[l]).find(".sq-info-asset-name").text(),
              o = jQuery(d[l]).find(".sq-info-type-name").text(),
              r = jQuery(d[l]).find(".sq-info-type-name").attr("data-type-code");
            if (-1 === jQuery.inArray(n, f)) {
              var p = "none";
              switch (r) {
                case "folder":
                  p = "folder";
                  break;
                case "image":
                case "image_variety":
                case "thumbnail":
                  p = "image generic";
                  break;
                case "page_standard":
                  p = "page";
                  break;
                case "news_item":
                  p = "news";
                  break;
                case "calendar_event_single":
                case "calendar_event_recurring":
                  p = "event";
                  break;
                case "file":
                case "css_file":
                case "js_file":
                case "rtf_file":
                case "text_file":
                case "flv_file":
                case "video_file":
                case "word_doc":
                case "pdf_file":
                case "mp3_file":
                case "excel_doc":
                case "powerpoint_doc":
                  p =
                    "generic";
                  break;
                case "page_redirect":
                case "link":
                case "data_record":
                  p = "none";
                  break;
                default:
                  p = null
              }
              e.push({
                type: {
                  name: o,
                  code: r,
                  "class": p
                },
                id: n,
                name: m,
                lineage: "",
                asset_url: ""
              });
              f.push(n);
              k.queue("getKeywordsReplacements", {
                asset_id: n,
                keywords_array: ["%asset_url%"]
              });
              k.queue("getLineageFromUrl", {
                asset_url: "%results_" + 2 * l + "_asset\\_url%"
              })
            }
          }
          k.run(function(d) {
            for (var k = 0, g = 1; k < e.length; k++, g += 2)
              if (f.shift(), e[k].lineage = [], e[k].asset_url = [], d[g].data.error) e.splice(k, 1), k--;
              else {
                for (var l = 0; l < d[g].data.length -
                  1; l++) e[k].lineage.push(d[g].data[l].name), l === d[g].data.length - 2 && e[k].asset_url.push(EasyEditUrl.buildEditURL(location.protocol + "//" + d[g].data[l + 1].url));
                e[k].lineage = e[k].lineage.join(" > ")
              }
            b.call(c, a, e)
          }, k.runMode.BATCH)
        } else b.call(c, a, e)
      };
    EasyEdit.getToken(function(b) {
      EasyEditAssetManager.getCurrentAsset(function(c) {
        var c = c.getPrimarySite(),
          d = [c.assetid];
        if (EasyEditConfig.assetFinderLocations)
          for (var k = 0; k < EasyEditConfig.assetFinderLocations.length; k++) EasyEditConfig.assetFinderLocations[k] !==
            c.assetid && d.push(EasyEditConfig.assetFinderLocations[k]);
        c = {
          token: b,
          process_form: 1,
          asset_search: a,
          asset_search_root: d.join(","),
          asset_search_redirect: 0
        };
        d = [];
        for (k in c) d.push(encodeURIComponent(k) + "=" + encodeURIComponent(c[k]));
        k = d.join("&");
        jQuery.ajax({
          url: e,
          type: "POST",
          data: k,
          success: function(a) {
            f.call(this, a)
          }
        })
      })
    })
  },
  filterResults: function(a) {
    var b = jQuery("#ees_assetSearch .asset-finder-filters");
    if (0 === b.find(".filter-btn.filter-active").length) return a;
    for (var a = [].concat(a), c = [], d = 0; d < a.length; d++) {
      var e =
        a[d].type["class"];
      if (null !== e)
        for (var e = e.split(" "), f = 0; f < e.length; f++)
          if (b.find(".filter-btn.filter-" + e[f]).hasClass("filter-active")) {
            c.push(a[d]);
            break
          }
    }
    return c
  },
  loadPage: function(a) {
    return EasyEdit.tmpl.render("asset_search_results", {
      open_finder_text: EasyEditLocalise._("Locate in Asset Finder"),
      assets: this.results.filtered.slice(a, a + this.pageSize)
    })
  },
  previousPage: function() {
    this.offset -= this.pageSize;
    var a = this,
      b = jQuery("#ees_assetSearch .asset-search-results"),
      c = jQuery(this.loadPage(this.offset));
    b.css({
      position: "relative"
    });
    c.css({
      position: "absolute",
      top: b.position().top + "px",
      left: b.position().left - b.width() + "px"
    }).insertBefore(b);
    jQuery("#ees_assetSearch .pagination-next").addClass("disabled");
    jQuery("#ees_assetSearch .pagination-previous").addClass("disabled");
    jQuery("#ees_assetSearch .pagination-page-no").text(this.offset / this.pageSize + 1);
    jQuery([c[0], b[0]]).animate({
      left: "+=" + b.width() + "px"
    }, 300, "swing", function() {
      jQuery("#ees_assetSearch .pagination-next").removeClass("disabled");
      0 <
        a.offset && jQuery("#ees_assetSearch .pagination-previous").removeClass("disabled");
      b.remove();
      c.css({
        position: "relative",
        top: "auto",
        left: "auto"
      });
      a.attachResultEvents()
    })
  },
  nextPage: function() {
    this.offset += this.pageSize;
    var a = this,
      b = jQuery("#ees_assetSearch .asset-search-results"),
      c = jQuery(this.loadPage(this.offset));
    b.css({
      position: "relative"
    });
    c.css({
      position: "absolute",
      top: b.position().top + "px",
      left: b.position().left + b.width() + "px"
    }).insertAfter(b);
    jQuery("#ees_assetSearch .pagination-previous").addClass("disabled");
    jQuery("#ees_assetSearch .pagination-next").addClass("disabled");
    jQuery("#ees_assetSearch .pagination-page-no").text(this.offset / this.pageSize + 1);
    jQuery([c[0], b[0]]).animate({
      left: "-=" + b.width() + "px"
    }, 300, "swing", function() {
      jQuery("#ees_assetSearch .pagination-previous").removeClass("disabled");
      a.offset + a.pageSize < a.results.filtered.length && jQuery("#ees_assetSearch .pagination-next").removeClass("disabled");
      b.remove();
      c.css({
        position: "relative",
        top: "auto",
        left: "auto"
      });
      a.attachResultEvents()
    })
  },
  toggle: function() {
    this.getButton().hasClass("active") ?
      this.hide() : this.show()
  },
  hide: function() {
    this.events.trigger("hide");
    this.getButton().removeClass("active");
    this.$searchbox.hide()
  },
  show: function() {
    this.events.trigger("show");
    this.getButton().addClass("active");
    this.$searchbox.show()
  },
  getButton: function() {
    return jQuery("#ees_toolBar").find("#ees_plusSearchButton")
  },
  attachResultEvents: function() {
    var a = this;
    jQuery("#ees_toolBar .asset-search-results .locate-in-asset-finder").off("click").click(function(b) {
      b.preventDefault();
      a.hide();
      b = jQuery(b.target).parent(".asset-search-item-wrapper").attr("data-assetid");
      EasyEditAssetManager.getAsset(b, function(a) {
        EasyEditComponents.openAssetFinder(a)
      })
    });
    a = this;
    jQuery("#ees_toolBar .asset-search-results .asset-search-item-link").off("click").click(function(b) {
      function c() {
        a.hide();
        EasyEditOverlay.showOverlay("loading");
        var c = jQuery(b.target).parents(".asset-search-item-wrapper").attr("data-assetid");
        EasyEditAssetManager.getAsset(c, function(a) {
          EasyEdit.redirect({
            asset: a
          })
        })
      }
      b.preventDefault();
      if (EasyEditComponentsToolbar.isUnsaved()) {
        var d = EasyEditSearchButton.prototype.hide;
        EasyEditSearchButton.prototype.hide = function() {};
        EasyEditOverlay.showOverlay("confirm", {
          message: '<p class="confirmMessage">' + EasyEditLocalise._("You have unsaved changes, please choose how to proceed.") + "</p>",
          cancelText: EasyEditLocalise._("Return to Asset Search"),
          confirmText: EasyEditLocalise._("Discard Changes"),
          title: EasyEditLocalise._("Unsaved Changes"),
          cssClass: "unsavedChanges",
          confirmFn: function() {
            EasyEditOverlay.hideOverlay("confirm");
            EasyEditSearchButton.prototype.hide = d;
            c()
          },
          cancelFn: function() {
            EasyEditOverlay.hideOverlay("confirm");
            EasyEditSearchButton.prototype.hide = d
          }
        })
      } else c()
    })
  },
  addToToolbar: function() {
    var a = this,
      b = jQuery("#ees_assetFinderButton");
    b.addClass("noright");
    b.attr("title", EasyEditLocalise._("Open Asset Finder"));
    var c = jQuery("<span></span>");
    c.addClass("screenHide").text(" | ");
    c.insertAfter(b);
    var b = jQuery("<a></a>"),
      d = EasyEditLocalise._("Search Assets");
    b.attr({
      href: "#",
      id: "ees_plusSearchButton",
      title: d
    }).addClass("toolbarButton noleft");
    b.insertAfter(c);
    c = jQuery("<span></span>");
    c.addClass("screenHide").text(d);
    c.appendTo(b);
    c = jQuery("<span></span>");
    c.addClass("icon");
    c.appendTo(b);
    b.click(function(b) {
      b.preventDefault();
      a.toggle.call(a);
      jQuery("#ees_toolBar .asset-search-box").focus()
    })
  }
};
EasyEditOverlay.overlays.greyOut = {
  id: "ees_greyOut",
  timer: null,
  show: function(a, b) {
    var c = this,
      d = c.getContainer(),
      e = {
        message: "",
        heading: "",
        continueButtonText: EasyEditLocalise._("Continue"),
        confirmFn: function() {}
      },
      f = jQuery.extend(e, a, !0);
    d.html(this._getTemplate(f.heading, f.message, f.continueButtonText)).show();
    jQuery("#ees_greyOutContinue").click(function(a) {
      a.preventDefault();
      f.confirmFn.call(this);
      c.hide()
    });
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' +
      this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide()
  },
  _getTemplate: function(a, b, c) {
    return '<div id="ees_greyOutMessage" class="warning"><h1>' + a + "</h1>" + b + '<p><a href="#" id="ees_greyOutContinue" class="guiButton default">' + c + "</a></p></div>"
  }
};
EasyEditOverlay.overlays.success = {
  id: "ees_successOverlay",
  show: function(a, b) {
    var c = this.getContainer(),
      d = jQuery.extend({
        message: ""
      }, a, !0);
    c.html(this._getTemplate(d.message)).show();
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide()
  },
  _getTemplate: function(a) {
    return '<div id="ees_overlayImage" class="success"></div><div id="ees_overlayMessage"><span>' +
      a + "</span></div>"
  }
};
EasyEditOverlay.overlays.confirm = {
  id: "ees_confirmOverlay",
  show: function(a, b) {
    var c = this.getContainer(),
      d = {
        message: "",
        title: EasyEditLocalise._("Please Confirm"),
        cancelText: EasyEditLocalise._("Cancel"),
        confirmText: EasyEditLocalise._("Confirm"),
        cssClass: ""
      },
      d = jQuery.extend(d, a, !0);
    c.html(this._getTemplate(d)).show();
    jQuery("#confirmButton").click(function(b) {
      b.preventDefault();
      "function" === typeof a.confirmFn && a.confirmFn.call(this)
    });
    jQuery("#cancelButton").click(function(b) {
      b.preventDefault();
      "function" ===
      typeof a.cancelFn && a.cancelFn.call(this)
    });
    var c = jQuery("#ees_confirm"),
      d = c.height(),
      e = c.width();
    c.draggable({
      handle: ".ees_BubbleTitle",
      containment: "document"
    });
    c.css("left", jQuery(window).width() / 2 - e / 2 + "px");
    c.css("top", jQuery(window).height() / 2 - d / 2 + "px");
    b.call(this)
  },
  getContainer: function() {
    jQuery("#" + this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide()
  },
  _getTemplate: function(a) {
    var b = '<div class="ees_Bubble ' +
      a.cssClass + '" id="ees_confirm"><div class="ees_BubbleTitle">' + a.title + '</div><div class="ees_BubbleContent"><div class="section">' + a.message + '</div><div class="confirmation section"><a href="#" id="confirmButton" class="alignRight light guiButton">' + a.confirmText + "</a>{{cancelText}}</div></div></div>",
      c = "";
    a.cancelText && (c = '<a href="#" id="cancelButton" class="alignLeft light guiButton">' + a.cancelText + "</a>");
    return b = b.replace("{{cancelText}}", c)
  }
};
var EasyEditAssetWizardQueue = function(a) {
  var b = this;
  this.queue = [];
  this.limit = a;
  this.events = new ObservableEvents(this);
  this.$elem = jQuery(EasyEdit.tmpl.render("wizard_queue", {
    title: EasyEditLocalise._("Add More")
  }));
  this.$addButton = jQuery(".add-more", this.$elem);
  this.$addButton.click(function(a) {
    a.preventDefault();
    a = b.queue.length;
    if (a < b.limit && !b.$elem.hasClass("disabled")) {
      var d = EasyEdit.wizard.build(b.first().attribute("type_code"));
      b.$elem.after(d.$element);
      b.add(d);
      a + 1 >= b.limit && jQuery(this).addClass("disabled")
    }
  });
  this.$list = this.$elem.find("ul");
  this.hide()
};
EasyEditAssetWizardQueue.prototype = {
  setLimit: function(a) {
    this.limit = a
  },
  first: function() {
    return 1 <= this.queue.length ? this.queue[0].wizard : null
  },
  each: function(a) {
    for (var b = 0, c = this.queue.length; b < c; b += 1) a.call(this, b, this.queue[b])
  },
  create: function(a) {
    var b = this,
      c = [];
    this.each(function(a, b) {
      b.wizard.valid() || c.push(b)
    });
    if (c.length) {
      var d = this.getCurrent().$element.find(".fieldWarning");
      d.length && d.siblings().filter(function() {
        return /(input|select|textarea)/.test(this.nodeName.toLowerCase())
      }).first().focus();
      a.call(this,
        c);
      return !1
    }
    var e = "undefined" === typeof this.queue[0].wizard.createWizardType || "create" === this.queue[0].wizard.createWizardType ? "create" : "clone";
    b.$elem.addClass("disabled");
    b.$list.find(".selected").removeClass("selected");
    b.events.trigger("create");
    var f = new EasyEditProgressBar(["total"]);
    b.$progress = jQuery(EasyEdit.tmpl.render("wizard_queue_progress", {
      title: EasyEditLocalise._("Processing...")
    }));
    b.$progress.find(".progress").append(f.$bar);
    var g = jQuery(".progress-status", b.$progress),
      j = jQuery(".progress-message",
        b.$progress),
      h = [],
      k = [];
    f.setTotal(2 * this.queue.length);
    this.each(function(a, c) {
      c.wizard.hide();
      h.push(function(d) {
        f.update(1);
        g.text(EasyEditLocalise._("Task %1 of %2", f.completed, f.total));
        c.wizard.gatherCreateData();
        var h = c.wizard.createData;
        "create" === e ? j.text(EasyEditLocalise._('Creating %1 "%2"', c.wizard.attribute("display_name"), h.asset_name)) : j.text(EasyEditLocalise._('Cloning #%1 "%2"', h.source_assetid, h.asset_name));
        c.wizard.$element.find("#ees_inputUpload").length && (c.wizard.events.observe("uploading",
          function() {
            j.text(EasyEditLocalise._('Uploading "%1"...', h.asset_name))
          }), c.wizard.events.observe("upload_complete", function() {
          j.text(EasyEditLocalise._("Upload complete"))
        }));
        var r = {
          index: a,
          queued: c
        };
        c.wizard.events.observe("create_complete", function(e, g, h) {
          f.update(1);
          r = {
            result: {
              success: Array.prototype.slice.call(arguments)
            },
            queued: c
          };
          k.push(r);
          b.$elem.find("li:eq(" + a + ")").addClass("complete");
          setTimeout(function() {
            d()
          }, 500)
        });
        c.wizard.events.observe("create_fail", function(e) {
          f.update(1);
          r = {
            result: {
              error: e,
              errorCode: "createFailed"
            },
            queued: c
          };
          k.push(r);
          b.$elem.find("li:eq(" + a + ")").addClass("fail");
          setTimeout(function() {
            d()
          }, 500)
        });
        c.wizard.create()
      })
    });
    this.$elem.after(b.$progress);
    b.$progress.show();
    h.push(function(a) {
      b.$progress.remove();
      b.events.trigger("create_complete", k);
      b.$elem.removeClass("disabled");
      a()
    });
    EasyEdit.util.async.series(h)
  },
  get: function(a) {
    return "undefined" !== typeof this.queue[a] ? this.queue[a].wizard : null
  },
  getCurrent: function() {
    return this.get(this.$list.find("li.selected").index())
  },
  find: function(a) {
    for (var b = 0, c = this.queue.length; b < c; b += 1)
      if (this.queue[b].wizard === a) return {
        index: b,
        queued: this.queue[b]
      };
    return null
  },
  select: function(a) {
    if ("undefined" === typeof this.queue[a]) return !1;
    this.each(function(a, c) {
      c.wizard.hide()
    });
    this.$list.find(".selected").removeClass("selected");
    this.queue[a].wizard.show();
    this.queue[a].elem.addClass("selected");
    this.events.trigger("select", this.queue[a].wizard)
  },
  add: function(a) {
    var b = this;
    this.each(function(a, b) {
      b.wizard.hide();
      b.elem.removeClass("selected")
    });
    var c = jQuery(EasyEdit.tmpl.render("simple_tag", {
      tag: "li",
      "class": "type-" + a.attribute("type_code") + " selected",
      content: '<span class="delete" title="' + EasyEditLocalise._("Delete") + '">' + EasyEditLocalise._("Delete") + '</span><span class="name">' + ("create" === a.createWizardType ? EasyEditLocalise._("New Asset") : EasyEditLocalise._("Clone Asset")) + "</span>"
    }));
    this.queue.push({
      elem: c,
      wizard: a,
      progress: 0
    });
    a.$nameField.on("keyup change", function() {
      var b = jQuery(this).val();
      if ("" === b || null !== /^\s+$/.exec(b)) b =
        "create" === a.createWizardType ? EasyEditLocalise._("New Asset") : EasyEditLocalise._("Clone Asset");
      jQuery(".name", c).text(b)
    });
    jQuery(".name", c).click(function(d) {
      d.preventDefault();
      if (!b.$elem.hasClass("disabled")) {
        if (c.hasClass("selected")) return !1;
        d = b.find(a);
        b.select(d.index)
      }
    });
    jQuery(".delete", c).click(function(a) {
      a.preventDefault();
      if (!b.$elem.hasClass("disabled")) {
        var e = b.queue.length,
          a = c.index();
        2 <= e && (e = !1, c.hasClass("selected") && (e = !0), b.remove(b.get(a)), e && b.select(0))
      }
    });
    a.events.observe("validate",
      function(b) {
        c.find(".error").remove();
        b || (b = a.validator.getFailCount(), b = EasyEditLocalise._n('<span class="count">1</span> <span class="screenHide">failed validation attempt</span>', '<span class="count">%1</span> <span class="screenHide">failed validation attempts</span>', b, b), c.append(EasyEdit.tmpl.render("simple_tag", {
          tag: "span",
          "class": "error",
          content: b
        })))
      });
    a.validator.validator.events.observe("run", function() {
      var b = a.validator.getFailCount();
      1 <= b ? c.find(".error .count").text(b) : c.find(".error").remove()
    });
    c.hide();
    this.$list.append(c);
    c.fadeIn("fast");
    this.events.trigger("add", a)
  },
  remove: function(a) {
    var b = this.find(a);
    EasyEdit.isset(b) && (b.queued.elem.fadeOut("fast", function() {
      b.queued.elem.remove()
    }), this.queue.splice(b.index, 1), a.$element.remove(), this.events.trigger("remove", a));
    this.queue.length < this.limit && this.$addButton.removeClass("disabled")
  },
  removeAll: function() {
    this.each(function(a, b) {
      b.wizard.$element.remove();
      b.elem.remove()
    });
    this.events.trigger("remove_all");
    this.queue = [];
    this.$addButton.removeClass("disabled")
  },
  show: function() {
    this.$elem.show();
    this.events.trigger("show")
  },
  hide: function() {
    this.$elem.hide();
    EasyEdit.isset(this.$progress) && this.$progress.remove();
    EasyEdit.isset(this.$results) && this.$results.remove();
    this.events.trigger("hide")
  }
};
EasyEditGlobalTemplates = {
  simple_tag: '<{{tag}} class="{{class}}">{{&content}}</{{tag}}>',
  id_tag: '<{{tag}} id="{{id}}">{{&content}}</{{tag}}>',
  list: '<ul class="{{class}}">{{#list}}<li>{{.}}</li>{{/list}}</ul>',
  select: '<select class="{{class}}" name="{{name}}" id="{{name}}">{{#options}}<option value="{{key}}"{{#selected}} selected{{/selected}}>{{value}}</option>{{/options}}</select>',
  light_button: '<a href="{{href}}" title="{{title}}" {{#attr}}id="{{id}}"{{/attr}} class="guiButton light {{class}}">{{content}}</a>',
  default_button: '<a href="{{href}}" title="{{title}}" {{#attr}}id="{{id}}"{{/attr}} class="guiButton default {{class}}">{{content}}</a>',
  icon_link: '<a href="{{href}}" title="{{title}}" {{#attr}}id="{{id}}"{{/attr}} class="iconLink {{class}}"><span class="icon"></span><span class="text">{{content}}</span></a>',
  light_plus_button: '<a href="{{href}}" title="{{title}}" {{#attr}}id="{{id}}"{{/attr}} class="guiButton light {{class}}"><span class="iconPlus"></span>{{content}}</a>',
  xml_tag: "<{{tag}}>{{content}}</{{tag}}>",
  error_item: "{{&name}}: {{&item}}",
  error_section: "------------- {{&name}} -------------",
  asset_info: '<a href="{{child.web_path}}" class="ees_assetInfo alignLeft" title="Edit this asset"><span class="assetIcon alignLeft {{child.type_code}}" title="{{child.type}}"></span><span class="assetStatus alignLeft {{status.className}}" title="{{status.description}}"></span><span class="assetName alignLeft">{{child.name}}</span><span class="assetId alignLeft">#{{child.id}}</span><span class="webPath screenHide">{{child.web_path}}</span></a>',
  bubble_wrapper: '<div class="ees_Bubble {{class}}" id="{{id}}"><div class="ees_BubbleTitle">{{title}}</div><div class="ees_BubbleContent">{{#sections}}<div class="section">{{&content}}</div>{{/sections}}<div class="confirmation section">{{&buttons}}</div></div></div>',
  tooltip: '<div id="{{id}}" class="eesTooltip {{class}}"><div class="tooltipArrow"></div>{{#title}}<div class="tooltipTitle">{{title}}</div>{{/title}}<div class="tooltipContent"><div class="tooltipMessage">{{&message}}</div>{{#buttons}}<div class="tooltipButtons clearfix">{{&buttons}}</div>{{/buttons}}</div></div>',
  linking_screen_child_list: '<div class="listWrapLeft"><div class="listWrapRight"><ul class="ees_directChildrenList">{{#children}}<li class="child permission-level-{{child.maximum_perm_on_asset}}"><span class="imageWrapper clearfix">{{#drag}}<a class="{{className}} alignLeft" title="{{title}}" href="#"></a>{{/drag}}<a href="{{child.web_path}}" data-treeid="{{child.tree_id}}" class="assetInfo alignLeft" title="Leave this list to edit this item"><span class="assetIcon alignLeft {{child.type_code}}" title="{{child.type}}"></span><span class="assetStatus alignLeft {{status.className}}" title="{{status.description}}"></span><span class="assetName alignLeft">{{child.name}}</span><span class="assetId alignLeft">#{{child.id}}</span><span class="webPath screenHide">{{child.web_path}}</span></a></span></li>{{/children}}</ul></div></div>',
  reorder_overlay_child_list: '<div class="reorderWrapper"><ul class="ees_directChildrenList">{{#children}}<li class="clearfix child-{{child.id}} child permission-level-{{child.maximum_perm_on_asset}}">{{#drag}}<a class="{{className}} alignLeft" title="{{title}}" href="#"><span class="screenHide">{{title}}</span></a>{{/drag}}<span class="assetInfo alignLeft"><span class="assetName alignLeft" title="{{child.name}}">{{child.name}}</span><span class="assetId alignLeft" title="#{{child.id}}">#{{child.id}}</span><span class="type alignLeft"></span></span></li>{{/children}}</ul></div>',
  toolbar_preview_button: '<li class="toolbarButton {{class}}"><a href="#" id="{{id}}" class="{{#current}}current{{/current}}" title="{{title}}"><span class="icon"></span></a></li>',
  modal_container: '<div class="overlay" id="ees_mainOverlay"><div class="modalContainer {{class}}" id="{{id}}"><div class="modalHeader"><div class="modalHeaderContent"><a class="closeModal" title="{{text.close}}" href="#"><span class="screenHide">{{text.close}}</span></a><div class="modalIcon"></div><div class="modalHeaderInner"><div class="modalTitle"><h1>{{text.title}}</h1></div><div class="modalDesc">{{text.description}}</div></div></div></div><div class="modalBody"><div class="modalBodyContent"><div id="{{body_container_id}}"></div></div></div><div class="modalFooter"></div></div></div>',
  modal_loading: '<div class="modalLoaderContainer modalBodyForm"><div class="modalLoader"><div class="modalLoaderFeebackContainer"><div class="modalLoaderFeeback"></div></div><div class="modalLoaderMessage"><p>{{message}}</p></div></div></div>',
  wizard_category_select: '<div class="modalBodyCategories" id="{{id}}Categories"><h2>{{category_title}}</h2><ul>{{#categories}}<li class="{{#selected}}selected{{/selected}}"><a class="assetCreateCategory" id="ees_categoryLink_{{cat_id}}" href="#"><span>{{display_name}}</span></a></li>{{/categories}}</ul><div class="buttons"><a id="ees_cloneAssetButton" href="#" class="clone guiButton light"><span class="icon">Clone Existing Asset</span></a></div></div><div class="modalBodyForm modalType-button" id="{{id}}AssetTypes"><ul>{{#wizards}}<li class="ees_categoryGroup_{{type_code}} wizard category_{{cat_id}}"><a class="{{type_code}} assetToCreate" href="#"><span class="assetType screenHide">{{type_code}}</span><span class="buttonContent"><strong class="buttonTitle">{{display_name}}</strong><span class="screenHide">: </span><span class="buttonDesc">{{description}}</span></span></a></li>{{/wizards}}</ul></div>',
  wizard_queue: '<div class="wizardQueue"><div class="buttons"><a href="#" class="add-more guiButton light"><span class="icon">+</span> {{title}}</a></div><ul class="queue"></ul></div>',
  wizard_queue_progress: '<div class="modalBodyForm wizardQueueProgressIndicator"><h2>{{title}}</h2><div class="progress-status"></div><div class="progress-message"></div><div class="progress"></div></div>',
  wizard_default: '<div class="modalBodyForm defaultCreate" id="ees_create{{type_code}}_{{queue}}"><div id="ees_{{cat_id}}CreateInformation" class="createSection"><h2>{{title}}</h2><div class="dataRow"><p><label class="textInputLabel required" for="ees_newName">{{name.label}}</label> </p><input type="text" class="textInput" value="{{default_asset_name}}" id="ees_newName" name="ees_newName" /></div><div class="dataRow"><p>{{link_type.title}}</p><div class="showInMenu"></div><span class="notes">{{link_type.description}}</span></div></div></div>',
  wizard_file: '<div class="modalBodyForm defaultCreate" id="ees_create{{type_code}}_{{queue}}"><div id="ees_{{cat_id}}CreateInformation" class="createSection"><h2>{{title}}</h2><div class="dataRow"><p><label class="textInputLabel required" for="ees_inputUpload">{{upload.label}}</label> </p><input type="file" id="ees_inputUpload" name="ees_inputUpload" /><br /><span class="notes" id="ees_fileNameFeedback">{{upload.feedback}}</span></div><div class="dataRow"><p><label class="textInputLabel required" for="ees_newName">{{name.file_label}}</label> </p><input type="text" class="textInput" value="" id="ees_newName" name="ees_newName" /></div><div class="dataRow"><p>{{link_type.title}}</p><div class="showInMenu"></div><span class="notes">{{link_type.description}}</span></div></div></div>',
  wizard_image: '<div class="modalBodyForm defaultCreate" id="ees_create{{type_code}}_{{queue}}"><div id="ees_imageCreateInformation" class="createSection"><h2>{{title}}</h2><div class="dataLeftColumn alignLeft"><div class="dataRow"><p><label class="textInputLabel required" for="ees_inputUpload">{{upload.label}}</label> </p><input type="file" id="ees_inputUpload" name="ees_inputUpload" /><br /><span class="notes" id="ees_fileNameFeedback">{{upload.feedback}}</span></div><div class="dataRow"><p><label class="textInputLabel required" for="ees_newName">{{name.label}}</label> </p><input type="text" class="textInput" value="" id="ees_newName" name="ees_newName" /><span class="notes">{{name.file_description}}</span></div><div class="dataRow"><div class="alignLeft altGrouping"><p><label class="textInputLabel required" for="ees_attributeAlt">{{alt.label}}</label> </p><input type="text" class="textInput" value="" id="ees_attributeAlt" name="ees_attributeAlt" /></div><div class="alignLeft altGrouping"><p class="decorativeSliderTitle">{{alt.decorativeLabel}}</p><div class="decorativeSlider"></div></div><span class="notes altNotes">{{alt.description}}</span></div></div><div class="dataRightColumn alignLeft"><div class="dataRow"><div class="dataRow"><p><label for="ees_attributeCaption" class="textInputLabel">{{caption.label}}</label> </p><textarea name="ees_attributeCaption" id="ees_attributeCaption" class="textInput"></textarea><span class="notes captionNotes">{{&caption.description}}</span></div></div><div class="dataRow"><p>{{link_type.title}}</p><div class="showInMenu"></div><span class="notes">{{link_type.description}}</span></div></div></div></div>',
  wizard_calendar: '<div class="modalBodyForm defaultCreate" id="ees_create{{type_code}}_{{queue}}"><div id="ees_{{cat_id}}CreateInformation" class="createSection"><h2>{{title}}</h2><div class="dataRow"><p><label class="textInputLabel required" for="ees_newName">{{name.label}}</label> </p><input type="text" class="textInput" value="" id="ees_newName" name="ees_newName" /></div><div class="dataRow clearfix"><div class="datePickerLabel alignLeft menuLabel">{{label.all_day_event}}</div><div class="allDayEvent alignLeft"></div></div><div class="dataRow clearfix"><div class="datePickerLabel alignLeft menuLabel">{{label.use_end_date}}</div><div class="useEndDate alignLeft"></div></div><div class="dataRow clearfix"><div class="datePickerLabel alignLeft">{{label.start_date}}:</div><div class="startDatePicker alignLeft"></div></div><div class="dataRow clearfix"><div class="datePickerLabel alignLeft">{{label.end_date}}:</div><div class="endDatePicker alignLeft"></div></div><div class="dataRow recurringOptions screenHide clearfix"><div class="alignLeft datePickerLabel">{{label.frequency}}:</div><div id="ees_frequencySelection" class="alignLeft"><fieldset class="ees_dateFrequency"><input type="radio" name="ees_dateFrequency_{{queue}}" value="DED" id="ees_dateFrequencyDaily" checked="checked" /><label for="ees_dateFrequencyDaily">{{label.daily}}</label><input type="radio" name="ees_dateFrequency_{{queue}}" value="WEW" id="ees_dateFrequencyWeekly" /><label for="ees_dateFrequencyWeekly">{{label.weekly}}</label><input type="radio" name="ees_dateFrequency_{{queue}}" value="MFN" id="ees_dateFrequencyMonthly" /><label for="ees_dateFrequencyMonthly">{{label.monthly}}</label></div></fieldset><div class="alignLeft until"><input type="checkbox" name="ees_dateUntil" id="ees_dateUntil" value="0" checked="checked" />&nbsp;<label for="ees_dateUntil">{{label.further_notice}}</label><div class="stopDateSelection screenHide"><div class="untilDatePicker "></div></div></div></div><div class="dataRow clearfix"><div class="datePickerLabel alignLeft menuLabel">{{link_type.title}}</div><div class="showInMenu alignLeft"></div></div></div></div>',
  wizard_buttons: '<div class="modalBodyButtons clearfix"><a href="#" class="guiButton light alignLeft backButton" title="{{back_button_label}}">{{back_button_label}}</a><a href="#" class="guiButton default alignRight createButton" title="{{create_button_label}}">{{create_button_label}}</a><a href="#" class="guiButton default alignRight cloneButton" title="{{clone_button_label}}">{{clone_button_label}}</a></div>',
  wizard_source_asset_selection: '<div id="ees_sourceAsset" class="createSection"><h2>{{title}}</h2><div class="dataRow"><div class="clearfix" id="ees_sourceAssetLocation"><p><span class="required">{{description}}</span></p><p class="clearfix alignRight ees_locationSelectors"><a class="guiButton light alignLeft ees_selectAsset" id="ees_selectSourceAsset" href="#">{{select_source_button}}</a><span class="alignLeft spacer">' +
    EasyEditLocalise._("or") + '</span><a class="guiButton light alignLeft ees_selectCurrentAsset" id="ees_addCurrentSourceAsset" href="#">{{select_current_button}}</a></p><ul class="ees_assetLocationsList" id="ees_sourceAssetLocationsList"><li class="noneSelected">{{no_locations}}</li></ul></div></div></div>',
  wizard_parent_selection: '<div id="ees_pageParents" class="createSection"><h2>{{title}}</h2><div class="dataRow"><div class="clearfix" id="ees_createLocations"><p><span class="required">{{description}}</span></p><p class="clearfix alignRight ees_locationSelectors"><a class="guiButton light alignLeft ees_selectAsset" id="ees_selectParents" href="#">{{select_parent_button}}</a><span class="alignLeft spacer">' +
    EasyEditLocalise._("or") + '</span><a class="{{#disabled}}disabled{{/disabled}} guiButton light alignLeft ees_selectCurrentAsset" {{#disabled}}title="You cannot use the current asset as it is a file or dependant asset"{{/disabled}} id="ees_addCurrentParent" href="#">{{select_current_button}}</a></p><ul class="ees_assetLocationsList" id="ees_createLocationsList"><li class="noneSelected">{{no_locations}}</li></ul></div></div></div>',
  wizard_parent_item: '<li class="selected"><span class="toggleSelection alignRight" title="{{toggleTitle}}"></span><span class="assetId screenHide">{{assetid}}</span><span class="lineage screenHide">{{lineage}}</span><span class="rootUrl screenHide">{{rootUrl}}</span><span class="safe screenHide">{{^safe}}unsafe{{/safe}}</span><span title="{{type}}" class="assetIcon alignLeft {{type_code}}"></span><span title="{{asset_name}}" class="assetName alignLeft">{{asset_name}}</span></li>',
  wizard_success: '<div id="ees_createSuccess" class="modalBodyForm defaultCreate"><h2>{{title}}</h2><div id="ees_createSuccessAssets" class="alignRight"><ul id="ees_createSuccessAssetsList">{{&results}}</ul></div><div id="ees_createSuccessMessage"><p class="message">{{message}}</p><div class="extraInformation clearLeft"></div><p><a href="#" id="ees_restartCreateWizard" class="guiButton light" title="{{restart_wizard_title}}">{{restart_wizard_title}}</a></p></div></div><div id="ees_createSuccessButtons" class="modalBodyButtons clearfix"><a href="#" id="ees_createSuccessClose" class="guiButton default alignRight" title="{{close_title}}">{{close_title}}</a></div>',
  wizard_success_asset: '<li class="success"><a class="assetEdit guiButton light alignRight" href="{{edit_path}}" title="{{edit_title}}">{{edit_title}}</a><span class="assetId screenHide">{{assetid}}</span><span class="assetIcon alignLeft {{type_code}}" title="{{type}}"></span><span class="assetName alignLeft" title="{{name}}">{{name}}</span></li>',
  wizard_fail_asset: '<li class="fail"><span class="errorIcon alignLeft" title="{{error}}"></span><span class="assetIcon alignLeft {{type_code}}"></span><span class="assetName alignLeft" title="{{name}}">{{name}}</span></li>',
  metadata_thesaurus_field: '<div class="clickToLoadTerms clearfix alignLeft clearBoth"></div><div class="loadingTerms screenHide clearfix alignLeft clearBoth">{{loading_message}}</div><div class="addNewTerm screenHide clearfix alignLeft clearBoth"><select name="{{id}}" id="{{id}}" class="thesaurusTermSelect alignLeft">{{#options}}<option value="{{value}}">{{text}}</option>{{/options}}</select><a href="#" title="{{title}}" class="guiButton light addNew alignRight">{{title}}</a></div><ul class="ees_directChildrenList editableItems screenHide clearBoth"><li class="asset defaultItem"><span class="tagContent">{{description}}</span></li></ul><ul class="ees_directChildrenList defaultItems screenHide clearBoth">{{#default_items}}<li class="asset defaultItem"><span class="tagContent">{{.}}</span></li>{{/default_items}}</ul>',
  metadata_thesaurus_field_tag: '<li class="asset"><a title="{{delete_title}}" class="assetDeleteOption alignRight" href="#"></a><a href="#" title="{{drag_title}}" class="dragIcon alignLeft"></a><span class="tagContent">{{tag}}</span><input type="hidden" id="{{id}}" name="{{name}}" value="{{value}}" /></li>',
  details_screen_page_redirect: '<h3 class="sectionHeading">{{heading}}</h3><div id="ees_detailsRedirect" class="clearfix"><div class="row clearfix"><div class="cellName alignLeft"><label for="{{redirect_url.id}}" class="inputLabel">{{redirect_url.label}}:</label></div><div class="cellData alignLeft"><input type="text" id="{{redirect_url.id}}" name="{{redirect_url.id}}" class="inputText ees_redirectUrl" value="{{redirect_url.value}}" /><span class="notes">{{redirect_url.notes}}</span></div></div><div class="row clearfix"><div class="cellName alignLeft">{{redirect_asset.label}}:</div><div class="cellData alignLeft"><div id="ees_redirectAsset"></div><div class="assetDetails screenHide"><input type="text" id="{{redirect_asset.id}}" name="{{redirect_asset.id}}" class="inputText ees_redirectAssetId" value="{{redirect_asset.value}}" /><input type="text" id="{{redirect_asset_name.id}}" name="{{redirect_asset_name.id}}" class="inputText ees_redirectAssetName" value="{{redirect_asset_name.value}}" /></div><span class="notes">{{redirect_asset.notes}}</span></div></div><div class="row clearfix"><div class="cellName alignLeft">{{permanent_redirect.label}}</div><div class="cellData alignLeft"><div class="ees_permanentRedirectSlider"></div><input type="hidden" id="{{permanent_redirect.id}}" name="{{permanent_redirect.id}}" class="ees_permanentRedirect" value="{{permanent_redirect.value}}" /><span class="notes">{{permanent_redirect.notes}}</span></div></div></div>',
  details_screen_page_redirect_read_only: '<h3 class="sectionHeading">{{heading}}</h3><div id="ees_detailsRedirect" class="clearfix"><div class="row clearfix"><div class="cellName alignLeft">{{redirect_url.label}}:</div><div class="cellData alignLeft">{{redirect_url.value}}</div></div><div class="row clearfix"><div class="cellName alignLeft">{{redirect_asset.label}}:</div><div class="cellData alignLeft">{{redirect_asset.name}}</div></div></div>',
  details_screen_link_asset_read_only: '<h3 class="sectionHeading">{{title.label}}</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft">{{title.label}}:</div><div class="cellData alignLeft">{{title.value}}</div></div></div><h3 class="sectionHeading">{{heading}}</h3><div id="ees_detailsRedirect" class="clearfix"><div class="row clearfix"><div class="cellName alignLeft">{{redirect_url.label}}:</div><div class="cellData alignLeft">{{redirect_url.value}}</div></div><div class="row clearfix"><div class="cellName alignLeft">{{redirect_asset.label}}:</div><div class="cellData alignLeft">{{redirect_asset.name}}</div></div></div>',
  details_screen_link_asset: '<h3 class="sectionHeading">{{title.label}}</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label class="inputLabel" for="{{title.id}}">{{title.label}}:</label></div><div class="cellData alignLeft"><input type="text" value="{{title.value}}" class="inputText" name="{{title.id}}" id="{{title.id}}"></div></div></div><h3 class="sectionHeading">{{heading}}</h3><div id="ees_detailsRedirect" class="clearfix"><div class="row clearfix"><div class="cellName alignLeft"><label for="{{redirect_url.id}}" class="inputLabel">{{redirect_url.label}}:</label></div><div class="cellData alignLeft"><input type="text" id="{{redirect_url.id}}" name="{{redirect_url.id}}" class="inputText ees_redirectUrl" value="{{redirect_url.value}}" /><span class="notes">{{redirect_url.notes}}</span></div></div><div class="row clearfix"><div class="cellName alignLeft">{{redirect_asset.label}}:</div><div class="cellData alignLeft"><div id="ees_redirectAsset"></div><div class="assetDetails screenHide"><input type="text" id="{{redirect_asset.id}}" name="{{redirect_asset.id}}" class="inputText ees_redirectAssetId" value="{{redirect_asset.value}}" /><input type="text" id="{{redirect_asset_name.id}}" name="{{redirect_asset_name.id}}" class="inputText ees_redirectAssetName" value="{{redirect_asset_name.value}}" /></div><span class="notes">{{redirect_asset.notes}}</span></div></div><div class="row clearfix"><div class="cellName alignLeft">{{relation.label}}</div><div class="cellData alignLeft"><div class="ees_permanentRedirectSlider"></div><input type="text" id="{{relation.id}}" name="{{relation.id}}" class="inputText ees_relation" value="{{relation.value}}" /><span class="notes">{{relation.notes}}</span></div></div></div>',
  bodycopy_insert_button: '<{{tag}} class="bodycopy_insert clearfix position-{{position}}"><a class="icon" href="#" title="{{title}}"><span class="screenHide">{{content}}</a></span></{{tag}}>',
  bodycopy_tools: '<{{tag}} class="bodycopy_tools clearfix position-{{position}}">{{#readonly}}<span title="{{readonly.content}}" class="bodycopy_unsupported"><span class="screenHide">{{readonly.content}}</span></span>{{/readonly}}{{#multilinked}}<span class="bodycopy_multi_linked" title="{{multilinked.title}}"><span class="screenHide">{{multilinked.content}}</span></span>{{/multilinked}}<span class="bodycopy_type">{{type}}</span>{{#readonly}}<span class="bodycopy_readonly" title="{{readonly.title}}">{{readonly.content}}</span>{{/readonly}}<a class="bodycopy_properties icon" href="#" title="{{properties.title}}"><span class="screenHide">{{properties.content}}</span></a>{{#conditions}}<a class="bodycopy_conditions {{#conditions.available}}available {{/conditions.available}}{{#conditions.enabled}}enabled {{/conditions.enabled}}icon" href="#" title="{{conditions.title}}"><span class="screenHide">{{conditions.content}}</span></a>{{/conditions}}<a class="bodycopy_delete icon" href="#" title="{{remove.title}}"><span class="screenHide">{{remove.content}}</span></a>{{#comments}}<a class="bodycopy_comments {{#comments.available}}available {{/comments.available}}{{#comments.enabled}}enabled {{/comments.enabled}}icon" href="#" title="{{comments.title}}"><span class="screenHide">{{comments.content}}</span></a>{{/comments}}<a class="bodycopy_re_order icon" href="#" title="{{reorder.title}}"><span class="screenHide">{{reorder.content}}</span></a></{{tag}}>',
  bodycopy_properties_popup: '<div class="section sectionId"><div class="heading">{{headings.identification}}</div><div class="row clearfix changeId"><label for="{{input.identifier.id}}" class="alignLeft">{{input.identifier.label}}</label><input type="text" name="{{input.identifier.id}}" id="{{input.identifier.id}}" value="{{input.identifier.value}}" class="alignLeft" /></div><div class="row clearfix changeDescription"><label for="{{input.description.id}}" class="alignLeft">{{input.description.label}}</label><textarea id="{{input.description.id}}" name="{{input.description.id}}" class="alignLeft">{{input.description.value}}</textarea></div></div><div class="section sectionStyle"><div class="heading">{{headings.styling}}</div><div class="row clearfix changeStyle"><label for="{{input.presentation.id}}" class="alignLeft">{{input.presentation.label}}</label><select name="{{input.presentation.id}}" id="{{input.presentation.id}}" class="alignLeft">{{#input.presentation.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.presentation.values}}</select></div><div class="row clearfix changeClass"><label for="{{input.css.id}}" class="alignLeft">{{input.css.label}}</label><input type="text" id="{{input.css.id}}" name="{{input.css.id}}" value="{{input.css.value}}" class="alignLeft" /></div><div class="row changeClassSelect clearfix{{^input.classSelect.values}} hidden{{/input.classSelect.values}}"><select name="{{input.classSelect.id}}" id="{{input.classSelect.id}}" class="alignRight"><option value="" selected="selected">{{input.classSelect.defaultText}}</option>{{#input.classSelect.values}}<option value="{{value}}">{{text}}</option>{{/input.classSelect.values}}</select></div></div><div class="section sectionDirection"><div class="heading">{{headings.direction}}</div><div class="row changeDirection clearfix"><label for="{{input.direction.id}}" class="alignLeft">{{input.direction.label}}</label><select name="{{input.direction.id}}" id="{{input.direction.id}}" class="alignLeft">{{#input.direction.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.direction.values}}</select></div></div><div class="section sectionType"><div class="heading">{{headings.content_type}}</div><div class="row clearfix changeType"><label for="{{input.content_type.id}}" class="alignLeft">{{input.content_type.label}}</label><select name="{{input.content_type.id}}" id="{{input.content_type.id}}" class="alignLeft">{{#input.content_type.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.content_type.values}}</select></div><div class="row clearfix changeType {{input.template.className}}"><label for="{{input.template.id}}" class="alignLeft">{{input.template.label}}</label><select name="{{input.template.id}}" id="{{input.template.id}}" class="alignLeft">{{#input.template.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.template.values}}</select></div><div class="row clearfix changeKeywords"><label for="{{input.keywords.id}}" class="alignLeft">{{input.keywords.label}}</label><input type="checkbox" value="1" id="{{input.keywords.id}}" name="{{input.keywords.id}}" class="alignLeft" {{input.keywords.checked}} /></div></div>',
  bodycopy_insert_popup: '<div class="section sectionId"><div class="heading">{{headings.identifier}}</div><div class="row changeId clearfix"><label for="{{input.identifier.id}}" class="alignLeft">{{input.identifier.label}}</label><input type="text" name="{{input.identifier.id}}" id="{{input.identifier.id}}" value="{{input.identifier.value}}" class="alignLeft" /></div></div><div class="section sectionStyle"><div class="heading">{{headings.styling}}</div><div class="row changePresentation clearfix"><label for="{{input.presentation.id}}" class="alignLeft">{{input.presentation.label}}</label><select name="{{input.presentation.id}}" id="{{input.presentation.id}}" class="alignLeft">{{#input.presentation.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.presentation.values}}</select></div><div class="row changeClassText clearfix"><label for="{{input.css.id}}" class="alignLeft">{{input.css.label}}</label><input type="text" id="{{input.css.id}}" name="{{input.css.id}}" class="alignLeft">{{input.css.value}}</textarea></div><div class="row changeClassSelect clearfix"><select name="{{input.classSelect.id}}" id="{{input.classSelect.id}}" class="alignRight"><option value="" selected="selected">{{input.classSelect.defaultText}}</option>{{#input.classSelect.values}}<option value="{{value}}">{{text}}</option>{{/input.classSelect.values}}</select></div></div><div class="section sectionType"><div class="heading">{{headings.type}}</div><div class="row changeType clearfix"><label for="{{input.content_type.id}}" class="alignLeft">{{input.content_type.label}}</label><select name="{{input.content_type.id}}" id="{{input.content_type.id}}" class="alignLeft">{{#input.content_type.values}}<option value="{{value}}"{{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.content_type.values}}</select></div><div class="row changeType clearfix {{input.template.className}}"><label for="{{input.template.id}}" class="alignLeft">{{input.template.label}}</label><select name="{{input.template.id}}" id="{{input.template.id}}" class="alignLeft">{{#input.template.values}}<option value="{{value}}"{{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.template.values}}</select></div></div>',
  bodycopy_conditions_popup: '<div class="section sectionOverall"><div class="heading">{{headings.section_name}}</div><div class="row clearfix changeEnable"><label for="{{input.enable.id}}" class="alignLeft">{{input.enable.label}}</label><div class="alignRight"><div class="enabledSlider"></div></div></div><div class="row condsDisabled {{input.enable.not_applied_class}}"><div class="message">' + EasyEditLocalise._("Display conditions will not be applied") + '</div></div><div class="row clearfix changeLogicalOpGroups"><label for="{{input.logical_op_groups.id}}">{{input.logical_op_groups.label}}</label><select name="{{input.logical_op_groups.id}}" id="{{input.logical_op_groups.id}}">{{#input.logical_op_groups.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.logical_op_groups.values}}</select></div></div>{{&groupsHTML}}{{^groupsHTML}}<div class="section nothingSet"><div class="message">' +
    EasyEditLocalise._("No conditions have been added") + '</div></div>{{/groupsHTML}}<div class="section addGroupRow"><div class="row clearfix buttonRow">{{&buttons.add_group}}</div></div>',
  bodycopy_conditions_group: '<div class="section sectionGroup conditionGroup"><div class="delete" title="' + EasyEditLocalise._("Delete this condition group") + '">' + EasyEditLocalise._("Delete this condition group") + '</div><div class="heading">{{headings.section_name}}</div><div class="row clearfix changeLogicalOp"><label for="{{input.logical_op.id}}">{{input.logical_op.label}}</label><select name="{{input.logical_op.id}}" id="{{input.logical_op.id}}">{{#input.logical_op.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.logical_op.values}}</select></div><div class="changeConditionsSide alignLeft">{{conditions_label}}</div>{{&conditionsHTML}}{{^conditionsHTML}}<div class="section nothingSet"><div class="message">' +
    EasyEditLocalise._("No conditions have been added") + '</div></div>{{/conditionsHTML}}<div class="row clearfix buttonRow">{{&buttons.add_condition}}</div></div>',
  bodycopy_conditions_condition: '<div class="row clearfix changeCondition"><div class="delete" title="' + EasyEditLocalise._("Delete this condition") + '">' + EasyEditLocalise._("Delete this condition") + '</div><select name="{{input.id}}" id="{{input.enable.id}}" class="alignLeft">{{#input.values}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{text}}</option>{{/input.values}}</select></div>',
  standard_page_bodycopy: '<{{tag}} class="{{class}}"><div class="bodycopy_content_wrapper clearfix"{{#rtl}} dir="rtl"{{/rtl}}>{{&content}}</div></{{tag}}>',
  bodycopy_nested_content: '<div id="{{id}}" class="{{class}}"><a class="guiButton light alignRight showButton" href="#">{{show_button}}</a><div class="bodycopy_nested_content_picker"></div><div class="bodycopy_nested_additional_get clearfix"><div class="dynamic_nest_get"><span class="title">{{dynamic_get.title}}</span><p class="description">{{dynamic_get.description}}</p><div class="get_parameter_input">{{#dynamic_get.input}}<label for="{{id}}">{{label}}</label><input id="{{id}}" name="{{id}}" value="{{value}}" />{{/dynamic_get.input}}</div></div><div class="bodycopy_paint_layout clearfix"><span class="title">{{layout.title}}</span><p class="description">{{layout.description}}</p><div class="layout_type clearfix screenHide"><select name="layout_type">{{#layout.types}}<option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{description}}</option>{{/layout.types}}</select><select name="layout_list" class="layout_list screenHide">{{#layout.list}}<option value="{{id}}" {{#selected}}selected="selected"{{/selected}}>{{name}}</option>{{/layout.list}}</select></div></div><div class="additional_get_container"><span class="title">{{additional_get.title}}</span><p class="description">{{additional_get.description}}</p><div class="bodycopy_nested_params clearfix">{{#additional_get.params}}<div class="nested_param clearfix"><div class="name nested_param_part"><label for="">{{name.label}}</label><input name="{{name.id}}" id="{{name.id}}" value="{{name.value}}" type="text" /></div><div class="value nested_param_part"><label for="">{{value.label}}</label><input name="{{value.id}}" id="{{value.id}}" value="{{value.value}}" type="text" /></div><div class="delete nested_param_part"><a href="#" class="deleteButton" title="{{delete_title}}"><div class="screenHide">{{delete_title}}</div></a></div></div>{{/additional_get.params}}</div><a href="#" class="guiButton light addNewParam alignLeft">{{additional_get.add}}</a><p class="note clearBoth">{{additional_get.note}}</p></div></div></div>{{#form_nesting_warning}}<div id="ees_nestedContentsWarning"><div class="nestedWarning clearfix"><p class="warningMessage"><strong>Warning: </strong>{{formNestedMessage}}</p></div></div>{{/form_nesting_warning}}',
  news_content: '<div id="{{wrapper_id}}"><div id="{{container_id}}" class="ees_newsContentContainer">{{#editing_divs}}<div class="bodycopy_manager_div content_type_wysiwyg"><div class="bodycopy_tools clearfix"><span class="bodycopy_type">{{heading}}</span></div><div id="news_item_{{assetid}}_{{heading}}" class="bodycopy_content htmlarea-div clearfix" data-keywords="{{data_keywords}}" data-snippets="{{data_snippets}}" >{{&content}}</div></div>{{/editing_divs}}</div></div>',
  calendar_content: '<div id="{{wrapper_id}}"><div id="{{container_id}}" class="ees_calendarContentContainer"><div class="bodycopy_manager_div content_type_wysiwyg"><div class="bodycopy_tools clearfix"><span class="bodycopy_type">{{heading}}</span></div><div id="calendar_{{assetid}}_{{heading}}" class="bodycopy_content htmlarea-div clearfix" data-keywords="{{data_keywords}}" data-snippets="{{data_snippets}}" >{{&content}}</div></div></div></div>',
  context_switcher: '<a id="{{id}}" class="toolbarButton noright" title="{{title}}"><span class="screenHide">{{label}}: </span><span class="name">{{current}}</span><span class="icon"></span></a><span class="screenHide"> | </span>',
  context_switcher_list: '<div id="{{id}}">{{#contexts}}<div class="{{className}} tooltipMessage context clearfix" data-context-id="{{val}}" title="{{name}}"><a href="#" class="button alignRight">{{change_to}}</a><span class="name alignLeft">{{name}}</span></div>{{/contexts}}</div>',
  condition_switcher: '<a id="{{id}}" title="{{title}}"><span class="screenHide">{{label}}</span><span class="icon"></span></a><span class="screenHide"> | </span>',
  condition_switcher_list: '<div id="{{id}}">{{#conditions}}<div class="tooltipMessage condition clearfix" data-conditionid="{{val}}" title="{{name}}"><a href="#" class="guiButton light alignRight noleft offOption {{offSel}}">{{off}}</a><a href="#" class="guiButton light alignRight noleft noright onOption {{onSel}}">{{on}}</a><a href="#" class="guiButton autoOption light alignRight noright {{autoSel}}">{{default}}</a><span class="name alignLeft">{{name}}</span></div>{{/conditions}}</div>',
  context_global_field_warning: '<div class="context-global-field-warning"><div class="context-warning-inner"><div class="message">{{&message}}<div><a class="button" href="#"><span class="button-inner">{{button}}</span></a></div></div>',
  asset_search_searchbox: '<div class="clearfix asset-search-container" id="ees_assetSearch"><div class="asset-search-header clearfix" id="ees_assetSearch_searchbox"><input class="asset-search-box" name="{{search_string.id}}" id="{{search_string.id}}" value="{{search_string.value}}" placeholder="{{search_string.placeholder}}" type="text" />{{&search_button}}</div>{{&filters}}<div class="asset-search-results-wrapper">{{&results}}</div>{{&pager}}{{&failed}}</div>',
  asset_search_results: '<div class="asset-search-results">{{#assets}}<div class="asset-search-item-wrapper clearfix" data-assetid="{{id}}"><div class="locate-in-asset-finder"><i>{{open_finder_text}}</i></div><a href="{{asset_url}}" title="{{type.name}}"><div class="asset-search-item-link"><div class="asset-search-item-icon ees_assetType {{type.code}}" title="{{type.name}}"><span class="screenHide">{{type.name}}</span></div><div class="asset-search-title-and-location"><div class="asset-search-item-title" title="{{name}}">{{name}} <span class="screenHide">(' +
    EasyEditLocalise._("Asset ID:") + ' </span><span class="asset-search-item-assetid">#{{id}}</span><span class="screenHide">)</span></div><div class="asset-search-item-path" title="{{lineage}}">{{lineage}}</div></div></div></a></div>{{/assets}}</div>',
  asset_search_filters: '<div class="asset-finder-filters"><div class="asset-search-summary"></div><span class="filters-label">{{filter_name}}</span><div class="filter-btn filter-{{file.status}} filter-generic"><i>{{file.title}}</i></div><div class="filter-btn filter-{{news.status}} filter-news"><i>{{news.title}}</i></div><div class="filter-btn filter-{{folder.status}} filter-folder"><i>{{folder.title}}</i></div><div class="filter-btn filter-{{event.status}} filter-event"><i>{{event.title}}</i></div><div class="filter-btn filter-{{image.status}} filter-image"><i>{{image.title}}</i></div><div class="filter-btn filter-{{page.status}} filter-page"><i>{{page.title}}</i></div></div>',
  asset_search_pager: '<div class="asset-search-pagination"><a href="#" class="pagination-btn pagination-previous {{prev.disable}}" title="{{prev.title}}"><span class="screenHide">{{prev.title}}</span></a><span class="pagination-label">' + EasyEditLocalise._("Page %1 of %2", '<span class="pagination-page-no">{{page_number}}</span>', '<span class="pagination-page-total">{{page_total}}</span>') + '</span><a href="#" class="pagination-btn pagination-next {{next.disable}}" title="{{next.title}}"><span class="screenHide">{{next.title}}</span></a></div>',
  asset_search_failed: '<div class="asset-search-failed"><p>' + EasyEditLocalise._('We were unable to match your search - <strong><em class="search-text"></em></strong> - to any assets.') + "</p><p>" + EasyEditLocalise._("Suggestions:") + "</p><ul><li>" + EasyEditLocalise._("Make sure the spelling of all words is correct.") + "</li><li>" + EasyEditLocalise._("Try different keywords.") + "</li><li>" + EasyEditLocalise._("Turn off any active filters.") + "</li></ul></div>",
  details_screen_section: '<h3 class="sectionHeading">{{title}}</h3><div class="details-screen-section clearfix">{{#rows}}<div class="row" data-attr="{{attr}}" data-type="{{type}}" {{#bindTo}}data-bind="{{bindTo}}" data-bind-action="{{bindAction}}" data-bind-value="{{bindValue}}"{{/bindTo}}><div class="cellName">{{&cellName}}</div><div class="cellData">{{&cellData}}{{#note}}<span class="note">{{.}}</span>{{/note}}</div></div>{{/rows}}</div>',
  details_screen_section_attr_name_default: '<div class="details-screen-attr-label">{{title}}</div>',
  details_screen_section_attr_data_default: EasyEditLocalise._("Something went wrong here"),
  details_screen_section_attr_data_slider: '<div class="slider-target" data-default-value="{{value}}" data-selected="{{value}}">{{textValue}}</div>',
  details_screen_section_attr_data_text: '<input type="text" value="{{value}}" name="" id="" class="inputText" />',
  details_screen_section_attr_data_numeric: '<input type="text" value="{{value}}" name="" id="" class="inputText inputNumeric" />',
  custom_form_read_only: '<div class="custom-form__read-only"><div class="custom-form-questions">{{#unattached}}<div class="custom-form-question__read-only"><div class="title alignLeft">{{name}}</div><div class="type alignRight">{{type}}</div></div>{{/unattached}}</div><div class="custom-form-sections">{{#sections}}<div class="custom-form-section__inner"><div class="custom-form-section__title"><h2 class="custom-form-section__header">{{title}}</h2></div>{{#questions}}<div class="custom-form-question__read-only"><div class="title alignLeft">{{name}}</div><div class="type alignRight">{{type}}</div></div>{{/questions}}</div>{{/sections}}</div></div>',
  custom_form_unattached_header: '<div class="custom-form-questions__header"><span class="">' + EasyEditLocalise._("Form Fields") + "</span></div>",
  custom_form_unattached: '<div class="custom-form-questions"><div class="custom-form-questions__question-list custom-form__parent" data-id="{{id}}"></div></div>',
  custom_form_section_wrapper: '<div class="custom-form-sections"></div>',
  custom_form_section: '<div class="custom-form-section"><div class="custom-form-section__insert-widget"><div class="custom-form-section__insert-button">Insert Section</div><div class="custom-form-section__separator"></div></div><div class="custom-form-section__inner"><div class="custom-form-section__title"><h2 class="custom-form-section__header"><div class="viper-editable">{{title}}</div><span class="editable-icon"></span><span class="custom-form-section__sub-title">{{subtitle}} #<span class="order">{{order}}</span></span></h2></div><ul class="custom-form-section__edit-tools"><li class="custom-form-section__drag-handle" title="' +
    EasyEditLocalise._("Reorder Sections") + '"></li><li class="custom-form-section__remove-button" title="' + EasyEditLocalise._("Remove Section") + '"></li></ul><div class="custom-form-section__question-list custom-form__parent" data-id="{{id}}"></div></div><div class="custom-form__deletion-overlay"></div></div>',
  custom_form_question: '<div class="custom-form-question {{^exists}}custom-form-question__new{{/exists}}" data-id="{{id}}" data-type="{{type}}"><div class="custom-form__deletion-overlay"></div><ul class="custom-form-question__edit-tools ees-button-group"><li class="ees-button-group__button custom-form-question__settings-button" title="' +
    EasyEditLocalise._("Edit Question Settings") + '"></li>{{#supported}}<li class="ees-button-group__button custom-form-question__clone-button" title="' + EasyEditLocalise._("Clone Question") + '"></li>{{/supported}}<li class="ees-button-group__button custom-form-question__remove-button" title="' + EasyEditLocalise._("Remove Question") + '"></li></ul><div class="custom-form-question__drag-handle"></div>{{#supported}}<div class="custom-form-question__type-switcher" data-morphed="{{is_morphed}}"><a href="#" class="custom-form-question__type-switcher-button custom-form-question__type-{{type}}" title="{{typeFriendly}}"><span class="screenHide">{{typeFriendly}}</span></a></div>{{/supported}}<div class="custom-form-question__inline-editable"><div class="custom-form-question__title viper-editable">{{attributes.name}}</div><span class="editable-icon"></span></div><div class="custom-form-question__inline-editable"><em class="custom-form-question__note viper-editable">{{attributes.note}}</em><span class="editable-icon"></span></div><a class="custom-form-question__note-cta"><span class="icon"></span>' +
    EasyEditLocalise._("Add a field note") + '</a><div class="custom-form-question__preview">{{^supported}}<div class="custom-form-question__unsupported-message">This question type has properties that can only be edited via the admin interface</div>{{/supported}}</div><div class="custom-form-question__insert-widget"><div class="custom-form-question__insert-button">' + EasyEditLocalise._("Insert Form Field") + '</div><div class="custom-form-question__separator"></div></div></div>',
  custom_form_add_new_question: '<div class="custom-form__add-new-question"><a href="#" class="custom-form__add-new-question-button">' +
    EasyEditLocalise._("Insert Form Field") + "</a></div>",
  custom_form_add_new_section: '<div class="custom-form__add-new-section"><a href="#" id="{{id}}" class="custom-form__add-new-section-button">' + EasyEditLocalise._("Insert Form Section") + "</a></div>",
  custom_form_add_new_section_modal: '<div class="custom-form-modal__add-section"><div class="alignLeft">' + EasyEditLocalise._("Section Name") + '</div><div class="alignRight"><input type="text" name="insert_section" class="inputText" /></div></div>',
  custom_form_question_unsupported: '<div class="custom-form-question__unsupported"><span class="message">' +
    EasyEditLocalise._("This question type is unsupported for editing") + "</span></div>",
  custom_form_modal_buttons: '<a href="#" class="guiButton light alignLeft button-cancel">' + EasyEditLocalise._("Close") + '</a><a href="#" class="guiButton default alignRight button-update">' + EasyEditLocalise._("Update") + "</a>",
  custom_form_modal_insert_buttons: '<a href="#" class="guiButton light alignLeft button-cancel">' + EasyEditLocalise._("Cancel") + '</a><a href="#" class="guiButton default alignRight button-insert">' +
    EasyEditLocalise._("Insert") + "</a>",
  custom_form_question_preview_text: '{{#showTextType}}<span class="custom-form-question__preview-text-type" title="' + EasyEditLocalise._("Text type set as %1", "{{attributes.text_type}}") + '"></span>{{/showTextType}}{{^multi}}<input name="preview_{{parent}}_{{id}}" type="text" size="{{width}}" value="{{value}}" class="inputText live-attr" data-attribute="default" placeholder="{{placeholder}}"/>{{/multi}}{{#multi}}<textarea name="preview_{{parent}}_{{id}}" rows="{{height}}" cols="{{width}}" class="live-attr" data-attribute="default" placeholder="{{placeholder}}">{{value}}</textarea>{{/multi}}',
  custom_form_question_preview_email_address: '{{#showTextType}}<span class="custom-form-question__preview-text-type" title="' + EasyEditLocalise._("Text type set as %1", "{{attributes.text_type}}") + '"></span>{{/showTextType}}<input name="preview_{{parent}}_{{id}}" type="email" size="{{width}}" value="{{value}}" class="inputText live-attr" data-attribute="default" placeholder="{{placeholder}}"/>',
  custom_form_question_preview_select: '<div class="custom-form-question__select"><select name="custom-form-select_{{parent}}_{{id}}" {{#attributes.multiple}}multiple{{/attributes.multiple}}>{{#attributes.allow_empty}}<option value="{{attributes.empty_key}}" class="empty-value" {{#emptyIsDefault}}selected{{/emptyIsDefault}}>{{attributes.empty_text}}</option>{{/attributes.allow_empty}}{{#values}}<option value="{{key}}" {{#isDefault}}selected{{/isDefault}}>{{value}}</option>{{/values}}</select></div>',
  custom_form_question_preview_option_list: '<ul class="custom-form-question__option-list">{{#values}}<li class="custom-form-question__option-list-item"><input type="radio" id="{{parent}}_{{id}}_{{internal_id}}" name="custom-form-question__option-list_{{parent}}_{{id}}[]" value="{{key}}" {{#isDefault}}checked{{/isDefault}} /><label for="{{parent}}_{{id}}_{{internal_id}}">{{value}}</label></li>{{/values}}</ul>',
  custom_form_question_preview_tickbox_list: '<ul class="custom-form-question__tickbox-list">{{#values}}<li class="custom-form-question__tickbox-list-item"><input type="checkbox" id="{{parent}}_{{id}}_{{internal_id}}" name="custom-form-question__tickbox-list_{{parent}}_{{id}}[]" value="{{key}}" {{#isDefault}}checked{{/isDefault}} /><label for="{{parent}}_{{id}}_{{internal_id}}">{{value}}</label></li>{{/values}}</ul>',
  custom_form_question_preview_country: '<div class="custom-form-question__select"><select name="countries" {{#attributes.multiple}}multiple{{/attributes.multiple}}>{{#selectedCountries}}<option value="{{code}}" {{#selected}}selected{{/selected}}>{{name}}</option>{{/selectedCountries}}</select></div>',
  custom_form_question_preview_datetime: '<div class="custom-form-question__datetime">{{^valid}}<div class="message">' + EasyEditLocalise._('Day, Month and Year must be configured to "show" before a default can be set') +
    '</div>{{/valid}}{{#valid}}{{#parts}}<div class="custom-form-question__datetime-part"><label for="part_{{parent}}_{{id}}">{{label}}</label>{{&input}}</div>{{/parts}}{{/valid}}</div>',
  custom_form_question_preview_file_upload: '<div>{{#attributes.create_location}}<input type="file" />{{/attributes.create_location}}</div>',
  custom_form_modal_question_type_list: '<ul class="custom-form-modal__question-type-list">{{#types}}<li class="custom-form-modal__question-type-item" data-type="{{type}}"><span class="custom-form-modal__question-type-icon custom-form-question__type-{{type}}"></span>{{text}}</li>{{/types}}</ul>',
  custom_form_modal_question_generic: '<div class="row custom-form-modal__question-title">{{attributes.name}}</div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Required field") + '</div><div class="alignRight custom-form-modal__slider" data-id="required" data-attribute="is_required"></div></div><div class="row"><div class="custom-form-modal__required-text-label">' + EasyEditLocalise._("Custom error message for required field") + '</div><div class="custom-form-modal__required-text-input"><textarea rows="4" class="custom-form-modal__required-text inputText live-attr" data-attribute="cust_required_error" data-default="">{{attributes.cust_required_error}}</textarea></div></div>',
  custom_form_modal_question_text: '<div class="row"><div class="alignLeft">' + EasyEditLocalise._("Placeholder") + '</div><div class="alignRight"><input type="text" size="20" class="inputText widthInput live-attr longInputText" value="{{attributes.placeholder}}"  min="1" step="1"  data-default="" data-attribute="placeholder"  /></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Text type") + '</div><div class="alignRight custom-form-modal__text-type-container"></div></div><div class="row"><div class="alignLeft">' +
    EasyEditLocalise._("Maximum characters") + '</div><div class="alignRight"><input type="text" size="3" class="inputText maxCharInput live-attr" value="{{attributes.max}}"  min="1" step="1" pattern="d+" data-default="300" data-attribute="max" data-parser="integer" /></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Width") + '</div><div class="alignRight"><input type="text" size="3" class="inputText widthInput live-attr" value="{{attributes.width}}"  min="1" step="1" pattern="d+" data-default="30" data-attribute="width" data-parser="integer" /></div></div><div class="row"><div class="alignLeft">' +
    EasyEditLocalise._("Multiple lines") + '</div><div class="alignRight custom-form-modal__multi-line-slider"></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Number of lines") + '</div><div class="alignRight"><input type="text" size="3" class="inputText multiLineInput live-attr" value="{{attributes.height}}"  min="1" step="1" pattern="d+" data-default="1"  data-attribute="height" data-parser="integer" /></div></div>',
  custom_form_modal_question_email_address: '<div class="row"><div class="alignLeft">' +
    EasyEditLocalise._("Placeholder") + '</div><div class="alignRight"><input type="text" size="20" class="inputText widthInput live-attr longInputText" value="{{attributes.placeholder}}"  min="1" step="1"  data-default="" data-attribute="placeholder"  /></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Text type") + '</div><div class="alignRight custom-form-modal__text-type-container"></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Width") + '</div><div class="alignRight"><input type="text" size="3" class="inputText widthInput live-attr" value="{{attributes.width}}"  min="1" step="1" pattern="d+" data-default="30" data-attribute="width" data-parser="integer" /></div></div>',
  custom_form_modal_question_select: '<div class="row"><div class="alignLeft">' + EasyEditLocalise._("Allow multiple selections") + '</div><div class="alignRight custom-form-modal__slider" data-id="multiSelect" data-attribute="multiple"></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Include empty option") + '</div><div class="alignRight custom-form-modal__slider" data-id="allowEmpty" data-attribute="allow_empty"></div></div><div class="row custom-form-modal__empty-row screenHide"><div class="alignLeft">' +
    EasyEditLocalise._("Empty option name") + '</div><div class="alignRight custom-form-modal__empty-option-text"><input type="text" class="inputText" value="{{attributes.empty_text}}" /></div></div><div class="row custom-form-modal__empty-row screenHide"><div class="alignLeft">' + EasyEditLocalise._("Empty option value") + '</div><div class="alignRight custom-form-modal__empty-option-value"><input type="text" class="inputText" value="{{attributes.empty_key}}" /></div></div><div class="row"><h2 class="custom-form-modal__values-header">' +
    EasyEditLocalise._("Values") + '</h2><div class="custom-form-question__option-widget"></div></div>',
  custom_form_modal_question_option_list: '<div class="row"><h2 class="custom-form-modal__values-header">' + EasyEditLocalise._("Values") + '</h2><div class="custom-form-question__option-widget"></div></div>',
  custom_form_modal_question_tickbox_list: '<div class="row"><h2 class="custom-form-modal__values-header">' + EasyEditLocalise._("Values") + '</h2><div class="custom-form-question__option-widget"></div></div>',
  custom_form_modal_question_country: '<div class="row"><div class="alignLeft">' + EasyEditLocalise._("Allow multiple selections") + '</div><div class="alignRight custom-form-modal__slider" data-id="multiSelect" data-attribute="multiple"></div></div><div class="row"><h2 class="custom-form-modal__values-header">' + EasyEditLocalise._("Available countries") + '</h2><select name="countries" multiple>{{#countries}}<option value="{{code}}">{{name}}</option>{{/countries}}</select></div>',
  custom_form_modal_question_file_upload: '<div class="row"><div class="">' +
    EasyEditLocalise._("Select storage location") + '</div><div class="custom-form-modal__destination"></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Attach to emails") + '</div><div class="alignRight custom-form-modal__slider" data-id="attach" data-attribute="attach_to_mail"></div></div><div class="row"><div class="alignLeft">' + EasyEditLocalise._("Overwrite rule") + '</div><div class="alignRight"><select name="overwrite"><option value="0">' + EasyEditLocalise._("Overwrite existing file") +
    '</option><option value="R">' + EasyEditLocalise._("Rename uploaded file") + '</option><option value="D" selected>' + EasyEditLocalise._("Raise a submission error") + "</option></select></div></div>",
  custom_form_modal_question_datetime: '<div class="row"><div class="alignLeft">' + EasyEditLocalise._("12 hour time%1", "?") + '</div><div class="alignRight custom-form-modal__slider" data-id="military"></div></div><div class="row custom-form-modal__table-row"></div>',
  custom_form_modal_date_input: '<input type="text" value="{{value}}" maxlength="{{max}}" class="inputText {{name}}" />',
  custom_form_modal_date_select: '<select class="{{name}}"><option value=""></option>{{#options}}<option value="{{value}}" {{#selected}}selected{{/selected}}>{{name}}</option>{{/options}}</select>',
  custom_form_modal_question_datetime_table: '<table class="custom-form-modal__table"><thead><tr><th></th><th>Day</th><th>Month</th><th>Year</th><th>Hour</th><th>Minute</th><th>Second</th></tr></thead><tbody><tr class="custom-form-modal__table-row-checkboxes"><th>' + EasyEditLocalise._("Use") + '</th>{{#show}}<td><input type="checkbox" class="show" data-id="{{key}}" {{#value}}checked{{/value}} value="1"></td>{{/show}}</tr><tr class="custom-form-modal__table-row-checkboxes"><th>' +
    EasyEditLocalise._("Allow blank") + '</th>{{#allowBlank}}<td><input type="checkbox" class="allowBlank" data-id="{{key}}" {{#value}}checked{{/value}} value="1"></td>{{/allowBlank}}</tr><tr class="custom-form-modal__table-row-checkboxes"><th>' + EasyEditLocalise._("Display as text") + '</th>{{#textBox}}<td><input type="checkbox" class="textBox" data-id="{{key}}" {{#value}}checked{{/value}} value="1"></td>{{/textBox}}</tr></tbody></table>',
  custom_form_modal_question_datetime_table_row: '<tr class="custom-form-modal__table-row-date" data-id="{{id}}"><th>{{name}}</th>{{#parts}}<td>{{&.}}</td>{{/parts}}</tr>',
  custom_form_section_reorder_item: '<li class="custom-form-section__sort-item"><div class="custom-form-section__sort-item-drag-handle" title="' + EasyEditLocalise._("Click and drag to re-order") + '"></div><div class="custom-form-section__sort-item-name">{{name}}</div></li>',
  custom_form_email_destructive_warning: '<div class="destructive-message">{{message}}</div><div class="destructive-hide-prompt"><input type="checkbox" id="hide-ok-{{id}}" class="destructive-hide-prompt__input" /><label for="hide-ok-{{id}}">' +
    EasyEditLocalise._("Don't show this warning again") + "</label></div>",
  custom_form_export_logs: '<h3 class="sectionHeading">' + EasyEditLocalise._("Export Submission Logs") + '</h3><div id="ees_formExport"><iframe name="ees_iframeExport" id="ees_iframeExport" src="javascript: false;" class="screenHide"></iframe><form action="{{path}}" method="post" target="ees_iframeExport" enctype="multipart/form-data" encoding="multipart/form-data">{{#hidden}}<input type="hidden" id="{{key}} name="{{key}}" value="{{value}}" />{{/hidden}}<div class="row">{{&matrixContent}}</div></form></div>',
  custom_form_email_bodycopy: '<div id="{{id}}" class="custom-form-email"><h2 class="custom-form-email__heading">{{heading}}</h2>{{#rows}}<div class="row"><div class="cell custom-form-email__label">{{label}}</div><div class="cell custom-form-email__input"><div class="custom-form-email__content">{{&content}}</div><div class="custom-form-email__note">{{note}}</div></div></div>{{/rows}}<div class="custom-form-email__body-row"><div class="custom-form-email__label">' + EasyEditLocalise._("Email Content") + '</div><div class="custom-form-email__body"><div class="custom-form-email__body-header"><div class="custom-form-email__body-text-slider"></div><div class="custom-form-email__body-status-text">{{statusText}}</div></div>{{&viperTextarea}}<div class="custom-form-email__body-viper"><div class="viper-editable">{{&viperContent}}</div></div><div class="custom-form-email__body-text-only screenHide">{{&textBody}}</div></div><div class="custom-form-email__note"><p>' +
    EasyEditLocalise._("To output a summary you may use the following keywords:") + "</p><ul><li><em>%form_info%</em> - " + EasyEditLocalise._("a list of form information including the asset id, name and URL of the form, and the name and asset id of the site") + "</li><li><em>%form_summary%</em> - " + EasyEditLocalise._("a list of responses received from this submission") + "</li></ul></div><div></div>",
  custom_form_email_address_list_item: '<li class="custom_form_email__sortable-item"><div class="custom_form_email__sortable-drag-handle"></div><div class="custom_form_email__sortable-input">{{#input}}<input class="inputText" type="text" value="" />{{/input}}</div><a href="#" class="custom_form_email__sortable-delete-button" title="' +
    EasyEditLocalise._("Delete Address") + '"><span class="screenHide">' + EasyEditLocalise._("Delete") + "</span></a></li>",
  option_widget: '<div class="ees-option-widget {{#keyEditable}}ees-option-widget__key-editable{{/keyEditable}}"><div class="ees-option-widget__header ees-option-widget__row"><div class="ees-option-widget__column">' + EasyEditLocalise._("Name") + '</div>{{#keyEditable}}<div class="ees-option-widget__column">' + EasyEditLocalise._("Value") + '</div>{{/keyEditable}}</div><ul class="ees-option-widget__list"></ul><div class="ees-option-widget__add-button"><span class="ees-option-widget__add-button-icon"></span>{{add_label}}</div></div>',
  option_widget_item: '<li class="ees-option-widget__row"><div class="ees-option-widget__column ees-option-widget__drag-column"><div class="ees-option-widget__drag-handle"></div></div><div class="ees-option-widget__column ees-option-widget__name-column"><div class="ees-option-widget__display-value">{{value}}</div><input class="ees-option-widget__input-value screenHide" value="{{value}}" /></div>{{#keyEditable}}<div class="ees-option-widget__column ees-option-widget__value-column"><div class="ees-option-widget__display-value">{{key}}</div><input class="ees-option-widget__input-value screenHide" value="{{key}}" /></div>{{/keyEditable}}<div class="ees-option-widget__column ees-option-widget__delete-column"><a href="#" class="ees-option-widget__delete-button" title="' +
    EasyEditLocalise._("Delete") + '"><span class="screenHide">' + EasyEditLocalise._("Delete") + "</span></a></div></li>",
  tab_screen_widget: '<div class="ees-tab-screen"><ul class="ees-tab-screen__nav">{{#tabs}}<li class="ees-tab-screen__nav-item"><a href="#" class="ees-tab-screen__nav-button {{#disabled}}disabled{{/disabled}}" data-id="{{id}}">{{name}}</a></li>{{/tabs}}</ul><div class="ees-tab-screen__content">{{#tabs}}<div class="ees-tab-screen__tab {{#disabled}}disabled{{/disabled}}" data-id="{{id}}">{{#disabled}}<div id="ees_screenWarning" class="clearfix"><div id="ees_screenWarningContents"><p class="warningMessage">{{&disabledMessage}}</p></div></div>{{/disabled}}</div>{{/tabs}}</div></div>'
};
var EasyEditScreens = {
    assetTypes: {},
    workspaces: {},
    screen: {},
    currentScreen: null,
    currentScreenName: null,
    currentScreenType: null,
    currentAssetType: null,
    interval: null,
    lockResponses: null,
    _savingCurrentScreen: !1,
    _currentScreenWarnings: !1,
    init: function(a) {
      var b = this,
        c = "asset",
        d = EasyEditConfig.hasOwnProperty("defaultScreen") ? EasyEditConfig.defaultScreen : "details",
        e = EasyEditUrl.getURL(),
        f = "string" === typeof e.params.asset_ei_screen ? e.params.asset_ei_screen : d,
        f = "string" === typeof e.params.screen ? e.params.screen :
        f,
        f = EasyEditUrl.hash.isset("screen") ? EasyEditUrl.hash.get("screen") : f,
        f = "undefined" === typeof f ? d : f;
      EasyEditDebug.log("EasyEditScreens.init", f, e.params.screen);
      EasyEditAssetManager.getCurrentAsset(function(e) {
        var j = e.attribute("type_code");
        if (EasyEditWorkspaceManager.isWorkspace(e)) {
          c = "workspace";
          var h = EasyEditWorkspaceManager.getWorkspaceFromRootNode(e.id);
          "string" === typeof h.type && (j = h.type)
        }
        var h = "workspace" === c ? "workspaces" : "assetTypes",
          j = EasyEditScreens[h].hasOwnProperty(j) ? j : "defaultAsset",
          k =
          EasyEditScreens[h][j];
        f = b.getValidScreenName(k.getConfig(), f.replace(/%20/g, " "), d);
        jQuery("#ees_eesUi").attr("class", f.toLowerCase());
        jQuery("#" + EasyEditComponents.contentWrapperId).append(b._getTemplate());
        b.doInitLoadScreen(e, k, f, c, function() {
          b.buildMenu(k, f);
          a.call(this)
        })
      })
    },
    getDefaultScreenForObject: function(a) {
      var b = EasyEditConfig.defaultScreen,
        a = a.getConfig(),
        c;
      for (c in a) a[c].isDefault && (b = c);
      return b
    },
    buildMenu: function(a, b) {
      var c = a.getConfig(),
        d;
      for (d in c)
        if (c.hasOwnProperty(d)) {
          var e =
            c[d],
            f = "ees_screenMenu" + e.objectName;
          this._buildMenuItem(f, e.className, d, e.displayName, b === d ? !0 : !1);
          "function" === typeof e.overrideFn && jQuery("#" + f).addClass("override").click(e.overrideFn)
        }
    },
    doInitLoadScreen: function(a, b, c, d, e) {
      var f = this,
        g = new EasyEditAPI,
        j = b.getConfig(),
        b = !1,
        c = f.getValidScreenName(j, c.replace(/%20/g, " "), EasyEditConfig.defaultScreen);
      f.currentScreenName = c;
      "asset" === d && !("Up For Review" === a.attribute("status") && a.hasWorkflowApplied) && (b = !0, a.acquireLock("all", g));
      !1 === b && !0 === a.hasWorkflowApplied &&
        "Admin Access" === a.attribute("maximum_perm_on_asset") && a.acquireLock("workflow", g);
      var h = EasyEditScreens.screen[j[c].objectName];
      f.setCurrentScreen(j[c].objectName);
      g.run(function(b) {
        f._checkWorkflow(a);
        var d = false;
        f._checkLive(a);
        if (b !== null && b[0].fnName === "acquireLock") {
          f.notifyLock(b[0].data);
          f.getLockError(function(b) {
            b !== null && !f._checkWorkflow(a) && f.displayWarning({
              message: b
            })
          })
        }
        d = f._checkReadOnly(a);
        h.init("#ees_screenContent", d, function() {
          EasyEdit.util.isFunction(h.detectScreenEdits) === true ?
            h.detectScreenEdits() : EasyEditComponentsToolbar.detectScreenEdits();
          f.setCurrentScreen(j[c].objectName);
          EasyEditEventManager.trigger("EasyEditScreenLoad");
          e.call(this);
          f._attachEvents();
          var a = EasyEdit.systemInfo.maintenance;
          if (a.notify || a.enabled) {
            a = '<div id="ees_screenWarning_maintenance" class="clearfix"><div class="warningMessage clearfix alignLeft">' + a.message;
            "</div>";
            "</div>";
            jQuery("#main_form").before(a)
          }
          f._adjustWarningWidth()
        })
      }, g.runMode.BATCH)
    },
    getValidScreenName: function(a, b, c) {
      var d =
        0,
        e = !1,
        f;
      for (f in a) {
        0 === d && (firstScreen = f);
        if (f.toLowerCase() === b.toLowerCase()) return f;
        f.toLowerCase() === c.toLowerCase() && (e = !0);
        d += 1
      }
      return e ? c : firstScreen
    },
    saveCurrentScreen: function(a) {
      var b = this;
      EasyEditScreens.getCurrentScreen().save(function(c, d, e) {
        var f = "";
        if (1 <= d.length)
          for (var g = 0, j = d.length; g < j; g++) f += "<div>" + ("object" === typeof d[g] ? d[g].error : d[g]) + "</div>";
        c ? (EasyEditComponentsToolbar.disableSaveButton(), "undefined" !== typeof e && "function" === typeof e.onSave && e.onSave.call(this), EasyEditComponentsInfoBox.refresh(function() {
          if ("undefined" !==
            typeof e && !1 === e.refresh) EasyEditOverlay.showOverlay("success", {
            timeout: 1E3
          }), a.call(this);
          else {
            var c = EasyEditScreens.currentScreen;
            EasyEditAssetManager.getCurrentAsset(function(d) {
              var e = new EasyEditAPI;
              e.queue("getPermissions", {
                asset_id: d.id,
                level: 1
              });
              e.expect(1).run(function(e) {
                e = e[0].data;
                e.hasOwnProperty("errorCode") && "permissionError" === e.errorCode ? (EasyEditOverlay.showOverlay("success", {
                  timeout: 1E3
                }), d.releaseLock("all", function() {
                  setTimeout(function() {
                    var a = {
                      message: '<p class="confirmMessage">' +
                        EasyEditLocalise._("The screen saved successfully, but you no longer have read access to this asset.") + "<br/><br/>" + EasyEditLocalise._("This could be because of changed group or role assignments, or because you only had temporary access via a workflow so that you could approve or reject changes.") + "</p>",
                      title: EasyEditLocalise._("No Read Access"),
                      confirmText: EasyEditLocalise._("Reload Screen"),
                      cancelText: null,
                      cssClass: "noReadAccess",
                      confirmFn: function() {
                        EasyEditOverlay.hideOverlay("confirm");
                        EasyEditOverlay.showOverlay("loading");
                        var a = EasyEdit.getURL(d.attribute("web_path"));
                        window.location = a.url + "/" + EasyEdit.systemInfo.suffixes.edit
                      }
                    };
                    EasyEditOverlay.hideOverlay("success");
                    EasyEditOverlay.showOverlay("confirm", a)
                  }, 1E3)
                })) : (b._savingCurrentScreen = !0, EasyEditScreens.loadScreen(c, function() {
                  b._savingCurrentScreen = !1;
                  EasyEditOverlay.showOverlay("success", {
                    timeout: 1E3
                  });
                  a.call(this);
                  b._currentScreenWarnings || jQuery("#ees_screenWarning").remove();
                  b._currentScreenWarnings = !1
                }))
              })
            })
          }
        })) : (EasyEditOverlay.hideOverlay(), (new EasyEditError(f)).display(),
          a.call(this))
      })
    },
    displayWarning: function(a) {
      this._currentScreenWarnings = !0;
      var b = {
          message: EasyEditLocalise._("default message"),
          buttonId: "buttonId",
          buttonText: EasyEditLocalise._("button text"),
          bindFn: null
        },
        a = jQuery.extend({}, b, a),
        b = '<div id="ees_screenWarning" class="clearfix"><div id="ees_screenWarningContents"><p class="warningMessage clearfix alignLeft">' + a.message;
      "function" === typeof a.bindFn && (b += '<a href="#" class="textButton" id="' + a.buttonId + '">' + a.buttonText + "</a>");
      b += "</p></div></div>";
      jQuery("#ees_screenWarning").remove();
      jQuery("#ees_screenMenu").after(b);
      "function" === typeof a.bindFn && jQuery("#ees_screenWarning a").bind("click", a.bindFn);
      0 < jQuery("#ees_screenWarning a").width() && this._adjustWarningWidth()
    },
    _adjustWarningWidth: function() {
      if (0 < jQuery("#ees_screenWarning a").width() - 113) {
        var a = jQuery("#ees_screenWarning .warningMessage");
        parseInt(a.css("max-width"))
      }
    },
    startLockRefresh: function() {
      var a = 1E3 * EasyEditConfig.lockRefreshInterval;
      this.interval && this.stopLockRefresh();
      this.interval =
        window.setInterval(function() {
          EasyEditScreens.refreshScreenLock()
        }, a)
    },
    stopLockRefresh: function() {
      window.clearInterval(this.interval);
      this.interval = null
    },
    notifyLock: function(a) {
      this.lockResponses = a;
      EasyEditEventManager.trigger("EasyEditLock")
    },
    getCurrentScreenName: function() {
      return this.currentScreenName
    },
    getCurrentScreen: function() {
      return this.screen[this.currentScreen]
    },
    setCurrentScreen: function(a) {
      this.currentScreen = a
    },
    _getTemplate: function() {
      return '<div id="ees_screenMenu"><div id="ees_screenMenuInner" class="clearfix"><h2 class="screenHide">' +
        EasyEditLocalise._("Editable Attributes") + '</h2><ul id="ees_screenMenuList" class="clearfix"></ul></div></div><form id="main_form" enctype="multipart/form-data" name="main_form"><div id="ees_screenContentWrapper"><div id="ees_screenContent" class="clearfix"></div></div></form>'
    },
    _buildMenuItem: function(a, b, c, d, e) {
      var f = "";
      e && (f = "current");
      jQuery("#ees_screenMenuList").append('<li class="screenMenuItem ' + f + '"><a href="#" id="' + a + '"><span class="screenType ' + b + '" data-screen="' + c + '">' + d + "</span></a></li>")
    },
    inTransit: null,
    _attachEvents: function() {
      var a = this,
        b = jQuery("#ees_screenMenuList");
      EasyEditEventManager.bind("EasyEditUrlChange", function() {
        if (EasyEditUrl.hash.isset("screen")) {
          var c = EasyEditUrl.hash.get("screen").toLowerCase(),
            d = a.getCurrentScreenName().toLowerCase();
          c !== d && jQuery("li", b).not(".current").find("." + c).parent().trigger("click")
        }
      });
      jQuery("li a", b).not(".override").click(function(b) {
        jQuery(this).parent();
        var d = this.id.replace("ees_screenMenu", "");
        b.preventDefault();
        if ("undefined" ===
          typeof EasyEditScreens.screen[d] || a.inTransit) return !1;
        a.switchScreen(d)
      })
    },
    switchScreen: function(a, b) {
      var c = this;
      if (c.inTransit) return !1;
      c.inTransit = !0;
      EasyEditScreens.loadScreen(a, function() {
        var a = c.getCurrentScreenName().toLowerCase();
        jQuery("#ees_eesUi").attr("class", a);
        c.inTransit = !1;
        !0 === b instanceof Function && b()
      })
    },
    getLockError: function(a) {
      var b = this;
      if (!EasyEdit.isset(b.lockResponses)) {
        var c = {
          message: EasyEditLocalise._("Locks could not be acquired on this asset")
        };
        b.lockResponses = [c];
        a.call(this,
          c.message);
        return !1
      }
      b.lockResponses.hasOwnProperty("message") && (b.lockResponses = [b.lockResponses]);
      EasyEditAssetManager.getCurrentUser(function(c) {
        var e = null;
        if (b.lockResponses.hasOwnProperty("error")) {
          e = b.lockResponses.error;
          e == "You do not have permission to access this asset" && (e = EasyEditLocalise._("You do not have permission to edit this asset."))
        }
        for (var f = 0, g = b.lockResponses.length; f < g; f++) {
          var j = RegExp('"([0-9]+)" locks are held by User "([^"]+)" \\(#([0-9]+)\\)', "gi"),
            h = RegExp("This is due to expire in ([0-9]+) minutes and ([0-9]+) second",
              "gi"),
            k = b.lockResponses[f].message,
            l = RegExp('Unable to acquire "([^"]+)" lock on "([^"]+)"', "gi").exec(k),
            j = j.exec(k),
            h = h.exec(k),
            k = /lock already held by "([^"]+)"/.exec(k);
          if (j !== null && h !== null && c.id + "" !== j[3]) {
            if (j[2].indexOf("CN=") !== -1) {
              e = /CN=([^,]+)/i.exec(j[2]);
              j[2] = typeof e[1] === "string" ? e[1] : j[2]
            }
            e = EasyEditLocalise._("Locks are held by User") + "' " + j[2] + "'. " + h[0] + ".<br />"
          }
          k !== null && (e = EasyEditLocalise._("Locks are held by User") + "' " + k[1] + "'.<br />");
          l !== null && k !== null && /#([0-9]+)$/gi.exec(l[2]) ===
            null && (e = EasyEditLocalise._('Unable to acquire lock for screen "%1" on "%2". Locks are held by User "%3"', l[1], l[2], k[1]) + "'.<br />")
        }
        a.call(this, e)
      })
    },
    lockInstance: null,
    additionalLockAssets: [],
    refreshScreenLock: function(a) {
      var b = this,
        c = "function" === typeof a ? a : function() {},
        d = EasyEditAssetManager._currentAsset;
      if ("Up For Review" === d.attribute("status") && d.hasWorkflowApplied) return !1;
      null === b.lockInstance && (b.lockInstance = new EasyEditAPI);
      a = b.lockInstance;
      a.reset();
      if (!EasyEditWorkspaceManager.isWorkspace(d)) {
        a.queue("acquireLock", {
          asset_id: d.id,
          screen_name: "all"
        });
        for (var e = 0, f = b.additionalLockAssets.length; e < f; e += 1) a.queue("acquireLock", {
          asset_id: b.additionalLockAssets[e],
          screen_name: "all"
        });
        a.run(function(a) {
          var e = a[0];
          b.notifyLock(e);
          b.getLockError(function(a) {
            a !== null && !b._checkWorkflow(d) && b.displayWarning({
              message: a
            });
            typeof a === "function" && a.call(this, e);
            c.call(this)
          })
        }, a.runMode.BATCH)
      }
    },
    getLockType: function() {
      alert("getLockType is a deprecated function");
      return !1
    },
    _checkWorkflow: function(a) {
      var b = this;
      return a.hasRunningWorkflow() ?
        ("Workflow" !== b.getCurrentScreenName() && b.displayWarning({
          message: EasyEditLocalise._("This asset is in workflow. "),
          buttonId: "ees_workflowButton",
          buttonText: EasyEditLocalise._("Go to workflow screen."),
          bindFn: function(a) {
            jQuery("#ees_eesUi").removeClass().addClass("workflow");
            b.loadScreen("workflowDefault", function() {});
            a.preventDefault()
          }
        }), !0) : "Live" === a.attribute("status") && a.hasWorkflowApplied ? !0 : !1
    },
    _checkReadOnly: function(a) {
      var b = !1,
        c = null;
      null !== this.lockResponses && "undefined" !== typeof this.lockResponses[0] &&
        ("string" === typeof this.lockResponses[0] ? c = this.lockResponses[0] : this.lockResponses[0].hasOwnProperty("message") ? c = this.lockResponses[0].message : this.lockResponses.hasOwnProperty("message") && (c = this.lockResponses.message), null !== RegExp('lock already held by "([^"]+)"', "gi").exec(c) && (b = !0));
      null !== this.lockResponses && this.lockResponses.hasOwnProperty("error") && (b = !0);
      c = a.attribute("status");
      if ("Archived" === c || "Approved To Go Live" === c || "Safe Edit Approved To Go Live" === c || "Safe Editing Pending Approval" ===
        c && !1 === a.attribute("effective_write") || "Pending Approval" === c && !1 === a.attribute("effective_write") || "Live" === c && !1 === a.attribute("can_live_edit") || "Up For Review" === c && !1 === a.attribute("can_live_edit")) b = !0, window.bodycopy_popup = {}, window.bodycopy_popup.clip = function() {};
      EasyEditDebug.log("CHECK READ ONLY", b);
      this.setReadOnly(b);
      return b
    },
    setReadOnly: function(a) {
      a ? jQuery("body").addClass("readOnly") : jQuery("body").removeClass("readOnly")
    },
    _checkLive: function(a) {
      var b = this;
      if (null !== b.lockResponses &&
        b.lockResponses.hasOwnProperty("error") && !a.hasRunningWorkflow()) return b.displayWarning({
        message: EasyEditLocalise._(b.lockResponses.error)
      }), !1;
      var c = {
        Linking: !0,
        URLs: !0,
        Analytics: !0
      };
      "Live" === a.attribute("status") && (null === b.currentScreenName || !1 === c.hasOwnProperty(b.currentScreenName)) ? (c = EasyEditLocalise._("This asset is Live. To work in a draft-like state that only editors can see "), a.hasWorkflowApplied && (c = EasyEditLocalise._("This asset is Live and has Workflow applied. To work in a draft-like state that only editors can see ")),
        jQuery("#ees_changeStatus").length && !jQuery("#ees_changeStatus select").length ? b.displayWarning({
          message: EasyEditLocalise._("This asset is live, but you do not have sufficient permission to change the status.")
        }) : b.displayWarning({
          message: c,
          buttonId: "ees_safeEditButton",
          buttonText: EasyEditLocalise._("Switch to Safe Edit status."),
          bindFn: function(c) {
            a.setStatus("64", "0");
            EasyEditOverlay.showOverlay("loading");
            a.save(function(a) {
              for (var c = !0, d = "", j = 0, h = a.length; j < h; j++) EasyEdit.isError(a[j]) && (c = !1,
                d += a[j] + "<br />");
              c ? (EasyEditComponentsInfoBox.refresh(function() {}), b.loadScreen(b.currentScreen, function() {
                EasyEditOverlay.showOverlay("success", {
                  message: EasyEditLocalise._("Asset is now in safe edit"),
                  timeout: 2E3
                })
              })) : (new EasyEditError(d)).display()
            });
            c.preventDefault()
          }
        })) : b._currentScreenWarnings = !1;
      if (jQuery("#ees_changeStatus").length && !jQuery("#ees_changeStatus select").length) return -1 !== a.attribute("status").indexOf("Approved") && b.displayWarning({
        message: EasyEditLocalise._("This asset is approved to go live, but you do not have sufficient permission to change the status.")
      }), !0
    },
    reloadCurrentScreen: function(a) {
      this.loadScreen(this.currentScreen, a)
    },
    loadScreen: function(a, b) {
      function c() {
        var c = EasyEditScreens.getCurrentScreen();
        !d._savingCurrentScreen && "undefined" !== typeof c && c.hasOwnProperty("cleanUp") && "function" === typeof c.cleanUp && c.cleanUp();
        EasyEditViperComments.cleanUpComments();
        EasyEditScreens.setCurrentScreen(a);
        var f = EasyEditScreens.screen[a];
        EasyEditOverlay.showOverlay("loading", {
          transparent: d._savingCurrentScreen
        });
        var c = jQuery("#ees_screenMenuList"),
          g = jQuery("#ees_screenMenu" +
            a),
          j = g.parent(),
          g = g.find("span").attr("data-screen");
        EasyEditScreens.currentScreenName = g;
        EasyEditComponentsToolbar.disableSaveButton();
        g = jQuery("#ees_screenContent");
        d._savingCurrentScreen || (g.empty(), jQuery("#ees_screenWarning").remove());
        jQuery("li", c).removeClass("current");
        j.addClass("current");
        EasyEditAssetManager.getCurrentAsset(function(c) {
          if (EasyEditWorkspaceManager.isWorkspace(c)) {
            f.init("#ees_screenContent", false, function() {
              EasyEditComponentsToolbar.detectScreenEdits();
              EasyEditOverlay.hideOverlay("loading");
              b.call(this)
            });
            return false
          }
          var e = d._checkReadOnly(c);
          a !== "workflowDefault" && (e || d._checkWorkflow(c));
          d.getLockError(function(g) {
            d._doScreenInit(f, c, a, "#ees_screenContent", e, g, b)
          })
        })
      }
      var d = this;
      EasyEdit.getURL();
      EasyEditComponentsToolbar.showEditMode(function() {
        EasyEditComponentsToolbar.isUnsaved() ? EasyEditOverlay.showOverlay("confirm", {
          message: '<p class="confirmMessage">' + EasyEditLocalise._("You have unsaved changes, please choose how to proceed.") + "</p>",
          title: EasyEditLocalise._("Unsaved Changes"),
          cancelText: EasyEditLocalise._("Return to Screen"),
          confirmText: EasyEditLocalise._("Discard Changes"),
          cssClass: "unsavedChanges",
          confirmFn: function() {
            jQuery("html").scrollTop(0);
            EasyEditOverlay.hideOverlay();
            EasyEditOverlay.showOverlay("loading");
            c()
          },
          cancelFn: function() {
            d.inTransit = !1;
            var a = EasyEditUrl.hash.get(),
              b = d.currentScreenName.toLowerCase();
            a.screen && a.screen !== b && (a.screen = b, EasyEditUrl.hash.push(a));
            EasyEditOverlay.hideOverlay()
          }
        }) : c()
      })
    },
    _doScreenInit: function(a, b, c, d, e, f, g) {
      var j = this;
      jQuery("#main_form").unbind();
      jQuery.removeData(jQuery("#main_form").get(0), "validator");
      "workflowDefault" !== c && j._checkWorkflow(b);
      null !== f && (e = !0);
      a.init(d, e, function() {
        j._checkLive(b);
        !0 === EasyEdit.util.isFunction(a.detectScreenEdits) ? a.detectScreenEdits() : EasyEditComponentsToolbar.detectScreenEdits();
        null !== f && "You do not have permission to access this asset" !== f && j.displayWarning({
          message: f
        });
        var c = EasyEditScreens.getCurrentScreenName().toLowerCase();
        EasyEditUrl.hash.push({
          screen: c
        });
        EasyEditEventManager.trigger("EasyEditScreenLoad");
        EasyEditOverlay.hideOverlay("loading");
        g.call(this)
      })
    }
  },
  EasyEditAssetWizardManager = function(a, b) {
    var c = this;
    this.categoryData = EasyEdit.isset(a) ? a : this._getDefaultCategoryData();
    this.id_base = "assetCreationWizard";
    EasyEdit.isset(b) && (this.id_base = b);
    this.categories = [];
    this.wizards = {};
    this.id = "ees_" + this.id_base;
    this.className = this.id_base;
    this.body_id = this.id + "Content";
    this.events = new ObservableEvents(this);
    this.loadedWizard = null;
    this.defaultTitle = EasyEditLocalise._("Asset Creation Wizard");
    this.defaultDesc =
      EasyEditLocalise._("Select the type of asset you want to create");
    this.$element = jQuery(EasyEdit.tmpl.render("modal_container", {
      id: this.id,
      "class": this.className,
      text: {
        close: EasyEditLocalise._("Close"),
        title: this.defaultTitle,
        description: this.defaultDesc
      },
      body_container_id: this.body_id
    }));
    this.$closeButton = jQuery(".closeModal", this.$element);
    this.$closeButton.bind("click", function(a) {
      a.preventDefault();
      c.hide();
      c.restart()
    });
    jQuery(".modalContainer", this.$element).draggable({
      handle: ".modalHeaderContent",
      containment: "document"
    });
    var d = [],
      e = EasyEditConfig.hasOwnProperty("createWizardAssetBlackList") ? EasyEditConfig.createWizardAssetBlackList : null,
      f = EasyEditConfig.hasOwnProperty("createWizardCategoryBlackList") ? EasyEditConfig.createWizardCategoryBlackList : null,
      g;
    for (g in c.categoryData)
      if (c.categoryData.hasOwnProperty(g) && -1 === jQuery.inArray(g, f)) {
        for (var j = c.categoryData[g].assets.length, h = 0, k = c.categoryData[g].assets.length; h < k; h += 1) {
          var l = c.categoryData[g].assets[h];
          if (-1 === jQuery.inArray(l.type_code,
              e)) {
            var n = g.replace(/\s/g, "_");
            l.cat_id = n;
            d.push(l)
          } else j -= 1
        }
        1 <= j && this.categories.push({
          name: g,
          display_name: c.categoryData[g].display_name,
          cat_id: g.replace(/\s/g, "_"),
          selected: !1
        })
      }
    0 >= this.categories.length ? this.$categories = jQuery(EasyEdit.tmpl.render("simple_tag", {
      tag: "div",
      "class": "modalBodyForm",
      content: EasyEditLocalise._("There are no asset types available to create.")
    })) : (this.categories[0].selected = !0, this.$categories = jQuery(EasyEdit.tmpl.render("wizard_category_select", {
      id: this.id,
      category_title: EasyEditLocalise._("Categories"),
      categories: this.categories,
      wizards: d
    })));
    this.queue = new EasyEditAssetWizardQueue(10);
    this.queue.events.observe("create", function() {
      c.$buttons.hide();
      c.$closeButton.hide()
    });
    this.queue.events.observe("create_complete", function(a) {
      c.queue.hide();
      c.$closeButton.show();
      var b = "Wizard Complete",
        d = "All asset(s) in the queue have now been processed. You can now edit the asset(s), restart the wizard or close the wizard and return to the last screen you were viewing.";
      EasyEdit.util.each(a, function(a, c) {
        var e =
          c.result;
        if (e.hasOwnProperty("errorCode") && e.errorCode === "createFailed") {
          b = "Asset creation failed";
          d = "All asset(s) in the queue have now been processed. 1 or more asset(s) have failed to be created. Review the errors below and you can restart the wizard or close the wizard and return to the last screen you were viewing."
        }
      });
      c.$success = jQuery(EasyEdit.tmpl.render("wizard_success", {
        title: EasyEditLocalise._(b),
        message: EasyEditLocalise._(d),
        restart_wizard_title: EasyEditLocalise._("Restart Wizard"),
        close_title: EasyEditLocalise._("Close")
      }));
      var e = c.$success.find("#ees_createSuccessAssetsList");
      EasyEdit.util.each(a, function(a, b) {
        var d = b.result,
          f = b.queued;
        if (d.hasOwnProperty("errorCode")) {
          if (d.errorCode === "createFailed") {
            if (!d.error) d.error = EasyEditLocalise._("Oops! Something went wrong trying to create this asset. Check the error logs for more information.");
            if (!jQuery(".extraInformation ul", c.$success).length) {
              var k = [];
              if (EasyEdit.isFileAsset(f.wizard.attribute("type_code"))) {
                k.push(EasyEditLocalise._("A file with the same name may already exist under the selected parent."));
                k.push(EasyEditLocalise._("Another user might be currently editing the asset you have selected as a parent."));
                k.push(EasyEditLocalise._("Administrators may have imposed file extension restrictions for the file type."))
              }
              k.push(EasyEditLocalise._("You may not have write permission to the parent asset."));
              EasyEdit.isFileAsset(f.wizard.attribute("type_code")) ? c.$success.find(".extraInformation").append(EasyEdit.tmpl.render("simple_tag", {
                  tag: "h3",
                  content: EasyEditLocalise._("Issues creating file asset(s)")
                })) :
                c.$success.find(".extraInformation").append(EasyEdit.tmpl.render("simple_tag", {
                  tag: "h3",
                  content: EasyEditLocalise._("Issues creating asset(s) in general")
                }));
              c.$success.find(".extraInformation").append(EasyEdit.tmpl.render("list", {
                list: k
              })).addClass("error")
            }
          }
          jQuery(EasyEdit.tmpl.render("wizard_fail_asset", {
            type_code: f.wizard.attribute("type_code"),
            error: d.error,
            name: f.wizard.createData.asset_name
          })).appendTo(e)
        } else if (d.hasOwnProperty("success")) {
          f = 0;
          for (k = d.success.length; f < k; f = f + 1) {
            var g = d.success[f].asset,
              l = d.success[f].lineage,
              h = d.success[f].url;
            jQuery(EasyEdit.tmpl.render("wizard_success_asset", {
              edit_path: EasyEditUrl.buildEditURL(g.attribute("web_path")),
              edit_title: EasyEditLocalise._("Edit"),
              assetid: g.id,
              type_code: g.attribute("type_code"),
              type: g.attribute("type"),
              name: g.attribute("name")
            })).appendTo(e).find("a.assetEdit").click(function(a) {
              a.preventDefault();
              EasyEditComponentsToolbar.isUnsaved() ? EasyEditOverlay.showOverlay("confirm", {
                message: '<p class="confirmMessage">' + EasyEditLocalise._("You have unsaved changes, please choose how to proceed.") +
                  "</p>",
                cancelText: EasyEditLocalise._("Return to Create Wizard"),
                confirmText: EasyEditLocalise._("Discard Changes"),
                title: EasyEditLocalise._("Unsaved Changes"),
                cssClass: "unsavedChanges",
                confirmFn: function() {
                  EasyEditOverlay.hideOverlay();
                  EasyEdit.redirect({
                    asset: g,
                    screen: "details",
                    lineage: l,
                    url: h
                  })
                },
                cancelFn: function() {
                  EasyEditOverlay.hideOverlay("confirm")
                }
              }, null, false) : EasyEdit.redirect({
                asset: g,
                screen: "details",
                lineage: l,
                url: h
              })
            })
          }
        }
      });
      c.$element.find(".modalBody").append(c.$success);
      c.$success.find("#ees_createSuccessClose").click(function(a) {
        a.preventDefault();
        jQuery("#ees_assetCreationWizard .closeModal:eq(0)").trigger("click")
      });
      c.$success.find("#ees_restartCreateWizard").click(function(a) {
        a.preventDefault();
        c.restart()
      });
      c.events.trigger("create_complete");
      EasyEditEventManager.trigger("CreationWizardComplete")
    });
    this.$element.find("#" + this.body_id).append(this.$categories).append(this.queue.$elem);
    this.$categoryButtons = this.$categories.find("a.assetCreateCategory");
    this.$categoryButtons.click(function(a) {
      a.preventDefault();
      c.selectCategory($(this).attr("id").replace("ees_categoryLink_",
        ""))
    });
    1 <= this.categories.length && this.selectCategory(this.categories[0].cat_id);
    this.$wizardItems = this.$categories.find("li.wizard a");
    this.$wizardItems.click(function(a) {
      a.preventDefault();
      c.load($(this).find(".assetType").text())
    });
    this.$buttons = jQuery(EasyEdit.tmpl.render("wizard_buttons", {
      create_button_label: EasyEditLocalise._("Create"),
      clone_button_label: EasyEditLocalise._("Clone"),
      back_button_label: EasyEditLocalise._("Back")
    }));
    jQuery(".backButton", this.$buttons).click(function(a) {
      a.preventDefault();
      c.restart()
    });
    var m = jQuery(".cloneButton", c.$buttons);
    m.hide();
    var o = jQuery(".createButton", c.$buttons);
    o.add(m).click(function(a) {
      a.preventDefault();
      var b = this;
      c.queue.create(function(a) {
        if (EasyEdit.isset(a)) {
          c.$buttons.find(".error").remove();
          var d = jQuery(EasyEdit.tmpl.render("simple_tag", {
            tag: "span",
            "class": "error alignRight",
            content: '<span class="message">' + EasyEditLocalise._n("%1 wizard incomplete", "%1 wizards incomplete", a.length, a.length) + '</span><span class="chevron"></span>'
          }));
          jQuery(b).after(d);
          setTimeout(function() {
            d.fadeOut("slow")
          }, 3E3)
        }
      }, c)
    });
    this.$cloneAssetOption = this.$categories.find("#ees_cloneAssetButton");
    this.$cloneAssetOption.click(function(a) {
      a.preventDefault();
      m.show();
      o.hide();
      c.load("")
    });
    this.events.observe("load", function(a) {
      c.setHeader(a.attribute("display_name"), a.attribute("type_code"), a.attribute("description"))
    });
    this.events.observe("restart", function() {
      c.setHeader(c.defaultTitle, "", c.defaultDesc)
    });
    this.$element.find(".modalBody").append(this.$error)
  };
EasyEditAssetWizardManager.prototype = {
  decorators: [],
  getWizardDataByTypeCode: function(a) {
    for (var b in this.categoryData)
      if (this.categoryData.hasOwnProperty(b))
        for (var c = 0, d = this.categoryData[b].assets.length; c < d; c += 1)
          if (this.categoryData[b].assets[c].type_code === a) return a = this.categoryData[b].assets[c], a.cat_id = b, a;
    return null
  },
  build: function(a) {
    if (a) {
      var b = this.getWizardDataByTypeCode(a);
      if (null === b) return (new EasyEditError(EasyEditLocalise._('Unable to retrieve wizard data by type code "%1"', a))).display(), !1
    } else b = this._getCloneAssetData();
    a = new EasyEditAssetWizard(b, this.queue.queue.length);
    EasyEdit.isFileAsset(b.type_code) && this.decorators.hasOwnProperty("file") && this.decorators.file(a);
    "image" === b.type_code && this.decorators.hasOwnProperty("image") && this.decorators.image(a); - 1 !== b.type_code.indexOf("event") && this.decorators.hasOwnProperty("calendar") && this.decorators.calendar(a);
    a.events.observe("upload_fail", function(a, b) {
      b.trash(function() {})
    });
    return a
  },
  restart: function() {
    this.queue.removeAll();
    this.queue.hide();
    "undefined" !== typeof this.$success && this.$success.remove();
    jQuery(".closeModal", this.$element).show();
    this.$buttons.hide();
    this.$buttons.find(".createButton").show();
    this.$buttons.find(".cloneButton").hide();
    this.$buttons.find(".error").remove();
    this.$categories.show();
    this.events.trigger("restart")
  },
  setHeader: function(a, b, c) {
    a == EasyEditLocalise._("Clone Asset") && (b = "clone_asset");
    this.$element.find(".modalIcon").get(0).className = "modalIcon " + b;
    this.$element.find(".modalTitle h1").text(a);
    this.$element.find(".modalDesc").text(c)
  },
  getCurrentWizard: function() {
    return this.queue.getCurrent()
  },
  load: function(a) {
    this.$categories.hide();
    a = this.build(a);
    this.queue.removeAll();
    this.queue.show();
    this.queue.add(a);
    this.queue.$elem.after(a.$element);
    a.$element.after(this.$buttons);
    a.show();
    this.$buttons.show();
    EasyEditEventManager.trigger("CreationWizardAssetTypeSelected");
    this.events.trigger("load", a);
    return a
  },
  get: function(a) {
    return this.load(a)
  },
  each: function(a) {
    var b = this;
    this.queue.each(function(c,
      d) {
      a.call(b, d)
    })
  },
  selectCategory: function(a) {
    var b = this.$categories.find("a#ees_categoryLink_" + a);
    this.$categoryButtons.parent().removeClass("selected");
    b.parent().addClass("selected");
    this.$categories.find("li.wizard").addClass("screenHide").filter(function() {
      return $(this).hasClass("category_" + a)
    }).removeClass("screenHide");
    this.events.trigger("select_category", a)
  },
  show: function() {
    EasyEditEventManager.trigger("CreationWizardBeforeInit");
    jQuery("body").prepend(this.$element);
    this.$element.show();
    this.events.trigger("show");
    EasyEditEventManager.trigger("CreationWizardAfterInit")
  },
  hide: function() {
    this.$element.detach();
    this.events.trigger("hide")
  },
  _getDefaultCategoryData: function() {
    return {
      Pages: {
        display_name: EasyEditLocalise._("Pages"),
        assets: [{
          type_code: "page_standard",
          display_name: EasyEditLocalise._("Standard Page"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("Pages are used to create standard content within your site such as a page with headings, hyperlinks and images.")
        }, {
          type_code: "news_item",
          display_name: EasyEditLocalise._("News Item"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("A News Item allows you to add articles to your site. These articles could be anything from a media release to a general article on your site.")
        }, {
          type_code: "page_custom_form",
          display_name: EasyEditLocalise._("Form"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("A Form can be used to collect different types of information from users. Examples include a contact us form, feedback form, job application, customer surveys etc.")
        }]
      },
      Events: {
        display_name: EasyEditLocalise._("Events"),
        assets: [{
          type_code: "calendar_event_single",
          display_name: EasyEditLocalise._("Single Calendar Event"),
          interface_type: "wizard_calendar",
          description: EasyEditLocalise._("Calendar events are used to define an event with a fixed start and end date and time.")
        }, {
          type_code: "calendar_event_recurring",
          display_name: EasyEditLocalise._("Recurring Calendar Event"),
          interface_type: "wizard_calendar",
          description: EasyEditLocalise._("Calendar events are used to define an event with a recurring start and end date and time.")
        }]
      },
      Files: {
        display_name: EasyEditLocalise._("Files"),
        assets: [{
          type_code: "image",
          display_name: EasyEditLocalise._("Image"),
          interface_type: "wizard_image",
          description: EasyEditLocalise._("Upload an image. You may only upload files of type gif, jpg, jpeg and png."),
          accept: "jpeg|jpg|png|gif"
        }, {
          type_code: "pdf_file",
          display_name: EasyEditLocalise._("PDF"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a Portable Document Format (PDF) file."),
          accept: "pdf"
        }, {
          type_code: "word_doc",
          display_name: EasyEditLocalise._("Word Document"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a file in Word format. You may only upload files of type doc, dot, docx, docm, dotx and dotm."),
          accept: "doc|docx|dot|dotx|docm|dotm"
        }, {
          type_code: "excel_doc",
          display_name: EasyEditLocalise._("Excel Document"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a file in Excel format. You may only upload files of type xls, xlt, xlsx, xlsm, xltx and xltm."),
          accept: "xls|xlsx|xlsm|xlt|xltx|xltm|xltb|xlam"
        }, {
          type_code: "powerpoint_doc",
          display_name: EasyEditLocalise._("PowerPoint Document"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a file in PowerPoint format. You may only upload files of type ppt, pot, pps, pptx, potx, ppsx, pptm, potm and ppsm."),
          accept: "ppt|pptx|pps|ppsm|pptm|ppsx|potx|potm"
        }, {
          type_code: "rtf_file",
          display_name: EasyEditLocalise._("Rich Text Format File"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a Rich Text Format document (RTF) file."),
          accept: "rtf"
        }, {
          type_code: "text_file",
          display_name: EasyEditLocalise._("Text File"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a plain text file.")
        }, {
          type_code: "mp3_file",
          display_name: EasyEditLocalise._("MP3 File"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a file in MP3 format."),
          accept: "mp3"
        }, {
          type_code: "flv_file",
          display_name: EasyEditLocalise._("FLV Movie"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a file in Flash Video (FLV) format. FLV is the standard for web optimised video and requires an SWF Flash player to view."),
          accept: "flv"
        }, {
          type_code: "video_file",
          display_name: EasyEditLocalise._("Generic Movie"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("Upload a video file. You may only upload files of type mov, avi, wmv, asf, flv, mp4, m4v, mpg, mpeg, ogv, ogg and webm."),
          accept: "mov|avi|wmv|asf|flv|mp4|m4v|mpg|mpeg|ogv|ogg|webm"
        }, {
          type_code: "file",
          display_name: EasyEditLocalise._("Generic File"),
          interface_type: "wizard_file",
          description: EasyEditLocalise._("This file type allows you to upload all file types and creates a generic file asset.")
        }]
      },
      Other: {
        display_name: EasyEditLocalise._("Other"),
        assets: [{
          type_code: "folder",
          display_name: EasyEditLocalise._("Folder"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("Folders are used to organise documents, images, movies and other files within your system.")
        }, {
          type_code: "page_redirect",
          display_name: EasyEditLocalise._("Redirect Page"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("Redirect pages automatically direct users to a set url or asset.")
        }, {
          type_code: "link",
          display_name: EasyEditLocalise._("Link"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("Store a link to an external URL or an internal asset.")
        }, {
          type_code: "data_record",
          display_name: EasyEditLocalise._("Data Record"),
          interface_type: "wizard_default",
          description: EasyEditLocalise._("A Data Record asset is an asset without any default purpose. It allows you to decide what to use it for through a Metadata Schema.")
        }]
      }
    }
  },
  _getCloneAssetData: function() {
    return {
      cat_id: "Clone Asset",
      display_name: EasyEditLocalise._("Clone Asset"),
      type_code: "",
      display_name: EasyEditLocalise._("Clone Asset"),
      interface_type: "wizard_default",
      description: EasyEditLocalise._("Cloning an asset creates a copy of the asset and any of its dependent assets.")
    }
  }
};
EasyEditBodycopyManager = function(a, b, c, d) {
  function e() {
    f.tip.hideAll()
  }
  this.bodycopies = [];
  this.bodycopyId = null;
  this.asset = a;
  this.keyword = "contents-";
  a.hasOwnProperty("attr") && "page_standard" === a.attr.type_code && (this.keyword = "__custom-contents");
  this.$html = "";
  this.tip = new EasyEditToolTipManager;
  this.$container = jQuery(b);
  this.containerId = b;
  this.availableTemplates = [];
  this.comments = [];
  a = jQuery(b).find(".ees_viperContent:first");
  a.length ? this.$element = a : (this.$element = jQuery(EasyEdit.tmpl.render("simple_tag", {
    tag: "div",
    "class": "ees_viperContent"
  })), this.$container.append(this.$element), this.$element.wrap('<div class="ees_viperContentWrapper" />'));
  this.propertyChange = {};
  this.insertion = this.deletion = null;
  this.events = new ObservableEvents(this, "insert,insert_complete,remove,fetch,fetch_complete,change".split(","));
  var f = this;
  this.viper = "undefined" !== typeof d && null !== d ? d : null;
  this.events.observe("insert", e);
  this.events.observe("remove", e);
  this.fetch(c)
};
EasyEditBodycopyManager.prototype = {
  fetch: function(a) {
    var b = this,
      c = new EasyEditAPI,
      d = /var _prefix = "bodycopy_([0-9]+)";/;
    b.events.trigger("fetch");
    c.queue("getKeywordsReplacements", {
      asset_id: b.asset.id,
      keywords_array: ["%" + this.keyword + "%"]
    });
    c.expect(1).run(function(e) {
      if (EasyEdit.isError(e[0].data)) return !1;
      e = e[0].data[b.keyword][b.keyword];
      b.$html = jQuery(e);
      if (e = d.exec(e)) b.bodycopyId = e[1];
      var f = {};
      jQuery("td.bodycopyContainerCell", b.$html).map(function() {
        var a;
        a = "ID_" + jQuery(this).attr("data-containerid");
        f[a] = {
          bodycopyid: jQuery(this).attr("data-bodycopyid"),
          id: jQuery(this).attr("data-containerid"),
          readonly: "true" === jQuery(this).attr("data-readonly"),
          content: jQuery(this).find('tr:nth-child(2) > td[id$="cell"]').contents(),
          multiLinked: jQuery(this).find('img[title="Multi-linked DIV"]').length,
          conditions: {},
          appliedTemplate: "",
          appliedTemplateName: ""
        };
        jQuery("table.sq-edit-bodycopy-section tr > td", this).map(function() {
          try {
            f[a].conditions = JSON.parse(jQuery(this).attr("data-available-conditions"))
          } catch (b) {}
          try {
            f[a].appliedTemplate =
              JSON.parse(jQuery(this).attr("data-applied-template")), f[a].appliedTemplateName = jQuery(this).attr("data-applied-template-name")
          } catch (c) {}
          return {}
        });
        return {}
      });
      b.$html.each(function() {
        if (jQuery(this).is("table.sq-edit-bodycopy-table")) {
          var a = jQuery(this).attr("data-available-templates");
          "undefined" !== typeof a && !1 !== a && (b.availableTemplates = JSON.parse(a))
        }
      });
      var e = 0,
        g;
      for (g in f) b.bodycopyId = parseFloat(f[g].bodycopyid), g = g.substr(3), c.queue("getGeneral", {
        asset_id: g,
        get_attributes: 1
      }), c.queue("getChildren", {
        asset_id: g,
        levels: 1
      }), c.queue("getGeneral", {
        asset_id: "%results_" + (3 * e + 1) + "_0_id%",
        get_attributes: 1
      }), e++;
      1 <= c.queued.length ? c.run(function(c) {
        b.bodycopies = [];
        if (EasyEdit.isError(c[0].data)) return a.call(this), !1;
        for (var d = 0, e = c.length; d < e; d += 1)
          if (0 === d % 3) {
            var g = c[d].data,
              n = c[d + 2].data;
            if (EasyEdit.isError(g)) return !1;
            var m = b.makeDiv(g.id, n.type_code);
            m.events.observe("change", function() {
              b.events.trigger("change", {
                div: this,
                args: arguments
              });
              EasyEditComponentsToolbar.enableSaveButton()
            });
            m.attribute("data",
              g);
            m.attribute("content_data", n);
            m.attribute("raw_content", f["ID_" + g.id].content);
            m.attribute("readonly", f["ID_" + g.id].readonly);
            m.attribute("multi_linked", f["ID_" + g.id].multiLinked);
            m.attribute("available_conditions", f["ID_" + g.id].conditions);
            m.attribute("applied_template", f["ID_" + g.id].appliedTemplate);
            m.attribute("applied_template_name", f["ID_" + g.id].appliedTemplateName);
            b.bodycopies.push(m)
          }
        b.events.trigger("fetch_complete", {
          api_results: c
        });
        a.call(this)
      }, c.runMode.BATCH) : a.call(b)
    })
  },
  each: function(a) {
    for (var b =
        0, c = this.bodycopies.length; b < c; b += 1) a.apply(this.bodycopies[b], [b, this.bodycopies[b]])
  },
  render: function() {
    var a = this,
      b = jQuery('<div class="ees_viperContent" style="display:none"></div>');
    a.$element.after(b);
    a.each(function(c, e) {
      var f = c + 1,
        g = e.attribute("data"),
        j = jQuery(EasyEdit.tmpl.render("bodycopy_insert_button", {
          content: EasyEditLocalise._("Insert New Container"),
          position: f,
          title: EasyEditLocalise._("Insert New Container"),
          tag: "div"
        })),
        h = !1;
      g.attributes.dir && "rtl" === g.attributes.dir && (h = !0);
      var k =
        jQuery(EasyEdit.tmpl.render("standard_page_bodycopy", {
          "class": "bodycopy_manager_div position-" + f + " " + e.attribute("content_data").type_code,
          tag: "div",
          rtl: h
        })),
        h = e.getFriendlyContainerName();
      "" != e.attribute("applied_template") && (h = h + " - " + e.attribute("applied_template_name"));
      f = {
        comments: !1,
        remove: {
          content: EasyEditLocalise._("Delete Container"),
          title: EasyEditLocalise._("Delete Container")
        },
        conditions: !1,
        properties: {
          content: EasyEditLocalise._("Edit Container Properties"),
          title: EasyEditLocalise._("Edit Container Properties")
        },
        position: f,
        tag: "div",
        reorder: {
          title: EasyEditLocalise._("Change the order of this container"),
          content: EasyEditLocalise._("Change the order of this container")
        },
        change_warning: EasyEditLocalise._("You have unsaved changes to this containers properties!"),
        type: h
      };
      "no" !== EasyEdit.systemInfo.preferences.bodycopy_container.SQ_DIV_DISABLE_DELETE && delete f.remove;
      f.comments = {
        content: EasyEditLocalise._("Show comments"),
        title: EasyEditLocalise._("Show comments")
      };
      "content_type_wysiwyg" === e.attribute("content_data").type_code &&
        EasyEditViperComments.hasComments(g.comments) && (f.comments.available = !0);
      "content_type_wysiwyg" === e.attribute("content_data").type_code && EasyEditViperComments.hasOpenComments(g.comments) && (f.comments.enabled = !0);
      g = g.attributes.conditions;
      0 < e.attribute("available_conditions").length && (f.conditions = {
        content: EasyEditLocalise._("Edit Display Conditions"),
        title: EasyEditLocalise._("Edit Display Conditions")
      });
      if (g && (g.conditions && 0 < g.conditions.length && (f.conditions.available = !0, f.conditions.content = EasyEditLocalise._("Edit Display Conditions") +
          " (" + EasyEditLocalise._("enabled") + ")"), g.condition_rules_status && "enable" === g.condition_rules_status)) f.conditions.enabled = !0, f.conditions.content = EasyEditLocalise._("Edit Display Conditions") + " (" + EasyEditLocalise._("set but not enabled") + ")";
      !0 === Boolean(e.attribute("multi_linked")) && (f.multilinked = {
        title: EasyEditLocalise._("This container is linked in multiple locations"),
        content: EasyEditLocalise._("This container is linked in multiple locations")
      });
      e instanceof BodycopyDivUnsupported ? f.readonly = {
        title: EasyEditLocalise._("This container is not supported in edit mode. Please use admin mode to edit."),
        content: "(" + EasyEditLocalise._("Unsupported") + ")"
      } : !0 === Boolean(e.attribute("readonly")) && (f.readonly = {
        title: EasyEditLocalise._("You do not have permission to edit this container."),
        content: "(" + EasyEditLocalise._("Read-only") + ")"
      });
      k.prepend(EasyEdit.tmpl.render("bodycopy_tools", f));
      "no" === EasyEdit.systemInfo.preferences.bodycopy_container.SQ_DIV_DISABLE_CREATE && b.append(j);
      b.append(k);
      e.render(k.find(".bodycopy_content_wrapper"));
      "content_type_wysiwyg" !== e.attribute("content_data").type_code && (j = k.find("textarea:first"), j.focus(function() {
        b.find("div.bodycopy_manager_div").removeClass("active");
        k.addClass("active")
      }), j.blur(function() {
        k.removeClass("active")
      }));
      k.find(".content_template_custom_layout").length && (k.find(".metadata_value_table").each(function() {
        newhtml = a._reRenderMetadata(this, "schema");
        newhtml = '<div id="ees_editMetadata" class="metadata">' + newhtml + "</div>";
        $(this).replaceWith(newhtml)
      }), k.find(".sq-backend-section-table").each(function() {
        newhtml =
          a._reRenderMetadata(this, "section");
        newhtml = '<div id="ees_editMetadata" class="metadata">' + newhtml + "</div>";
        $(this).replaceWith(newhtml)
      }))
    });
    var c = jQuery(EasyEdit.tmpl.render("bodycopy_insert_button", {
      content: EasyEditLocalise._("Insert New Container"),
      position: a.bodycopies.length + 1,
      title: EasyEditLocalise._("Insert New Container"),
      tag: "div"
    }));
    "no" === EasyEdit.systemInfo.preferences.bodycopy_container.SQ_DIV_DISABLE_CREATE && b.append(c);
    a.$element.remove();
    a.$element = b.show();
    a._attachEvents();
    a.reRenderWysiwyg();
    a._attachMetadataEvents()
  },
  save: function(a) {
    var b = this,
      c = [],
      d = {};
    b.tip.removeAll();
    var e = new EasyEditSimpleEditRequest({
      backend_assetid: b.asset.id,
      assetid: b.bodycopyId,
      screen: "contents"
    });
    b._processMetadataWysiwygs(e);
    (viper = b.getViper()) && EasyEditViperComments.saveComments(viper, this);
    b.each(function(a, c) {
      !0 !== c.attribute("readonly") && (c.queueSave(e, b), e.setParamsFromElement(c.$container, !1))
    });
    e.setParam(b.propertyChange);
    e.setParam(b.deletion);
    e.setParam(b.insertion);
    b.asset.acquireLock("all",
      function() {
        e.send(function(e) {
          b.insertion && b.events.trigger("insert_complete", {
            data: b.insertion,
            responseData: e
          });
          a.apply(this, [!0, c, d])
        })
      })
  },
  getDivById: function(a) {
    var a = parseFloat(a),
      b = null;
    this.each(function() {
      parseFloat(this.attribute("data").id) === a && (b = this)
    });
    return b
  },
  getDivByPosition: function(a) {
    a = parseFloat(a) - 1;
    return "undefined" !== typeof this.bodycopies[a] ? this.bodycopies[a] : null
  },
  _createDivXML: function(a, b, c) {
    var d = "",
      e;
    for (e in a) d += EasyEdit.tmpl.render("xml_tag", {
      tag: e,
      content: a[e]
    });
    b && (d += decodeURIComponent("%0D%0A"));
    1 <= c && (d = Array(c + 1).join(" ") + d);
    return d
  },
  changeProperties: function(a, b) {
    var c = "bodycopy_saved[bodycopy_" + this.bodycopyId + "][" + a + "]",
      d = "__raw_options_" + this.bodycopyId + "_" + a,
      e = "",
      e = {},
      e = void 0 !== b.conditions ? {
        conditions: {
          condition_rules_status: "enable",
          logical_op_group: "all_match",
          conditions: []
        }
      } : {
        description: "",
        id: "",
        content_type: "",
        css_class: "",
        layout_type: "none",
        direction: "",
        disable_keywords: "",
        template: "--"
      },
      f = this.propertyChange[d];
    void 0 !== f && (b = jQuery.extend(f,
      b));
    this.propertyChange[d] = b;
    d = jQuery.extend(e, b);
    e = this._createDivXML({
      val_type: "array"
    }, !0, 0);
    e += this._createDivXML({
      name_type: "string",
      name: "attributes",
      val_type: "array"
    }, !0, 1);
    void 0 !== d.id && (e += this._createDivXML({
      name_type: "string",
      name: "identifier",
      val_type: "string",
      val: d.id
    }, !0, 2));
    void 0 !== d.description && (e += this._createDivXML({
      name_type: "string",
      name: "desc",
      val_type: "string",
      val: d.description
    }, !0, 2));
    void 0 !== d.css_class && (e += this._createDivXML({
      name_type: "string",
      name: "css_class",
      val_type: "string",
      val: d.css_class
    }, !0, 2));
    void 0 !== d.layout_type && (e += this._createDivXML({
      name_type: "string",
      name: "layout_type",
      val_type: "string",
      val: d.layout_type
    }, !0, 2));
    if (void 0 !== d.conditions && (e += this._createDivXML({
        name_type: "string",
        name: "conditions",
        val_type: "array"
      }, !0, 2), e += this._createDivXML({
        name_type: "string",
        name: "condition_rules_status",
        val_type: "string",
        val: d.conditions.condition_rules_status
      }, !0, 3), e += this._createDivXML({
        name_type: "string",
        name: "logical_op_groups",
        val_type: "string",
        val: d.conditions.logical_op_groups
      }, !0, 3), d.conditions.conditions && 0 < d.conditions.conditions.length)) {
      e += this._createDivXML({
        name_type: "string",
        name: "conditions",
        val_type: "array"
      }, !0, 3);
      for (f = 0; f < d.conditions.conditions.length; f++) {
        var g = d.conditions.conditions[f],
          e = e + this._createDivXML({
            name_type: "string",
            name: "" + f,
            val_type: "array"
          }, !0, 4),
          e = e + this._createDivXML({
            name_type: "string",
            name: "logical_op",
            val_type: "string",
            val: g.logical_op
          }, !0, 5),
          e = e + this._createDivXML({
            name_type: "string",
            name: "conditions",
            val_type: "array"
          }, !0, 5);
        if (g.conditions &&
          0 < g.conditions.length)
          for (var j = 0; j < g.conditions.length; j++) e += this._createDivXML({
            name_type: "string",
            name: "" + j,
            val_type: "string",
            val: g.conditions[j]
          }, !0, 6)
      }
    }
    void 0 !== d.content_type && (e += this._createDivXML({
      name_type: "string",
      name: "content_type",
      val_type: "string",
      val: d.content_type
    }, !0, 2));
    void 0 !== d.template && (e += this._createDivXML({
      name_type: "string",
      name: "template",
      val_type: "string",
      val: d.template
    }, !0, 2));
    void 0 !== d.disable_keywords && (e += this._createDivXML({
      name_type: "string",
      name: "disable_keywords",
      val_type: "string",
      val: d.disable_keywords
    }, !0, 2));
    void 0 !== d.direction && (e += this._createDivXML({
      name_type: "string",
      name: "dir",
      val_type: "string",
      val: d.direction
    }, !1, 2));
    this.propertyChange[c] = e;
    c = this.getDivById(a);
    null !== c && c.events.trigger("change")
  },
  insert: function(a) {
    var b = jQuery.extend({
        position: 1,
        container_type: "div",
        layout_type: "div",
        css_class: "",
        id: "",
        content_type: "",
        template: "--",
        before: 0
      }, a),
      c = {};
    decodeURIComponent("%0D%0A");
    c.bodycopy_action = "insert_container";
    c.bodycopy_name = "bodycopy_" +
      this.bodycopyId;
    c.bodycopy_data = this._createDivXML({
      val_type: "array"
    }, !0, 0);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "containerid",
      val_type: "integer",
      val: b.position
    }, !0, 1);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "container_type",
      val_type: "string",
      val: b.container_type
    }, !0, 1);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "before",
      val_type: "boolean",
      val: b.before
    }, !0, 1);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "attributes",
      val_type: "array"
    }, !0, 1);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "identifier",
      val_type: "string",
      val: b.id
    }, !0, 2);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "layout_type",
      val_type: "string",
      val: b.layout_type
    }, !0, 2);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "css_class",
      val_type: "string",
      val: b.css_class
    }, !0, 2);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "content_type",
      val_type: "string",
      val: b.content_type
    }, !0, 2);
    c.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "template",
      val_type: "string",
      val: b.template
    }, !1, 2);
    new EasyEditSimpleEditRequest({
      backend_assetid: this.asset.id,
      assetid: this.bodycopyId,
      screen: "contents"
    });
    this.events.trigger("insert", a);
    this.insertion = c
  },
  remove: function(a) {
    var b = {
      bodycopy_action: "delete_container"
    };
    b.bodycopy_name = "bodycopy_" + this.bodycopyId;
    decodeURIComponent("%0D%0A");
    b.bodycopy_data = this._createDivXML({
      val_type: "array"
    }, !0, 0);
    b.bodycopy_data += this._createDivXML({
      name_type: "string",
      name: "containerid",
      val_type: "string",
      val: a
    }, !1, 1);
    this.events.trigger("remove", {
      id: a
    });
    this.deletion = b
  },
  makeDiv: function(a, b) {
    var c = new BodycopyDiv(a);
    switch (b) {
      case "content_type_wysiwyg":
        c = new BodycopyDivWysiwyg(c);
        break;
      case "content_type_raw_html":
        c = new BodycopyDivRaw(c);
        break;
      case "content_type_code":
        c = new BodycopyDivCode(c);
        break;
      case "content_type_nest_content":
        c = new BodycopyDivNested(c);
        break;
      case "content_type_markdown":
        c = new BodycopyDivMarkdown(c);
        break;
      default:
        c = new BodycopyDivUnsupported(c)
    }
    return c
  },
  editPropertiesPopup: function(a,
    b) {
    var c = this,
      d = c.tip.getTipById(a);
    if (null === b) return !1;
    var e = c.getDivByPosition(b),
      f = e.attribute("data"),
      g = f.attributes.content_type,
      j = f.attributes.direction,
      h = c.availableTemplates,
      k = e.attribute("applied_template");
    "undefined" === typeof g && (g = "content_type_wysiwyg");
    var l = [{
        value: "--",
        text: EasyEditLocalise._("-- None --"),
        selected: ""
      }],
      n = "";
    if ("undefined" !== typeof h && 0 < h.length)
      for (var m in h) {
        if (h.hasOwnProperty(m) && null != h[m]) {
          var o = "";
          h[m].assetid == k && (o = "selected");
          l.push({
            value: h[m].assetid,
            text: h[m].name + " (#" + h[m].assetid + ")",
            selected: o
          })
        }
      } else n = "screenHide";
    h = [{
      value: "content_type_wysiwyg",
      text: EasyEditLocalise._("WYSIWYG"),
      selected: ""
    }, {
      value: "content_type_raw_html",
      text: EasyEditLocalise._("Raw HTML"),
      selected: ""
    }, {
      value: "content_type_code",
      text: EasyEditLocalise._("Code"),
      selected: ""
    }, {
      value: "content_type_nest_content",
      text: EasyEditLocalise._("Nested content"),
      selected: ""
    }];
    EasyEditConfig.hasOwnProperty("markdownEnabled") && EasyEditConfig.markdownEnabled && h.push({
      value: "content_type_markdown",
      text: EasyEditLocalise._("Markdown"),
      selected: ""
    });
    k = !1;
    for (m = 0; m < h.length; m++)
      if (h[m].value === g) {
        h[m].selected = "selected";
        k = !0;
        break
      }!1 === k && (g = EasyEdit.util.ucWords(g.substr(13, g.length).replace("_", " ")) + " (" + EasyEditLocalise._("Unsupported") + ")", h.unshift({
      value: "",
      selected: "selected",
      text: g
    }));
    f = EasyEdit.tmpl.render("bodycopy_properties_popup", {
      headings: {
        identification: EasyEditLocalise._("Identification"),
        styling: EasyEditLocalise._("Styling"),
        direction: EasyEditLocalise._("Direction"),
        content_type: EasyEditLocalise._("Content Type")
      },
      input: {
        identifier: {
          label: EasyEditLocalise._("ID name"),
          id: "id_" + e.id,
          value: f.name
        },
        description: {
          label: EasyEditLocalise._("Description"),
          id: "description_" + e.id,
          value: f.attributes.hasOwnProperty("desc") ? f.attributes.desc : ""
        },
        presentation: {
          label: EasyEditLocalise._("Presentation"),
          id: "presentation_" + e.id,
          values: [{
            value: "div",
            selected: f.attributes.hasOwnProperty("layout_type") && "div" === f.attributes.layout_type ? "true" : "",
            text: "Block (div)"
          }, {
            value: "section",
            selected: f.attributes.hasOwnProperty("layout_type") &&
              "section" === f.attributes.layout_type ? "true" : "",
            text: "Section (section)"
          }, {
            value: "article",
            selected: f.attributes.hasOwnProperty("layout_type") && "article" === f.attributes.layout_type ? "true" : "",
            text: "Article (article)"
          }, {
            value: "span",
            selected: f.attributes.hasOwnProperty("layout_type") && "span" === f.attributes.layout_type ? "true" : "",
            text: "Inline (span)"
          }, {
            value: "none",
            selected: f.attributes.hasOwnProperty("layout_type") && "none" === f.attributes.layout_type ? "true" : "",
            text: "Raw (no formatting)"
          }]
        },
        css: {
          label: EasyEditLocalise._("CSS class"),
          id: "css_class_" + e.id,
          value: f.attributes.hasOwnProperty("css_class") ? f.attributes.css_class : ""
        },
        classSelect: {
          id: "class_select_" + e.id,
          defaultText: EasyEditLocalise._("Leave Unchanged"),
          values: EasyEditConfig.hasOwnProperty("classSelect") ? EasyEditConfig.classSelect : ""
        },
        direction: {
          label: EasyEditLocalise._("Direction"),
          id: "dir_" + e.id,
          values: [{
            value: "",
            selected: "true",
            text: EasyEditLocalise._("Not set")
          }, {
            value: "ltr",
            text: EasyEditLocalise._("Left to right"),
            selected: "ltr" === j ? "selected" : ""
          }, {
            value: "rtl",
            text: EasyEditLocalise._("Right to left"),
            selected: "rtl" === j ? "selected" : ""
          }]
        },
        content_type: {
          label: EasyEditLocalise._("Type"),
          id: "content_type_" + e.id,
          values: h
        },
        template: {
          label: EasyEditLocalise._("Template"),
          id: "template_" + e.id,
          values: l,
          className: n
        },
        keywords: {
          label: EasyEditLocalise._("Disable keywords?"),
          id: "disable_keywords_" + e.id,
          value: 1,
          checked: f.attributes.hasOwnProperty("disable_keywords") && "1" === f.attributes.disable_keywords ? 'checked="checked"' : ""
        }
      }
    });
    j = EasyEdit.tmpl.render("default_button", {
      "class": "alignRight",
      href: "#",
      title: EasyEditLocalise._("Set Properties"),
      content: EasyEditLocalise._("Set Properties"),
      attr: {
        id: "edit_properties_ok_" + e.id
      }
    });
    l = EasyEdit.tmpl.render("light_button", {
      "class": "alignLeft",
      href: "#",
      title: EasyEditLocalise._("Cancel"),
      content: EasyEditLocalise._("Cancel"),
      attr: {
        id: "edit_properties_cancel_" + e.id
      }
    });
    d = c.tip.create({
      targetId: a,
      containerId: "ees_DivProperties_" + b,
      position: "east",
      className: "tooltipEditDiv",
      leftOffset: -18,
      topOffset: 0,
      cssPosition: "absolute",
      title: EasyEditLocalise._("Edit Container Properties"),
      message: f,
      buttons: j + l
    });
    d.events.observe("show",
      function() {
        a.addClass("active");
        EasyEditDebug.log("EDITING DIV", e)
      });
    d.events.observe("hide", function() {
      a.removeClass("active")
    });
    e.events.observe("change", function() {
      a.parent().addClass("changed");
      a.parent().parent().addClass("props-changed")
    });
    jQuery("#class_select_" + e.id).change(function() {
      jQuery("#css_class_" + e.id).val(jQuery(this).val())
    });
    jQuery("#edit_properties_ok_" + e.id).click(function(a) {
      a.preventDefault();
      a = {
        description: jQuery("#description_" + e.id).val(),
        id: jQuery("#id_" + e.id).val(),
        content_type: jQuery("#content_type_" +
          e.id).val(),
        css_class: jQuery("#css_class_" + e.id).val(),
        layout_type: jQuery("#presentation_" + e.id).val(),
        direction: jQuery("#dir_" + e.id).val(),
        template: jQuery("#template_" + e.id).val()
      };
      if (jQuery("#disable_keywords_" + e.id).is(":checked")) a.disable_keywords = "1";
      var b = e.attribute("data");
      b.name = a.id;
      b.attributes.desc = a.description;
      b.attributes.layout_type = a.layout_type;
      b.attributes.css_class = a.css_class;
      b.attributes.disable_keywords = a.disable_keywords;
      b.attributes.direction = a.direction;
      b.attributes.content_type =
        a.content_type;
      b.attributes.template = a.template;
      e.attribute("data", b);
      c.changeProperties(e.id, a);
      d.hide()
    });
    jQuery("#edit_properties_cancel_" + e.id).click(function(a) {
      a.preventDefault();
      d.hide()
    });
    c.tip.each(function() {
      this.settings.position === "east" && this.hide()
    });
    d.toggle()
  },
  editConditionsPopup: function(a, b) {
    var c = this,
      d = c.tip.getTipById(a),
      e = c.getDivByPosition(b),
      f = e.attribute("data"),
      g = {
        condition_rules_status: "enable",
        logical_op_groups: "all_match",
        conditions: []
      };
    f.attributes.conditions && (g = jQuery.extend(g,
      f.attributes.conditions));
    if (null === b) return !1;
    for (var j = e.attribute("available_conditions"), f = [{
        value: "all_match",
        selected: "all_match" === g.logical_op_groups ? "selected" : "",
        text: EasyEditLocalise._("All condition groups are matched")
      }, {
        value: "one_match",
        selected: "one_match" === g.logical_op_groups ? "selected" : "",
        text: EasyEditLocalise._("At least 1 condition group is matched")
      }], h = function(a) {
        for (var c = [], d = 0; d < j.length; d++) {
          var e = j[d].split(":");
          c.push({
            value: j[d],
            selected: j[d] === a ? "selected" : "",
            text: e[0].replace(/_/g,
              " ") + " (#" + e[1] + ")"
          })
        }
        return EasyEdit.tmpl.render("bodycopy_conditions_condition", {
          input: {
            label: EasyEditLocalise._("Condition:"),
            id: "condition_" + b,
            values: c
          }
        })
      }, k = function(a) {
        for (var c = "", d = 0; d < a.conditions.length; d++) c += h(a.conditions[d]);
        d = EasyEdit.tmpl.render("icon_link", {
          "class": "addCondition alignCenter",
          href: "#",
          title: EasyEditLocalise._("Add a condition to the above group"),
          content: EasyEditLocalise._("Add Condition")
        });
        a = [{
          value: "all_match",
          selected: "all_match" === a.logical_op ? "selected" : "",
          text: EasyEditLocalise._("All conditions are True")
        }, {
          value: "one_match",
          selected: "one_match" === a.logical_op ? "selected" : "",
          text: EasyEditLocalise._("At least 1 condition is True")
        }, {
          value: "none_match",
          selected: "none_match" === g.logical_op_groups ? "selected" : "",
          text: EasyEditLocalise._("All conditions are False")
        }, {
          value: "one_mismatch",
          selected: "one_mismatch" === g.logical_op_groups ? "selected" : "",
          text: EasyEditLocalise._("At least 1 condition is False")
        }];
        return EasyEdit.tmpl.render("bodycopy_conditions_group", {
          headings: {
            section_name: EasyEditLocalise._("Group")
          },
          input: {
            logical_op: {
              label: EasyEditLocalise._("This condition group will be matched when:"),
              id: "logical_op_conditions_" + b,
              values: a
            }
          },
          conditionsHTML: "" === c ? [] : c,
          conditions_label: EasyEditLocalise._("Conditions"),
          buttons: {
            add_condition: d
          }
        })
      }, l = "", n = 0; n < g.conditions.length; n++) var m = k(g.conditions[n]),
      l = l + m;
    n = EasyEdit.tmpl.render("light_plus_button", {
      "class": "alignCenter iconLink",
      href: "#",
      title: EasyEditLocalise._("Add a condition group"),
      content: EasyEditLocalise._("Add Group"),
      attr: {
        id: "bodycopy_conditions_add_group_" +
          b
      }
    });
    f = EasyEdit.tmpl.render("bodycopy_conditions_popup", {
      headings: {
        section_name: EasyEditLocalise._("Settings")
      },
      input: {
        enable: {
          label: EasyEditLocalise._("Enable display conditions for this container"),
          id: "condition_rules_status_" + b,
          not_applied_class: "enable" === g.condition_rules_status ? "screenHide" : ""
        },
        logical_op_groups: {
          label: EasyEditLocalise._("If enabled, this container will be displayed when:"),
          id: "logical_op_grouping_" + b,
          values: f
        }
      },
      buttons: {
        add_group: n
      },
      groupsHTML: "" === l ? [] : l
    });
    l = EasyEdit.tmpl.render("default_button", {
      "class": "alignRight",
      href: "#",
      title: EasyEditLocalise._("Apply changes to this container"),
      content: EasyEditLocalise._("Apply Changes"),
      attr: {
        id: "bodycopy_conditions_ok_" + b
      }
    });
    n = EasyEdit.tmpl.render("light_button", {
      "class": "alignLeft",
      href: "#",
      title: EasyEditLocalise._("Cancel"),
      content: EasyEditLocalise._("Cancel"),
      attr: {
        id: "bodycopy_conditions_cancel_" + b
      }
    });
    d = c.tip.create({
      targetId: a,
      containerId: "ees_DivConditions_" + b,
      className: "tooltipDivConditions",
      position: "east",
      leftOffset: 20,
      topOffset: 0,
      cssPosition: "absolute",
      title: EasyEditLocalise._("Container Display Conditions"),
      message: f,
      buttons: l + n
    });
    new EasyEditSlider({
      bindElem: d.$element.find(".enabledSlider"),
      defaultVal: "enable" === g.condition_rules_status ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No"),
      options: [
        [EasyEditLocalise._("Yes"), EasyEditLocalise._("Enable display conditions on this container"), function() {
          d.$element.find(".condsDisabled").addClass("screenHide")
        }],
        [EasyEditLocalise._("No"), EasyEditLocalise._("Disable display conditions; this container will always be displayed"),
          function() {
            d.$element.find(".condsDisabled").removeClass("screenHide")
          }
        ]
      ]
    });
    d.events.observe("show", function() {
      a.addClass("active")
    });
    d.events.observe("hide", function() {
      a.removeClass("active")
    });
    e.events.observe("change", function() {
      a.parent().addClass("changed");
      a.parent().parent().addClass("props-changed")
    });
    var o = function(a) {
        var b = jQuery(a.target).parents(".section.sectionGroup");
        b.fadeOut("fast", function() {
          1 >= b.parents(".tooltipMessage").find(".sectionGroup").length && ($nothingSet = jQuery("<div></div>"),
            $nothingSet.addClass("section nothingSet"), $nothingSet.html('<div class="message">' + EasyEditLocalise._("No condition groups have been added") + "</div>"), $nothingSet.insertBefore(b));
          b.remove()
        })
      },
      r = function(a) {
        var b = jQuery(a.target).parents(".row.changeCondition");
        b.fadeOut("fast", function() {
          1 >= b.parents(".sectionGroup").find(".changeCondition").length && ($nothingSet = jQuery("<div></div>"), $nothingSet.addClass("section nothingSet"), $nothingSet.html('<div class="message">' + EasyEditLocalise._("No conditions have been added") +
            "</div>"), $nothingSet.insertBefore(b));
          b.remove()
        })
      },
      p = function(a) {
        a.preventDefault();
        var b = h(null),
          a = jQuery(a.target),
          c = a.parents(".section").children(".section.nothingSet");
        c && c.remove();
        jQuery(a.parents(".row")[0]).before(b);
        jQuery(a.parents(".row")[0].previousSibling).children(".delete").click(r)
      };
    jQuery(jQuery.find("#ees_DivConditions_" + b + " .sectionGroup .buttonRow a")).click(p);
    jQuery(jQuery.find("#ees_DivConditions_" + b + " .sectionGroup > .delete")).click(o);
    jQuery(jQuery.find("#ees_DivConditions_" +
      b + " .sectionGroup .changeCondition .delete")).click(r);
    jQuery("#bodycopy_conditions_ok_" + b).click(function(a) {
      a.preventDefault();
      var f = jQuery("#ees_DivConditions_" + b),
        a = {
          condition_rules_status: "0" === "" + f.find(".enabledSlider .selected").attr("data-id") ? "enable" : "disable",
          logical_op_groups: f.find("#logical_op_grouping_" + b)[0].value,
          conditions: []
        };
      $condGroups = f.find(".section.sectionGroup");
      for (f = 0; f < $condGroups.length; f++) {
        var k = jQuery($condGroups[f]),
          g = {
            logical_op: k.find(".changeLogicalOp select")[0].value,
            conditions: []
          },
          k = k.find(".changeCondition select");
        if (0 < k.length) {
          for (var l = 0; l < k.length; l++) g.conditions.push(k[l].value);
          a.conditions.push(g)
        }
      }
      f = e.attribute("data");
      f.attributes.conditions = a;
      e.attribute("data", f);
      f = e.$container.parent().find(".bodycopy_tools .bodycopy_conditions");
      f.removeClass("available enabled");
      a.conditions && 0 < a.conditions.length && f.addClass("available");
      a.condition_rules_status && "enable" === a.condition_rules_status && f.addClass("enabled");
      c.changeProperties(e.id, {
        conditions: a
      });
      e.events.trigger("change");
      d.hide()
    });
    jQuery("#bodycopy_conditions_cancel_" + b).click(function(a) {
      a.preventDefault();
      d.hide()
    });
    jQuery("#bodycopy_conditions_add_group_" + b).click(function(a) {
      a.preventDefault();
      var b = k({
          logical_op: "all_match",
          conditions: []
        }),
        a = jQuery(a.target).parents(".section"),
        c = a.parent().children(".section.nothingSet");
      c && c.remove();
      b = jQuery(b);
      jQuery(b.find(".buttonRow a")).click(p);
      jQuery(b.children(".delete")).click(o);
      a.before(b)
    });
    c.tip.each(function() {
      "east" === this.settings.position &&
        this.hide()
    });
    d.toggle()
  },
  insertDivPopup: function(a, b) {
    function c(a, b) {
      return b + "_insert_" + a
    }
    var d = this,
      e = d.tip.getTipById(a);
    if (null === b) return !1;
    var f = EasyEdit.systemInfo.preferences.bodycopy_container.SQ_DEFAULT_CONTENT_TYPE,
      g = EasyEdit.systemInfo.preferences.bodycopy_container.SQ_DEFAULT_PRESENTATION_TYPE;
    if (null === e) {
      d.getDivByPosition(b);
      var j = d.availableTemplates,
        h = [{
          value: "--",
          text: EasyEditLocalise._("-- None --"),
          selected: ""
        }],
        k = "";
      if ("undefined" !== typeof j && 0 < j.length)
        for (var l in j) j.hasOwnProperty(l) &&
          null != j[l] && h.push({
            value: j[l].assetid,
            text: j[l].name + " (#" + j[l].assetid + ")",
            selected: ""
          });
      else k = "screenHide";
      j = [{
        value: "content_type_wysiwyg",
        selected: "",
        text: EasyEditLocalise._("WYSIWYG")
      }, {
        value: "content_type_raw_html",
        selected: "",
        text: EasyEditLocalise._("Raw HTML")
      }, {
        value: "content_type_code",
        selected: "",
        text: EasyEditLocalise._("Code")
      }, {
        value: "content_type_nest_content",
        selected: "",
        text: EasyEditLocalise._("Nested content")
      }];
      EasyEditConfig.hasOwnProperty("markdownEnabled") && EasyEditConfig.markdownEnabled &&
        j.push({
          value: "content_type_markdown",
          selected: "",
          text: EasyEditLocalise._("Markdown")
        });
      j = j.map(function(a) {
        a.value === f && (a.selected = "selected");
        return a
      });
      h = {
        headings: {
          identifier: EasyEditLocalise._("Identifier"),
          styling: EasyEditLocalise._("Styling"),
          type: EasyEditLocalise._("Type")
        },
        input: {
          identifier: {
            label: EasyEditLocalise._("ID name"),
            id: c(b, "id"),
            value: ""
          },
          presentation: {
            label: EasyEditLocalise._("Presentation"),
            id: c(b, "presentation"),
            values: [{
              value: "div",
              selected: "",
              text: EasyEditLocalise._("Block (div)")
            }, {
              value: "section",
              selected: "",
              text: EasyEditLocalise._("Section (section)")
            }, {
              value: "article",
              selected: "",
              text: EasyEditLocalise._("Article (article)")
            }, {
              value: "span",
              selected: "",
              text: EasyEditLocalise._("Inline (span)")
            }, {
              value: "none",
              selected: "",
              text: EasyEditLocalise._("Raw (no formatting)")
            }]
          },
          css: {
            label: EasyEditLocalise._("CSS class"),
            id: c(b, "css_class"),
            value: ""
          },
          classSelect: {
            id: c(b, "class_select"),
            defaultText: EasyEditLocalise._("Leave Unchanged"),
            values: EasyEditConfig.hasOwnProperty("classSelect") ?
              EasyEditConfig.classSelect : ""
          },
          content_type: {
            label: EasyEditLocalise._("Content type"),
            id: c(b, "content_type"),
            values: j
          },
          template: {
            label: EasyEditLocalise._("Template"),
            id: c(b, "template"),
            values: h,
            className: k
          }
        }
      };
      h.input.presentation.values = h.input.presentation.values.map(function(a) {
        a.value === g && (a.selected = "selected");
        return a
      });
      h = EasyEdit.tmpl.render("bodycopy_insert_popup", h);
      k = EasyEdit.tmpl.render("default_button", {
        "class": "alignRight",
        href: "#",
        title: EasyEditLocalise._("Insert New Container"),
        content: EasyEditLocalise._("Insert"),
        attr: {
          id: c(b, "insert_div_ok")
        }
      });
      j = EasyEdit.tmpl.render("light_button", {
        "class": "alignLeft",
        href: "#",
        title: EasyEditLocalise._("Cancel"),
        content: EasyEditLocalise._("Cancel"),
        attr: {
          id: c(b, "insert_div_cancel")
        }
      });
      e = d.tip.create({
        targetId: a,
        containerId: "ees_DivInsert_" + b,
        className: "tooltipInsertDiv",
        position: "west",
        leftOffset: 20,
        topOffset: 0,
        cssPosition: "absolute",
        title: EasyEditLocalise._("Insert New Container"),
        message: h,
        buttons: k + j
      });
      e.events.observe("show", function() {
        a.addClass("active")
      });
      e.events.observe("hide",
        function() {
          a.removeClass("active")
        });
      jQuery("#" + c(b, "class_select")).change(function() {
        jQuery("#" + c(b, "css_class")).val(jQuery(this).val())
      });
      jQuery("#" + c(b, "insert_div_ok")).click(function(a) {
        a.preventDefault();
        a = {
          position: parseFloat(b) - 1,
          container_type: "div",
          layout_type: jQuery("#" + c(b, "presentation")).val(),
          css_class: jQuery("#" + c(b, "css_class")).val(),
          id: jQuery("#" + c(b, "id")).val(),
          content_type: jQuery("#" + c(b, "content_type")).val(),
          template: jQuery("#" + c(b, "template")).val(),
          before: parseFloat(b) >
            d.bodycopies.length ? 0 : 1
        };
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Inserting new div...")
        });
        d.insert(a);
        EasyEditScreens.saveCurrentScreen(function() {
          EasyEditOverlay.hideOverlay()
        })
      });
      jQuery("#" + c(b, "insert_div_cancel")).click(function(a) {
        a.preventDefault();
        e.hide()
      })
    }
    d.tip.each(function() {
      "west" === this.settings.position && this.hide()
    });
    e.toggle()
  },
  deleteDiv: function(a, b) {
    var c = this,
      d = c.getDivByPosition(b);
    if (null !== d) {
      $topContainer = null;
      d.$container.parent() && ($topContainer =
        d.$container.parent(), $topContainer.addClass("selected_div"));
      if (-1 !== d.attribute("data").status.indexOf("Safe Edit")) return EasyEditOverlay.showOverlay("confirm", {
        title: EasyEditLocalise._("Warning"),
        message: '<p class="confirmMessage">' + EasyEditLocalise._("You cannot delete divs in safe edit.") + "</p>",
        confirmText: "Ok",
        cancelFn: function() {
          $topContainer && $topContainer.removeClass("selected_div");
          EasyEditOverlay.hideOverlay("confirm")
        },
        confirmFn: function() {
          $topContainer && $topContainer.removeClass("selected_div");
          EasyEditOverlay.hideOverlay("confirm")
        }
      }), !1;
      EasyEditOverlay.showOverlay("confirm", {
        message: EasyEditLocalise._("Are you sure you want to delete this container?"),
        confirmFn: function() {
          $topContainer && $topContainer.removeClass("selected_div");
          EasyEditOverlay.hideOverlay("confirm");
          EasyEditOverlay.showOverlay("loading", {
            message: EasyEditLocalise._("Removing container...")
          });
          c.remove(d.id);
          EasyEditScreens.saveCurrentScreen(function() {
            EasyEditOverlay.hideOverlay("loading")
          })
        },
        cancelFn: function() {
          $topContainer &&
            $topContainer.removeClass("selected_div");
          EasyEditOverlay.hideOverlay("confirm")
        }
      })
    }
  },
  reRenderWysiwyg: function() {
    var a = this;
    $wysiwygs = jQuery("div[id$=_wysiwyg_container]", a.containerId);
    $wysiwygs.length && ($wysiwygs.find("script").remove(), $wysiwygs.each(function() {
      var b = jQuery(this).find('div[id$="_contents_div"]');
      b.length && (b.removeAttr("onclick"), jQuery(this).removeAttr("style"), jQuery('div[id$="_switch_option_div"]', this).remove(), b = b.attr("id").replace("_contents_div", ""), jQuery('input[id="' +
        b + '_default"]', a.containerId).removeAttr("onclick"))
    }))
  },
  _filterNotSupported: function(a) {
    return 0 < jQuery('input[id*="_hierarchy"]', a).length ? '<div class="notSupported">' + EasyEditLocalise._("Use admin mode to edit this field.") + "</div>" : a.html()
  },
  _reRenderMetadata: function(a, b) {
    var c = this,
      d = "",
      e = jQuery(a);
    $sectionTables = e.find("table.sq-backend-section-table-inner").find("td.sq-limbo-field:eq(0)").parent().parent().parent();
    $sectionTables.length || (d = e.html());
    "schema" == b ? jQuery($sectionTables).parent().parent().prev().find("td.sq-limbo-section-subheading:eq(0)").parents(".sq-backend-section-table-inner").parents(".sq-backend-section-table").find('td[class$="heading"]:eq(0)').each(function(a) {
      var b =
        jQuery(this),
        a = '<h3 class="schemaHeading_' + a + '">' + b.text() + "</h3>";
      d += a;
      $sectionTables = b.parent().next().find("table.sq-backend-section-table");
      $sectionTables.each(function(a) {
        var b = jQuery(this).children().find("td.sq-limbo-section-subheading:eq(0)").text();
        d += '<h4 class="sectionHeading_' + a + '">' + b + '</h4><div class="editSection section_' + a + '">';
        jQuery(".sq-limbo-field", this).each(function(a) {
          var b = jQuery(this),
            e = jQuery(this).next(),
            f = e.find(".sq-backend-smallprint"),
            g = 0 === e.find("input, textarea, select").length,
            h = 0 < jQuery(':contains("*")', b).length,
            b = '<span class="inputLabel">' + b.text() + '</span><span class="notes">' + f.html() + "</span>";
          f.hide();
          e.find("input[type=text]").addClass("inputText typeText");
          e.find("textarea").addClass("inputText typeTextArea");
          e.find("select").addClass("typeSelect");
          e.find("input[type=radio]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeRadioSelect");
          e.find("input[type=checkbox]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeCheckBoxSelect");
          e.find('input[id$="_default"]').addClass("defaultCheckbox");
          e.find('label[for$="_default"]').addClass("defaultLabel");
          e.find('div[id*="metadata_field_related_asset"]').addClass("typeRelatedAsset");
          e.find('span[id*="_select"]').css("display", "block");
          e.find('div[id$="_wysiwyg_container"]').addClass("wysiwygContainer content_type_wysiwyg").nextAll().css("clear", "both");
          e.find('div[id$="switch_option_div"]').addClass("wysiwygSwitchers");
          e.find('div[id$="default_html_container"]').addClass("wysiwygDefaultContainer");
          e.find('input[id*="metadata_field_date"]').parent().addClass("dateTime");
          h && !g && e.prepend('<span title="' + EasyEditLocalise._("Required") + '" class="fieldRequired"><span></span></span>');
          f = "";
          g && (e.prepend('<span title="' + EasyEditLocalise._("Non Editable") + '" class="fieldNonEditable"><span></span></span>'), f = "locked");
          g = c._filterNotSupported(e);
          h = e.find("div[id$=_wysiwyg_container]").length ? "rowWithWYSIWYG" : "";
          h = e.find("input[id^=metadata_field_thesaurus]").length ? "thesaurusContainer" : h;
          e.find("th:first").length && "Term" === jQuery.trim(e.find("th:first").text()) && (h = "thesaurusContainer");
          d += '<div class="row ' + h + " row_" + a + '"><div class="cellName">' + b + '</div><div class="cellData ' + f + '">' + g + "</div></div>"
        });
        d += "</div>"
      })
    }) : "section" == b && $sectionTables.each(function(a) {
      var b = jQuery(this).parent().parent().parent().find("td.sq-limbo-section-heading:eq(0)").text();
      d += '<h4 class="sectionHeading_' + a + '">' + b + '</h4><div class="editSection section_' + a + '">';
      jQuery(".sq-limbo-field", this).each(function(a) {
        var b = jQuery(this),
          e = jQuery(this).next(),
          f = e.find(".sq-backend-smallprint"),
          g = 0 === e.find("input, textarea, select").length,
          m = 0 < jQuery(':contains("*")', b).length,
          b = '<span class="inputLabel">' + b.text() + '</span><span class="notes">' + f.html() + "</span>";
        f.hide();
        e.find("input[type=text]").addClass("inputText typeText");
        e.find("textarea").addClass("inputText typeTextArea");
        e.find("select").addClass("typeSelect");
        e.find("input[type=radio]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeRadioSelect");
        e.find("input[type=checkbox]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeCheckBoxSelect");
        e.find('input[id$="_default"]').addClass("defaultCheckbox");
        e.find('label[for$="_default"]').addClass("defaultLabel");
        e.find('div[id*="metadata_field_related_asset"]').addClass("typeRelatedAsset");
        e.find('span[id*="_select"]').css("display", "block");
        e.find('div[id$="_wysiwyg_container"]').addClass("wysiwygContainer content_type_wysiwyg").nextAll().css("clear", "both");
        e.find('div[id$="switch_option_div"]').addClass("wysiwygSwitchers");
        e.find('div[id$="default_html_container"]').addClass("wysiwygDefaultContainer");
        e.find('input[id*="metadata_field_date"]').parent().addClass("dateTime");
        m && !g && e.prepend('<span title="' + EasyEditLocalise._("Required") + '" class="fieldRequired"><span></span></span>');
        f = "";
        g && (e.prepend('<span title="' + EasyEditLocalise._("Non Editable") + '" class="fieldNonEditable"><span></span></span>'), f = "locked");
        g = c._filterNotSupported(e);
        m = e.find("div[id$=_wysiwyg_container]").length ? "rowWithWYSIWYG" : "";
        m = e.find("input[id^=metadata_field_thesaurus]").length ? "thesaurusContainer" : m;
        e.find("th:first").length && "Term" === jQuery.trim(e.find("th:first").text()) && (m = "thesaurusContainer");
        d += '<div class="row ' + m + " row_" + a + '"><div class="cellName">' + b + '</div><div class="cellData ' + f + '">' + g + "</div></div>"
      });
      d += "</div>"
    });
    return d
  },
  _attachMetadataEvents: function() {
    function a(a, b, e) {
      a.append('<li class="child"><a href="#" class="assetDeleteOption alignRight" title="' + EasyEditLocalise._("Delete this option") + '"></a><a class="dragIcon alignLeft" title="' + EasyEditLocalise._("Drag to re-arrange") + '" href="#"></a><input type="text" name="' + b + '" value="' + e + '" /></li>')
    }
    this.attachWysiwygEvents();
    jQuery(".sq-metadata-date-wrapper", this.containerId).find("input[id*=metadata_field_date_],select[id*=metadata_field_date_]").not("input[id$=default]").change(function() {
      jQuery(this).parent().find("input[id$=default]").attr("checked", !1)
    }).parent().addClass("dateTime").find('b:contains("OR")').text("Otherwise Select");
    jQuery(".dateTime", this.containerId).find("input[type=text]").parents(".dateTime").addClass("dateTimeTextInputs");
    jQuery("div[id$=_switch_option_div]").click(function() {
      EasyEditComponentsToolbar.enableSaveButton()
    });
    jQuery('div[id*="metadata_field_related_asset"]', this.containerId).filter(function() {
      return jQuery(this).is('[id$="_default_ra_container"]')
    }).each(function() {
      function a(c, e) {
        var f = jQuery(e);
        "" !== c ? w[e].loadAsset(c, null, function(a) {
          f.find("input[id*=assetid]").val(a.id);
          f.find("input[id$=label]").val(a.attribute("name") + " - #" + a.id);
          f.find("input[id*=linkid]").val(a.attribute("link_info").link_id)
        }) : (f.find("input[id*=assetid]").val(""), f.find("input[id$=label]").val(""), f.find("input[id*=linkid]").val(""));
        f.next("div[id*=metadata_field_related_asset]").removeClass("screenHide");
        b()
      }

      function b() {
        1 < g.find(".relatedMetadata:not(.screenHide)").length ? (g.find("a.sortHandle").addClass("dragIcon"), g.sortable({
          axis: "y",
          handle: ".dragIcon",
          stop: function() {
            EasyEditComponentsToolbar.enableSaveButton();
            q.attr("checked", !1)
          }
        })) : g.find("a.sortHandle").removeClass("dragIcon")
      }
      var e = jQuery(this),
        f = [],
        g = e.prev("div"),
        j = e.parent(),
        h = g.find("input");
      h.addClass("screenHide");
      j.append(h);
      h.each(function() {
        f.push({
          id: jQuery(this).attr("id"),
          value: jQuery(this).val()
        })
      });
      g.find("div.sq-multiple-asset-finder-wrapper").detach();
      g.appendTo(j);
      var h = g.attr("id"),
        k = j.find("input[id*=\\[assetid\\]]"),
        l = g.data("restricted-types");
      l && (l = l.split("|"));
      var n = g.data("restricted-roots");
      n && (n = n.split("|"), n.pop());
      var m = g.data("asset-types");
      m && (m = m.split("|"));
      for (var o = [], r = [], p = 1, s = 0; s < k.length; s++) $currentAssetField = jQuery(k[s]), p = $currentAssetField.val(), 0 == p && (p = ""), o[s] = p, r[s] = h + "_" + s, p = jQuery('<div id="' + r[s] + '"></div>'), p.append('<div id="' +
          r[s] + '_picker"></div>'), p.append(j.find("input[id*=\\[" + s + "\\]]")), p.append(j.find("input[id$=_" + s + "__label]")), baseFieldName = $currentAssetField.attr("id").replace("[assetid]", ""), p.append('<input id="sq_asset_finder_' + baseFieldName + '_assetid" name="sq_asset_finder_' + baseFieldName + '_assetid" value="' + $currentAssetField.val() + '" class="screenHide" type="text" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_label" name="sq_asset_finder_' + baseFieldName + '_label" value="" class="screenHide" type="text" />'),
        g.append(p), p = s;
      h.replace(/^.*?([0-9]+)_ra_container$/, "$1");
      (k = g.data("max-selections")) || (k = 1);
      if (p < k)
        for (s = p + 1; s < k; s++) r[s] = h + "_" + s, p = jQuery('<div id="' + r[s] + '" class="screenHide"></div>'), p.append('<div id="' + r[s] + '_picker"></div>'), baseFieldName = h.replace(/_ra_container$/, "") + "_value[" + s + "]", p.append('<input id="' + baseFieldName + '[assetid]" name="' + baseFieldName + '[assetid]" value="" class="screenHide" type="hidden" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_assetid" name="sq_asset_finder_' +
          baseFieldName + '_assetid" value="" class="screenHide" type="text" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_label" name="sq_asset_finder_' + baseFieldName + '_label" value="" class="screenHide" type="text" />'), g.append(p);
      e.hide();
      g.show();
      var q = jQuery(".defaultCheckbox", j.parent());
      q.attr("onclick", "");
      var t = e.find("span.sq-info-assetid");
      q.click(function() {
        for (var a = true, c = 0; c < r.length; c++) {
          var e = jQuery.data(j.get(0), "picker" + c),
            f = t[c] !== void 0 ? jQuery(t[c]).text() : "",
            k = jQuery("#" +
              r[c]);
          if (jQuery(this).is(":checked"))
            if (f === "") {
              if (a) {
                k.removeClass("screenHide");
                a = false
              } else k.addClass("screenHide");
              e.clear()
            } else {
              k.removeClass("screenHide");
              e.loadAsset(f, null, function(a) {
                k.find("input[id*=assetid]").val(a.id);
                k.find("input[id$=label]").val(a.attribute("name") + " - #" + a.id);
                k.find("input[id*=linkid]").val(a.attribute("link_info").link_id)
              })
            }
          else if (f === "" && a) {
            k.removeClass("screenHide");
            a = false
          }
        }
        b()
      });
      j.find('img[src$="asset_locator.png"]').hide();
      for (var w = [], s = 0; s < r.length; s++) {
        var e =
          "#" + r[s],
          p = o[s],
          v = {
            bindElem: e + "_picker",
            bindFn: function(b) {
              return function(d) {
                typeof d === "undefined" || d === null ? a("", b) : a(d.id, b);
                EasyEditComponentsToolbar.enableSaveButton()
              }
            }(e),
            itemRefiner: function(a) {
              if (a.type_code === "image_variety") a.is_dependant = 0;
              return a
            },
            types: l,
            restrictedRootNodes: n,
            groupId: 1 < k ? "field_group_" + h.replace(/[^\d]/g, "") : ""
          };
        if (p) {
          var u = void 0 !== m[s] ? m[s] : "";
          v.prefillNode = {
            assetid: p,
            type_code: u,
            type: u.replace("_", " ").replace(/\S+/g, function(a) {
              return a.charAt(0).toUpperCase() +
                a.substr(1)
            }),
            name: jQuery(e).find("input[id$=label]").val()
          }
        }
        w[e] = new EasyEditAssetPicker(v);
        jQuery.data(j.get(0), "picker" + s, w[e]);
        e = jQuery(e);
        e.addClass("relatedMetadata fieldContainer");
        e.prepend('<a class="sortHandle alignLeft" title="Drag to re-arrange" href="#"></a>')
      }
      g.find(".assetChangeButton").bind("click", function() {
        q.is(":checked") && q.attr("checked", false)
      });
      g.find(".assetClearSelection").bind("click", function() {
        q.is(":checked") && q.attr("checked", false)
      });
      b()
    });
    $multipletextfield = jQuery("div.sq-metadata-multitext-wrapper",
      this.containerId);
    $multipletextfield.addClass("multipleText");
    var b = jQuery(".multipleText", this.containerId);
    b.find("input:disabled").parents(".multipleText").addClass("disabled");
    b.each(function() {
      function b() {
        d.find("input[type=text]").each(function(a) {
          jQuery(this).attr("id", f.replace("[]", "[" + a + "]"))
        })
      }
      var d = jQuery(this),
        e = d.clone();
      d.empty();
      var f = e.find("input[type=text]:first").attr("name");
      d.html('<ul class="ees_directChildrenList"></ul>');
      var g = d.find("ul");
      e.find("input[type=text]").each(function() {
        a(g,
          f, jQuery(this).val())
      });
      g.on("focus", "input[type=text]", function() {
        var d = g.find("input[type=text]"),
          e = g.find("input:last"),
          k = jQuery(this).val(),
          h = 0;
        d.each(function() {
          "" === jQuery(this).val() && (h += 1)
        });
        "" === e.val() && "" === k && 2 > h && (a(g, f, ""), b())
      });
      d.prepend(e.find(".fieldRequired"));
      d.append(e.find("input.defaultCheckbox"));
      d.append(e.find('label[for$="_default"]'));
      var j = d.prev().find("input.defaultCheckbox"),
        h = (j.attr("onclick") + "").match(/\[(.*)\]/);
      null !== h && (h = h[0]);
      var k = null !== h ? eval(h) : null;
      j.attr("onclick", "");
      j.unbind("click");
      j.is(":checked") && d.find("input[type=text]").attr("disabled", !0).parent().addClass("defaultMode");
      window.handleDefaultClickMT = function() {};
      j.click(function() {
        d.toggleClass("disabled");
        if (j.is(":checked")) {
          g.empty();
          if (null !== k) {
            for (var l = 0, h = k.length; l < h; l++) a(g, f, k[l]);
            a(g, f, "")
          } else e.find("input[type=text]").each(function() {
            a(g, f, jQuery(this).val())
          });
          d.find("input[type=text]").not(".deleted").attr("disabled", !0).parent().addClass("defaultMode");
          b()
        } else d.find("input[type=text]").not(".deleted").attr("disabled", !1).parent().removeClass("defaultMode")
      });
      d.on("click", ".assetDeleteOption", function(a) {
        a.preventDefault();
        if (j.is(":checked")) return !1;
        EasyEditComponentsToolbar.enableSaveButton();
        var a = jQuery(this).parent(),
          b = a.find("input");
        a.hasClass("markedForDeletion") ? (a.removeClass("markedForDeletion").removeClass("defaultMode"), b.attr("disabled", !1).removeClass("deleted")) : (a.addClass("markedForDeletion").addClass("defaultMode"), b.attr("disabled", !0).addClass("deleted"))
      });
      b();
      g.sortable({
        axis: "y",
        handle: ".dragIcon",
        cancel: "li.defaultMode",
        stop: function() {
          EasyEditComponentsToolbar.enableSaveButton();
          b()
        }
      })
    });
    jQuery(".thesaurusContainer", this.containerId).each(function() {
      var a = jQuery('div[id$="_interface"]', this);
      if (a.length) {
        var b = a.attr("id"),
          e = /Id:\s#([0-9]+)/gi.exec(a.text());
        if (!EasyEdit.isset(e)) return !1;
        var f = jQuery(this).find('input[id$="_default"]'),
          g = jQuery('div[id$="_defaults"]', this);
        g.addClass("screenHide");
        var g = g.text(),
          j = [];
        "" !== g && (j = g.split(","));
        a.attr("id", b + "_old").addClass("screenHide");
        g = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field", {
          default_items: j,
          id: b + "_select",
          options: [{
            text: EasyEditLocalise._("-- Select a term --"),
            value: ""
          }],
          description: EasyEditLocalise._("There are currently no terms configured"),
          title: EasyEditLocalise._("Add"),
          loading_message: EasyEditLocalise._("Loading terms...")
        }));
        jQuery(this).append(g);
        var h = jQuery(EasyEdit.tmpl.render("light_button", {
            href: "#",
            title: EasyEditLocalise._("Click to load terms"),
            content: EasyEditLocalise._("Click to load terms"),
            attr: {
              id: b + "_loadTerms"
            }
          })),
          k = jQuery("select", this),
          g = jQuery("a.addNew", this),
          l = jQuery("ul.editableItems", this),
          n = jQuery("ul.defaultItems", this),
          m = jQuery("div.addNewTerm", this),
          j = jQuery("div.clickToLoadTerms", this),
          o = jQuery("div.loadingTerms", this);
        j.append(h);
        j = function() {
          f.is(":checked") ? (l.addClass("screenHide"), n.removeClass("screenHide"), h.addClass("screenHide"), m.addClass("screenHide")) : (l.removeClass("screenHide"), 1 === k.find("option").length ? h.removeClass("screenHide") : m.removeClass("screenHide"),
            n.addClass("screenHide"))
        };
        f.removeAttr("onclick");
        f.click(j);
        j();
        var r = function(a, c) {
          if ("" !== a && 0 !== a && !l.find('input[value="' + a + '"]').length) {
            l.find(".defaultItem").remove();
            var e = jQuery("li", l).length,
              e = b.replace("_interface", "") + "_thes_term[" + e + "][assetid]",
              f = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field_tag", {
                delete_title: EasyEditLocalise._("Delete this tag"),
                drag_title: EasyEditLocalise._("Drag to re-arrange"),
                tag: c,
                id: e,
                name: e,
                value: a
              }));
            l.append(f);
            f.find("a.assetDeleteOption").click(function(a) {
              a.preventDefault();
              f.toggleClass("markedForDeletion");
              f.hasClass("markedForDeletion") ? f.find("input").attr("disabled", "disabled") : f.find("input").removeAttr("disabled");
              EasyEditComponentsToolbar.enableSaveButton()
            })
          }
          EasyEditComponentsToolbar.enableSaveButton()
        };
        f.is(":checked") || a.find('input[id$="[assetid]"]').each(function(b) {
          var d = jQuery(this).val(),
            b = a.find('input[id$="' + b + '__label"]').val();
          "" !== d && 0 !== d && "" !== b && r(d, b)
        });
        a.find("input").not('[id$="_terms_submitted"]').remove();
        g.click(function(a) {
          a.preventDefault();
          f.is(":checked") && f.removeAttr("checked");
          var a = k.val(),
            b = k.find("option:selected").text();
          r(a, b)
        });
        var p = function(a, b) {
          var c = k.find("option:first");
          c.text(EasyEditLocalise._("Loading..."));
          EasyEditAssetManager.getAssetMap({
            assetids: [{
              id: a
            }],
            callback: function(d) {
              if (EasyEdit.isset(d["ID_" + a]) && d["ID_" + a].hasOwnProperty("children"))
                for (var d = d["ID_" + a].children, e = 0, f = d.length; e < f; e += 1) k.append('<option value="' + decodeURIComponent(d[e].assetid) + '">' + decodeURIComponent(d[e].name).replace(/\+/g, " ") + "</option>"),
                  d[e].assetid && (p(d[e].assetid, b), b.call(this));
              c.text(EasyEditLocalise._("-- Select a term --"));
              b.call(this)
            }
          })
        };
        l.sortable({
          axis: "y",
          handle: ".dragIcon",
          cancel: "li.markedForDeletion",
          stop: function() {
            EasyEditComponentsToolbar.enableSaveButton();
            l.find("input").each(function(a) {
              a = b.replace("_interface", "") + "_thes_term[" + a + "][assetid]";
              jQuery(this).attr("id", a).attr("name", a)
            })
          }
        });
        if (EasyEdit.isset(e) && EasyEdit.isset(e[1])) {
          var s = parseFloat(e[1]);
          h.click(function(a) {
            a.preventDefault();
            h.addClass("screenHide");
            o.removeClass("screenHide");
            p(s, function() {
              o.addClass("screenHide");
              m.removeClass("screenHide")
            })
          });
          k.bind("change", function() {
            f.is(":checked") && f.removeAttr("checked")
          })
        }
      } else {
        var q = [];
        jQuery("a", this).each(function() {
          "#" !== jQuery(this).attr("href") && q.push(jQuery(this).text())
        });
        g = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field", {
          default_items: q
        }));
        jQuery(this).append(g);
        jQuery("ul.defaultItems", this).removeClass("screenHide");
        jQuery("table", this).remove()
      }
    })
  },
  attachWysiwygEvents: function() {
    var a =
      this;
    $wysiwygs = jQuery('div[id$="_wysiwyg_container"]', this.containerId);
    $wysiwygs.length && (null === a.viper ? a.viper = EasyEdit.loadViper({
      editableDivs: $wysiwygs.find('div[id$="_contents_div"]'),
      scrollable: !0,
      scrollThreshold: 118,
      viperName: "metadata-screen"
    }) : $wysiwygs.find('div[id$="_contents_div"]').each(function() {
      EasyEdit.addViperEditableElement(this, a.viper)
    }));
    $wysiwygs = jQuery(".rowWithWYSIWYG", this.containerId);
    if ($wysiwygs.length) {
      $wysiwygs.addClass("clearfix");
      jQuery("#ees_screenContentWrapper").addClass("withViper");
      if (null === a.viper) return !1;
      viper = a.getViper();
      $wysiwygs.each(function() {
        if (!jQuery(this).find(".cellData").hasClass("locked")) {
          var a = jQuery(this).find(".cellData"),
            c = jQuery(this).find('div[id$="_contents_div"]'),
            d = jQuery(this).find('input[id$="_default"]'),
            e = d.parent(),
            f = jQuery(this).find('div[id$="_default_html_container"]');
          jQuery(".ees_viperEditCallToAction", this);
          var g = viper.cleanHTML(f.html());
          f.hide();
          e.removeAttr("style").addClass("tools clearfix");
          a.prepend(e);
          var j = function() {
            if ($(this).is(":checked")) {
              viper.getViperElement() !==
                c.get(0) && viper.setEditableElement(c.get(0));
              jQuery.data(this, "originalValue", viper.getHtml());
              viper.setHtml(g)
            } else typeof jQuery.data(this, "originalValue") !== "undefined" && viper.setHtml(jQuery.data(this, "originalValue"))
          };
          c.bind("click keyup focus", function() {
            if (d.is(":checked")) {
              d.attr("checked", false);
              j.call(d.get(0))
            }
          });
          d.change(j)
        }
      })
    }
  },
  _attachEvents: function() {
    function a(a) {
      a = /position\-([0-9]+)/.exec(a);
      return null !== a ? parseFloat(a[1]) : null
    }

    function b(a, b, c) {
      var d = e.viper.Tools;
      if (c = d.getItem("MatrixKeywordsPlugin:" +
          c)) jQuery(c.input).find("option").remove(), !EasyEdit.util.isEmpty(a) && !EasyEdit.util.isArray(a) ? (c.setValue(a), d.enableButton(b)) : d.disableButton(b)
    }

    function c() {
      e.$element.find("div.bodycopy_manager_div").removeClass("active");
      var a = e.viper.getViperElement();
      if (EasyEdit.isset(a)) {
        e.$element.find(a).parent().parent().addClass("active");
        if (g !== a) {
          var c = $(a);
          b(c.data("keywords"), "insertKeywords", "insertKeywordSelect");
          b(c.data("snippets"), "insertSnippets", "insertSnippetSelect")
        }
        g = a
      }
    }

    function d() {
      e.$element.find("div.bodycopy_manager_div").removeClass("active")
    }
    var e = this;
    jQuery(".bodycopy_tools a.bodycopy_properties", e.$element).click(function(b) {
      b.preventDefault();
      b = $(this).parent().attr("class");
      e.editPropertiesPopup($(this), a(b))
    });
    jQuery(".bodycopy_tools a.bodycopy_conditions", e.$element).click(function(b) {
      b.preventDefault();
      b = $(this).parent().attr("class");
      e.editConditionsPopup($(this), a(b))
    });
    jQuery(".bodycopy_tools a.bodycopy_delete", e.$element).click(function(b) {
      b.preventDefault();
      b = $(this).parent().attr("class");
      e.deleteDiv($(this), a(b))
    });
    jQuery(".bodycopy_tools a.bodycopy_comments",
      e.$element).click(function(b) {
      b.preventDefault();
      b = $(this).parent().attr("class");
      if (viper = e.getViper()) b = e.getDivByPosition(a(b)), EasyEditViperComments.showComments(b.id, viper)
    });
    jQuery(".bodycopy_tools a.bodycopy_re_order", e.$element).click(function(b) {
      b.preventDefault();
      var b = $(this).parent().attr("class"),
        b = a(b),
        c = e.getDivByPosition(b);
      EasyEditOverlay.showOverlay("reorder", {
        rootNode: e.bodycopyId,
        targetDiv: c
      }, function() {
        EasyEditOverlay.hideOverlay("reorder");
        EasyEditOverlay.hideOverlay("loading");
        EasyEditScreens.saveCurrentScreen(function() {})
      });
      EasyEditOverlay.overlays.reorder.list.events.observe("render", function() {
        this.$element.find(".type").each(function() {
          var a = jQuery(this).parent().find(".assetId").text().replace("#", ""),
            a = e.getDivById(a);
          null !== a && jQuery(this).text(a.attribute("content_data").type)
        });
        EasyEdit.isset(c) && c.hasOwnProperty("id") && this.$element.find(".child-" + c.id).addClass("current")
      })
    });
    1 === e.bodycopies.length && (jQuery(".bodycopy_tools a.bodycopy_re_order", e.$element).hide(),
      jQuery(".bodycopy_tools a.bodycopy_delete", e.$element).hide());
    jQuery(".bodycopy_insert a", e.$element).click(function(b) {
      b.preventDefault();
      b = $(this).parent().attr("class");
      e.insertDivPopup($(this), a(b))
    });
    var f = e.$element.find('.content_type_wysiwyg div[id$="contents_div"][id*="content_type_wysiwyg"]');
    f.prop("onclick", null);
    f.removeAttr("onclick");
    f.addClass("bodycopy_content");
    f.closest(".sq-edit-content-type-wrapper").children().unwrap();
    var g = null;
    f.length && (e.$element.parents(".ees_viperContentWrapper").addClass("withViper"),
      null === e.viper ? e.viper = EasyEdit.loadViper({
        editableDivs: f
      }) : f.each(function() {
        EasyEdit.addViperEditableElement(this, e.viper)
      }), e.viper.registerCallback("Viper:clickedInside", "EES", c), f.focus(c), e.viper.registerCallback("Viper:clickedOutside", "EES", d), f.blur(d));
    e.events.trigger("bind")
  },
  _processMetadataWysiwygs: function(a) {
    var b = this,
      c = jQuery('div[id$="_wysiwyg_container"]', this.containerId);
    null !== b.viper && c.each(function() {
      var c = $(this).find('div[id$="_contents_div"][id*="metadata_field_wysiwyg_"]'),
        e = b.viper.getHtml(c.get(0));
      a.setParam(c.attr("id") + "_viper_input", e)
    })
  },
  getViper: function() {
    return this.hasOwnProperty("viper") ? this.viper : null
  }
};
var EasyEditContextSwitcher = function(a) {
  var b = this;
  this.contexts = [];
  this.alternateContextId = this.currentContextId = 0;
  this.events = new ObservableEvents(this);
  this.fetch(function() {
    if (EasyEdit.util.isArray(b.contexts) && 1 >= b.contexts.length) return a.call(b), !1;
    b.$button = jQuery(EasyEdit.tmpl.render("context_switcher", {
      id: "ees_contextSwitcherButton",
      label: EasyEditLocalise._("Change Context"),
      title: EasyEditLocalise._("Context Switcher"),
      current: b.getCurrentContextInfo().name
    }));
    var c = [];
    b.each(function(a,
      e) {
      c.push({
        val: a,
        name: e.name,
        className: parseFloat(a) === parseFloat(b.currentContextId) ? "current" : ""
      })
    });
    b.$elem = jQuery(EasyEdit.tmpl.render("context_switcher_list", {
      change_to: EasyEditLocalise._("Change to"),
      id: "ees_contextSwitcherList",
      change: EasyEditLocalise._("Change"),
      contexts: c
    }));
    jQuery("#ees_currentUser").prepend(b.$button);
    EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_currentUser .toolbarButton"));
    b.tip = EasyEdit.tip.create({
      targetId: b.$button,
      containerId: "ees_contextSwitcherContainer",
      position: "south",
      title: EasyEditLocalise._("Change Context"),
      topOffset: 20,
      cssPosition: "fixed"
    });
    b.tip.$element.find(".tooltipContent").empty();
    b.tip.$element.find(".tooltipContent").append(b.$elem);
    b.tip.events.observe("hide", function() {
      b.$button.removeClass("current")
    });
    b.tip.events.observe("show", function() {
      b.$button.addClass("current")
    });
    b.$button.click(function(a) {
      a.preventDefault();
      b.toggle()
    });
    b.$elem.find(".button").click(function(a) {
      a.preventDefault();
      a = jQuery(this).parent();
      b.change(a.attr("data-context-id"),
        a.find(".name").text());
      b.hide()
    });
    a.call(b)
  })
};
EasyEditContextSwitcher.prototype = {
  isDefault: function() {
    return 0 === this.getCurrentContextId()
  },
  getCurrentContextId: function() {
    return this.currentContextId
  },
  getCurrentContextInfo: function() {
    return this.contexts[this.getCurrentContextId()]
  },
  each: function(a) {
    jQuery.each(this.contexts, a)
  },
  fetch: function(a) {
    var b = this,
      c = new EasyEditAPI;
    c.queue("getAllContexts", {
      all_info: 1
    });
    c.queue("getCurrentContext", {
      all_info: 1
    });
    c.queue("getAlternateContext", {
      all_info: 1
    });
    c.run(function(c) {
      var e = EasyEdit.isset(c[0]) ?
        c[0].data : void 0,
        f = EasyEdit.isset(c[1]) ? c[1].data : void 0,
        c = EasyEdit.isset(c[2]) ? c[2].data : void 0;
      EasyEdit.isset(e) && e.hasOwnProperty("success") && (b.contexts = e.success);
      if (EasyEdit.isset(c) && c.hasOwnProperty("success"))
        for (var g in c.success) f.success.hasOwnProperty(g) && (b.alternateContextId = parseFloat(g));
      if (EasyEdit.isset(f) && f.hasOwnProperty("success"))
        for (var j in f.success) f.success.hasOwnProperty(j) && (b.currentContextId = parseFloat(j));
      a.call(this)
    }, c.runMode.BATCH)
  },
  change: function(a, b) {
    var c =
      new EasyEditAPI,
      d = this;
    EasyEditOverlay.showOverlay("loading", {
      message: EasyEditLocalise._("Changing context to %1", b)
    });
    c.queue("setContext", {
      context_id: a
    });
    c.run(function(c) {
      c = EasyEdit.isset(c[0]) && c[0].hasOwnProperty("data") ? c[0].data : null;
      EasyEdit.isError(c) || (d.$button.find(".name").text(b), d.$elem.find(".context").removeClass("current"), d.$elem.find('.context[data-context-id="' + a + '"]').addClass("current"), EasyEditCacheManager.clearAll(), EasyEditAssetManager.clearCurrentAssetCache(), EasyEditComponentsInfoBox.refresh(function() {
        jQuery("body.previewMode").length ?
          EasyEditComponentsToolbar.showEditMode(function() {
            EasyEditScreens.reloadCurrentScreen(function() {
              EasyEditComponentsToolbar.showPreviewMode(function() {
                d.events.trigger("change", {
                  id: a,
                  name: b
                })
              })
            })
          }) : EasyEditScreens.reloadCurrentScreen(function() {
            d.events.trigger("change", {
              id: a,
              name: b
            })
          });
        d.currentContextId = parseFloat(a)
      }))
    }, c.runMode.BATCH)
  },
  toggle: function() {
    this.$button.hasClass("current") ? this.hide() : this.show()
  },
  hide: function() {
    this.events.trigger("hide");
    this.tip.hide()
  },
  show: function() {
    this.events.trigger("show");
    this.tip.show()
  }
};
var EasyEditComponentsInfoBox = {
    tip: null,
    init: function(a) {
      var b = this;
      EasyEditDebug.log("EasyEditComponentsInfoBox.init");
      EasyEditComponentsInfoBox._getTemplate(function(c) {
        c = '<div id="ees_infoBoxColumn"><div id="ees_infoBox">' + c + "</div></div>";
        b.tip = EasyEdit.tip.create({
          targetId: "ees_assetInfoBox",
          containerId: "ees_infoBoxTooltip",
          position: "south",
          leftOffset: 0,
          topOffset: 20,
          cssPosition: "fixed",
          title: EasyEditLocalise._("Asset Information"),
          message: c
        });
        EasyEditComponentsInfoBox._attachEvents();
        a.call(this)
      })
    },
    refresh: function(a) {
      EasyEditAssetManager.getCurrentAsset(function(b) {
        EasyEditComponentsInfoBox._getTemplate(function(c) {
          jQuery("#ees_infoBox").empty().html(c);
          EasyEditComponentsInfoBox._attachEvents();
          EasyEditComponentsToolbar.populateAssetInfoButton(b);
          a.call(this)
        })
      })
    },
    _getTemplate: function(a) {
      EasyEditAssetManager.getCurrentAsset(function(b) {
        if (EasyEditWorkspaceManager.isWorkspace(b)) EasyEditWorkspaceManager.getCurrentWorkspace(function(b) {
          var c = jQuery("<div></div>").attr("id", "ees_infoBoxInner"),
            d = jQuery("<div></div>").attr("id", "ees_infoBoxInner1"),
            e = jQuery("<div></div>").attr("id", "ees_infoBoxInner2");
          d.appendTo(c);
          e.appendTo(d);
          jQuery("<span></span>").addClass("screenHide").appendTo(e).text(EasyEditLocalise._("Current Workspace") + ": ");
          jQuery("<span></span>").attr("class", "ees_assetType").appendTo(e).text(EasyEditLocalise._("Workspace"));
          jQuery("<h1></h1>").attr("id", "ees_assetName").appendTo(e).text(b.name);
          jQuery("<div></div>").attr("id", "ees_assetInfo").appendTo(e).text(b.description);
          a.call(this, c.html())
        });
        else {
          var c = b.attribute("status"),
            d = "number" !== typeof b.attribute("published") ? EasyEditLocalise._("Never published") : b.getFormattedDate("published"),
            e = "number" !== typeof b.attribute("updated") ? EasyEditLocalise._("Never updated") : b.getFormattedDate("updated"),
            f = b.attribute("type"),
            g = jQuery("<div></div>").attr("id", "ees_infoBoxInner"),
            j = jQuery("<div></div>").attr("id", "ees_infoBoxInner1"),
            h = jQuery("<div></div>").attr("id", "ees_infoBoxInner2");
          j.appendTo(g);
          h.appendTo(j);
          jQuery("<span></span>").addClass("screenHide").appendTo(h).text(EasyEditLocalise._("Currently Editing") +
            ": ");
          var j = jQuery("<div></div>").attr("id", "ees_assetInfo").appendTo(h),
            h = jQuery("<div></div>").attr("id", "ees_assetInfoInner").addClass(c.replace(/\s/g, "").toLowerCase()).appendTo(j),
            k = jQuery("<div></div>").addClass("row clearfix status").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("Status"));
          jQuery("<span></span>").addClass("data").attr("id", "ees_assetCurrentStatus").appendTo(k).text(EasyEditLocalise._(c));
          k = jQuery("<div></div>").addClass("row clearfix identification").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("ID"));
          jQuery("<span></span>").addClass("data").attr("id", "ees_assetAssetID").appendTo(k).text("#" + b.id);
          k = jQuery("<div></div>").addClass("row clearfix type").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("Type"));
          jQuery("<span></span>").addClass("data").addClass(b.attribute("type_code")).addClass("ees_assetType").appendTo(k).text(f);
          k = jQuery("<h1></h1>").addClass("row clearfix naming").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("Name"));
          jQuery("<span></span>").addClass("data").attr("id", "ees_assetName").appendTo(k).text(b.attribute("name"));
          k = jQuery("<div></div>").addClass("row clearfix published").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("Published"));
          jQuery("<span></span>").addClass("data").attr("id", "ees_assetPublishedDate").appendTo(k).text(d);
          k = jQuery("<div></div>").addClass("row clearfix updated").appendTo(h);
          jQuery("<span></span>").addClass("label").appendTo(k).text(EasyEditLocalise._("Last updated"));
          jQuery("<span></span>").addClass("data").attr("id", "ees_assetLastUpdated").appendTo(k).text(e);
          k = jQuery("<div></div>").addClass("row clearfix trash").appendTo(j);
          c = jQuery("<a></a>").attr("href", "#").attr("id", "ees_assetDelete").attr("title", EasyEditLocalise._("Go to linking screen to delete links")).appendTo(k);
          jQuery("<span></span>").appendTo(c).text(EasyEditLocalise._("Move to Trash"));
          a.call(this, g.html())
        }
        document.title =
          EasyEditConfig.titleBar.replace("@asset_name@", b.attribute("name"))
      })
    },
    _attachEvents: function() {
      jQuery("#ees_assetDelete").click(function(a) {
        a.preventDefault();
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Redirecting to linking screen...")
        });
        jQuery("#ees_eesUi").removeClass().addClass("linking");
        EasyEditUrl.hash.push({
          screen: "linking"
        });
        EasyEditScreens.loadScreen("linkingDefault", function() {
          EasyEditComponentsToolbar.showEditMode(function() {
            EasyEditScreens.getCurrentScreen().markAll()
          })
        })
      })
    }
  },
  EasyEditConditionSwitcher = function(a, b) {
    var c = this;
    this.asset = a;
    this.conditions = [];
    this.currentConditions = {};
    this.events = new ObservableEvents(this);
    this.fetch(function() {
      if (EasyEdit.util.isArray(c.conditions) && 0 >= c.conditions.length) return b.call(c), !1;
      c.$button = jQuery(EasyEdit.tmpl.render("condition_switcher", {
        id: "ees_conditionSwitcherButton",
        label: EasyEditLocalise._("Change conditions"),
        title: EasyEditLocalise._("Condition switcher"),
        current: ""
      }));
      var a = [];
      c.each(function(b, e) {
        var j = e.split(/:/),
          j = j[0].replace(/\_/g, " ") + " (#" + j[1] + ")";
        a.push({
          val: e,
          name: j,
          onSel: "1" === c.currentConditions[e] ? "selected" : "",
          offSel: "0" === c.currentConditions[e] ? "selected" : "",
          autoSel: void 0 === c.currentConditions[e] ? "selected" : ""
        })
      });
      c.$elem = jQuery(EasyEdit.tmpl.render("condition_switcher_list", {
        change_to: EasyEditLocalise._("Change to"),
        id: "conditionSwitcherList",
        change: EasyEditLocalise._("Change"),
        conditions: a,
        on: EasyEditLocalise._("True"),
        off: EasyEditLocalise._("False"),
        "default": EasyEditLocalise._("Auto")
      }));
      c.$elem.find(".offOption").click(function(a) {
        a.preventDefault();
        jQuery(jQuery(a.target).parent().children(".guiButton")).removeClass("selected");
        jQuery(a.target).addClass("selected");
        a = jQuery(a.target).parent().attr("data-conditionid");
        c.currentConditions[a] = "0"
      });
      c.$elem.find(".onOption").click(function(a) {
        a.preventDefault();
        jQuery(jQuery(a.target).parent().children(".guiButton")).removeClass("selected");
        jQuery(a.target).addClass("selected");
        a = jQuery(a.target).parent().attr("data-conditionid");
        c.currentConditions[a] =
          "1"
      });
      c.$elem.find(".autoOption").click(function(a) {
        a.preventDefault();
        jQuery(jQuery(a.target).parent().children(".guiButton")).removeClass("selected");
        jQuery(a.target).addClass("selected");
        a = jQuery(a.target).parent().attr("data-conditionid");
        delete c.currentConditions[a]
      });
      if (!1 === jQuery("#ees_previewOptions > ul > li").hasClass("toolbarButton cond")) {
        jQuery("#ees_previewOptions > ul > li:last-child").after("<li></li>").addClass("noright");
        var e = jQuery("#ees_previewOptions > ul > li:last-child");
        e.addClass("toolbarButton cond");
        e.append(c.$button);
        e = EasyEdit.tmpl.render("default_button", {
          "class": "alignCenter",
          href: "#",
          title: EasyEditLocalise._("Update Preview"),
          content: EasyEditLocalise._("Update Preview"),
          attr: {
            id: "ees_conditionSwitcher_preview_conditions_update"
          }
        });
        c.tip = EasyEdit.tip.create({
          targetId: c.$button,
          containerId: "ees_conditionSwitcherContainer",
          position: "south",
          title: "Change Conditions",
          topOffset: 20,
          cssPosition: "fixed",
          buttons: e
        })
      }
      EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"));
      c.tip.$element.find("#ees_conditionSwitcher_preview_conditions_update").click(function(a) {
        a.preventDefault();
        c.change(c.currentConditions);
        c.hide()
      });
      c.tip.$element.find(".tooltipMessage").replaceWith(c.$elem);
      c.tip.events.observe("hide", function() {
        c.$button.parents("li").removeClass("current")
      });
      c.tip.events.observe("show", function() {
        c.$button.parents("li").addClass("current")
      });
      c.$button.click(function(a) {
        a.preventDefault();
        c.toggle()
      });
      c.$elem.find(".button").click(function(a) {
        a.preventDefault();
        jQuery(this).parent();
        c.change({});
        c.hide()
      });
      jQuery.isFunction(b) && b.call(c)
    })
  };
EasyEditConditionSwitcher.prototype = {
  isDefault: function() {
    return this.currentConditions == {}
  },
  getCurrentConditions: function() {
    return this.currentConditions
  },
  each: function(a) {
    jQuery.each(this.conditions, a)
  },
  fetch: function(a) {
    var b = this,
      c = new EasyEditAPI;
    c.queue("getGeneral", {
      asset_id: b.asset.id,
      get_attributes: 1
    });
    c.run(function() {
      var d = c.getResult(0, "conditions");
      b.conditions = d && d.used_conditions ? d.used_conditions : [];
      a.call(b)
    }, c.runMode.ASYNC)
  },
  change: function(a) {
    var b = jQuery("#ees_modePreviewFrame"),
      c = b.attr("src"),
      c = EasyEditUrl.getURLFromString(c).url + "/" + EasyEdit.systemInfo.suffixes.nocache,
      d = [];
    for (i in a) d.push(encodeURIComponent("SQ_CONDITION[" + i + "]") + "=" + encodeURIComponent(a[i]));
    0 < d.length && (c = c + "?" + d.join("&"));
    b.attr("src", c)
  },
  toggle: function() {
    this.$button.parent("li").hasClass("current") ? this.hide() : this.show()
  },
  hide: function() {
    this.events.trigger("hide");
    this.tip.hide();
    EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"))
  },
  show: function() {
    this.events.trigger("show");
    this.tip.show();
    EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"))
  }
};
var EasyEditComponentsToolbar = {
  editModeUsed: !1,
  init: function(a) {
    var b = this;
    b.events = new ObservableEvents(this);
    sessionStorage.setItem("edit_screen_scroll_position", "");
    EasyEditDebug.log("EasyEditComponentsToolbar.init");
    EasyEditAssetManager.getCurrentAsset(function(c) {
      EasyEditAssetManager.getCurrentUser(function(d) {
        jQuery("#ees_toolBar").append(b._getTemplate());
        EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_modeSwitcher .toolbarButton"));
        EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"));
        EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_currentUser .toolbarButton"));
        b.populateUserDetails(d);
        b.populateAssetInfoButton(c);
        b.populatePreviewScreenSizeToolTip();
        new EasyEditConditionSwitcher(c, function() {
          new EasyEditSearchButton(function() {
            this.addToToolbar();
            a.call(this)
          })
        })
      })
    })
  },
  _getTemplate: function() {
    return this.addLogo() + this.addCreateNew() + this.addModeSwitcher() + this.addSaveButton() + this.addCurrentUser()
  },
  addLogo: function() {
    return '<div id="ees_toolBarLogo"><span class="screenHide"><strong>' +
      EasyEditLocalise._("Squiz Matrix : Easy Edit Suite") + "</strong></span></div>"
  },
  addCurrentUser: function() {
    return '<div id="ees_currentUser"><a href="#" id="ees_currentUserExit" title="' + EasyEditLocalise._("View Current User or Exit Edit Mode") + '" class="toolbarButton noright"><span class="screenHide">' + EasyEditLocalise._("View Current User or Exit Edit Mode") + '</span><span class="icon"></span></a><span class="screenHide"> | </span><a href="#" id="ees_assetFinderButton" title="' + EasyEditLocalise._("Find an asset") +
      '" class="toolbarButton noleft"><span class="screenHide">' + EasyEditLocalise._("Find an asset") + '</span><span class="icon"></span></a></div>'
  },
  addCreateNew: function() {
    return '<div id="ees_createNew" class="toolbarButton"><a href="#" id="ees_initCreationWizard" title="' + EasyEditLocalise._("Create New Asset") + '"><span class="icon">' + EasyEditLocalise._("New") + "</span></a></div>"
  },
  addModeSwitcher: function() {
    var a = jQuery("body"),
      b = a.hasClass("previewMode"),
      c = a.hasClass("plus") ? " noright" : "",
      d = EasyEditConfig.hasOwnProperty("showDifferencesInPreviewMode") ?
      EasyEditConfig.showDifferencesInPreviewMode : !1,
      d = EasyEditUrl.hash.isset("show_diff") && 1 === 1 * EasyEditUrl.hash.get("show_diff") ? !0 : d,
      e = (d = EasyEditUrl.hash.isset("show_diff") && 0 === 1 * EasyEditUrl.hash.get("show_diff") ? !1 : d) ? "current" : "",
      f = d ? "" : " screenHide",
      g = d ? EasyEditLocalise._("Stop Comparing") : EasyEditLocalise._("Compare to Live"),
      j = EasyEditLocalise._("Screen Size");
    EasyEditAssetManager.getCurrentAsset(function(a) {
      f = -1 !== a.attribute("status").indexOf("Safe Edit") ? "" : " screenHide"
    });
    d && a.addClass("previewingDiff");
    a = "";
    0 >= EasyEdit.systemInfo.preferences.user.SQ_USER_PREVIEW_SCREEN_SIZES.options.length && (a = " screenHide");
    return '<div id="ees_modeSwitcher"><span class="screenHide"><strong>' + EasyEditLocalise._("Interface Mode") + ':</strong></span><ul><li class="' + ("buildPreview" === EasyEditComponents.initialModeFn ? "current" : "") + ' toolbarButton noright"><a href="#" id="ees_modePreview">' + EasyEditLocalise._("Preview") + '</a></li><li class="' + ("buildEditInterface" === EasyEditComponents.initialModeFn ? "current" : "") + ' toolbarButton noleft"><a href="#" id="ees_modeEdit">' +
      EasyEditLocalise._("Edit") + '</a></li></ul></div><div id="ees_assetInfoBox" class="toolbarButton"><span class="screenHide"><strong>' + EasyEditLocalise._("Show / Hide the Asset Info Box") + ': </strong></span><a href="#" id="ees_showInfoBox" class="clearfix"></a></div><div id="ees_previewOptions" class="' + (b ? "" : "screenHide") + '"><span class="screenHide"><strong>' + EasyEditLocalise._("Preview Options") + ':</strong></span><ul><li class="toolbarButton diff' + c + f + '"><a href="#" id="ees_showDifferences" class="' +
      e + '" title="' + g + '"><span class="icon"></span></a></li>' + ('<li class="toolbarButton' + a + '"><a href="#" id="ees_previewScreenSize" class="" title="' + j + '"><span id="ees_previewScreenSizeName" class="icon"></span></a></li>') + "</ul></div>"
  },
  addSaveButton: function() {
    return '<div id="ees_saveButton"><button accesskey="s" id="ees_saveButtonAction" type="button" value="commit"  class="disabled toolbarButton"><span id="ees_saveLabel">' + EasyEditLocalise._("Save") + "</span></button></div>"
  },
  isUnsaved: function() {
    if (jQuery("#ees_saveButtonAction").hasClass("disabled")) return !1;
    EasyEditEventManager.trigger("EasyEditUnsavedChanges");
    return !0
  },
  enableSaveButton: function() {
    var a = jQuery("#ees_saveButtonAction");
    a.hasClass("disabled") && EasyEdit.sendRemoteCommand("window.parent.parent.Widget.prototype.enableSaveButton()", function() {});
    a.hasClass("disabled") && EasyEditEventManager.trigger("EasyEditSaveButtonEnable");
    a.removeClass("disabled")
  },
  disableSaveButton: function() {
    var a = jQuery("#ees_saveButtonAction");
    a.hasClass("disabled") || EasyEdit.sendRemoteCommand("window.parent.parent.Widget.prototype.disableSaveButton()",
      function() {});
    a.hasClass("disabled") || EasyEditEventManager.trigger("EasyEditSaveButtonDisable");
    a.addClass("disabled")
  },
  detectScreenEdits: function() {
    this.disableSaveButton();
    var a = jQuery("#ees_screenContent"),
      b = this;
    jQuery("input,select,textarea", a).bind("change keyup", function() {
      b.enableSaveButton()
    });
    var c = [];
    c.push(jQuery('table.bodytext img[alt*="Edit Contents"]', a));
    c.push(jQuery('table.bodytext img[alt*="Edit Properties"]', a));
    c.push(c[0].parent().parent().parent().next());
    jQuery.each(c, function(a,
      c) {
      c.unbind("click").click(function() {
        b.enableSaveButton()
      })
    });
    jQuery('div[id$="_switch_option_div"] div').click(b.enableSaveButton).parent().next().click(b.enableSaveButton);
    jQuery('#ees_editMetadata div[id$="_contents_div"]').click(b.enableSaveButton)
  },
  showEditMode: function(a) {
    var b = this,
      c = jQuery("#ees_editMode"),
      d = [jQuery("#ees_modePreviewFrame"), jQuery("#ees_modePreviewFile")],
      e = jQuery("#ees_PreviewFrameContainer"),
      f = "function" === typeof a ? a : function() {};
    b.events.trigger("mode_change_start", {
      mode: "edit"
    });
    jQuery("li", "#ees_modeSwitcher").removeClass("current");
    jQuery("#ees_modeEdit").parent().addClass("current");
    jQuery("#ees_previewOptions").addClass("screenHide");
    EasyEditViperComments.showAllComments();
    d[0].remove();
    d[1].remove();
    e.hide();
    jQuery("body").removeClass("previewMode").addClass("editMode");
    c.show();
    EasyEdit.embedMode || EasyEditOverlay.showOverlay("loading");
    EasyEditComponents.buildEditInterface(function() {
      "" !== sessionStorage.getItem("edit_screen_scroll_position") && (jQuery(window).scrollTop(sessionStorage.getItem("edit_screen_scroll_position")),
        sessionStorage.setItem("edit_screen_scroll_position", ""));
      EasyEditScreens.startLockRefresh();
      EasyEditComponents.editModeUsed = !0;
      EasyEditOverlay.hideOverlay("loading");
      EasyEdit.embedMode && EasyEdit.sendRemoteCommand("window.parent.parent.Widget.prototype.removeDisabledDiv()", function() {});
      EasyEditUrl.hash.push({
        mode: "edit"
      });
      f.call(this);
      EasyEditEventManager.trigger("EasyEditModeChange", "edit");
      b.events.trigger("mode_change_complete", {
        mode: "edit"
      })
    })
  },
  showPreviewMode: function(a) {
    var b = this,
      c = "function" ===
      typeof a ? a : function() {};
    b.events.trigger("mode_change_start", {
      mode: "preview"
    });
    jQuery("li", "#ees_modeSwitcher").removeClass("current");
    jQuery("#ees_modePreview").parent().addClass("current");
    jQuery("#ees_previewOptions").removeClass("screenHide");
    EasyEditViperComments.hideAllComments();
    a = jQuery("#ees_editMode");
    jQuery("#ees_modePreviewFrame");
    jQuery("#ees_modePreviewFile");
    var d = jQuery("#ees_PreviewFrameContainer");
    sessionStorage.setItem("edit_screen_scroll_position", jQuery(window).scrollTop());
    jQuery("body").removeClass("editMode").addClass("previewMode");
    a.hide();
    d.show();
    EasyEditScreens.stopLockRefresh();
    EasyEditOverlay.showOverlay("loading");
    EasyEditComponents.buildPreview(function() {
      EasyEditUrl.hash.push({
        mode: "preview"
      });
      !1 === EasyEditUrl.hash.isset("show_diff") && !0 === EasyEditConfig.showDifferencesInPreviewMode && EasyEditUrl.hash.push({
        show_diff: "1"
      });
      b.checkPreviewOptions();
      EasyEditOverlay.hideOverlay("loading");
      c.call(this);
      EasyEditEventManager.trigger("EasyEditModeChange", "preview");
      b.events.trigger("mode_change_complete", {
        mode: "preview"
      })
    })
  },
  populatePreviewScreenSizeToolTip: function() {
    var a = EasyEdit.systemInfo.preferences.user.SQ_USER_PREVIEW_SCREEN_SIZES.options,
      b = EasyEdit.systemInfo.preferences.user.SQ_USER_PREVIEW_SCREEN_SIZES.selected;
    if (!(0 >= a.length)) {
      var c = sessionStorage.getItem("preview_screen_size");
      if ("auto" == c) b = "auto";
      else if (c && "undefined" != c) {
        for (var d = !1, e = 0; e < a.length; e++)
          if (c == a[e].width + "px," + a[e].height + "px") {
            d = !0;
            break
          }
        b = d ? c : b
      }
      for (var f = d = c = "", e = 0; e < a.length; e++) {
        var g = a[e].name,
          j = a[e].width + "px",
          h = a[e].height + "px";
        21 < g.length && (g = g.substr(0, 18) + "...");
        b == j + "," + h || b == e ? (c = g, f = "selected") : f = "";
        d += '<tr id="ees_selectedSize_' + (e + 1) + '" class="row ' + f + '"><td>' + g + "</td><td>" + j + "</td><td>" + h + '</td><td class="ticked"></td></tr>'
      }
      f = "";
      c || (c = EasyEditLocalise._("Auto"), f = "selected");
      d = '<div><div id ="ees_previewSizeOptionList"><table id="ees_previewSizeTable"><thead><tr class="header"><th class="name">' + EasyEditLocalise._("Name") + '</th><th class="width">' + EasyEditLocalise._("Width") + '</th><th class="height">' + EasyEditLocalise._("Height") +
        '</th><th></th></tr></thead><tbody><tr id="ees_selectedSize_0" class="row ' + f + '"><td>' + EasyEditLocalise._("Auto") + '</td><td>100%</td><td>100%</td><td class="ticked"></td></tr>' + d + '</tbody></table><div id="ees_updatePreviewButtonContainer"><a href="#" id="ees_updatePreviewButton" class="guiButton default">' + EasyEditLocalise._("Update Preview") + "</a></div></div></div>";
      c && (18 < c.length && (c = c.substr(0, 15) + "..."), jQuery("#ees_previewScreenSizeName").addClass("iconWithLabel").html(c));
      var k = EasyEdit.tip.create({
          targetId: "ees_previewScreenSize",
          containerId: "ees_previewScreenSizeToolTip",
          position: "south",
          leftOffset: 0,
          topOffset: 20,
          cssPosition: "fixed",
          title: EasyEditLocalise._("Screen Size"),
          message: d
        }),
        l = jQuery("#ees_previewScreenSize");
      jQuery("#ees_previewSizeTable");
      b = jQuery("#ees_updatePreviewButton");
      k.events.observe("show", function() {
        l.addClass("active")
      });
      k.events.observe("hide", function() {
        l.removeClass("active")
      });
      l.click(function(a) {
        a.preventDefault();
        $(this).hasClass("active") ? k.hide() : k.show()
      });
      for (var n = "", e = 0; e <= a.length; e++) jQuery("#ees_selectedSize_" +
        e).click(function(b) {
        b.preventDefault();
        $selectedRow = jQuery(this);
        var b = $selectedRow.children().eq(0).html(),
          c = $selectedRow.children().eq(1).html(),
          d = $selectedRow.children().eq(2).html(),
          e = jQuery("#ees_PreviewFrameContainer"),
          f = jQuery("body");
        if (b == EasyEditLocalise._("Auto")) {
          f.removeClass("modeResizedPreviewFrame");
          c = jQuery("#ees_modePreviewFrame");
          e.css("width", "100%");
          c = c.contents().find("body");
          c = jQuery("div", c).length > 0 ? c.height() + 40 : jQuery(window).height();
          e.css("height", c);
          e.contents().find("html").css("overflow",
            "hidden");
          n = "auto"
        } else {
          f.addClass("modeResizedPreviewFrame");
          e.css("width", c);
          e.css("height", d);
          n = c + "," + d
        }
        if (b) {
          b.length > 18 && (b = b.substr(0, 15) + "...");
          jQuery("#ees_previewScreenSizeName").addClass("iconWithLabel").html(b)
        } else jQuery("#ees_previewScreenSizeName").removeClass("iconWithLabel");
        for (b = 0; b <= a.length; b++) jQuery("#ees_selectedSize_" + b).removeClass("selected");
        $selectedRow.addClass("selected");
        sessionStorage.setItem("preview_screen_size", n)
      });
      b.click(function(a) {
        a.preventDefault();
        EasyEditOverlay.showOverlay("loading");
        sessionStorage.setItem("preview_screen_size", n);
        location.reload()
      })
    }
  },
  populateUserDetails: function(a) {
    var b = this,
      c = a.attribute("first_name") ? a.attribute("first_name") : "",
      d = a.attribute("last_name") ? a.attribute("last_name") : "",
      e = c || d ? c + " " + d : a.attribute("username"),
      f = !1,
      g = "/__data/ees/Images/user_thumb.png";
    null !== a.attribute("thumbnail") ? g = a.attribute("thumbnail") : null !== a.attribute("thumbnailId") && (g = EasyEditUrl.getBaseSiteURL() + "/?a=" + a.attribute("thumbnailId"));
    var a = EasyEditLocalise._("Current User"),
      c = EasyEditLocalise._("Logged in as") + '<span class="userName"> ' + e + "</span>",
      d = '<a href="#" id="ees_tooltipExit" class="guiButton light">' + EasyEditLocalise._("Exit Edit Mode") + '</a><a href="#" id="ees_tooltipLogout" class="guiButton light">' + EasyEditLocalise._("Logout") + "</a>",
      j = EasyEdit.tip.create({
        targetId: "ees_currentUserExit",
        containerId: "ees_exitEditTooltip",
        position: "south",
        leftOffset: 0,
        topOffset: 20,
        cssPosition: "fixed",
        title: a,
        message: c,
        buttons: d
      }),
      h = jQuery("#ees_currentUserExit");
    j.events.observe("show",
      function() {
        h.addClass("active")
      });
    j.events.observe("hide", function() {
      h.removeClass("active")
    });
    h.click(function(a) {
      a.preventDefault();
      $(this).hasClass("active") ? j.hide() : (!1 == f && (f = !0, jQuery("#ees_exitEditTooltip .tooltipMessage").prepend('<div class="clearfix"><img src="' + g + '" alt="' + e + ' thumbnail" class="userThumb" /></div>')), j.show())
    });
    var k = function(a) {
        var b = EasyEdit.getURL(a.attribute("web_path"));
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Please wait, exiting edit mode") +
            "..."
        });
        a.releaseLock("all", function() {
          window.location = b.url
        })
      },
      l = function(a) {
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Please wait, logging you out of edit mode") + "..."
        });
        a.releaseLock("all", function() {
          var b = EasyEdit.getURL(a.attribute("web_path"));
          window.location = b.url + "/" + EasyEdit.systemInfo.suffixes.edit + "?SQ_ACTION=logout"
        })
      };
    j.$element.find("a").click(function(a) {
      var c = a.target;
      a.preventDefault();
      "ees_tooltipCancelUserDetails" === this.id && j.hide();
      EasyEditAssetManager.getCurrentAsset(function(a) {
        var d = [],
          e = l,
          f = EasyEditLocalise._("The following items may need your attention:"),
          g = EasyEditLocalise._("Are you sure you want to logout from Squiz Matrix?"),
          h = EasyEditLocalise._("Logout");
        !0 === b.isUnsaved() && d.push(EasyEditLocalise._("There are currently unsaved changes. If you leave this page, you will lose your changes since your last save."));
        "ees_tooltipExit" === c.id && (e = k, g = EasyEditLocalise._("Are you sure you want to exit Edit Mode and return to the frontend?"), h = EasyEditLocalise._("Exit Edit Mode"),
          "page_redirect" === a.attribute("type_code") && d.push(EasyEditLocalise._("You are exiting the editing mode of a Redirect Page. Continuing will likely redirect you to the page's intended target.")));
        0 < d.length ? EasyEditOverlay.showOverlay("confirm", {
          message: f + "<ul><li>" + d.join("</li><li>") + "</li></ul>" + g,
          confirmText: h,
          confirmFn: function() {
            e(a)
          },
          cancelFn: function() {
            EasyEditOverlay.hideOverlay("confirm")
          }
        }) : e(a)
      })
    })
  },
  populateAssetInfoButton: function(a) {
    var b = jQuery("#ees_showInfoBox");
    b.html('<span class="status alignLeft"></span><span class="name alignLeft"></span><span class="id alignLeft"></span>');
    var c = a.attr.status,
      d = c.replace(/\s/g, "").toLowerCase(),
      e = a.attr.name,
      a = a.attr.id;
    b.find(".status").addClass(d).attr("title", c);
    b.find(".name").attr("title", e).text(e);
    b.find(".id").text("#" + a)
  },
  checkPreviewOptions: function() {
    var a = jQuery("#ees_previewOptions"),
      b = jQuery("#ees_showDifferences");
    jQuery("#ees_showAccessibilityOverlay");
    jQuery("#ees_conditionSwitcherButton");
    var c = jQuery("body").hasClass("editMode") || jQuery("#ees_modeEdit").parent().hasClass("current"),
      d = jQuery("body").hasClass("previewMode") ||
      jQuery("#ees_modePreview").parent().hasClass("current");
    EasyEditAssetManager.getCurrentAsset(function(e) {
      var f = -1 !== e.attribute("status").indexOf("Safe Edit");
      jQuery("#ees_modePreviewFrame").length ? a.removeClass("screenHide") : a.addClass("screenHide");
      f && d ? b.parent().removeClass("screenHide") : b.parent().addClass("screenHide");
      if (!0 === c) {
        var g = new EasyEditAPI;
        g.queue("getGeneral", {
          asset_id: e.id,
          get_attributes: 1
        });
        g.run(function() {
          var a = jQuery("#ees_previewOptions .toolbarButton.cond"),
            b = g.getResult(0,
              "conditions");
          b && b.used_conditions && 0 < b.used_conditions.length ? (0 === a.length && new EasyEditConditionSwitcher(e, function() {}), a.removeClass("screenHide")) : a.addClass("screenHide")
        }, g.runMode.BATCH)
      }
      EasyEditComponentsToolbar.adjustToolbarBorders(a.find(".toolbarButton"))
    })
  },
  deselectPreviewScreenSizeOption: function() {
    var a = jQuery("#ees_previewScreenSizeName").parent().parent();
    a.hasClass("screenHide") ? (a.removeClass("screenHide"), EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"))) :
      jQuery("#ees_previewSizeTable > tbody > tr").each(function() {
        var a = jQuery(this);
        if (a.hasClass("selected")) return a.removeClass("selected"), !1
      })
  },
  printCustomScreenSizeText: function(a, b) {
    var c = EasyEditLocalise._("Custom") + " (" + a + " x " + b + ")";
    jQuery("#ees_previewScreenSizeName").addClass("iconWithLabel customScreenSize").html(c)
  },
  customPreviewScreenSize: function() {
    return jQuery("#ees_previewScreenSizeName").hasClass("customScreenSize")
  },
  adjustToolbarBorders: function(a) {
    for (var b = null, c = null, d = 0; d < a.length; d++) {
      var e =
        jQuery(a[d]);
      !1 === e.hasClass("screenHide") && (c = e, e.addClass("noright"), null === b ? (b = e, e.removeClass("noleft")) : e.addClass("noleft"))
    }
    null !== c && c.removeClass("noright")
  },
  attachEvents: function() {
    function a() {
      if (EasyEditUrl.hash.isset("show_diff")) {
        var a = parseFloat(EasyEditUrl.hash.get("show_diff"));
        a !== e && (EasyEditOverlay.showOverlay("loading"), EasyEditComponents.buildPreview(function() {
          EasyEditOverlay.hideOverlay("loading");
          b.events.trigger("show_diff", {
            previous: e,
            current: a
          });
          e = a
        }))
      }
    }
    EasyEditDebug.log("Attaching Toolbar Events");
    var b = this,
      c = jQuery("#ees_showDifferences");
    jQuery("#ees_infoBoxTooltip");
    var d = jQuery("#ees_showInfoBox");
    EasyEditComponentsInfoBox.tip.events.observe("show", function() {
      d.addClass("active")
    });
    EasyEditComponentsInfoBox.tip.events.observe("hide", function() {
      d.removeClass("active")
    });
    d.click(function(a) {
      a.preventDefault();
      jQuery(this);
      EasyEditComponentsInfoBox.tip.toggle()
    });
    EasyEditEventManager.bind("EasyEditAssetStatusChange", function() {
      b.checkPreviewOptions()
    });
    c.click(function(a) {
      a.preventDefault();
      a = jQuery(this);
      a.hasClass("current") ? (jQuery("body").removeClass("previewingDiff"), EasyEditUrl.hash.push({
        show_diff: "0"
      })) : (a.addClass("current"), jQuery("body").addClass("previewingDiff"), EasyEditUrl.hash.push({
        show_diff: "1"
      }))
    });
    EasyEditEventManager.bind("EasyEditModeChange", function() {
      b.checkPreviewOptions()
    });
    var e = EasyEditUrl.hash.isset("show_diff") ? parseFloat(EasyEditUrl.hash.get("show_diff")) : null;
    EasyEditEventManager.bind("EasyEditUrlChange", function() {
      if (EasyEditUrl.hash.isset("mode")) {
        var d =
          EasyEditUrl.hash.get("mode").toLowerCase(),
          e = jQuery("body").hasClass("editMode") ? "edit" : "preview";
        EasyEditDebug.log("MODE SWITCH", d, e, jQuery("body").attr("class"));
        if (d !== e) switch (d) {
          case "edit":
            b.showEditMode();
            break;
          case "preview":
            b.showPreviewMode()
        }
      }
      EasyEditUrl.hash.isset("show_diff") && 1 === 1 * EasyEditUrl.hash.get("show_diff") ? c.addClass("current").attr("title", EasyEditLocalise._("Stop Comparing")) : c.removeClass("current").attr("title", EasyEditLocalise._("Compare to Live"));
      a()
    });
    var f = jQuery("#ees_initCreationWizard");
    EasyEdit.wizard.events.observe("show", function() {
      f.addClass("current")
    });
    EasyEdit.wizard.events.observe("hide", function() {
      f.removeClass("current")
    });
    EasyEdit.wizard.events.observe("create_complete", function() {
      jQuery("body").hasClass("previewMode") && EasyEditComponents.buildPreview(function() {})
    });
    f.click(function(a) {
      a.preventDefault();
      EasyEdit.wizard.show()
    });
    var g = jQuery("#ees_modeSwitcher");
    jQuery("a", g).click(function(a) {
      var b = this.id;
      if (jQuery(this).parent().hasClass("current")) return !1;
      "ees_modePreview" ===
      b && EasyEditUrl.hash.push({
        mode: "preview"
      });
      "ees_modeEdit" === b && EasyEditUrl.hash.push({
        mode: "edit"
      });
      a.preventDefault()
    });
    jQuery("#ees_saveButtonAction").click(function(a) {
      var b = $(this);
      if (b.hasClass("disabled") || jQuery("body").hasClass("previewMode") || "false" === $("div .Viper-popup").attr("aria-disabled")) return !1;
      var c = $("div .viper-editable, div .htmlarea-div").find('*[data-imagepaste="true"]');
      0 < c.length ? (c.attr("data-imagepaste-status", "error"), EasyEditOverlay.showOverlay("confirm", {
        message: '<p class="confirmMessage">' +
          EasyEditLocalise._("You have image previews in the content that are not yet uploaded. Saving without uploading them will remove them from the content. Are you sure you want to save?") + "</p>",
        title: EasyEditLocalise._("Unsaved Image Previews"),
        cancelText: EasyEditLocalise._("Return to Screen"),
        confirmText: EasyEditLocalise._("Remove Previews"),
        cssClass: "unsavedChanges",
        confirmFn: function() {
          c.remove();
          EasyEditOverlay.hideOverlay();
          EasyEditEventManager.trigger("EasyEditSaveClick");
          EasyEditScreens.saveCurrentScreen(function() {
            b.addClass("disabled");
            EasyEditEventManager.trigger("EasyEditSaveComplete")
          })
        },
        cancelFn: function() {
          EasyEditOverlay.hideOverlay()
        }
      })) : (EasyEditEventManager.trigger("EasyEditSaveClick"), EasyEditScreens.saveCurrentScreen(function() {
        b.addClass("disabled");
        EasyEditEventManager.trigger("EasyEditSaveComplete")
      }));
      a.preventDefault()
    });
    jQuery("#ees_assetFinderButton").click(function(a) {
      a.preventDefault();
      EasyEditComponents.openAssetFinder()
    })
  }
};
EasyEditOverlay.overlays.reorder = {
  id: "ees_reorderOverlay",
  list: null,
  show: function(a, b) {
    var c = this,
      d = c.getContainer(),
      e = jQuery.extend({
        rootNode: null
      }, a, !0);
    d.html(EasyEditOverlay.overlays.loading._getTemplate("")).show();
    var f = EasyEdit.tmpl.render("default_button", {
        title: EasyEditLocalise._("Save changes"),
        content: EasyEditLocalise._("Save changes"),
        href: "#",
        "class": "alignRight",
        attr: {
          id: c.id + "_save"
        }
      }),
      g = EasyEdit.tmpl.render("light_button", {
        title: EasyEditLocalise._("Cancel"),
        content: EasyEditLocalise._("Cancel"),
        href: "#",
        "class": "alignLeft",
        attr: {
          id: c.id + "_cancel"
        }
      }),
      j = jQuery(EasyEdit.tmpl.render("bubble_wrapper", {
        title: EasyEditLocalise._("Re-order Content Containers"),
        id: "ees_reorderContainer",
        sections: {
          content: ""
        },
        buttons: f + g
      }));
    c.list = new EasyEditAssetChildList({
      rootNode: e.rootNode,
      target: j.find(".section:first"),
      template: "reorder_overlay_child_list",
      filterOptions: {
        allowDependents: !0
      }
    });
    c.list.events.observe("fetch_complete", function() {
      d.empty().append(j);
      this.render()
    });
    c.list.events.observe("render",
      function() {
        jQuery("#" + c.id + "_cancel").click(function(a) {
          a.preventDefault();
          c.hide()
        });
        jQuery("#" + c.id + "_save").click(function(a) {
          a.preventDefault();
          EasyEditOverlay.showOverlay("loading");
          c.list.save(function() {
            b.call(this);
            c.hide()
          })
        });
        var a = jQuery("#ees_reorderContainer"),
          d = a.height(),
          e = a.width();
        a.draggable({
          handle: ".ees_BubbleTitle",
          containment: "document"
        });
        a.css("left", jQuery(window).width() / 2 - e / 2 + "px");
        a.css("top", jQuery(window).height() / 2 - d / 2 + "px")
      });
    c.list.fetch()
  },
  getContainer: function() {
    jQuery("#" +
      this.id).length || jQuery("body").prepend('<div id="' + this.id + '" class="overlay"></div>');
    return jQuery("#" + this.id)
  },
  hide: function() {
    jQuery("#" + this.id).hide();
    this.list = null
  }
};
var EasyEditAccessibilityOverlay = function() {
  var a = this;
  this.events = new ObservableEvents(this);
  this.hideMessage = EasyEditLocalise._("Hide Accessibility Auditor");
  this.showMessage = EasyEditLocalise._("Show Accessibility Auditor");
  var b = jQuery("#ees_previewOptions ul li.diff"),
    c = EasyEdit.tmpl.render("toolbar_preview_button", {
      "class": "acc",
      id: "ees_showAccessibilityOverlay",
      current: 0,
      title: this.showMessage
    });
  0 === b.length ? jQuery("#ees_previewOptions ul").prepend(c) : b.after(c);
  EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"));
  this.$button = jQuery("#ees_showAccessibilityOverlay");
  this.$button.click(function(b) {
    b.preventDefault();
    if ($(this).hasClass("disabled")) return !1;
    a.toggle()
  });
  this.standard = "WCAG2AA";
  EasyEditConfig.hasOwnProperty("accessibilityStandard") && (this.standard = EasyEditConfig.accessibilityStandard);
  a.events.observe("htmlcs_close", function() {
    a.resetButtonOnClose()
  });
  a.events.observe("htmlcs_run", function() {
    jQuery("body.previewMode").length && jQuery("#HTMLCS-wrapper").draggable({
      handle: ".HTMLCS-header",
      containment: "document",
      iframeFix: true,
      start: function() {
        a.events.trigger("htmlcs_drag_start")
      },
      stop: function() {
        a.events.trigger("htmlcs_drag_stop")
      }
    })
  })
};
EasyEditAccessibilityOverlay.prototype = {
  show: function() {
    jQuery("body.previewMode").length && (this.events.trigger("show"), jQuery("#HTMLCS-wrapper").show(), this.$button.addClass("current").attr("title", this.hideMessage), jQuery("body").addClass("previewingAcc"), EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton")), this.run(function() {}))
  },
  disable: function() {
    this.$button.addClass("disabled").attr("title", EasyEditLocalise._("Auditor disabled while show differences enabled"))
  },
  enable: function() {
    this.$button.removeClass("disabled").attr("title", this.showMessage)
  },
  hide: function() {
    this.events.trigger("hide");
    HTMLCSAuditor.close();
    EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"));
    this.resetButtonOnClose()
  },
  resetButtonOnClose: function() {
    this.$button.removeClass("current").attr("title", this.showMessage);
    jQuery("body").removeClass("previewingAcc")
  },
  toggle: function() {
    this.$button.hasClass("current") ? this.hide() : this.show();
    EasyEditComponentsToolbar.adjustToolbarBorders(jQuery("#ees_previewOptions .toolbarButton"))
  },
  addStylesheet: function() {
    for (var a = jQuery("#ees_modePreviewFrame").contents().find("head"), b = a.find("link"), c = "/__data/ees/Plus/Libs/Viper/viper.css", d = document.getElementsByTagName("link"), e = 0, f = d.length; e < f; e += 1) d[e].href && d[e].href.match(/\/viper\.css$/) && (c = d[e].href);
    var g = !1;
    b.each(function() {
      -1 !== jQuery(this).attr("href").indexOf(c) && (g = !0)
    });
    g || a.append('<link rel="stylesheet" href="' + c + '" media="screen" />')
  },
  run: function(a) {
    var b = this;
    EasyEdit.isset(HTMLCSAuditor) && (b.events.trigger("run"),
      b.addStylesheet(), HTMLCSAuditor.run(this.standard, jQuery("#ees_modePreviewFrame").contents().find("body").get(0), {
        alwaysShowNotices: !1,
        includeCss: !1,
        openCallback: function() {
          b.events.trigger("htmlcs_open")
        },
        closeCallback: function() {
          b.events.trigger("htmlcs_close")
        },
        runCallback: function(c) {
          b.events.trigger("htmlcs_run");
          a.call(this);
          return c
        }
      }))
  }
};
EasyEditEventManager.bind("EasyEditAfterLoad", function() {
  if ("undefined" === typeof HTMLCS) return !1;
  var a = new EasyEditAccessibilityOverlay;
  if (EasyEditConfig.hasOwnProperty("showAccessibilityInPreviewMode") && EasyEditConfig.showAccessibilityInPreviewMode || !EasyEditConfig.hasOwnProperty("showAccessibilityInPreviewMode")) jQuery("#ees_showDifferences").hasClass("current") && EasyEditAssetManager.getCurrentAsset(function(b) {
    -1 !== b.attribute("status").indexOf("Safe Edit") && a.disable()
  }), EasyEditAssetManager.getCurrentAsset(function(a) {
    a.isFile() &&
      $("#ees_previewOptions").remove()
  }), EasyEditEventManager.bind("EasyEditUrlChange", function() {
    EasyEditUrl.hash.isset("mode") && "edit" === EasyEditUrl.hash.get("mode") && a.hide()
  }), EasyEditEventManager.bind("EasyEditModeChange", function() {
    EasyEditAssetManager.getCurrentAsset(function(b) {
      -1 === b.attribute("status").indexOf("Safe Edit") && a.enable()
    })
  }), EasyEditComponentsToolbar.events.observe("show_diff", function(b) {
    1 === b.current ? (a.hide(), EasyEditAssetManager.getCurrentAsset(function(b) {
      -1 !== b.attribute("status").indexOf("Safe Edit") &&
        a.disable()
    })) : a.enable()
  }), EasyEditComponentsToolbar.accOverlay = a
});
(function(a, b) {
  b.reorderSections = {
    id: "ees_reorderFormSectionOverlay",
    $container: null,
    show: function(a, b) {
      this.$container = this.render();
      this.$container.show();
      this.populate(a.sections);
      var e = this.$container.find(".ees_Bubble"),
        f = e.height(),
        g = e.width();
      e.css("left", jQuery(window).width() / 2 - g / 2 + "px");
      e.css("top", jQuery(window).height() / 2 - f / 2 + "px");
      b.call(this)
    },
    _bindEvents: function(b) {
      var d = this;
      b.draggable({
        handle: ".ees_BubbleTitle",
        containment: "document"
      });
      var e = b.find(".custom-form-section__sort-list");
      e.sortable({
        handle: ".custom-form-section__sort-item-drag-handle",
        items: "> .custom-form-section__sort-item",
        placeholder: "custom-form-section__sort-item-drag-placeholder",
        forcePlaceholderSize: !0
      });
      var f = a(".custom-form-sections", "#ees_questionWrapper").find(".custom-form__add-new-section");
      e.on("sortstop", function() {
        a(".custom-form-section__sort-item", this).each(function() {
          var b = a(this).data("section");
          f.before(b)
        })
      });
      b.find(".button-done").on("click", function(a) {
        a.preventDefault();
        d.hide()
      })
    },
    populate: function(b) {
      var d =
        this.$container.find(".custom-form-section__sort-list");
      d.empty();
      b.each(function() {
        var b = a(EasyEdit.tmpl.render("custom_form_section_reorder_item", {
          name: a(".custom-form-section__header", this).text()
        }));
        b.data("section", a(this));
        d.append(b)
      });
      d.sortable("refresh")
    },
    render: function() {
      var a = jQuery('<div id="' + this.id + '" class="overlay"></div>');
      jQuery("body").prepend(a);
      var b = EasyEdit.tmpl.render("default_button", {
          title: EasyEditLocalise._("Done"),
          content: EasyEditLocalise._("Done"),
          href: "#",
          "class": "alignRight button-done",
          attr: {
            id: this.id + "_done"
          }
        }),
        b = jQuery(EasyEdit.tmpl.render("bubble_wrapper", {
          title: EasyEditLocalise._("Re-order Sections"),
          id: "ees_reorderSectionContainer",
          sections: {
            content: '<ul class="custom-form-section__sort-list"></ul>'
          },
          buttons: b
        }));
      a.html(b);
      this._bindEvents(b);
      return a
    },
    getContainer: function() {
      return this.$container
    },
    hide: function() {
      null !== this.$container && this.getContainer().hide()
    }
  }
})(jQuery, EasyEditOverlay.overlays);
(function(a) {
  function b(b, f) {
    this.$elem = a(b);
    this.settings = a.extend({}, d, f);
    this._defaults = d;
    this._name = c;
    this.values = [];
    this.index = 0;
    this.init()
  }
  var c = "EasyEditOptionWidget",
    d = {
      add_label: EasyEditLocalise._("Add Option"),
      keyEditable: !1
    };
  b.prototype = {
    init: function() {
      var b = this;
      this.$elem.append(EasyEdit.tmpl.render("option_widget", this.settings));
      this.settings.hasOwnProperty("values") && EasyEdit.util.each(this.settings.values, function(a, c) {
        b.add({
          key: a,
          value: c
        }, !0);
        b.index += 1
      });
      a(".ees-option-widget__add-button",
        this.$elem).click(function(a) {
        a.preventDefault();
        b.add({
          key: b.index,
          value: "Option " + b.index
        });
        b.index += 1
      });
      this.makeSortable();
      this.$elem.trigger("init.widget")
    },
    fetch: function() {
      var b = this,
        c = this.$elem.find(".ees-option-widget__list"),
        d = [];
      a(".ees-option-widget__row", c).each(function(c) {
        c = b.settings.keyEditable ? a(".ees-option-widget__value-column input", this).val() : c;
        d.push({
          key: c,
          value: a(".ees-option-widget__name-column input", this).val()
        })
      });
      return d
    },
    makeSortable: function() {
      var b = this,
        c = a(".ees-option-widget__list",
          this.$elem);
      c.hasClass("ui-sortable") && c.sortable("destroy");
      c.sortable({
        handle: ".ees-option-widget__drag-handle",
        items: "> .ees-option-widget__row",
        placeholder: "ees-option-widget__drag-placeholder"
      }).on("sortstop", function() {
        b.$elem.trigger("change.widget")
      });
      this.$elem.on("delete.widget add.widget", function() {
        c.hasClass("ui-sortable") && c.sortable("refresh");
        b.$elem.trigger("change.widget")
      })
    },
    add: function(b, c) {
      var d = jQuery(EasyEdit.tmpl.render("option_widget_item", jQuery.extend({}, this.settings,
        b)));
      a(".ees-option-widget__list", this.$elem).append(d);
      this.bindItemEvents(d);
      if ("undefined" === typeof c || !0 !== c)
        if (this.$elem.trigger("add.widget"), "Explorer" !== EasyEdit.browser) {
          var j = window.scrollX,
            h = window.scrollY;
          d.find("input:first").focus();
          window.scrollTo(j, h)
        }
    },
    bindItemEvents: function(b) {
      function c(b) {
        var e = b.siblings(".ees-option-widget__display-value"),
          f = a.trim(b.val());
        b.addClass("screenHide");
        e.removeClass("screenHide").text(f).parents(".ees-option-widget__list").find(".ees-option-widget__column-edited").removeClass("ees-option-widget__column-edited");
        d.$elem.trigger("change.widget")
      }
      var d = this,
        j = b.find(".ees-option-widget__input-value");
      j.on("focus", function() {
        var b = a(this),
          c = b.siblings(".ees-option-widget__display-value"),
          d = a.trim(c.text());
        b.removeClass("screenHide").val(d).selectRange(0, d.length);
        c.addClass("screenHide").parent().addClass("ees-option-widget__column-edited")
      });
      j.on("blur", function() {
        c(a(this))
      }).on("keyup", function(b) {
        if (13 === b.which || 19 === b.which) {
          b.preventDefault();
          c(a(this));
          var b = a(this),
            b = a(".ees-option-widget__row", b),
            d = b.next(".ees-option-widget__row");
          d.length || (d = b.parent().find(".ees-option-widget__row"));
          d.find("input:first").focus()
        }
      });
      a(".ees-option-widget__delete-button", b).click(function(b) {
        b.preventDefault();
        var c = a(this).parents(".ees-option-widget__row");
        c.fadeOut("fast", function() {
          setTimeout(function() {
            c.remove();
            d.$elem.trigger("delete.widget")
          }, 50)
        })
      });
      b.find(".ees-option-widget__name-column, .ees-option-widget__value-column").click(function() {
        var b = a(this).find(".ees-option-widget__input-value");
        b.is(":focus") || b.focus()
      })
    }
  };
  a.fn[c] = function(d) {
    return this.each(function() {
      a.data(this, c) || a.data(this, c, new b(this, d))
    })
  }
})(jQuery);
EasyEditAssetWizardManager.prototype.decorators.file = function(a) {
  function b(b) {
    b.bind("change", function() {
      var b = "" + this.value,
        c = "",
        b = b.replace(/\\/g, "/"),
        c = b.match("/") ? b.substring(b.lastIndexOf("/") + 1, b.length) : b;
      a.$element.find("#ees_fileNameFeedback").html(EasyEditLocalise._("File name: <span>%1</span>", c));
      d.val(c).addClass("defaultFileName").trigger("change")
    });
    a.addValidationMethod(b, b, {
      required: {
        message: EasyEditLocalise._("A file is required.")
      }
    });
    var c = a.attribute("accept");
    null !== c && a.addValidationMethod(b,
      b, {
        accept: {
          args: c,
          message: EasyEditLocalise._("Incorrect file type.")
        }
      })
  }
  var c = a.$element.find("#ees_inputUpload"),
    d = a.$nameField,
    e = a.reset;
  a.reset = function() {
    e.call(a);
    var d = a.$element.find("#ees_inputUpload");
    d.val("");
    c = d.clone();
    a.removeValidationMethod(d);
    b(c);
    d.after(c).remove();
    a.$element.find("#ees_fileNameFeedback").html(EasyEditLocalise._("No file selected"))
  };
  b(c);
  d.focus(function() {
    this.value === a.$element.find("#ees_fileNameFeedback span:eq(0)").text() && (jQuery(this).removeClass("defaultFileName"),
      this.value = "")
  }).blur(function() {
    var b = a.$element.find("#ees_fileNameFeedback span:eq(0)").text();
    this.value.length || (jQuery(this).addClass("defaultFileName"), this.value = b);
    this.value !== b && this.value.length && jQuery(this).removeClass("defaultFileName")
  });
  a.addValidationMethod(a.$element.find("#ees_inputUpload"), a.$element.find("#ees_inputUpload"), {
    test: {
      args: function(a) {
        "C:\\fakepath\\" === a.substr(0, 12) && (a = a.substr(12));
        if (240 < EasyEdit.util.utf8ByteLength(a)) return !1
      },
      message: EasyEditLocalise._("File name cannot be larger than 240 bytes.")
    }
  });
  var f = a.gatherCreateData;
  a.gatherCreateData = function() {
    f.call(a);
    a.createData.extra_attributes.push({
      key: "title",
      val: d.val()
    });
    var b = a.$element.find("#ees_fileNameFeedback span:eq(0)").text();
    a.createData.asset_name = b
  };
  var g = a.create,
    j = function(c, d) {
      var e = c.attribute("type_code") + "_" + c.id,
        f = Math.floor(1E16 * Math.random()),
        g = EasyEditUrl.getBaseSiteURL();
      c.acquireLock("all", function() {
        var h = a.$element.find("#ees_inputUpload"),
          h = {
            url: g + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + c.id + "&load_easy_edit=false&file_create=true&nocache=" +
              f + "&SQ_BACKEND_PAGE=main&ignore_frames=1&sq_link_path=&sq_asset_path=&asset_ei_screen=details",
            id: "#ees_inputUpload",
            filePostName: e,
            interfaceFileInput: h,
            assetid: c.id,
            onStart: function() {
              a.events.trigger("uploading")
            },
            onComplete: function(b) {
              if (b.length) {
                for (var e = "", f = 0, h = b.length; f < h; f += 1) e += "<p><strong>" + b[f].header + ":</strong> " + b[f].error + "</p>";
                a.events.trigger("upload_fail", e, c);
                a.events.trigger("create_fail", e)
              } else c.refreshAttributes(function() {
                a.events.trigger("upload_complete", c);
                a.events.trigger("create_complete", {
                  asset: c,
                  lineage: d,
                  url: g
                })
              })
            },
            postParam: {
              process_form: "1",
              backend_section: "am",
              am_section: "limbo",
              am_form_submitted: "1",
              assetid: c.id,
              backend_assetid: c.id,
              asset_action: "edit",
              asset_ei_screen: "details",
              sq_lock_release: "0",
              sq_link_path: "",
              sq_preview_url: c.attribute("web_path"),
              sq_limbo_lock_type: "a%3A1%3A%7Bi%3A0%3Bs%3A10%3A%22attr_links%22%3B%7D",
              sq_lock_type: "attr_links"
            }
          };
        a.upload = new EasyEditFileUpload(h);
        a.upload.start(function() {
          b(a.$element.find("#ees_inputUpload"))
        })
      })
    },
    h = function(b, c) {
      a.events.trigger("create_fail",
        EasyEditLocalise._("Upload failed, asset was not created properly: %1", c));
      return !1
    };
  a.create = function() {
    g.call(a, j, h)
  }
};
(function(a, b) {
  function c(b) {
    var c = b.settingsTip.$element,
      d = null !== b.attribute("text_type") ? b.attribute("text_type") : "text",
      e = EasyEdit.util.map(f, function(a, b) {
        b.selected = d === b.key ? !0 : !1;
        return b
      });
    "email_address" === b.options.type ? e = EasyEdit.util.filter(e, function(a, b) {
      return "email" === b.key || "text" === b.key
    }) : "numeric" === b.options.type && (e = EasyEdit.util.filter(e, function(a, b) {
      return "number" === b.key || "text" === b.key
    }));
    a(EasyEdit.tmpl.render("select", {
      "class": "custom-form-modal__text-type-select",
      options: e
    })).appendTo(a(".custom-form-modal__text-type-container",
      c))
  }

  function d(b) {
    a(".custom-form-modal__text-type-select", b.settingsTip.$element).on("change", function() {
      b.events.trigger("change")
    })
  }

  function e(b) {
    var c = a(".custom-form-modal__text-type-select", b.settingsTip.$element);
    b.attribute("text_type", c.val())
  }
  var f = [{
    key: "color",
    value: "Color"
  }, {
    key: "date",
    value: "Date"
  }, {
    key: "datetime",
    value: "Datetime"
  }, {
    key: "datetime-local",
    value: "Datetime-local"
  }, {
    key: "email",
    value: "Email"
  }, {
    key: "hidden",
    value: "Hidden"
  }, {
    key: "month",
    value: "Month"
  }, {
    key: "number",
    value: "Number"
  }, {
    key: "range",
    value: "Range"
  }, {
    key: "search",
    value: "Search"
  }, {
    key: "text",
    value: "Text"
  }, {
    key: "tel",
    value: "Tel"
  }, {
    key: "time",
    value: "Time"
  }, {
    key: "url",
    value: "Url"
  }, {
    key: "week",
    value: "Week"
  }];
  b.text = function(b) {
    b.events.observe("render", function() {
      var d = a(".custom-form-modal__multi-line-slider", b.settingsTip.$element);
      b.multiTextSlider = new EasyEditSlider({
        bindElem: d,
        defaultVal: EasyEditLocalise._(b.attributes.hasOwnProperty("height") && 1 < parseFloat(b.attributes.height) ? "Yes" : "No")
      });
      c(b)
    });
    b.events.observe("bind",
      function() {
        var c = b.settingsTip.$element;
        a(".multiLineInput", c).on("change", function() {
          var c = parseFloat(a(this).val());
          "number" === typeof c && (1 < c ? b.multiTextSlider.setSelected(EasyEditLocalise._("Yes")) : b.multiTextSlider.setSelected(EasyEditLocalise._("No")), b.attribute("height", c), b.events.trigger("change"))
        });
        b.multiTextSlider.events.observe("change", function() {
          var a = b.multiTextSlider.getSelected(),
            d = c.find(".multiLineInput"),
            e = parseFloat(d.val());
          "number" === typeof e && (a === EasyEditLocalise._("Yes") &&
            1 >= e ? d.val(3) : a === EasyEditLocalise._("No") && 1 < e && d.val(1), b.attribute("height", d.val()), b.events.trigger("change"))
        });
        d(b)
      });
    b.events.observe("update", function() {
      e(b)
    });
    b.buildPreview = function(a, c) {
      b.attributes.hasOwnProperty("height") && (c.height = Math.min(parseFloat(b.attribute("height")), 50));
      c.width = b.attributes.hasOwnProperty("width") ? Math.min(parseFloat(b.attribute("width")), 80) : 30;
      c.multi = 1 < c.height;
      c.placeholder = b.attributes.hasOwnProperty("placeholder") ? b.attribute("placeholder") : "";
      var d =
        b.attribute("default");
      null !== d && (c.value = d);
      b.attributes.hasOwnProperty("text_type") && "text" !== b.attributes.text_type && (c.showTextType = !0);
      d = EasyEdit.tmpl.render("custom_form_question_preview_" + c.type, c);
      a.html(d)
    }
  };
  b.numeric = function(a) {
    a.inherit("text")
  };
  b.email_address = function(a) {
    a.events.observe("render", function() {
      c(a)
    });
    a.events.observe("bind", function() {
      d(a)
    });
    a.events.observe("update", function() {
      e(a)
    });
    a.buildPreview = function(b, c) {
      c.width = a.attributes.hasOwnProperty("width") ? Math.min(parseFloat(a.attribute("width")),
        80) : 30;
      var d = a.attribute("default");
      null !== d && (c.value = d);
      c.placeholder = a.attributes.hasOwnProperty("placeholder") ? a.attribute("placeholder") : "";
      a.attributes.hasOwnProperty("text_type") && "text" !== a.attributes.text_type && (c.showTextType = !0);
      d = EasyEdit.tmpl.render("custom_form_question_preview_" + c.type, c);
      b.html(d)
    }
  }
})(jQuery, EasyEditQuestionDecorators);
EasyEditAssetWizardManager.prototype.decorators.image = function(a) {
  var b = a.$element.find("#ees_attributeAlt"),
    c = a.$element.find("#ees_attributeCaption"),
    d = a.gatherCreateData;
  a.gatherCreateData = function() {
    d.call(a);
    a.createData.extra_attributes.push({
      key: "alt",
      val: b.val()
    });
    a.createData.extra_attributes.push({
      key: "caption",
      val: c.val()
    })
  };
  a.decorativeSlider = new EasyEditSlider({
    bindElem: a.$element.find(".decorativeSlider"),
    defaultVal: EasyEditLocalise._("No"),
    options: [
      [EasyEditLocalise._("Yes"), EasyEditLocalise._("No 'ALT' attribute text is required, this image is decorative"),
        function() {}
      ],
      [EasyEditLocalise._("No"), EasyEditLocalise._("This image requires a short description"), function() {}]
    ]
  });
  var e = a.reset;
  a.reset = function() {
    e.call(a);
    b.val("");
    c.val("");
    a.decorativeSlider.setSelected(EasyEditLocalise._("No"))
  };
  a.addValidationMethod(b, function() {
    return /^\s*$/g.test(b.val()) && a.decorativeSlider.getSelected() === EasyEditLocalise._("Yes") ? "pass" : b.val()
  }, {
    required: {
      message: EasyEditLocalise._("Alt text is required if this image is not decorative.")
    }
  });
  var f = "";
  a.decorativeSlider.events.observe("change",
    function() {
      1 <= a.validator.getFailCount() && a.valid();
      var c = a.decorativeSlider.getSelected();
      c === EasyEditLocalise._("Yes") ? (f = b.val(), b.val(""), b.attr("disabled", !0)) : c === EasyEditLocalise._("No") ? b.attr("disabled", !1) : "" === b.val() && b.val(f)
    });
  b.bind("keyup change", function() {
    1 <= a.validator.getFailCount() && a.valid()
  })
};
(function(a) {
  function b(b, e) {
    this.$elem = a(b);
    this.settings = a.extend({}, c, e);
    this.events = new ObservableEvents(this);
    this.init()
  }
  var c = {
    tabs: [{
      name: EasyEditLocalise._("Default"),
      id: "default"
    }],
    defaultId: "default"
  };
  b.prototype = {
    init: function() {
      this.$elem.append(EasyEdit.tmpl.render("tab_screen_widget", this.settings));
      this.$tabs = a(".ees-tab-screen__tab", this.$elem);
      this.$buttons = a(".ees-tab-screen__nav-button", this.$elem);
      this.$tabs.hide();
      this._bindEvents();
      this.events.trigger("init")
    },
    loadTab: function(a) {
      "undefined" ===
      typeof a && (a = EasyEditUrl.hash.get("tab"), EasyEdit.util.isEmpty(a) && (a = this.settings.defaultId));
      this.$tabs.hide();
      this.$tabs.filter('[data-id="' + a + '"]').show();
      this.$buttons.removeClass("active");
      this.$buttons.filter('[data-id="' + a + '"]').addClass("active");
      EasyEditUrl.hash.push({
        tab: a
      });
      this.events.trigger("load", a)
    },
    _bindEvents: function() {
      var b = this;
      this.$buttons.click(function(c) {
        c.preventDefault();
        c = a(this).data("id");
        b.loadTab(c)
      });
      EasyEditEventManager.bind("EasyEditUrlChange", function() {
        var a =
          EasyEditUrl.hash.get("tab"),
          c = b.$buttons.filter('[data-id="' + a + '"]');
        !EasyEdit.util.isEmpty(a) && !c.hasClass("active") && b.loadTab(a)
      });
      this.events.trigger("bind")
    }
  };
  a.fn.EasyEditTabScreenWidget = function(c) {
    return this.each(function() {
      a.data(this, "EasyEditTabScreenWidget") || a.data(this, "EasyEditTabScreenWidget", new b(this, c))
    })
  }
})(jQuery);
EasyEditAssetWizardManager.prototype.decorators.calendar = function(a) {
  var b = !1;
  "calendar_event_recurring" === a.attribute("type_code") && (b = !0);
  var c = a.reset;
  a.reset = function() {
    c.call(a);
    var d = new Date;
    a.startDatePicker.setDate(d);
    a.endDatePicker.setDate(d);
    b && (a.$element.find('input[name="ees_dateUntil"]').attr("checked", "checked"), a.$element.find("#ees_dateFrequencyDaily").trigger("click"), a.untilDatePicker.setDate(d));
    a.$element.find(".recurringOptions").find(".stopDateSelection").addClass("screenHide")
  };
  var d = new EasyEditSlider({
      bindElem: a.$element.find(".dataRow .allDayEvent"),
      defaultVal: EasyEditLocalise._("No")
    }),
    e = new EasyEditSlider({
      bindElem: a.$element.find(".dataRow .useEndDate"),
      defaultVal: EasyEditLocalise._("Yes")
    });
  a.startDatePicker = new EasyEditDatePicker({
    bindElem: a.$element.find(".startDatePicker"),
    minimumDate: function() {
      return new Date("1 Jan " + ((new Date).getFullYear() - 10))
    },
    onChange: function() {
      var b = a.startDatePicker.getDate(),
        c = a.endDatePicker.getDate();
      b > c && a.endDatePicker.setDate(b);
      a.untilDatePicker && a.untilDatePicker.getDate() < b && a.untilDatePicker.setDate(b)
    }
  });
  a.endDatePicker = new EasyEditDatePicker({
    bindElem: a.$element.find(".endDatePicker"),
    minimumDate: function() {
      return a.startDatePicker.settings.minimumDate()
    },
    onChange: function() {
      var b = a.startDatePicker.getDate(),
        c = a.endDatePicker.getDate();
      c < b && a.startDatePicker.setDate(c)
    }
  });
  d.$bind.find("a[data-id]").click(function(b) {
    b.preventDefault();
    b = 1 == $(this).attr("data-id");
    a.startDatePicker.includeTimeComponent(b);
    a.endDatePicker.includeTimeComponent(b)
  });
  e.$bind.find("a[data-id]").click(function(b) {
    b.preventDefault();
    0 == $(this).attr("data-id") ? a.endDatePicker.$bindElem.parent().removeClass("screenHide") : a.endDatePicker.$bindElem.parent().addClass("screenHide")
  });
  var f = a.gatherCreateData;
  a.gatherCreateData = function() {
    f.call(a);
    var c = e.isTrue() ? a.endDatePicker.getMatrixDateString() : "---------- --:--:--";
    a.createData.attributes.push({
      key: "start_date",
      val: a.startDatePicker.getMatrixDateString()
    });
    a.createData.attributes.push({
      key: "end_date",
      val: c
    });
    b &&
      (a.createData.attributes.push({
        key: "frequency",
        val: jQuery("fieldset.ees_dateFrequency input:checked", a.$element).val()
      }), a.$element.find('input[name="ees_dateUntil"]').is(":checked") || a.createData.attributes.push({
        key: "stop_date",
        val: a.untilDatePicker.getMatrixDateString()
      }))
  };
  if (b) {
    var g = a.$element.find(".recurringOptions");
    g.removeClass("screenHide");
    a.untilDatePicker = new EasyEditDatePicker({
      time: !1,
      bindElem: a.$element.find(".untilDatePicker"),
      minimumDate: function() {
        return a.startDatePicker.settings.minimumDate()
      },
      onChange: function() {
        var b = a.startDatePicker.getDate();
        a.untilDatePicker.getDate() < b && a.untilDatePicker.setDate(b)
      }
    });
    g.find('input[name="ees_dateUntil"]').change(function() {
      jQuery(this).is(":checked") ? g.find(".stopDateSelection").addClass("screenHide") : g.find(".stopDateSelection").removeClass("screenHide")
    })
  }
};
(function(a, b) {
  var c = [{
    code: "af",
    name: "Afghanistan"
  }, {
    code: "ax",
    name: "Aland Islands"
  }, {
    code: "al",
    name: "Albania"
  }, {
    code: "dz",
    name: "Algeria"
  }, {
    code: "as",
    name: "American Samoa"
  }, {
    code: "ad",
    name: "Andorra"
  }, {
    code: "ao",
    name: "Angola"
  }, {
    code: "ai",
    name: "Anguilla"
  }, {
    code: "aq",
    name: "Antarctica"
  }, {
    code: "ag",
    name: "Antigua and Barbuda"
  }, {
    code: "ar",
    name: "Argentina"
  }, {
    code: "am",
    name: "Armenia"
  }, {
    code: "aw",
    name: "Aruba"
  }, {
    code: "au",
    name: "Australia"
  }, {
    code: "at",
    name: "Austria"
  }, {
    code: "az",
    name: "Azerbaijan"
  }, {
    code: "bs",
    name: "Bahamas"
  }, {
    code: "bh",
    name: "Bahrain"
  }, {
    code: "bd",
    name: "Bangladesh"
  }, {
    code: "bb",
    name: "Barbados"
  }, {
    code: "by",
    name: "Belarus"
  }, {
    code: "be",
    name: "Belgium"
  }, {
    code: "bz",
    name: "Belize"
  }, {
    code: "bj",
    name: "Benin"
  }, {
    code: "bm",
    name: "Bermuda"
  }, {
    code: "bt",
    name: "Bhutan"
  }, {
    code: "bo",
    name: "Bolivia"
  }, {
    code: "ba",
    name: "Bosnia and Herzegovina"
  }, {
    code: "bw",
    name: "Botswana"
  }, {
    code: "bv",
    name: "Bouvet Island"
  }, {
    code: "br",
    name: "Brazil"
  }, {
    code: "io",
    name: "British Indian Ocean Territory"
  }, {
    code: "bn",
    name: "Brunei darussalam"
  }, {
    code: "bg",
    name: "Bulgaria"
  }, {
    code: "bf",
    name: "Burkina Faso"
  }, {
    code: "bi",
    name: "Burundi"
  }, {
    code: "kh",
    name: "Cambodia"
  }, {
    code: "cm",
    name: "Cameroon"
  }, {
    code: "ca",
    name: "Canada"
  }, {
    code: "cv",
    name: "Cape Verde"
  }, {
    code: "ky",
    name: "Cayman Islands"
  }, {
    code: "cf",
    name: "Central African Republic"
  }, {
    code: "td",
    name: "Chad"
  }, {
    code: "cl",
    name: "Chile"
  }, {
    code: "cn",
    name: "China"
  }, {
    code: "cx",
    name: "Christmas Islands"
  }, {
    code: "cc",
    name: "Cocos (Keeling) Islands"
  }, {
    code: "co",
    name: "Colombia"
  }, {
    code: "km",
    name: "Comoros"
  }, {
    code: "cg",
    name: "Congo"
  }, {
    code: "ck",
    name: "Cook Islands"
  }, {
    code: "cr",
    name: "Costa Rica"
  }, {
    code: "ci",
    name: "Ivory Coast"
  }, {
    code: "hr",
    name: "Croatia"
  }, {
    code: "cu",
    name: "Cuba"
  }, {
    code: "cy",
    name: "Cyprus"
  }, {
    code: "cz",
    name: "Czech Republic"
  }, {
    code: "dk",
    name: "Denmark"
  }, {
    code: "dj",
    name: "Djibouti"
  }, {
    code: "dm",
    name: "Dominica"
  }, {
    code: "do",
    name: "Dominican Republic"
  }, {
    code: "tp",
    name: "East Timor"
  }, {
    code: "ec",
    name: "Ecuador"
  }, {
    code: "eg",
    name: "Egypt"
  }, {
    code: "sv",
    name: "El Salvador"
  }, {
    code: "gq",
    name: "Equatorial Guinea"
  }, {
    code: "er",
    name: "Eritrea"
  }, {
    code: "ee",
    name: "Estonia"
  }, {
    code: "et",
    name: "Ethiopia"
  }, {
    code: "fk",
    name: "Falkland Islands (Malvinas)"
  }, {
    code: "fo",
    name: "Faroe Islands"
  }, {
    code: "fj",
    name: "Fiji"
  }, {
    code: "fi",
    name: "Finland"
  }, {
    code: "fr",
    name: "France"
  }, {
    code: "fx",
    name: "France, Metropolitan"
  }, {
    code: "gf",
    name: "French Guiana"
  }, {
    code: "pf",
    name: "French Polynesia"
  }, {
    code: "tf",
    name: "French Southern Territories"
  }, {
    code: "ga",
    name: "Gabon"
  }, {
    code: "gm",
    name: "Gambia"
  }, {
    code: "ge",
    name: "Georgia"
  }, {
    code: "de",
    name: "Germany"
  }, {
    code: "gh",
    name: "Ghana"
  }, {
    code: "gi",
    name: "Gibraltar"
  }, {
    code: "gr",
    name: "Greece"
  }, {
    code: "gl",
    name: "Greenland"
  }, {
    code: "gd",
    name: "Grenada"
  }, {
    code: "gp",
    name: "Guadeloupe"
  }, {
    code: "gu",
    name: "Guam"
  }, {
    code: "gt",
    name: "Guatemala"
  }, {
    code: "gn",
    name: "Guinea"
  }, {
    code: "gw",
    name: "Guinea Bissau"
  }, {
    code: "gy",
    name: "Guyana"
  }, {
    code: "ht",
    name: "Haiti"
  }, {
    code: "hm",
    name: "Heard Island and Mc Donald Islands"
  }, {
    code: "hn",
    name: "Honduras"
  }, {
    code: "hk",
    name: "Hong Kong"
  }, {
    code: "hu",
    name: "Hungary"
  }, {
    code: "is",
    name: "Iceland"
  }, {
    code: "in",
    name: "India"
  }, {
    code: "id",
    name: "Indonesia"
  }, {
    code: "ir",
    name: "Iran (Islamic republic of)"
  }, {
    code: "iq",
    name: "Iraq"
  }, {
    code: "ie",
    name: "Ireland"
  }, {
    code: "il",
    name: "Israel"
  }, {
    code: "it",
    name: "Italy"
  }, {
    code: "jm",
    name: "Jamaica"
  }, {
    code: "jp",
    name: "Japan"
  }, {
    code: "je",
    name: "Jersey"
  }, {
    code: "jo",
    name: "Jordan"
  }, {
    code: "kz",
    name: "Kazakhstan"
  }, {
    code: "ke",
    name: "Kenya"
  }, {
    code: "ki",
    name: "Kiribati"
  }, {
    code: "kp",
    name: "Korea, Democratic people's Republic of"
  }, {
    code: "kr",
    name: "Korea, Republic of"
  }, {
    code: "kw",
    name: "Kuwait"
  }, {
    code: "kg",
    name: "Kyrgyzstan"
  }, {
    code: "la",
    name: "Lao people's democratic republic"
  }, {
    code: "lv",
    name: "Latvia"
  }, {
    code: "lb",
    name: "Lebanon"
  }, {
    code: "ls",
    name: "Lesotho"
  }, {
    code: "lr",
    name: "Liberia"
  }, {
    code: "ly",
    name: "Libyan Arab Jamahiriya"
  }, {
    code: "li",
    name: "Liechtenstein"
  }, {
    code: "lt",
    name: "Lithuania"
  }, {
    code: "lu",
    name: "Luxembourg"
  }, {
    code: "mo",
    name: "Macau"
  }, {
    code: "mk",
    name: "Macedonia, The Former Yugoslav Republic Of"
  }, {
    code: "mg",
    name: "Madagascar"
  }, {
    code: "mw",
    name: "Malawi"
  }, {
    code: "my",
    name: "Malaysia"
  }, {
    code: "mv",
    name: "Maldives"
  }, {
    code: "ml",
    name: "Mali"
  }, {
    code: "mt",
    name: "Malta"
  }, {
    code: "mh",
    name: "Marshall islands"
  }, {
    code: "mq",
    name: "Martinique"
  }, {
    code: "mr",
    name: "Mauritania"
  }, {
    code: "mu",
    name: "Mauritius"
  }, {
    code: "yt",
    name: "Mayotte"
  }, {
    code: "mx",
    name: "Mexico"
  }, {
    code: "fm",
    name: "Micronesia (Federated States of)"
  }, {
    code: "md",
    name: "Moldova, Republic of"
  }, {
    code: "mc",
    name: "Monaco"
  }, {
    code: "mn",
    name: "Mongolia"
  }, {
    code: "me",
    name: "Montenegro"
  }, {
    code: "ms",
    name: "Montserrat"
  }, {
    code: "ma",
    name: "Morocco"
  }, {
    code: "mz",
    name: "Mozambique"
  }, {
    code: "mm",
    name: "Myanmar"
  }, {
    code: "na",
    name: "Namibia"
  }, {
    code: "nr",
    name: "Nauru"
  }, {
    code: "np",
    name: "Nepal"
  }, {
    code: "nl",
    name: "Netherlands"
  }, {
    code: "an",
    name: "Netherlands Antilles"
  }, {
    code: "nc",
    name: "New Caledonia"
  }, {
    code: "nz",
    name: "New Zealand"
  }, {
    code: "ni",
    name: "Nicaragua"
  }, {
    code: "ne",
    name: "Niger"
  }, {
    code: "ng",
    name: "Nigeria"
  }, {
    code: "nu",
    name: "Niue"
  }, {
    code: "nf",
    name: "Norfolk Islands"
  }, {
    code: "mp",
    name: "Northern Mariana Islands"
  }, {
    code: "no",
    name: "Norway"
  }, {
    code: "om",
    name: "Oman"
  }, {
    code: "pk",
    name: "Pakistan"
  }, {
    code: "pw",
    name: "Palau"
  }, {
    code: "ps",
    name: "Palestinian Territory, Occupied"
  }, {
    code: "pa",
    name: "Panama"
  }, {
    code: "pg",
    name: "Papua New Guinea"
  }, {
    code: "py",
    name: "Paraguay"
  }, {
    code: "pe",
    name: "Peru"
  }, {
    code: "ph",
    name: "Philippines"
  }, {
    code: "pn",
    name: "Pitcairn"
  }, {
    code: "pl",
    name: "Poland"
  }, {
    code: "pt",
    name: "Portugal"
  }, {
    code: "pr",
    name: "Puerto Rico"
  }, {
    code: "qa",
    name: "Qatar"
  }, {
    code: "re",
    name: "Reunion"
  }, {
    code: "ro",
    name: "Romania"
  }, {
    code: "ru",
    name: "Russia Federation"
  }, {
    code: "rw",
    name: "Rwanda"
  }, {
    code: "bl",
    name: "Saint Barthelemy"
  }, {
    code: "sh",
    name: "Saint Helena"
  }, {
    code: "kn",
    name: "Saint Kitts and Nevis"
  }, {
    code: "lc",
    name: "Saint Lucia"
  }, {
    code: "mf",
    name: "Saint Martin"
  }, {
    code: "pm",
    name: "Saint Pierre et Miquelon"
  }, {
    code: "vc",
    name: "Saint Vincent and the Grenadines"
  }, {
    code: "ws",
    name: "Samoa"
  }, {
    code: "sm",
    name: "San Marino"
  }, {
    code: "st",
    name: "Sao Tome and Principe"
  }, {
    code: "sa",
    name: "Saudi Arabia"
  }, {
    code: "sn",
    name: "Senegal"
  }, {
    code: "yu",
    name: "Serbia"
  }, {
    code: "sc",
    name: "Seychelles"
  }, {
    code: "sl",
    name: "Sierra Leone"
  }, {
    code: "sg",
    name: "Singapore"
  }, {
    code: "sk",
    name: "Slovakia"
  }, {
    code: "si",
    name: "Slovenia"
  }, {
    code: "sb",
    name: "Solomon Islands"
  }, {
    code: "so",
    name: "Somalia"
  }, {
    code: "za",
    name: "South Africa"
  }, {
    code: "gs",
    name: "South Georgia and the South Sandwich Islands"
  }, {
    code: "es",
    name: "Spain"
  }, {
    code: "lk",
    name: "Sri Lanka"
  }, {
    code: "sd",
    name: "Sudan"
  }, {
    code: "sr",
    name: "Suriname"
  }, {
    code: "sj",
    name: "Svalbard and Jan Mayen"
  }, {
    code: "sz",
    name: "Swaziland"
  }, {
    code: "se",
    name: "Sweden"
  }, {
    code: "ch",
    name: "Switzerland"
  }, {
    code: "sy",
    name: "Syria Arab Republic"
  }, {
    code: "tw",
    name: "Taiwan, Province of China"
  }, {
    code: "tj",
    name: "Tajikistan"
  }, {
    code: "tz",
    name: "Tanzania, United Republic Of"
  }, {
    code: "th",
    name: "Thailand"
  }, {
    code: "tg",
    name: "Togo"
  }, {
    code: "tk",
    name: "Tokelau"
  }, {
    code: "to",
    name: "Tonga"
  }, {
    code: "tt",
    name: "Trinidad and Tobago"
  }, {
    code: "tn",
    name: "Tunisia"
  }, {
    code: "tr",
    name: "Turkey"
  }, {
    code: "tm",
    name: "Turkmenistan"
  }, {
    code: "tc",
    name: "Turks and Caicos Islands"
  }, {
    code: "tv",
    name: "Tuvalu"
  }, {
    code: "ug",
    name: "Uganda"
  }, {
    code: "ua",
    name: "Ukraine"
  }, {
    code: "ae",
    name: "United Arab Emirates"
  }, {
    code: "gb",
    name: "United Kingdom"
  }, {
    code: "us",
    name: "United States"
  }, {
    code: "um",
    name: "United States Minor Outlying Islands"
  }, {
    code: "uy",
    name: "Uruguay"
  }, {
    code: "uz",
    name: "Uzbekistan"
  }, {
    code: "vu",
    name: "Vanuatu"
  }, {
    code: "va",
    name: "Vatican City State (Holy See)"
  }, {
    code: "ve",
    name: "Venezuela"
  }, {
    code: "vn",
    name: "Vietnam"
  }, {
    code: "vg",
    name: "Virgin Islands (British)"
  }, {
    code: "vi",
    name: "Virgin Islands (U.S.)"
  }, {
    code: "wf",
    name: "Wallis and Futuna Islands"
  }, {
    code: "eh",
    name: "Western Sahara"
  }, {
    code: "ye",
    name: "Yemen"
  }, {
    code: "zm",
    name: "Zambia"
  }, {
    code: "zw",
    name: "Zimbabwe"
  }];
  b.country = function(b) {
    b.options.countries = c;
    b.events.observe("render",
      function() {
        var c = b.getSerialisedAttribute("available"),
          f = b.settingsTip.$element.find('select[name="countries"]');
        EasyEdit.util.each(c, function(b, c) {
          a('option[value="' + c + '"]', f).attr("selected", "selected")
        })
      });
    b.events.observe("bind", function() {
      b.settingsTip.$element.find('select[name="countries"]').on("change", function() {
        var c = a(this).val();
        EasyEdit.util.isArray(c) || (c = [c]);
        b.attribute("available", EasyEdit.util.serialise(c));
        b.events.trigger("change")
      })
    });
    b.events.observe("update", function() {
      var c =
        a(".custom-form-question__preview", b.$element),
        c = a("select", c).val();
      EasyEdit.util.isArray(c) || (c = [c]);
      b.attribute("default", EasyEdit.util.serialise(c))
    });
    b.buildPreview = function(e, f) {
      var g = b.getSerialisedAttribute("default"),
        j = b.getSerialisedAttribute("available"),
        h = [];
      if (null === j || 0 === j.length) {
        for (i = 0; i < c.length; i++) h.push(c[i].code);
        j = h
      }
      h = EasyEdit.util.filter(c, function(a, b) {
        var c = !1;
        EasyEdit.util.each(j, function(a, d) {
          b.code === d && (c = !0)
        });
        EasyEdit.util.each(g, function(a, c) {
          b.selected = b.code ===
            c ? !0 : !1
        });
        return c
      });
      h = a.extend({}, {
        selectedCountries: h
      }, f);
      e.html(EasyEdit.tmpl.render("custom_form_question_preview_" + f.type, h))
    }
  }
})(jQuery, EasyEditQuestionDecorators);
(function(a, b) {
  var c = function(a) {
      var b = [],
        c = "",
        c = EasyEdit.util.map(a, function(a, b) {
          return b.key
        });
      EasyEdit.util.filter(c, function(a, b) {
        return EasyEdit.util.isNumber(b) || /^[0-9]+$/.test(b)
      }).length === c.length ? (b = EasyEdit.util.map(a, function(a, b) {
        return b.value
      }), c = EasyEdit.util.serialise(b)) : (EasyEdit.util.each(a, function(a, c) {
        b.push(EasyEdit.util.serialise(c.key));
        b.push(EasyEdit.util.serialise(c.value))
      }), c = "a:" + b.length / 2 + ":{" + b.join("") + "}");
      return c
    },
    d = function(a, b) {
      var c = a.getSerialisedAttribute("default");
      EasyEdit.util.isArray(c) && EasyEdit.util.each(c, function(c, d) {
        if (d === a.attribute("empty_key") || "EMPTY" === d) b.emptyIsDefault = !0;
        EasyEdit.util.each(b.values, function(a, b) {
          d + "" === b.key + "" && (b.isDefault = !0)
        })
      });
      return b
    },
    e = function(b, d) {
      b.events.observe("render", function() {
        var c = [];
        b.attributes.hasOwnProperty("options") && (c = b.getSerialisedAttribute("options"));
        var d = a(".custom-form-question__option-widget", b.settingsTip.$element);
        b.optionWidget = d.EasyEditOptionWidget({
          values: c,
          keyEditable: "select" === b.options.type ?
            !0 : !1
        }).data("EasyEditOptionWidget")
      });
      b.events.observe("bind", function() {
        b.optionWidget.$elem.on("change.widget", function() {
          var a = b.optionWidget.fetch(),
            a = c(a);
          b.attribute("options", a);
          b.events.trigger("change")
        })
      });
      b.buildPreview = function(a, c) {
        var e = [];
        b.hasOwnProperty("optionWidget") ? e = b.optionWidget.fetch() : c.attributes.hasOwnProperty("options") && (e = EasyEdit.util.map(b.getSerialisedAttribute("options"), function(a, b) {
          return {
            key: a,
            value: b
          }
        }));
        d.call(b, a, c, e)
      }
    };
  b.select = function(b) {
    !1 === b.attributes.hasOwnProperty("empty_key") &&
      b.attribute("empty_key", "");
    !1 === b.attributes.hasOwnProperty("empty_text") && b.attribute("empty_text", "-- " + EasyEditLocalise._("Please Select") + " --");
    e(b, function(c, e, f) {
      var l = a.extend({}, {
          values: f
        }, e),
        f = d(b, l);
      c.html(EasyEdit.tmpl.render("custom_form_question_preview_" + e.type, l));
      c.find("select").on("change", function() {
        var c = a(this).val();
        EasyEdit.util.isArray(c) || (c = [c]);
        b.attribute("default", EasyEdit.util.serialise(c))
      })
    });
    b.events.observe("bind", function() {
      var c = a(".custom-form-question__preview select",
          b.$element),
        d = a(".custom-form-modal__empty-row", b.settingsTip.$element);
      1 === b.attribute("allow_empty") && d.removeClass("screenHide");
      a(".custom-form-modal__empty-option-text input", d).on("keyup change", function() {
        var d = a(this).val();
        b.attribute("empty_text", d);
        a(".empty-value", c).text(d)
      });
      a(".custom-form-modal__empty-option-value input", d).on("keyup change", function() {
        var d = a(this).val();
        b.attribute("empty_key", d);
        a(".empty-value", c).attr("value", d)
      });
      b.bindSliderEvent("allowEmpty", function() {
          d.removeClass("screenHide")
        },
        function() {
          d.addClass("screenHide")
        });
      b.bindSliderEvent("multiSelect", function() {
        c.attr("multiple", !0)
      }, function() {
        c.removeAttr("multiple")
      })
    })
  };
  var f = 0;
  b.option_list = function(b) {
    e(b, function(c, e, k) {
      k.splice(0, 0, {
        key: "",
        value: EasyEditLocalise._("No default selection")
      });
      var l = !1;
      EasyEdit.util.each(k, function(a, b) {
        b.internal_id = f;
        f += 1;
        b.isDefault && (l = !0)
      });
      l || (k[0].isDefault = !0);
      k = a.extend({}, {
        values: k
      }, e);
      k = d(b, k);
      c.html(EasyEdit.tmpl.render("custom_form_question_preview_" + e.type, k));
      a(".custom-form-question__option-list-item:first",
        c).find("input, label").attr("title", EasyEditLocalise._("This radio button won't appear on the front end"));
      c.find("input").on("change", function() {
        var a = c.find("input:checked").val();
        a === "" ? b.attribute("default", EasyEdit.util.serialise([])) : b.attribute("default", EasyEdit.util.serialise([a]))
      })
    })
  };
  b.tickbox_list = function(b) {
    e(b, function(c, e, k) {
      EasyEdit.util.each(k, function(a, b) {
        b.internal_id = f;
        f += 1
      });
      k = a.extend({}, {
        values: k
      }, e);
      k = d(b, k);
      c.html(EasyEdit.tmpl.render("custom_form_question_preview_" + e.type,
        k));
      c.find("input").on("change", function() {
        var d = [];
        c.find("input:checked").each(function() {
          d.push(a(this).val())
        });
        b.attribute("default", EasyEdit.util.serialise(d))
      })
    })
  }
})(jQuery, EasyEditQuestionDecorators);
EasyEditScreens.assetTypes.file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsFileDefault = {
  containerId: null,
  upload: null,
  validationRules: {
    ees_inputName: [{
      type: "required"
    }, {
      message: EasyEditLocalise._("File name should be no larger than 240 bytes when encoded as UTF-8"),
      type: "test",
      args: function(a) {
        if (240 < EasyEdit.util.utf8ByteLength(a)) return !1
      }
    }]
  },
  init: function(a, b, c) {
    var d = this;
    d.validator = null;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(e, function(f) {
        var g = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(e),
          f = '<div id="ees_editDetails">' + f + d._getDetailsHTML(e) + g + "</div>",
          g = jQuery(d.containerId),
          j = g.find("#ees_editDetails");
        j.length ? j.replaceWith(f) : g.append(f);
        f = e.attributes();
        jQuery("#ees_inputTitle").val(f.hasOwnProperty("title") ? f.title : "");
        d._attachEvents(e);
        EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, e, b, c)
      })
    })
  },
  save: function(a) {
    function b(a, b) {
      var d, e = jQuery(a),
        k = new EasyEditValidationErrorInline({
          element: e
        });
      d = EasyEditLocalise._("There is a problem with this field");
      switch (b.type) {
        case "required":
          d =
            EasyEditLocalise._("This field is required");
          break;
        case "accept":
          d = EasyEditLocalise._("Incorrect file type")
      }
      void 0 !== b.message && (d = b.message);
      var l = {};
      l[b.type] = {
        args: b.args || null,
        message: d
      };
      c.validator.addTest(e, l, k)
    }
    var c = this;
    if (!c.hasOwnProperty("validator") || null === c.validator) {
      c.validator = new EasyEditValidationController;
      for (var d in c.validationRules)
        if (c.validationRules.hasOwnProperty(d))
          for (var e in c.validationRules[d]) c.validationRules[d].hasOwnProperty(e) && b("#" + d, c.validationRules[d][e])
    }
    c.validator.valid() ||
      !jQuery("#ees_inputName").length ? (EasyEditOverlay.showOverlay("loading"), EasyEditAssetManager.getCurrentAsset(function(b) {
        c._doSave(function(c, d) {
          b.acquireLock("all", function() {
            a.apply(this, [c, d, {
              refresh: !0
            }])
          })
        })
      })) : ($warnings = jQuery(".fieldWarning"), 0 < $warnings.length && EasyEditComponents.scrollIntoView($warnings[0]))
  },
  _doSave: function(a) {
    var b = this;
    EasyEditAssetManager.getCurrentAsset(function(c) {
      function d() {
        EasyEditOverlay.showOverlay("loading");
        EasyEditScreens.screen.detailsDefault.checkStatus(c,
          function(d) {
            EasyEditScreens.screen.detailsDefault.saveFutureStatus(function() {
              EasyEditScreens.screen.detailsDefault.saveThumbnail(function() {
                d || e ? c.save(function(d) {
                  var e = EasyEdit.filterErrorArray(d),
                    f = 1 <= e.length ? !1 : !0;
                  "undefined" !== typeof g && g !== j && "Archived" === !c.attribute("status") ? b.saveWebPaths(c.id, j, g, function() {
                    c.refreshAttributes(function() {
                      a.apply(this, [f, e])
                    })
                  }) : c.refreshAttributes(function() {
                    a.apply(this, [f, e])
                  })
                }) : c.refreshAttributes(function() {
                  a.apply(this, [!0, []])
                })
              })
            })
          })
      }
      var e = !1,
        f = jQuery("#ees_inputTitle").val();
      f !== c.attribute("title") && jQuery("#ees_inputTitle").length && (e = !0, c.attribute("title", f));
      var g = jQuery("#ees_inputName").val(),
        j = c.attribute("name");
      g !== c.attribute("name") && jQuery("#ees_inputName").length && (e = !0, c.attribute("name", g));
      "" !== jQuery("#ees_inputUpload").val() && null !== b.upload && jQuery("#ees_inputUpload").length ? b.upload.start(function(a) {
        jQuery("body>form").remove();
        jQuery("body>iframe").remove();
        b.upload = null;
        if (a instanceof Array && a.length >= 1) {
          for (var e =
              "", f = 0, g = a.length; f < g; f++) a[f].header.indexOf("Failed adding URL remap") === -1 && (e = e + ("<p><strong>" + a[f].header + ":</strong> " + a[f].error + "</p>"));
          e.indexOf("File upload failed") !== -1 || e.indexOf("File extension") !== -1 || /\[SYS002[0-3]\]/.test(e) !== -1 ? (new EasyEditError(e)).display() : d()
        } else d();
        b._attachEvents(c)
      }) : d()
    })
  },
  saveWebPaths: function(a, b, c, d) {
    var e = !1,
      f = new EasyEditAPI;
    f.queue("getWebPath", {
      asset_id: a
    });
    f.expect(1).run(function(g) {
      g = g[0].data;
      if (!EasyEdit.isError(g)) {
        for (var j = 0, h = g.webpath.length; j <
          h; j++) b === g.webpath[j] && (e = !0, g.webpath[j] = c);
        e || g.webpath.push(c);
        f.queue("setWebPath", {
          asset_id: a,
          paths: g.webpath,
          auto_remap: 1
        }, f.runMode.SYNC);
        f.expect(1).run(function() {
          d.apply(this, [!0, []])
        })
      }
    }, f.runMode.SYNC)
  },
  _getDetailsHTML: function(a) {
    a.attributes();
    return '<h3 class="sectionHeading">' + EasyEditLocalise._("File Information") + '</h3><div id="ees_fileAttributes"><div id="ees_fileDetails" class="alignLeft"><div class="row"><div class="cellName alignLeft"><label for="ees_inputTitle" class="inputLabel">' +
      EasyEditLocalise._("Friendly Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputTitle" name="ees_inputTitle" class="inputText" value="" /></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputName" class="inputLabel">' + EasyEditLocalise._("File Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /><span class="notes">' + EasyEditLocalise._("File name will appear at the end of the URL.") +
      '</span></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputUpload" class="inputLabel">' + EasyEditLocalise._("Upload") + '</label></div><div class="cellData alignLeft"><input type="file" name="ees_inputUpload" id="ees_inputUpload" value="" /><span class="notes">' + EasyEditLocalise._("Upload a new file to overwrite the current file.") + "</span></div></div></div></div>"
  },
  _attachEvents: function(a) {
    var b = a.attribute("type_code") + "_" + a.id,
      c = Math.floor(1E16 * Math.random()),
      d = EasyEditUrl.getBaseSiteURL();
    this.upload = new EasyEditFileUpload({
      url: d + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + a.id + "&load_easy_edit=false&nocache=" + c + "&SQ_BACKEND_PAGE=main&ignore_frames=1&sq_link_path=&sq_asset_path=&asset_ei_screen=details",
      selector: "body",
      id: "#ees_inputUpload",
      filePostName: b,
      assetid: a.id,
      prefix: "ees_uploader_",
      onStart: function() {
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Uploading file") + "..."
        })
      },
      onComplete: function() {
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("File upload complete. Saving asset") +
            "..."
        })
      },
      postParam: {
        process_form: "1",
        backend_section: "am",
        am_section: "limbo",
        am_form_submitted: "1",
        assetid: a.id,
        backend_assetid: a.id,
        asset_action: "edit",
        asset_ei_screen: "details",
        sq_lock_release: "0",
        sq_link_path: "",
        sq_preview_url: a.attribute("web_path"),
        sq_limbo_lock_type: "a%3A1%3A%7Bi%3A0%3Bs%3A10%3A%22attr_links%22%3B%7D",
        sq_lock_type: "attr_links"
      }
    })
  }
};
EasyEditScreens.screen.urlsDefault = {
  containerId: null,
  childCount: 0,
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(b) {
      e.queue("getKeywordsReplacements", {
        asset_id: b.id,
        keywords_array: ["%paths-S_web_paths%"]
      });
      e.queue("getChildCount", {
        asset_id: b.id,
        level: 0
      });
      e.expect(2).run(function(b) {
        EasyEdit.isError(b[1].data) || (d.childCount = b[1].data.child_count);
        var e = jQuery(a),
          f = e.find("#ees_editURLs");
        if (EasyEdit.isError(b[0].data))(new EasyEditError(EasyEdit.getError(b[0].data))).display();
        else {
          var k = jQuery(b[0].data["paths-S_web_paths"]["paths-S_web_paths"]);
          if (0 === k.find("input").length) {
            var l = '<h3 class="sectionHeading">' + EasyEditLocalise._("Web Paths") + '</h3><div id="ees_webPaths">',
              n = /http/i;
            k.find("td.sq-backend-data").each(function() {
              var a = jQuery(this);
              a.find("br").remove();
              a = a.html();
              n.test(a) && (l = l + ('<div id="ees_listCurrentUrls">' + a + "</div>"))
            });
            l += "</div>";
            b = '<div id="ees_editURLs">' + l + "</div>";
            f.length ? f.replaceWith(b) : e.append(b)
          } else {
            b = '<div id="ees_editURLs">' + d._rebuildHTML(b[0].data["paths-S_web_paths"]["paths-S_web_paths"]) +
              "</div>";
            f.length ? f.replaceWith(b) : e.append(b);
            $sliderDiv = jQuery("#ees_addAutoRemap");
            var m = new EasyEditSlider({
              bindElem: $sliderDiv,
              defaultVal: 1 === parseFloat($sliderDiv.attr("data-value")) ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No"),
              options: [
                [EasyEditLocalise._("Yes"), EasyEditLocalise._("Create and automatic remap"), function() {}],
                [EasyEditLocalise._("No"), EasyEditLocalise._("Do not create an automatic remap"), function() {}]
              ]
            });
            m.events.observe("change", function() {
              $sliderDiv.attr("data-value",
                m.getSelected() === EasyEditLocalise._("Yes") ? 1 : 0);
              EasyEditComponentsToolbar.enableSaveButton()
            });
            EasyEditComponentsToolbar.detectScreenEdits()
          }
          jQuery(d.containerId).find("input").bind("change", function() {
            jQuery(d.containerId).find(".fieldWarning").remove()
          })
        }
        c.call(this)
      }, e.runMode.BATCH)
    })
  },
  _rebuildHTML: function(a) {
    var b = jQuery("<div>" + a + "</div>"),
      c = b.find("td.sq-backend-data:eq(0)"),
      a = b.find("td.sq-backend-data:eq(1)"),
      d = b.find("td.sq-backend-data:eq(2) input").val();
    c.find("br").remove();
    a.find("br").remove();
    c.find("input").each(function() {
      var a = jQuery(this);
      a.addClass("inputText");
      "" !== a.val() ? a.wrap('<div class="row" />') : a.wrap('<div id="ees_newPathInput" />')
    });
    var e = c.find("#ees_newPathInput"),
      b = e.html();
    e.remove();
    c = c.html();
    c = '<h3 class="sectionHeading">' + EasyEditLocalise._("Web Paths") + '</h3><div id="ees_webPaths">' + c + '</div><div id="ees_autoRemap"><div class="row"><div class="cellName">' + EasyEditLocalise._("Add Remaps?") + '</div><div class="cellData"><div id="ees_addAutoRemap" data-value="' + Number(d) +
      '"></div><div class="notes"><p>' + EasyEditLocalise._('When set to "%1", this option will add remaps for Web Paths that have been changed above.', EasyEditLocalise._("Yes")) + "</p></div></div></div></div>";
    d = location.protocol + "//" + location.host + location.pathname.replace("/" + EasyEdit.systemInfo.suffixes.edit, "");
    d = d.substring(0, d.lastIndexOf("/")) + "/";
    c += '<h3 class="sectionHeading">' + EasyEditLocalise._("Add New") + '</h3><div id="ees_newWebPath">' + b + '<div class="notes"><p>' + EasyEditLocalise._("Add the name of the page as you would like it to appear at the end of the URL.") +
      "<br />" + EasyEditLocalise._('The URL stem <span class="stem">%1</span> cannot be edited on this screen.', d) + " </p></div></div>";
    a = a.html();
    return c += '<h3 class="sectionHeading">' + EasyEditLocalise._("Current URLs") + '</h3><div id="ees_listCurrentUrls">' + a + "</div>"
  },
  save: function(a) {
    var b = this,
      c = jQuery('input[type="text"]', b.containerId),
      d = jQuery("#ees_addAutoRemap", b.containerId),
      e = new EasyEditAPI;
    jQuery(b.containerId).find(".fieldWarning").remove();
    if (2 <= c.length) {
      var f = !0;
      c.each(function() {
        null ===
          /^\s*$/g.exec(jQuery(this).val()) && (f = !1)
      });
      if (f) return jQuery(c.get(0)).after(EasyEdit.tmpl.render("simple_tag", {
        "class": "fieldWarning",
        content: EasyEditLocalise._("You must have at least one webpath"),
        tag: "span"
      })), EasyEditOverlay.hideOverlay("loading"), !1
    }
    EasyEditAssetManager.getCurrentAsset(function(f) {
      function j() {
        EasyEditOverlay.showOverlay("loading");
        var h = [];
        c.each(function() {
          var a = jQuery(this).val();
          "" !== a && h.push(a)
        });
        var k = Number(d.attr("data-value"));
        e.queue("setWebPath", {
          asset_id: f.id,
          paths: h,
          auto_remap: k
        });
        e.queue("getWebPath", {
          asset_id: f.id
        });
        e.expect(2).run(function(c) {
          !EasyEdit.isError(c[0].data) && !EasyEdit.isError(c[1].data) && ("string" === typeof c[0].data[0] && -1 !== c[0].data[0].indexOf("Could not update webpath") ? (new EasyEditError(c[0].data[0] + "<br />" + EasyEditLocalise._("You may need to check if another asset already has this url."))).display() : b.checkRedirect(e.getResult(1, "webpath")) && a.apply(this, [!0, [], {
            refresh: !0
          }]))
        }, e.runMode.BATCH)
      }
      b.childCount >= EasyEditConfig.cascadeThreshold ?
        EasyEditOverlay.showOverlay("confirm", {
          message: EasyEditLocalise._('<p class="confirmMessage">You are about to affect the web path of more than %1 assets. Do you wish to continue?</p>', EasyEditConfig.cascadeThreshold),
          title: EasyEditLocalise._("Update Web Path"),
          cancelText: EasyEditLocalise._("Return to Screen"),
          confirmText: EasyEditLocalise._("Apply Web Path Change"),
          cssClass: "updateWebPath",
          confirmFn: function() {
            EasyEditOverlay.hideOverlay("confirm");
            j()
          },
          cancelFn: function() {
            EasyEditOverlay.hideOverlay("confirm")
          }
        }) :
        j()
    })
  },
  checkRedirect: function(a) {
    var b = EasyEdit.getURL(),
      c = RegExp("([^/]+)$", "g"),
      d = c.exec(b.url),
      e = EasyEdit.getParam("limbo_assetid"),
      f = EasyEdit.getParam("a");
    if (null !== d && null === f && null === e && (d = d[0], a instanceof Array))
      for (e = a.length; 0 < e && a[0] !== d;) return b.url = b.url.replace(c, a[0]), EasyEditOverlay.showOverlay("loading", {
        message: EasyEditLocalise._("Redirecting to new url") + "..."
      }), window.location = b.url + "/" + EasyEdit.systemInfo.suffixes.edit + "?screen=urls", !1;
    return !0
  }
};
EasyEditScreens.assetTypes.image = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsImage",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsImage = {
  containerId: null,
  upload: null,
  validationRules: {
    ees_inputAlt: {
      required: !0
    }
  },
  init: function(a, b, c) {
    var d = this;
    d.validator = null;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(e, function(f) {
        var g = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(e),
          f = '<div id="ees_editDetails">' + f + d._getDetailsHTML(e) + g + "</div>",
          g = jQuery(d.containerId),
          j = g.find("#ees_editDetails");
        j.length ? j.replaceWith(f) : g.append(f);
        f = e.attributes();
        jQuery("#ees_inputTitle").val(f.hasOwnProperty("title") ? f.title : "");
        jQuery("#ees_inputAlt").val(f.hasOwnProperty("alt") ? f.alt : "");
        d._attachEvents(e);
        EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, e, b, c)
      })
    })
  },
  save: function(a) {
    var b = this,
      c = jQuery("#ees_inputName"),
      d = jQuery("#ees_inputUpload");
    if (!b.hasOwnProperty("validator") || null === b.validator) {
      b.validator = new EasyEditValidationController;
      var e = new EasyEditValidationErrorInline({
        element: c
      });
      b.validator.addTest(c, {
        required: {
          args: null,
          message: EasyEditLocalise._("A file name is required.")
        }
      }, e);
      b.validator.addTest(c, {
        test: {
          args: function(a) {
            if (240 < EasyEdit.util.utf8ByteLength(a)) return !1
          },
          message: EasyEditLocalise._("File name should be no larger than 240 bytes when encoded as UTF-8")
        }
      }, e);
      e = new EasyEditValidationErrorInline({
        element: d
      });
      b.validator.addTest(d, {
        accept: {
          args: "jpeg|jpg|gif|png",
          message: EasyEditLocalise._("A valid file extension is required.")
        }
      }, e)
    }
    b.validator.valid() || !c.length ? (EasyEditOverlay.showOverlay("loading"),
      EasyEditAssetManager.getCurrentAsset(function(c) {
        b._doSave(function(b, d) {
          c.acquireLock("all", function() {
            a.apply(this, [b, d, {
              refresh: !0
            }])
          })
        })
      })) : ($warnings = jQuery(".fieldWarning"), 0 < $warnings.length && EasyEditComponents.scrollIntoView($warnings[0]))
  },
  _doSave: function(a) {
    var b = this;
    EasyEditAssetManager.getCurrentAsset(function(c) {
      function d() {
        EasyEditOverlay.showOverlay("loading");
        EasyEditScreens.screen.detailsDefault.checkStatus(c, function(b) {
          EasyEditScreens.screen.detailsDefault.saveFutureStatus(function() {
            EasyEditScreens.screen.detailsDefault.saveThumbnail(function() {
              b ||
                e ? c.save(function(b) {
                  var d = EasyEdit.filterErrorArray(b),
                    e = 1 <= d.length ? !1 : !0;
                  g !== j && jQuery("#ees_inputName").length ? EasyEditScreens.screen.detailsFileDefault.saveWebPaths(c.id, j, g, function() {
                    c.refreshAttributes(function() {
                      a.apply(this, [e, d])
                    })
                  }) : c.refreshAttributes(function() {
                    a.apply(this, [e, d])
                  })
                }) : c.refreshAttributes(function() {
                  a.apply(this, [!0, []])
                })
            })
          })
        })
      }
      var e = !1,
        f = jQuery("#ees_inputTitle").val();
      f !== c.attribute("title") && jQuery("#ees_inputTitle").length && (e = !0, c.attribute("title", f));
      f = jQuery("#ees_inputAlt").val();
      f !== c.attribute("alt") && jQuery("#ees_inputAlt").length && (e = !0, c.attribute("alt", f));
      f = jQuery("#ees_inputCaption").val();
      f !== c.attribute("caption") && jQuery("#ees_inputCaption").length && (e = !0, c.attribute("caption", f));
      var g = jQuery("#ees_inputName").val(),
        j = c.attribute("name");
      g !== c.attribute("name") && jQuery("#ees_inputName").length && (e = !0, c.attribute("name", g));
      "" !== jQuery("#ees_inputUpload").val() && null !== b.upload && jQuery("#ees_inputUpload").length ? b.upload.start(function(a) {
        jQuery("body>form").remove();
        jQuery("body>iframe").remove();
        b.upload = null;
        if (a instanceof Array && a.length >= 1) {
          for (var e = "", f = 0, g = a.length; f < g; f++) a[f].header.indexOf("Failed adding URL remap") === -1 && (e = e + ("<p><strong>" + a[f].header + ":</strong> " + a[f].error + "</p>"));
          e.indexOf("File upload failed") !== -1 || e.indexOf("File extension") !== -1 ? (new EasyEditError(e)).display() : d()
        } else d();
        b._attachEvents(c)
      }) : d()
    })
  },
  _getDetailsHTML: function(a) {
    var b = a.attributes(),
      a = '<h3 class="sectionHeading">' + EasyEditLocalise._("Image Information") +
      '</h3><div id="ees_imageAttributes"><div id="ees_imageDetails" class="alignLeft"><div class="row"><div class="cellName alignLeft"><label for="ees_inputTitle" class="inputLabel">' + EasyEditLocalise._("Friendly Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputTitle" name="ees_inputTitle" class="inputText" value="" /></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputAlt" class="inputLabel">' + EasyEditLocalise._("Alt Text") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputAlt" name="ees_inputAlt" class="inputText" value="" /><span class="notes altNotes">' +
      EasyEditLocalise._("The text to be used in the Alt attribute of the IMG tag. If decorative, leave this field empty.") + ' </span></div></div><div class="row"><div class="cellName alignLeft caption"><label for="ees_inputCaption" class="inputLabel">' + EasyEditLocalise._("Caption") + '</label></div><div class="cellData alignLeft"><textarea id="ees_inputCaption" name="ees_inputCaption" class="inputText"></textarea><span class="notes">' + EasyEditLocalise._("Some text to be associated with the image and can be accessed and printed out separately if required.") +
      '</span></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputName" class="inputLabel">' + EasyEditLocalise._("File Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /><span class="notes">' + EasyEditLocalise._("File name will appear at the end of the URL.") + '</span></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputUpload" class="inputLabel">' + EasyEditLocalise._("Upload") +
      '</label></div><div class="cellData alignLeft"><input type="file" name="ees_inputUpload" id="ees_inputUpload" value="" /><span class="notes">' + EasyEditLocalise._("Upload a new image to overwrite the current file.") + '</span></div></div></div><div id="ees_imagePreview" class="alignLeft"><p class="heading">' + EasyEditLocalise._("Preview") + '</p><p id="ees_imageContainer">' + this.rescaleImage(a.id, b, 250, 250) + '</p><p id="ees_imageDimensions" class="notes">' + EasyEditLocalise._("Dimensions") + ': <span id="ees_imageWidth">' +
      (b.hasOwnProperty("width") ? b.width : "") + '</span> x <span id="ees_imageHeight">' + (b.hasOwnProperty("height") ? b.height : "") + '</span></p><p id="ees_imageSize" class="notes">' + EasyEditLocalise._("File size") + ': <span id="ees_imageFileSize">' + EasyEditScreens.assetTypes.defaultAsset.readablizeBytes(b.hasOwnProperty("size") ? b.size : 0) + "</span></p></div></div>",
      a = jQuery("<div>" + a + "</div>");
    a.find("#ees_inputCaption").text(b.hasOwnProperty("caption") ? b.caption : "");
    return a.html()
  },
  rescaleImage: function(a, b, c,
    d) {
    var e, f, g = 1 * b.width,
      j = 1 * b.height,
      c = 1 * c,
      d = 1 * d;
    g > j ? g > c && (e = c, f = j * (c / g)) : j > d && (f = d, e = g * (d / j));
    c = new Date;
    $imgSpan = jQuery("<span><img " + (void 0 !== e ? 'width="' + e + '"' : "") + " " + (void 0 !== f ? 'height="' + f + '"' : "") + "/></span>");
    $imgSpan.find("img").attr("src", EasyEditUrl.getURL().url + "?a=" + a + "&time=" + c.getTime()).attr("alt", b.alt);
    return $imgSpan.html()
  },
  _attachEvents: function(a) {
    var b = a.attribute("type_code") + "_" + a.id,
      c = Math.floor(1E16 * Math.random()),
      d = EasyEditUrl.getBaseSiteURL();
    this.upload = new EasyEditFileUpload({
      url: d +
        "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + a.id + "&load_easy_edit=false&nocache=" + c + "&SQ_BACKEND_PAGE=main&ignore_frames=1&sq_link_path=&sq_asset_path=&asset_ei_screen=details",
      selector: "body",
      id: "#ees_inputUpload",
      filePostName: b,
      assetid: a.id,
      prefix: "ees_uploader_",
      onStart: function() {
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("Uploading file") + "..."
        })
      },
      onComplete: function() {
        EasyEditOverlay.showOverlay("loading", {
          message: EasyEditLocalise._("File upload complete. Saving asset") +
            "..."
        })
      },
      postParam: {
        process_form: "1",
        backend_section: "am",
        am_section: "limbo",
        am_form_submitted: "1",
        assetid: a.id,
        backend_assetid: a.id,
        asset_action: "edit",
        asset_ei_screen: "details",
        sq_lock_release: "0",
        sq_link_path: "",
        sq_preview_url: a.attribute("web_path"),
        sq_limbo_lock_type: "a%3A1%3A%7Bi%3A0%3Bs%3A10%3A%22attr_links%22%3B%7D",
        sq_lock_type: "attr_links"
      }
    })
  }
};
(function(a, b) {
  function c(a) {
    a.hasOwnProperty("a") && delete a.a;
    a.hasOwnProperty("c") && delete a.c;
    return a = EasyEdit.util.map(a, function(a, b) {
      return {
        key: a,
        value: "1" === b ? !0 : !1
      }
    })
  }

  function d(a, b) {
    return EasyEdit.util.map(a, function(a, c) {
      var d = b.call(this, a, c);
      return {
        name: d[0],
        value: d[1],
        selected: d[2]
      }
    })
  }

  function e(a) {
    var b = 1 * a;
    10 > b && (a = "0" + b);
    return a + ""
  }

  function f(a) {
    return {
      d: EasyEditLocalise._("Day"),
      m: EasyEditLocalise._("Month"),
      y: EasyEditLocalise._("Year"),
      i: EasyEditLocalise._("Minutes"),
      h: EasyEditLocalise._("Hours"),
      s: EasyEditLocalise._("Seconds"),
      a: EasyEditLocalise._("12 Hour Time"),
      c: EasyEditLocalise._("Circa")
    }[a]
  }

  function g(a, b, c, f, k, g) {
    var l = {},
      h = "";
    void 0 === k && (k = new Date("1 Jan 0001 00:00:00"), k.setFullYear(1));
    void 0 === g && (g = new Date("31 Dec 9999 23:59:59"));
    c = c ? "custom_form_modal_date_input" : "custom_form_modal_date_select";
    switch (a) {
      case "d":
        l.name = "day";
        l.value = b instanceof Date ? b.getDate() : "";
        l.options = d(EasyEdit.util.range(1, 31), function(a, b) {
          return [b, b, l.value === b]
        });
        l.max = 2;
        break;
      case "m":
        l.name =
          "month";
        l.value = b instanceof Date ? b.getMonth() + 1 : "";
        l.options = d(EasyEdit.util.range(1, 12), function(a, b) {
          return [o[a], b, l.value === b]
        });
        l.max = 2;
        break;
      case "y":
        a = Math.max(0, g.getFullYear() - k.getFullYear() + 1);
        l.name = "year";
        l.value = b instanceof Date ? b.getFullYear() : "";
        l.options = d(EasyEdit.util.range(k.getFullYear(), a), function(a, b) {
          return [b, b, l.value === b]
        });
        l.max = 4;
        break;
      case "h":
        l.name = "hours";
        l.value = b instanceof Date ? b.getHours() : "";
        l.options = f ? d(EasyEdit.util.range(0, 24), function(a, b) {
          return [e(b), b,
            l.value === b
          ]
        }) : d(EasyEdit.util.range(1, 12), function(a, b) {
          return [b, b, (l.value > 12 ? l.value - 12 : l.value) === b]
        });
        l.max = 2;
        break;
      case "i":
        l.name = "minutes";
        l.value = b instanceof Date ? b.getMinutes() : "";
        l.options = d(EasyEdit.util.range(0, 60), function(a, b) {
          return [e(b), b, l.value === b]
        });
        l.max = 2;
        break;
      case "s":
        l.name = "seconds";
        l.value = b instanceof Date ? b.getSeconds() : "";
        l.options = d(EasyEdit.util.range(0, 60), function(a, b) {
          return [e(b), b, l.value === b]
        });
        l.max = 2;
        break;
      case "a":
        f || (k = EasyEditLocalise._("am"), a = EasyEditLocalise._("pm"),
          l.name = "am_pm", l.value = k, b instanceof Date && 12 <= b.getHours() && (l.value = a), l.options = d([k, a], function(a, b) {
            return [b, b, l.value === b]
          }))
    }
    l.hasOwnProperty("name") && (h = EasyEdit.tmpl.render(c, l));
    return h
  }

  function j(a) {
    if ("undefined" === typeof a || null === a || "" === a) return null;
    var b = "",
      a = /^([0-9]{4})\-([0-9]{2})\-([0-9]{2})\s([0-9]{2}:[0-9]{2}:[0-9]{2})$/.exec(a);
    null !== a && (b = new Date(a[2] + "/" + a[3] + "/" + a[1] + " " + a[4]));
    return b
  }

  function h(a, b, c) {
    var b = j(b),
      d = EasyEdit.util.map("d,m,y,h,i,s".split(","), function(a,
        d) {
        return g(d, b, c[d] === "1", true)
      });
    return EasyEdit.tmpl.render("custom_form_modal_question_datetime_table_row", {
      name: a.charAt(0).toUpperCase() + a.slice(1),
      id: a,
      parts: d
    })
  }

  function k(b, c) {
    var d = {};
    a("input." + c, b).each(function() {
      d[a(this).data("id")] = a(this).is(":checked") ? "1" : ""
    });
    return d
  }

  function l(a) {
    return "[object Date]" !== Object.prototype.toString.call(a) ? !1 : !isNaN(a.getTime()) && 0 !== a.getTime()
  }

  function n(b) {
    var c = {},
      d = !0;
    EasyEdit.util.each(["day", "month", "year"], function(a, f) {
      var k = b.find("." +
        f).val();
      if (/^\s*$/.test(k) || "undefined" === typeof k) d = !1;
      c[f] = e(k)
    });
    EasyEdit.util.each(["hours", "minutes", "seconds"], function(a, d) {
      var f = b.find("." + d).val();
      if (/^\s*$/.test(f) || "undefined" === typeof f) f = 0;
      c[d] = e(f)
    });
    var f = a(".am_pm", b);
    f.length && f.val() === EasyEditLocalise._("pm") && (c.hours = parseFloat(c.hours) + 12);
    return d ? new Date(c.month + "/" + c.day + "/" + c.year + " " + c.hours + ":" + c.minutes + ":" + c.seconds) : ""
  }

  function m(a) {
    return a.getFullYear() + "-" + e(a.getMonth() + 1) + "-" + e(a.getDate()) + " " + e(a.getHours()) +
      ":" + e(a.getMinutes()) + ":" + e(a.getSeconds())
  }
  var o = [EasyEditLocalise._("Jan"), EasyEditLocalise._("Feb"), EasyEditLocalise._("Mar"), EasyEditLocalise._("Apr"), EasyEditLocalise._("May"), EasyEditLocalise._("Jun"), EasyEditLocalise._("Jul"), EasyEditLocalise._("Aug"), EasyEditLocalise._("Sep"), EasyEditLocalise._("Oct"), EasyEditLocalise._("Nov"), EasyEditLocalise._("Dec")];
  b.datetime = function(b) {
    b.pickers = {};
    b.events.observe("render", function() {
      var d = b.settingsTip.$element,
        e = b.getSerialisedAttribute("text"),
        f = b.getSerialisedAttribute("null"),
        k = b.getSerialisedAttribute("show"),
        g = EasyEditLocalise._("Yes"),
        j = EasyEditLocalise._("No");
      null !== k && (k.hasOwnProperty("a") ? b.sliders.military.setSelected("1" === k.a ? g : j) : b.sliders.military.setSelected(j), k.hasOwnProperty("c") && (b.circa = k.c));
      var f = null === f ? {
          d: "",
          m: "",
          y: "",
          h: "",
          i: "",
          s: ""
        } : f,
        k = null === k ? {
          d: "1",
          m: "1",
          y: "1",
          h: "",
          i: "",
          s: ""
        } : k,
        e = null === e ? {
          d: "",
          m: "",
          y: "",
          h: "",
          i: "",
          s: ""
        } : e,
        f = {
          allowBlank: c(f),
          show: c(k),
          textBox: c(e)
        },
        f = a.extend({}, f),
        n = a(EasyEdit.tmpl.render("custom_form_modal_question_datetime_table",
          f)).appendTo(a(".custom-form-modal__table-row", d));
      EasyEdit.util.each(["minimum", "maximum"], function(a, c) {
        var d = b.attribute(c);
        l(new Date(d)) === false && (d = null);
        var f = {},
          k;
        for (k in e) f[k] = e[k];
        f.y = "1";
        d = h(c, d, f);
        n.find("tbody").append(d)
      });
      d.find('[data-id="required"]').parent(".row").hide()
    });
    b.events.observe("bind", function() {
      a(".custom-form-modal__table", b.settingsTip.$element).on("change keyup", "input, select", function() {
        b.update()
      })
    });
    b.events.observe("update", function() {
      var c = b.settingsTip.$element,
        d = k(c, "show");
      d.a = b.sliders.military.isTrue() ? "1" : "";
      d.c = "undefined" !== typeof b.circa ? b.circa : "";
      b.attribute("show", EasyEdit.util.serialise(d));
      b.attribute("null", EasyEdit.util.serialise(k(c, "allowBlank")));
      b.attribute("text", EasyEdit.util.serialise(k(c, "textBox")));
      EasyEdit.util.each(["minimum", "maximum"], function(a, d) {
        var e = c.find('.custom-form-modal__table-row-date[data-id="' + d + '"]'),
          e = n(e);
        l(e) ? (e = m(e), b.attribute(d, e)) : b.attribute(d, "---------- --:--:--")
      });
      d = a(".custom-form-question__preview",
        b.$element);
      d = n(d);
      l(d) ? b.attribute("default", m(d)) : b.attribute("default", "---------- --:--:--")
    });
    b.buildPreview = function(c, d) {
      var e = b.settingsTip.$element,
        h = k(e, "show"),
        m = k(e, "textBox"),
        o = j(b.attribute("default")),
        u = {
          minimum: new Date("1 Jan 1900 00:00:00"),
          maximum: new Date("31 Dec 2099 23:59:59")
        };
      EasyEdit.util.each(["minimum", "maximum"], function(a, b) {
        var c = e.find('.custom-form-modal__table-row-date[data-id="' + b + '"]'),
          c = n(c);
        !0 === l(c) && (u[b] = c)
      });
      EasyEditDebug.log("Date time default date for preview %o (min: %o, max: %o, defaultAttr: %s)",
        o, u.minimum, u.maximum, b.attribute("default"));
      var y = !b.sliders.military.isTrue(),
        z = [];
      EasyEdit.util.map(h, function(a, b) {
        "1" === b && z.push({
          label: f(a),
          input: g(a, o, "1" === m[a], y, u.minimum, u.maximum)
        })
      });
      y || z.push({
        label: f("a"),
        input: g("a", o, !1, y)
      });
      h = a.extend({}, d, {
        valid: h.hasOwnProperty("d") && "1" === h.d && h.hasOwnProperty("m") && "1" === h.m && h.hasOwnProperty("y") && "1" === h.y,
        parts: z
      });
      h = EasyEdit.tmpl.render("custom_form_question_preview_" + d.type, h);
      c.html(h)
    }
  }
})(jQuery, EasyEditQuestionDecorators);
EasyEditScreens.assetTypes.js_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.folder = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFolder",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsFolder = {
  init: function(a, b, c) {
    var d = this;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(e, function(f) {
        var g = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(e),
          f = '<div id="ees_editDetails">' + f + d._getTemplate(e) + g + "</div>",
          g = jQuery(d.containerId),
          j = g.find("#ees_editDetails");
        j.length ? j.replaceWith(f) : g.append(f);
        EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, e, b, c)
      })
    })
  },
  save: function(a) {
    EasyEditAssetManager.getCurrentAsset(function(b) {
      var c = !1,
        d = jQuery("#ees_inputName").val();
      d !== b.attribute("name") && jQuery("#ees_inputName").length && "" !== d && (c = !0, b.attribute("name", d));
      EasyEditScreens.screen.detailsDefault.checkStatus(b, function(d) {
        EasyEditScreens.screen.detailsDefault.saveFutureStatus(function() {
          EasyEditScreens.screen.detailsDefault.saveThumbnail(function() {
            c || d ? b.save(function(c) {
              var d = EasyEdit.filterErrorArray(c),
                e = d.length >= 1 ? false : true;
              b.acquireLock("all", function() {
                a.apply(this, [e, d])
              })
            }) : b.acquireLock("all", function() {
              a.apply(this, [true, []])
            })
          })
        })
      })
    })
  },
  _getTemplate: function(a) {
    var b = '<h3 class="sectionHeading">' + EasyEditLocalise._("Name") + '</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label for="ees_inputShortName" class="inputLabel">' + EasyEditLocalise._("Folder Name") + ':</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /> &nbsp;</div></div></div>',
      b = jQuery("<div>" + b + "</div>");
    b.find("#ees_inputName").attr("value",
      a.attribute("name"));
    return b.html()
  }
};
BodycopyDivRaw = function(a) {
  this.events = new ObservableEvents(this, ["change", "rendered", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.$container = null
};
BodycopyDivRaw.prototype.queueSave = function(a, b) {
  var c = this.$container.find("textarea");
  a.setParam(c.attr("name"), EasyEdit.fixHtml(c.val()));
  a.setParam("bodycopy_saved[bodycopy_" + b.bodycopyId + "][" + this.id + "]", "");
  this.events.trigger("save_queued");
  return a
};
BodycopyDivRaw.prototype.getFriendlyContainerName = function() {
  return EasyEditLocalise._("Raw HTML Content Container")
};
BodycopyDivRaw.prototype.getContent = function() {
  return EasyEdit.fixHtml(this.$container.find("textarea.sq-backend-code-editing").val())
};
BodycopyDivRaw.prototype.render = function(a) {
  var b = this;
  b.$container = a;
  a = jQuery("<div />");
  jQuery(b.attribute("raw_content")).appendTo(a);
  var c = a.find("textarea.sq-backend-code-editing");
  c.removeAttr("style");
  a.find('select[id^="sq_keyword_selector_"]').remove();
  c.bind("change", function() {
    b.events.trigger("change")
  });
  a.find('div[id$="wysiwyg_div"]').remove();
  a.find(">div").each(function() {
    $(this).removeAttr("onclick")
  });
  a.html(Viper.prototype.cleanHTML(a.html()));
  b.$container.append(a);
  b.events.trigger("render")
};
EasyEditScreens.screen.linkingDefault = {
  containerId: null,
  originalValues: null,
  parentIds: null,
  readOnly: !1,
  directChildList: null,
  sliders: [],
  init: function(a, b, c) {
    this.containerId = a;
    var d = this;
    d.readOnly = b;
    d.originalValues = [];
    this._getTemplate(function(a) {
      var b = jQuery(d.containerId),
        g = b.find("#ees_editLinking");
      g.length ? g.replaceWith('<div id="ees_editLinking">' + a + "</div>") : b.append('<div id="ees_editLinking">' + a + "</div>");
      EasyEditConfig.hasOwnProperty("showChildrenOnLinkingScreen") && EasyEditConfig.showChildrenOnLinkingScreen ?
        EasyEditAssetManager.getCurrentAsset(function(a) {
          d.directChildList = new EasyEditAssetChildList({
            rootNode: a.id,
            target: "#ees_directChildren",
            filterOptions: {
              type_code: {
                blacklist: ["image_variety"]
              },
              link_type: ["SQ_SC_LINK_SIGNIFICANT"]
            },
            template: "linking_screen_child_list"
          });
          d.directChildList.events.observe("fetch_complete", function() {
            this.render()
          });
          d.directChildList.events.observe("change", function() {
            EasyEditComponentsToolbar.enableSaveButton()
          });
          d.directChildList.events.observe("render", function() {
            d.directChildList.$element.find("li.child span.imageWrapper").each(function() {
              var a =
                jQuery(this),
                b = jQuery(EasyEdit.tmpl.render("light_button", {
                  href: "#",
                  title: EasyEditLocalise._("Go to Linking Screen"),
                  content: EasyEditLocalise._("Go to Linking Screen"),
                  "class": "linkingScreenShortCut"
                }));
              b.click(function(b) {
                function c() {
                  EasyEditOverlay.showOverlay("loading");
                  var b = parseFloat(a.find(".assetId").text().replace("#", "")),
                    d = a.find(".assetInfo").attr("data-treeid"),
                    e = {
                      screen: "linking"
                    };
                  EasyEditAssetManager.getAsset(b, function(a) {
                    e.asset = a;
                    d && 0 < d.length && (e.lineage = a.getLineageFromTreeId(d),
                      e.lineage && (e.lineage = e.lineage.map(function(a) {
                        return a.assetid
                      })));
                    EasyEdit.redirect(e)
                  })
                }
                b.preventDefault();
                EasyEditComponentsToolbar.isUnsaved() ? EasyEditOverlay.showOverlay("confirm", {
                    message: EasyEditLocalise._("You have unsaved changes, please choose how to proceed."),
                    title: EasyEditLocalise._("Unsaved Changes"),
                    cancelText: EasyEditLocalise._("Return to Screen"),
                    confirmText: EasyEditLocalise._("Discard Changes"),
                    cssClass: "unsavedChanges",
                    confirmFn: function() {
                      c()
                    },
                    cancelFn: function() {
                      EasyEditOverlay.hideOverlay()
                    }
                  }) :
                  c()
              });
              a.append(b)
            });
            d.directChildList.$element.find("a.assetInfo").click(function(a) {
              a.preventDefault();
              EasyEditOverlay.showOverlay("loading");
              var a = parseFloat(jQuery(this).find(".assetId").text().replace("#", "")),
                b = this.getAttribute("data-treeid");
              EasyEditAssetManager.getAsset(a, function(a) {
                var c = {
                  asset: a
                };
                b && 0 < b.length && (c.lineage = a.getLineageFromTreeId(b), c.lineage && (c.lineage = c.lineage.map(function(a) {
                  return a.assetid
                })));
                EasyEdit.redirect(c)
              })
            });
            d._attachEvents();
            var a = jQuery("#ees_directChildren");
            1 <= d.directChildList.children.length ? a.before('<h3 class="sectionHeading clearBoth">' + EasyEditLocalise._("Direct Children") + '</h3><p class="childrenMessage">' + EasyEditLocalise._("The following list of assets are direct children of this page. Use this list to change the order in which they appear in menus and listings.") + "</p>") : (a.before('<h3 class="sectionHeading clearBoth">' + EasyEditLocalise._("Direct Children") + '</h3><p class="childrenMessage">' + EasyEditLocalise._("There are no direct children to list.") +
              "</p>"), a.addClass("noChildren"));
            c.call(this)
          });
          d.directChildList.fetch()
        }) : (d._attachEvents(), c.call(this))
    })
  },
  save: function(a) {
    var b = this,
      c = new EasyEditAPI,
      d = EasyEdit.getURL(),
      e = {
        links: []
      };
    EasyEditAssetManager.getCurrentAsset(function(f) {
      function g(a) {
        c.queue("removeMultipleLinks", {
          link_info: e
        }).run(function(b) {
          for (var c = f.getPrimaryLineage(), g = [], h = 0, j = c.length - 1; h < j; h += 1) g.push(c[h].assetid);
          for (var c = !1, j = null, s = g[g.length - 1], h = 0, q = e.links.length; h < q; h += 1) parseFloat(e.links[h].child) === parseFloat(f.id) &&
            parseFloat(s) === parseFloat(e.links[h].parent) && (j = h);
          b = b[0].data;
          if (!EasyEdit.isError(b)) {
            for (h = q = 0; h < b.length; h++) !1 === EasyEdit.isError(b[h]) ? h === j && (c = !0) : q++;
            0 === k && 0 === q || c ? EasyEditAssetManager.getAsset(s, function(a) {
              var b = EasyEditUrl.getBaseSiteURL();
              "" === b && (b = d.protocol + "://" + d.host);
              EasyEdit.redirect({
                asset: a,
                lineage: g,
                url: b
              })
            }) : a.call(this)
          }
        }, c.runMode.SYNC)
      }

      function j(a) {
        var b = new EasyEditSimpleEditRequest({
          backend_assetid: f.id,
          assetid: f.id,
          screen: "linking"
        });
        b.setParamsFromElement(jQuery("#main_form"));
        b.setParam("ees_content_no_filter", "1");
        b.send(function() {
          f.acquireLock("all", function() {
            a.call(this)
          })
        })
      }

      function h() {
        EasyEditAssetManager.clearCurrentAssetCache();
        EasyEditAssetManager.getCurrentAsset(function() {
          null !== b.directChildList ? b.directChildList.save(function() {
            EasyEditScreens.refreshScreenLock(function() {
              a.apply(this, [!0, [], {
                refresh: !0
              }])
            })
          }) : EasyEditScreens.refreshScreenLock(function() {
            a.apply(this, [!0, [], {
              refresh: !0
            }])
          })
        })
      }
      EasyEditOverlay.showOverlay("loading");
      jQuery("#ees_locationLinks .deleteLink").each(function() {
        var a =
          jQuery(this);
        e.links.push({
          parent: jQuery(".linkDataParentId", a).text(),
          child: f.id,
          link_type: "SQ_LINK_TYPE_" + jQuery("select :selected", a).attr("value"),
          link_value: jQuery('input[name*="link_value"]', a).val()
        })
      });
      var k = jQuery("#ees_locationLinks tr").filter(function() {
        return $(this).find("input").length
      }).not(".deleteLink").length;
      1 <= e.links.length ? 1 <= k ? j(function() {
        g(function() {
          h()
        })
      }) : g(function() {
        h()
      }) : j(function() {
        h()
      })
    })
  },
  _getLinkingOutput: function(a, b) {
    var c = this,
      d = new EasyEditAPI;
    d.queue("getKeywordsReplacements", {
      asset_id: a,
      keywords_array: ["%linking-%"]
    });
    d.expect(1).run(function(a) {
      (!EasyEdit.isset(a) || !(a[0].data.hasOwnProperty("errorCode") && "permissionError" === a[0].data.errorCode)) && b.call(c, a[0].data["linking-"]["linking-"])
    })
  },
  _getTemplate: function(a) {
    var b = "",
      c = this;
    EasyEditAssetManager.getCurrentAsset(function(d) {
      c._getLinkingOutput(d.id, function(d) {
        b = c._reRender(d);
        a.call(this, b)
      })
    })
  },
  _reRender: function(a) {
    var b = "",
      a = jQuery("<div>" + a + "</div>").find("table.sq-backend-section-table:eq(0)").find("table.sq-backend-table:eq(0)"),
      a = jQuery("tr:gt(1)", a).filter(function() {
        jQuery("td:eq(2)", this).text().replace(/\s+/g, "");
        return 10 === 1 * jQuery("td:eq(3)", this).text() ? !1 : !0
      }).remove();
    return b += this._buildLocationsTable(a)
  },
  _buildLocationsTable: function(a) {
    var b = this,
      c = "",
      c = c + ('<h3 class="sectionHeading">' + EasyEditLocalise._("Location Links") + '</h3><div id="ees_lastLinkWarning" class="screenHide"><span class="warningTitle">' + EasyEditLocalise._("Warning") + "</span>" + EasyEditLocalise._("Content items marked for deletion will be moved to the trash when you click the save button.") +
        " " + EasyEditLocalise._("Hyperlinks or references to items marked for deletion will not work when the item is in the trash.") + "</div>"),
      c = c + ('<table border="0" cellpadding="0" cellspacing="0" id="ees_locationLinks" class="ees_locationLinks"><tr><th class="locationHeading">' + EasyEditLocalise._("Website Locations") + '</th><th class="typeHeading">' + EasyEditLocalise._("Show in Menu") + '</th><th class="linkValueHeading">' + EasyEditLocalise._("Link Value") + '</th><th class="deleteHeading">&nbsp;<span class="screenHide">' +
        EasyEditLocalise._("Delete Option") + "</span></th></tr>");
    EasyEditScreens.setReadOnly(0 === jQuery("option", a).length ? !0 : b.readOnly);
    var d = {},
      e = [];
    jQuery(a).each(function(a) {
      var f = jQuery(this),
        h = f.find("td:eq(2)"),
        k = h.text().replace(/\s+/g, ""),
        l = !0;
      if (0 !== jQuery("option", h).length) {
        var l = !1,
          n = jQuery("option:selected", h).val();
        "1" === n ? k = "TYPE_1" : "2" === n && (k = "TYPE_2")
      }
      if (!("TYPE_1" !== k && "TYPE_2" !== k)) {
        var n = !1,
          m = f.find("td:eq(0)"),
          a = f.find("td:eq(6)"),
          o = jQuery.trim(f.find("td:eq(1)").text()),
          r = jQuery.trim(a.text());
        if ("Trash" === r || !0 === /^Trash \>/.test(r)) d[o] = f;
        else {
          d[o] && (f = d[o], delete d[o]);
          o = f.find("td:eq(5)");
          o.find('input[id*="link_locked"]:checked').length && (n = !0);
          var r = f.find('input[name*="link_value"]').parent().html(),
            r = null === r || void 0 === r || "" === r ? "&nbsp;" : '<span class="linkValueInputWrapper">' + r + "</span>",
            p = a.data("lineage_type_codes").split("|"),
            s = a.text().split(">"),
            q = [];
          if (0 < s.length)
            for (a = s.length - 1; 0 <= a; a--) {
              var t = "",
                t = t + ('<span class="locationName">' + s[a] + "</span>");
              a < s.length - 1 && (t += '<span class="locationSeparator">&nbsp;<span class="screenHide"> &gt; </span></span>');
              q.push(t);
              if ("site" === p[a]) break
            }
          p = q.reverse().join("");
          for (a = 0; a < e.length; a++)
            if (e[a] == p) return;
          e.push(p);
          n && (p = '<strong class="linkLocked">' + EasyEditLocalise._("Link Location Locked") + "</strong> <br/>" + p);
          a = f.find("td:eq(4)").text();
          s = "";
          "TYPE_2" === k && (s = "hiddenFromMenus");
          l || b.originalValues.push(jQuery("option:selected", h).val());
          c += '<tr class="' + s + '"><td class="websiteLocation" title="Locate lineage in the Asset Finder"><span class="wrapper">' + p + '</span><span class="screenHide"><span class="linkDataLineage">' +
            (m.find("img").length ? m.find("img").attr("onclick").replace(/(.*)asset_locator_start\('([0-9|]+)~(.*)/g, "$2").replace(/\|/g, ",") : "") + '</span><span class="linkDataParentId">' + f.find("td:eq(3)").text().replace(/\s+/g, "") + '</span><span class="linkDataType">' + jQuery("option:selected", h).val() + '</span></span></td><td class="linkTypes"><div class="screenHide">' + h.html() + " " + o.html() + "</div>";
          c = l ? c + ("TYPE_1" === k ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No")) : c + '<div class="sliderWrap"></div>';
          c += '</td><td class="linkValue">';
          c = l ? c + a : c + r;
          c += '</td><td class="linkDeletion">';
          l ? c += "&nbsp;" : n || (c += '<a title="' + EasyEditLocalise._("Mark this item for deletion") + '" class="assetDeleteOption" href="#"><span class="screenHide">' + EasyEditLocalise._("Delete link option") + "</span></a>");
          c += "</td></tr>"
        }
      }
    });
    var c = c + "</table>",
      c = c + ('<a id="ees_addNewLink" href="#" class="alignLeft guiButton light">' + EasyEditLocalise._("New Location Link") + "</a>"),
      f = "",
      e = [];
    jQuery(a).each(function(a) {
      var b = jQuery(this),
        c = b.find("td:eq(2)"),
        d = !0,
        a = c.text().replace(/\s+/g,
          "");
      0 !== jQuery("option", c).length && (d = !1, "8" === jQuery("option:selected", c).val() && (a = "NOTICE"));
      if ("NOTICE" === a) {
        var l = b.find("td:eq(0)"),
          a = b.find("td:eq(6)"),
          n = a.data("lineage_type_codes").split("|"),
          m = a.text().split(">"),
          o = [];
        if (0 < m.length)
          for (a = m.length - 1; 0 <= a; a--) {
            var r = "",
              r = r + ('<span class="locationName">' + m[a] + "</span>");
            a < m.length - 1 && (r += '<span class="locationSeparator">&nbsp;<span class="screenHide"> &gt; </span></span>');
            o.push(r);
            if ("site" === n[a]) break
          }
        l = l.find("img").length ? l.find("img").attr("onclick").replace(/(.*)asset_locator_start\('([0-9|]+)~(.*)/g,
          "$2").replace(/\|/g, ",") : "";
        if (0 !== l.indexOf("10,")) {
          n = o.reverse().join("");
          for (a = 0; a < e.length; a++)
            if (e[a] == n) return;
          e.push(n);
          a = b.find("td:eq(4)").text().replace(/\s+/g, "");
          d || (a = b.find('input[name*="link_value"]').val());
          f += '<tr><td class="websiteLocation" title="Locate lineage in the Asset Finder"><span class="wrapper">' + n + '</span><span class="screenHide"><span class="linkDataLineage">' + l + '</span><span class="linkDataParentId">' + b.find("td:eq(3)").text().replace(/\s+/g, "") + '</span><span class="linkDataType">' +
            jQuery("option:selected", c).val() + "</span></span></td>";
          "root" === a ? (linkTypeName = EasyEditLocalise._("Root Node"), linkTypeClass = "rootNode") : "nested_asset" === a ? (linkTypeName = EasyEditLocalise._("Nested Asset"), linkTypeClass = "nestedAsset") : (linkTypeName = EasyEditLocalise._("URL Link"), linkTypeClass = "urlLink");
          f += '<td class="linkType ' + linkTypeClass + '"><span class="wrapper">' + linkTypeName + "</span></td></tr>"
        }
      }
    });
    f && (c += '<table border="0" cellpadding="0" cellspacing="0" id="ees_assetLinks" class="ees_locationLinks"><tr><th class="locationHeading">' +
      EasyEditLocalise._("Asset Links") + '</th><th class="linkTypeHeading">' + EasyEditLocalise._("Link Type") + "</th></tr>" + f + "</table>");
    return c += '<div id="ees_directChildren"></div>'
  },
  hasChanged: function() {
    var a = this,
      b = jQuery("#ees_locationLinks"),
      c = !1;
    jQuery("td.linkTypes", b).each(function(b) {
      var e = jQuery(this);
      jQuery("option:selected", e).val() !== a.originalValues[b] && (c = !0)
    });
    jQuery(".assetDeleteOption", b).each(function() {
      jQuery(this).parent().parent().hasClass("deleteLink") && (c = !0)
    });
    c && EasyEditComponentsToolbar.enableSaveButton();
    return c
  },
  markAll: function() {
    var a = jQuery("#ees_locationLinks");
    jQuery(".assetDeleteOption", a).each(function() {
      jQuery(this).trigger("click")
    })
  },
  _attachEvents: function() {
    function a(a, b, c) {
      if (b.length) {
        for (var d = c.getLineageFromTreeId(c.getTreeIdFromLineage(b)), a = jQuery(a).parents(".websiteLocation"), b = d.length - 1; 0 < b && "site" !== d[b].type_code; --b);
        d.splice(0, b);
        a.addClass("lineage").click(function() {
          EasyEditAssetFinder.init({
            focusAssetId: c.id,
            selectedLineage: d,
            callback: function(a, b, c) {
              EasyEdit.redirect({
                asset: a,
                url: c,
                screen: "details",
                lineage: b
              })
            }
          })
        })
      }
    }
    var b = this,
      c = jQuery("#ees_locationLinks"),
      d = jQuery("#ees_assetLinks"),
      e = new EasyEditAPI;
    jQuery(".linkDataLineage", c).each(function() {
      var b = jQuery(this),
        c = jQuery.trim(b.text()).split(",");
      c.length && EasyEditAssetManager.getCurrentAsset(function(d) {
        a(b, c, d)
      })
    });
    jQuery(".linkDataLineage", d).each(function() {
      var b = jQuery(this),
        c = jQuery.trim(b.text()).split(",");
      c.pop();
      0 < c.length && EasyEditAssetManager.getAsset(c[c.length - 1], function(d) {
        a(b, c, d)
      })
    });
    jQuery(".assetDeleteOption",
      c).click(function(a) {
      var c = jQuery(this).parent().parent();
      this.title = c.hasClass("deleteLink") ? EasyEditLocalise._("Mark this item for deletion") : EasyEditLocalise._("Remove this item from the list of deletions");
      c.toggleClass("deleteLink");
      var c = jQuery("#ees_locationLinks tr.deleteLink"),
        d = jQuery("#ees_locationLinks a.assetDeleteOption"),
        e = jQuery("#ees_lastLinkWarning");
      0 < c.length && c.length === d.length ? e.removeClass("screenHide") : e.addClass("screenHide");
      a.preventDefault();
      b.hasChanged()
    });
    var f = 0;
    jQuery(".sliderWrap",
      c).each(function() {
      var a = jQuery(this),
        c = a.parent().parent().hasClass("hiddenFromMenus"),
        d = function(a) {
          var c = this.parents("td.linkTypes:eq(0)");
          jQuery("select option", c).attr("selected", null);
          jQuery('select option[value="' + a + '"]', c).attr("selected", "selected");
          this.parents("tr:eq(0)").toggleClass("hiddenFromMenus");
          b.hasChanged()
        };
      b.sliders[f] = new EasyEditSlider({
        bindElem: a,
        defaultVal: c ? EasyEditLocalise._("No") : EasyEditLocalise._("Yes"),
        options: [
          [EasyEditLocalise._("Yes"), EasyEditLocalise._("Show this item in menus"),
            function() {
              d.call(this, 1)
            }
          ],
          [EasyEditLocalise._("No"), EasyEditLocalise._("Hide this item in menus"), function() {
            d.call(this, 2)
          }]
        ]
      });
      f++
    });
    jQuery("#ees_addNewLink").click(function(a) {
      EasyEditAssetManager.getCurrentAsset(function(a) {
        EasyEditAssetFinder.init({
          callback: function(b) {
            if (b.isFile() || 1 === a.attribute("is_dependant")) return error = new EasyEditError(EasyEditLocalise._("You cannot link under file or dependant assets")), error.display(), !1;
            if (1 * b.id === 1 * a.attribute("parent_id")) return error = new EasyEditError(EasyEditLocalise._("This asset is already linked to the parent you selected")),
              error.display(), !1;
            if (b.id === a.id) return error = new EasyEditError(EasyEditLocalise._("You cannot link an asset under itself")), error.display(), !1;
            for (var c = 0, d = b.lineage.length; c < d; c += 1)
              if (1 * b.lineage[c].assetid === 1 * a.id) return error = new EasyEditError(EasyEditLocalise._("You cannot link an asset that exists in the current assets lineage")), error.display(), !1;
            EasyEditOverlay.showOverlay("loading", {
              message: EasyEditLocalise._("Adding new link") + "..."
            });
            EasyEditComponentsToolbar.disableSaveButton();
            e.queue("createLink", {
              parent_id: b.id,
              child_id: a.attribute("id"),
              link_type: 1,
              link_value: "",
              is_dependent: a.attribute("is_dependant"),
              is_exclusive: a.attribute("is_exclusive")
            }).run(function(a) {
              a = a[0].data;
              if (a.errorCode && "createFailed" === a.errorCode) return error = new EasyEditError(EasyEditLocalise._("Failed to create link. You may not have write permissions to the intended parent, or this asset's web path may clash with one of the parent's existing children.")), error.display(), !1;
              EasyEdit.isError(a) || (EasyEditAssetManager.clearCurrentAssetCache(),
                EasyEditAssetManager.getCurrentAsset(function() {
                  EasyEditScreens.reloadCurrentScreen(function() {
                    EasyEditOverlay.showOverlay("success", {
                      message: EasyEditLocalise._("This asset has been successfully linked"),
                      timeout: 2E3
                    })
                  })
                }))
            })
          }
        })
      });
      a.preventDefault()
    })
  }
};
EasyEditScreens.assetTypes.pdf_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.word_doc = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.flv_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.mp3_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsDefault = {
  containerId: null,
  current_status: null,
  init: function(a, b, c) {
    var d = this;
    d.validator = null;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      d.getStatusHTML(e, function(f) {
        var g = d.getThumbnailHTML(e),
          f = '<div id="ees_editDetails">' + f + d._getDetailsHTML(e) + g + "</div>",
          g = jQuery(d.containerId),
          j = g.find("#ees_editDetails");
        j.length ? j.replaceWith(f) : g.append(f);
        d.commonDetailsInit(a, e, b, c)
      })
    })
  },
  commonDetailsInit: function(a, b, c, d) {
    jQuery("#ees_inputName").val(b.attribute("name"));
    jQuery("#ees_inputShortName").val(b.attribute("short_name"));
    jQuery("#ees_changeStatus table").attr({
      border: "0",
      cellpadding: "0",
      cellspacing: "0"
    });
    jQuery("#ees_changeStatus select:disabled").attr("disabled", !1);
    0 === jQuery("#ees_changeStatus select[id$=_stream_bypass] option").length && jQuery("#ees_changeStatus select[id$=_stream_bypass]").hide();
    c ? (jQuery(' input[type="text"],textarea', a).each(function() {
      if (-1 === jQuery(this).attr("id").indexOf("_workflow_approval_request_comment")) {
        var a = jQuery(this).val();
        "" === a && (a = "- blank -");
        jQuery(this).parent().append(jQuery("<span></span>").addClass("readOnly").text(a)).end().remove()
      }
    }), jQuery(a + ' input[type="file"]').remove()) : this.attachThumbEvents();
    this.attachStatusEvents();
    d.call(this)
  },
  save: function(a) {
    var b = this,
      c = jQuery("#ees_inputName"),
      d = jQuery("#ees_inputShortName");
    if (!b.hasOwnProperty("validator") || null === b.validator) {
      b.validator = new EasyEditValidationController;
      var e = new EasyEditValidationErrorInline({
        element: c
      });
      b.validator.addTest(c, {
        required: {
          args: null,
          message: EasyEditLocalise._("A name is required.")
        }
      }, e);
      e = new EasyEditValidationErrorInline({
        element: d
      });
      b.validator.addTest(d, {
        required: {
          args: null,
          message: EasyEditLocalise._("A short name is required.")
        }
      }, e)
    }
    b.validator.valid() || !c.length ? (EasyEditOverlay.showOverlay("loading"), EasyEditAssetManager.getCurrentAsset(function(c) {
      b._doSave(function(b, d) {
        c.acquireLock("all", function() {
          a.apply(this, [b, d, {
            refresh: !0
          }])
        })
      })
    })) : ($warnings = jQuery(".fieldWarning"), 0 < $warnings.length && EasyEditComponents.scrollIntoView($warnings[0]))
  },
  _doSave: function(a) {
    var b = this;
    EasyEditAssetManager.getCurrentAsset(function(c) {
      var d = !1,
        e = jQuery("#ees_inputName").val();
      e !== c.attribute("name") && jQuery("#ees_inputName").length && (d = !0, c.attribute("name", e));
      e = jQuery("#ees_inputShortName").val();
      e !== c.attribute("short_name") && jQuery("#ees_inputShortName").length && (d = !0, c.attribute("short_name", e));
      b.checkStatus(c, function(e) {
        b.saveFutureStatus(function() {
          b.saveThumbnail(function() {
            d || e ? c.save(function(b) {
              b = EasyEdit.filterErrorArray(b);
              a.apply(this, [b.length >= 1 ? false : true, b])
            }) : a.apply(this, [true, []])
          })
        })
      })
    })
  },
  checkStatus: function(a, b) {
    $statusSelect = jQuery('#ees_changeStatus select[id$="_change_status"]');
    var c = $statusSelect.val(),
      d = jQuery("option", $statusSelect).length;
    cascade = jQuery('#ees_changeStatus input[id$="_change_status_all_children"]').is(":checked");
    var e = {
        Archived: 1,
        "Under Construction": 2,
        Live: 16,
        "Up For Review": 32,
        "Safe Editing": 64
      },
      c = 1 * c;
    if (0 === c && cascade) {
      var f = jQuery("#ees_currentStatus .cellData").text();
      "undefined" !== typeof e[f] &&
        (c = e[f])
    }
    0 !== c && (1 <= d || cascade) ? (changes = !0, a.setStatus(c, cascade), cascade ? a.childCount(function(d) {
      !EasyEdit.isError(d) && 1 * d.child_count >= EasyEditConfig.cascadeThreshold ? EasyEditOverlay.showOverlay("confirm", {
        message: EasyEditLocalise._('<p class="confirmMessage">You are about to affect %1 child assets (including dependants) with this status change. Are you sure you wish to continue?</p>', d.child_count),
        title: EasyEditLocalise._("Cascade Status Change to Children"),
        cancelText: EasyEditLocalise._("Return to Screen"),
        confirmText: EasyEditLocalise._("Cascade to Children"),
        cssClass: "cascadeStatus",
        confirmFn: function() {
          a.setStatus(c, cascade);
          EasyEditOverlay.hideOverlay("confirm");
          EasyEditOverlay.showOverlay("loading", {
            message: EasyEditLocalise._("Applying status changes")
          });
          b.call(this, !0)
        },
        cancelFn: function() {
          EasyEditOverlay.hideOverlay("confirm");
          b.call(this, !1)
        }
      }) : b.call(this, changes)
    }) : b.call(this, changes)) : b.call(this, !1)
  },
  getStatusHTML: function(a, b) {
    var c = this,
      d = [],
      e = "",
      f = new EasyEditAPI;
    f.queue("getKeywordsReplacements", {
      asset_id: a.id,
      keywords_array: ["%details-S_status%", "%details-S_future_status%"]
    }).run(function(f) {
      var j = f[0].data["details-S_status"]["details-S_status"],
        j = j.replace(/Change\s\?/g, EasyEditLocalise._("Change?")),
        h = jQuery("<div>" + j + "</div>");
      h.find("br").remove();
      var k = !1;
      h.find("select").length && h.find('a:contains("metadata")').length && (k = !0);
      var l = h.find('select[id$="_change_status"]'),
        n = h.find('select[id$="_change_status_stream_bypass"]'),
        m = h.find('select[id$="_change_status_stream_workflow"]'),
        o = h.find('input[type="hidden"][name$="_change_status_stream"]'),
        r = h.find('textarea[id$="_workflow_approval_request_comment"]'),
        p = jQuery("<div>");
      l.find('select[id$="_change_status"] option').each(function(a, b) {
        var c = jQuery(b);
        d.push({
          statusId: c.val(),
          statusText: c.html()
        })
      });
      var j = a.attributes().status,
        s = j.replace(/\s/g, "").toLowerCase();
      if (l.length && "input" !== l[0].nextSibling.nodeName.toLowerCase()) {
        var q = h.find('input[id$="_change_status_all_children"]'),
          t = jQuery(q[0].nextSibling);
        l[0].parentNode.insertBefore(document.createElement("br"),
          l[0].nextSibling);
        l[0].parentNode.insertBefore(q[0].nextSibling, l[0].nextSibling);
        l[0].parentNode.insertBefore(q[0], l[0].nextSibling)
      }
      var h = jQuery(f[0].data["details-S_future_status"]["details-S_future_status"]).find("div.sq-backend-smallprint:last").html(),
        f = f[0].data["details-S_future_status"]["details-S_future_status"],
        w = !1;
      EasyEditConfig.hasOwnProperty("allowFutureStatusChange") && EasyEditConfig.allowFutureStatusChange && EasyEdit.isset(h) && -1 === f.indexOf("The Cron Manager has not been configured") &&
        (w = !0);
      var v = jQuery('<div class="row clearfix changeCascade">').appendTo(p);
      w && jQuery('<a href="#" id="ees_futureStatusToggle" class="guiButton light alignRight"><span class="label">' + EasyEditLocalise._("View Future Status") + "</span></a>").appendTo(v);
      var u = jQuery("<div>").addClass("cellName alignLeft").text(EasyEditLocalise._("Change?")).appendTo(v),
        y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v);
      l.length ? (l.attr("onchange", ""), l.appendTo(y), q && (q.appendTo(y), q.attr("onclick", ""), t.appendTo(y)),
        jQuery("<br>").appendTo(y), k && (v = jQuery('<div class="row clearfix metadataWarnings">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), q = jQuery('<div class="clearfix statusWarning">').appendTo(y), jQuery('<p class="warningMessage with-button">').html(EasyEditLocalise._("This asset cannot be made live until all required metadata fields are complete. These can be completed on the Metadata screen.")).appendTo(q), jQuery('<a href="#" id="ees_metadataWarningBtn" class="guiButton light warningButton"><span class="label">' +
          EasyEditLocalise._("Metadata Screen") + "</span></a>").appendTo(q)), v = jQuery('<div class="row clearfix cascadeWarningLive">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), q = jQuery('<div class="clearfix statusWarning">').appendTo(y), jQuery('<p class="warningMessage">').text(EasyEditLocalise._("Cascading a Live status to child assets may result in unintended canceling of Safe Editing of those children which can result in loss of content.")).appendTo(q),
        v = jQuery('<div class="row clearfix nonLiveWarning">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), q = jQuery('<div class="clearfix statusWarning">').appendTo(y), jQuery('<p class="warningMessage">').text(EasyEditLocalise._("You are about to change the status to a non-Live status. This will make the asset inaccessible to users with read access to it.")).appendTo(q), v = jQuery('<div class="row clearfix cascadeNonLiveWarning">').appendTo(p),
        u = jQuery("<div>").addClass("cellName alignLeft").appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), q = jQuery('<div class="clearfix statusWarning">').appendTo(y), jQuery('<p class="warningMessage">').text(EasyEditLocalise._("Cascading a non-Live status to child assets may result in unintended un-publishing of those children.")).appendTo(q), v = jQuery('<div class="row clearfix cascadeWarningWorkflow">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v),
        q = jQuery('<div class="clearfix statusWarning">').appendTo(y), jQuery('<p class="warningMessage">').text(EasyEditLocalise._("Cascading this workflow initiation status to child assets will initiate the workflow for all children that are in a workflow ready state. The chosen workflow stream will also be cascaded if applicable.")).appendTo(q), o && o.appendTo(y), v = jQuery('<div class="row clearfix workflowStream">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").text(EasyEditLocalise._("Use workflow stream:")).appendTo(v),
        y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), n && n.appendTo(y), m && m.appendTo(y), v = jQuery('<div class="row clearfix workflowLog">').appendTo(p), u = jQuery("<div>").addClass("cellName alignLeft").text(EasyEditLocalise._("Add workflow comment:")).appendTo(v), y = jQuery("<div>").addClass("cellData alignLeft").appendTo(v), r && r.appendTo(y)) : w ? u.text("") : v.remove();
      n = p.html();
      w && (n += '<div id="ees_futureStatus" class="clearBoth"><div id="ees_matrixFutureStatus" class="">' + f + '</div><div id="ees_futureStatusPicker"><div class="row"><div class="cellName futureStatusHeading">' +
        EasyEditLocalise._("Add New Future Status") + '</div><div id="ees_futureStatusSelect" class="cellData"></div></div><div class="row"><div class="cellName futureStatusHeading">' + EasyEditLocalise._("Set Date &amp; Time for New Future Status") + '</div><div class="cellData" id="datePickerContainer"></div></div></div><div class="row"><div class="cellName futureStatusHeading">' + EasyEditLocalise._("Next Run") + '</div><div id="ees_futureStatusNextRun" class="cellData">' + h + '<br/><a href="#" class="genericButton" id="ees_setFutureStatusToNextRun">' +
        EasyEditLocalise._("Set Date &amp; Time to Next Run") + '</a></div></div><div class="row"><div class="cellName futureStatusHeading">' + EasyEditLocalise._("Scheduled Runs") + '</div><div id="ees_futureStatusSchedule" class="cellData">' + EasyEditLocalise._("No scheduled changes") + "</div></div></div>");
      e = '<h3 class="sectionHeading">' + EasyEditLocalise._("Status") + '</h3><div id="ees_editStatus"><div id="ees_currentStatus" class="' + s + '"><div class="cellName alignLeft">' + EasyEditLocalise._("Current") + ':</div><div class="cellData alignLeft">' +
        j + "</div></div>" + ("" === n ? "" : '<div id="ees_changeStatus">' + n + "</div>") + "</div>";
      b.call(c, e)
    }, f.runMode.SYNC)
  },
  getThumbnailHTML: function(a) {
    a = a.attribute("thumbnail");
    if (!EasyEditConfig.useThumbnail) return "";
    var b = EasyEditLocalise._("This asset has no related image applied. Select a new image or thumbnail asset.");
    null !== a && (b = this.getThumbnailDescription({
      asset_id: a.asset_id,
      width: a.width,
      height: a.height,
      web_path: a.path,
      alt: "",
      name: a.name,
      size: a.size,
      sizeMod: a.sizeMod
    }));
    return '<h3 class="sectionHeading">' +
      EasyEditLocalise._("Related Image") + '</h3><div id="ees_setThumbnail"><div class="row"><div class="cellName alignLeft">' + EasyEditLocalise._("Set Image") + '</div><div class="cellData alignLeft"><div id="ees_thumbnailPicker"></div><div id="ees_thumbnailPreview">' + b + "</div></div></div></div>"
  },
  attachThumbEvents: function() {
    if (!EasyEditConfig.useThumbnail) return !1;
    var a = this,
      b = jQuery("#ees_thumbnailName .thumbName").text(),
      c = jQuery("#ees_thumbnailId .thumbId").text();
    prefillData = {
      assetid: c,
      name: b,
      type_code: "image",
      type: "Image"
    };
    "" === c && (prefillData = null);
    new EasyEditAssetPicker({
      bindElem: "#ees_thumbnailPicker",
      description: EasyEditLocalise._("Enter an ID or click select to find an asset"),
      prefillNode: prefillData,
      itemRefiner: function(a) {
        "image_variety" === a.type_code && (a.is_dependant = 0);
        return a
      },
      types: ["image", "thumbnail", "image_variety"],
      bindFn: function(b) {
        EasyEditComponentsToolbar.enableSaveButton();
        null === b || "undefined" === typeof b ? (jQuery("#ees_thumbnailPreview").find(".error").remove(), jQuery("#ees_thumbnailPreview").empty()) :
          "image" !== b.attribute("type_code") && "thumbnail" !== b.attribute("type_code") && "image_variety" !== b.attribute("type_code") ? (jQuery("#ees_thumbnailPicker a.assetClearSelection").click(), jQuery("#ees_thumbnailPreview").append('<div class="error">' + EasyEditLocalise._('Sorry, a thumbnail could not be set. Thumbnails can only be of type "image" or "thumbnail"') + "</div>")) : (jQuery("#ees_thumbnailPreview").find(".error").remove(), a.changeThumbnailPreview(b))
      }
    })
  },
  getThumbnailDescription: function(a) {
    var a = jQuery.extend({
        asset_id: null,
        width: null,
        height: null,
        web_path: null,
        alt: "",
        name: null,
        size: 0,
        sizeMod: "kb"
      }, a, !0),
      b = {
        width: a.width,
        height: a.height,
        alt: a.alt,
        web_path: a.web_path
      };
    return '<span id="ees_thumbnailImage" class="alignLeft">' + EasyEditScreens.screen.detailsImage.rescaleImage(a.asset_id, b, 160, 160, b.web_path) + '</span><span id="ees_thumbnailName" class="displayBlock"><strong>Name:</strong> <span class="thumbName">' + a.name + '</span></span><span id="ees_thumbnailId" class="displayBlock"><strong>Id:</strong> #<span class="thumbId">' +
      a.asset_id + '</span></span><span id="ees_thumbnailDimensions" class="displayBlock"><strong>Actual Dimensions:</strong> ' + b.width + " x " + b.height + ' pixels</span><span id="ees_thumbnailFileSize" class="displayBlock"><strong>File Size:</strong> ' + a.size + a.sizeMod.toLowerCase() + '</span><span class="displayBlock" style="margin-top:10px"><a href="' + b.web_path + '" id="ees_thumbnailPreviewLink" class="alignLeft genericButton" target="_blank">' + EasyEditLocalise._("Preview in New Window") + "</a></span>"
  },
  changeThumbnailPreview: function(a) {
    jQuery("#ees_thumbnailPreview").empty();
    var b = 0,
      c = 0,
      d = 0;
    a.attribute("variety_size") ? (c = a.attribute("variety_width"), d = a.attribute("variety_height"), b = a.attribute("variety_size")) : (c = a.attribute("width"), d = a.attribute("height"), b = a.attribute("size"));
    var e = b,
      b = Math.round(e / 1E3),
      e = Math.round(e / 1E6),
      b = 1 <= e ? [e, "mb"] : [b, "kb"];
    a = this.getThumbnailDescription({
      asset_id: a.id,
      width: c,
      height: d,
      web_path: a.attribute("web_path"),
      alt: a.attribute("alt"),
      name: a.attribute("name"),
      size: b[0],
      sizeMod: b[1]
    });
    jQuery("#ees_thumbnailPreview").html(a)
  },
  saveThumbnail: function(a) {
    var b =
      jQuery("#ees_thumbnailPicker");
    if (0 === b.length || 0 === b.children(".ees_assetPicker").length) return a.call(this), !1;
    EasyEditAssetManager.getCurrentAsset(function(b) {
      function d(d, e, j) {
        var h = {};
        h[b.attribute("type_code") + "_" + b.id + "_thumbnail[assetid]"] = d;
        h["sq_asset_finder_" + b.attribute("type_code") + "_" + b.id + "_thumbnail_assetid"] = d;
        h["sq_asset_finder_" + b.attribute("type_code") + "_" + b.id + "_thumbnail_label"] = e;
        h[b.attribute("type_code") + "_" + b.id + "_thumbnail[linkid]"] = j;
        h[b.attribute("type_code") + "_" + b.id +
          "_thumbnail[url]"] = "";
        d = new EasyEditSimpleEditRequest({
          backend_assetid: b.id,
          assetid: b.id,
          screen: "details"
        });
        d.setParam(h);
        d.setParam("ees_content_no_filter", "1");
        d.send(function() {
          b.acquireLock("all", function() {
            a.call(this)
          })
        })
      }
      if ("Archived" === b.attribute("status")) return a.call(this), !1;
      var e = jQuery("#ees_thumbnailPicker .assetId").text();
      if (null !== b.attribute("thumbnail")) {
        if ("" !== e && 1 * e === 1 * b.attribute("thumbnail").asset_id) return a.call(this), !1
      } else if ("" === e) return a.call(this), !1;
      "" === e ? (d("",
        "", ""), b.attribute("thumbnail", null)) : EasyEditAssetManager.getAsset(e, function(a) {
        var g = 0,
          j = 0,
          h = 0;
        a.attribute("variety_width") ? (g = a.attribute("variety_width"), j = a.attribute("variety_height"), h = a.attribute("variety_size")) : (g = a.attribute("width"), j = a.attribute("height"), h = a.attribute("size"));
        b.attribute("thumbnail", {
          asset_id: e,
          width: g,
          height: j,
          path: a.attribute("web_path"),
          name: a.attribute("name"),
          size: h / 1E3,
          sizeMod: "kb"
        });
        d(a.id, a.attribute("name"), a.attribute("link_info"))
      })
    })
  },
  attachStatusEvents: function() {
    function a(a) {
      e.find('select[id$="_new_fs_when_day"]').val(g.addLeadingZero(a.getDate()));
      e.find('select[id$="_new_fs_when_month"]').val(g.addLeadingZero(a.getMonth() + 1));
      e.find('select[id$="_new_fs_when_year"]').val(a.getFullYear());
      e.find('select[id$="_new_fs_when_hour"]').val(g.addLeadingZero(a.getHours()));
      e.find('select[id$="_new_fs_when_minute"]').val(g.addLeadingZero(a.getMinutes()))
    }
    var b = jQuery("#ees_changeStatus"),
      c = b.find('a:contains("metadata")');
    if (c.length) {
      var c = c.parent(".sq-backend-smallprint"),
        d = c.parents("tr:eq(0)");
      c.hide();
      d.after('<tr><td class="metadataRequired" colspan="2"><p>' +
        c.html() + "</p></td></tr>");
      jQuery(".metadataRequired a", b).click(function(a) {
        a.preventDefault();
        EasyEditScreens.loadScreen("metadataDefault", function() {})
      })
    }
    if (EasyEditConfig.hasOwnProperty("allowFutureStatusChange") && EasyEditConfig.allowFutureStatusChange && jQuery("#ees_futureStatus").length) {
      jQuery("#ees_futureStatusToggle").click(function(a) {
        jQuery("#ees_futureStatus").slideToggle();
        var b = jQuery(this).find(".label");
        b.text().match(EasyEditLocalise._("View")) ? b.text(EasyEditLocalise._("Hide Future Status")) :
          b.text(EasyEditLocalise._("View Future Status"));
        jQuery("html, body").animate({
          scrollTop: 0
        }, "slow");
        a.preventDefault()
      });
      var c = RegExp("next run on the (([0-9]{1,2})(st|nd|rd|th) ([A-Z]{3}) ([0-9]{1,4}) ([0-9]{1,2}):([0-9]{1,2})(am|pm))", "i"),
        b = /runs every ([0-9]+) minutes/i,
        d = jQuery("#ees_futureStatusNextRun").text(),
        c = c.exec(d),
        b = b.exec(b),
        e = jQuery("#ees_matrixFutureStatus"),
        f = new Date;
      null !== c && (f = new Date(c[2] + " " + c[4] + " " + c[5] + " " + c[6] + ":" + c[7] + " " + c[8]));
      var g = new EasyEditDatePicker({
        bindElem: "#datePickerContainer",
        defaultDate: f,
        minimumDate: function() {
          return f
        },
        minuteIncrement: null !== b ? 1 * b[1] : 15,
        onChange: function(b) {
          if (b.getTime() !== f.getTime()) {
            for (var c = new Date(f); c.getTime() < b.getTime();) c.setMinutes(c.getMinutes() + g.settings.minuteIncrement);
            g.setDate(new Date(c))
          }
          a(b)
        },
        onLoad: function() {}
      });
      jQuery("#ees_setFutureStatusToNextRun").click(function(a) {
        a.preventDefault();
        new Date > g.settings.defaultDate ? g.setDate(new Date(g.settings.defaultDate.setMinutes(g.settings.defaultDate.getMinutes() + g.settings.minuteIncrement))) :
          g.setDate(g.settings.defaultDate)
      });
      b = e.find('select[id$="_new_fs_status"]');
      c = e.find('input[id$="_new_fs_change_status_all_children"]');
      c.wrap('<div class="cascade"></div>').prependTo(jQuery("#ees_futureStatusSelect")).after('<label for="' + c.attr("id") + '">' + EasyEditLocalise._("Cascade Status Change") + "</label>");
      b.prependTo(jQuery("#ees_futureStatusSelect"));
      b.bind("change", function() {
        a(g.getDate());
        EasyEditComponentsToolbar.enableSaveButton()
      });
      b = jQuery("#ees_matrixFutureStatus table:eq(2)");
      b.length &&
        (jQuery("#ees_futureStatusSchedule").text(""), jQuery("#ees_futureStatusSchedule").append(b), b = b.find("tr").length - 1, jQuery("#ees_futureStatusToggle").append(' <span class="scheduledChangeCount" title="' + EasyEditLocalise._n("There is 1 future status change scheduled", "There are %1 future status changes scheduled", b, b) + '">(' + b + ")</span>"))
    }
    EasyEditAssetManager.getCurrentAsset(function(a) {
      self.current_status = a.attribute("status");
      a = {
        Archived: "1",
        "Under Construction": "2",
        Live: "16",
        "Up For Review": "32",
        "Safe Editing": "64"
      };
      "undefined" !== typeof a[self.current_status] && (self.current_status = a[self.current_status]);
      jQuery("#ees_metadataWarningBtn").click(function(a) {
        a.preventDefault();
        EasyEditScreens.switchScreen("metadataDefault")
      })
    });
    var j = jQuery('select[id$="_change_status_stream_bypass"]'),
      h = jQuery('select[id$="_change_status_stream_workflow"]'),
      k = jQuery('textarea[id$="_workflow_approval_request_comment"]'),
      l = jQuery('select[id$="_change_status"]'),
      n = jQuery('input[id$="_all_children"]'),
      m = jQuery("div.row.workflowStream"),
      o = jQuery("div.row.workflowLog"),
      r = jQuery("div.row.cascadeWarningLive"),
      p = jQuery("div.row.nonLiveWarning"),
      s = jQuery("div.row.cascadeWarningWorkflow"),
      q = jQuery("div.row.cascadeNonLiveWarning");
    j.length && h.length && (b = jQuery('select[id$="_change_status"]').parent().get(0).childNodes, jQuery.each(b, function(a, b) {
      3 === b.nodeType && jQuery(b).wrap('<span class="streamText"></span>')
    }));
    n.bind("click", function() {
      var a = jQuery(this).is(":checked"),
        b = l.val();
      r.hide();
      s.hide();
      q.hide();
      p.hide();
      if (a)
        if (b === "16" ||
          b === "0" && self.current_status === "16") r.show();
        else if ("1|2".indexOf(self.current_status) !== -1 && ("1|2".indexOf(b) !== -1 || b === "0")) q.show();
      else if ("1|2".indexOf(self.current_status) === -1 && "1|2".indexOf(b) !== -1) {
        p.show();
        q.show()
      } else "4|32|128".indexOf(b) !== -1 && s.show();
      else "1|2".indexOf(self.current_status) === -1 && "1|2".indexOf(b) !== -1 && p.show()
    });
    l.bind("change", function() {
      var a = jQuery(this).val();
      r.hide();
      s.hide();
      p.hide();
      q.hide();
      switch (a) {
        case "1":
        case "2":
          if ("1|2".indexOf(self.current_status) ===
            -1)
            if (n.is(":checked")) {
              p.show();
              q.show()
            } else p.show();
          else "1|2".indexOf(self.current_status) !== -1 && n.is(":checked") && q.show();
          k.length && "2".indexOf(self.current_status) === -1 && o.show();
          break;
        case "8":
        case "256":
          h.hide();
          j.show();
          (j.length || h.length) && m.show();
          k.length && o.show();
          break;
        case "4":
        case "32":
        case "64":
        case "128":
          h.show();
          j.hide();
          (j.length || h.length) && m.show();
          k.length && "16".indexOf(self.current_status) === -1 && o.show();
          n.is(":checked") && s.show();
          break;
        default:
          h.hide();
          j.hide();
          m.hide();
          o.hide();
          (a === "16" || self.current_status === "16" && a === "0") && n.is(":checked") ? r.show() : "1|2".indexOf(self.current_status) !== -1 && n.is(":checked") && q.show()
      }
    });
    h.hide();
    j.hide()
  },
  saveFutureStatus: function(a) {
    EasyEditAssetManager.getCurrentAsset(function(b) {
      if ("" !== jQuery('select[id$="_new_fs_status"]').val() || jQuery('input[id$="_remove_fs[]"]:checked').length) {
        EasyEditDebug.log("SAVING FUTURE STATUS", jQuery('select[id$="_new_fs_status"]').val(), jQuery('input[id$="_remove_fs[]"]:checked').length);
        var c =
          new EasyEditSimpleEditRequest({
            backend_assetid: b.id,
            assetid: b.id,
            screen: "details"
          });
        c.setParamsFromElement(jQuery("#ees_futureStatus"));
        c.setParam("ees_content_no_filter", "1");
        c.send(function() {
          b.acquireLock("all", function() {
            a.call(this)
          })
        })
      } else a.call(this)
    })
  },
  _getDetailsHTML: function(a) {
    a.attributes();
    return '<h3 class="sectionHeading">' + EasyEditLocalise._("Names") + '</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label for="ees_inputName" class="inputLabel">' + EasyEditLocalise._("Page Name") +
      '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /> &nbsp;</div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputShortName" class="inputLabel">' + EasyEditLocalise._("Page Short Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputShortName" name="ees_inputShortName" class="inputText" value="" /> &nbsp;</div></div></div>'
  }
};
(function(a, b) {
  b.file_upload = function(a) {
    a.events.observe("attach", function() {
      var b = a.settingsTip.$element,
        e = {
          bindElem: b.find(".custom-form-modal__destination"),
          bindFn: function() {
            var b = this.getCurrent();
            a.attribute("create_location", b.assetid);
            a.events.trigger("change")
          }
        };
      if (a.attributes.hasOwnProperty("create_location") && /^[0-9]+$/g.test(a.attributes.create_location) && a.options.createLocations.hasOwnProperty(a.attributes.create_location)) {
        var f = a.attributes.create_location;
        e.prefillNode = {
          assetid: f,
          type_code: a.options.createLocations[f].type_code,
          name: a.options.createLocations[f].short_name
        }
      }
      a.desination_picker = new EasyEditAssetPicker(e);
      null !== a.attribute("overwrite_rule") && b.find('select[name="overwrite"]').val(a.attribute("overwrite_rule"))
    });
    a.events.observe("bind", function() {
      a.settingsTip.$element.find('select[name="overwrite"]').on("change", function() {
        a.update()
      })
    });
    a.events.observe("update", function() {
      var b = a.settingsTip.$element.find('select[name="overwrite"]').val();
      a.attribute("overwrite_rule",
        b)
    })
  }
})(jQuery, EasyEditQuestionDecorators);
EasyEditScreens.assetTypes.rtf_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.text_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
var handleMetadataDatetimeDefaultClick = function(a, b, c) {
  if (jQuery(a).attr("checked") && null !== c)
    for (var d in c) jQuery(document.getElementById(b + "_datetimevalue[" + d + "]")).val(c[d]), jQuery("#" + b + "_repkeys").val("")
};
EasyEditScreens.screen.metadataDefault = {
  containerId: null,
  init: function(a, b, c) {
    var d = this;
    d.containerId = a;
    d._getTemplate(function(a) {
      var b = jQuery(d.containerId),
        g = b.find("#ees_editMetadata");
      g.length ? g.replaceWith(a) : b.append(a);
      d._attachEvents();
      c.call(this)
    })
  },
  _processWysiwygs: function() {
    var a = this,
      b = jQuery(".rowWithWYSIWYG", this.containerId);
    null !== a.viper && b.each(function() {
      var b = $(this).find('div[id$="_contents_div"]'),
        d = $(this).find("textarea"),
        b = a.viper.getHtml(b.get(0));
      d.val(b)
    })
  },
  save: function(a) {
    var b =
      this;
    EasyEditOverlay.showOverlay("loading", {}, function() {
      EasyEditAssetManager.getCurrentAsset(function(c) {
        b._processWysiwygs();
        var d = new EasyEditSimpleEditRequest({
          backend_assetid: c.id,
          assetid: c.id,
          screen: "metadata"
        });
        d.setParamsFromElement(jQuery(b.containerId), !1);
        d.setParam("ees_content_no_filter", "1");
        d.send(function() {
          c.acquireLock("all", function() {
            c.refreshAttributes(function() {
              a.apply(this, [!0, [], {
                refresh: !0
              }])
            })
          })
        })
      })
    })
  },
  getViper: function() {
    return this.hasOwnProperty("viper") ? this.viper : null
  },
  cleanUp: function() {
    var a = this.getViper();
    EasyEdit.isset(a) && a.destroy()
  },
  validateRequired: function() {
    function a() {
      return jQuery(this).find("span.fieldRequired").length
    }

    function b(a, b) {
      c(a);
      a.addClass("error").append('<span class="fieldWarning">' + b + "</span>")
    }

    function c(a) {
      a.removeClass("error").find("span.fieldWarning").remove()
    }
    var d = jQuery("#ees_editMetadata"),
      e = EasyEditLocalise._("This field is mandatory"),
      f = jQuery(".cellData", d).filter(a).filter(function() {
        return !jQuery(this).find("iframe").length
      });
    jQuery(".cellData", d).each(function() {
      c(jQuery(this))
    });
    jQuery(".multipleText", d).filter(a).each(function() {
      var a = jQuery(this);
      a.find("input[type=text]").filter(function() {
        return "" !== jQuery(this).val()
      }).length || b(a, EasyEditLocalise._("At least one field is required to have a value"))
    });
    f.filter(function() {
      var a = jQuery(this).find("input[type=text]");
      return 1 === a.length && "" === a.val()
    }).each(function() {
      b(jQuery(this), e)
    });
    jQuery(".dateTime", d).filter(a).filter(function() {
      var a = jQuery(this),
        b = a.find("select[id$=_repkeys]").val(),
        c = a.find("select").not("[id$=_repkeys]"),
        a = a.find("input[type=text]"),
        d = !0;
      c.each(function() {
        "--" === jQuery(this).val() && (d = !1)
      });
      a.each(function() {
        "" === jQuery(this).val() && (d = !1)
      });
      !d && "" !== b && (d = !0);
      return d ? !1 : !0
    }).each(function() {
      b(jQuery(this), e)
    });
    f.filter(function() {
      var a = jQuery(this).find("select");
      return 1 === a.length && ("" === a.val() || "undefined" === typeof a.find("option:selected").val()) ? !0 : !1
    }).each(function() {
      b(jQuery(this), e)
    });
    jQuery(".rowWithWYSIWYG .cellData", d).filter(a).filter(function() {
      var a = !1;
      jQuery(this).find("iframe").length && "" === jQuery(this).find("iframe").contents().find("body").text() && (a = !0);
      jQuery(this).find("input[id$=default]:checked").length && "" === jQuery(this).find("div[id$=_default_html_container]").text() && (a = !0);
      return a
    }).each(function() {
      b(jQuery(this), e)
    });
    f.filter(function() {
      return jQuery(this).find("input[type=checkbox]").not("input[id$=default]").length
    }).filter(function() {
      return 0 === jQuery(this).find("input[type=checkbox]:checked").not("input[id$=default]").length ?
        !0 : !1
    }).each(function() {
      b(jQuery(this), e)
    });
    f.filter(function() {
      return jQuery(this).find("input[type=radio]").length
    }).filter(function() {
      return 0 === jQuery(this).find("input[type=radio]:checked").length || "" === jQuery(this).find("input[type=radio]:checked").val() ? !0 : !1
    }).each(function() {
      b(jQuery(this), e)
    });
    f.filter(function() {
      var a = jQuery(this).find("textarea");
      return a.length && "" === a.val() ? !0 : !1
    }).each(function() {
      b(jQuery(this), e)
    })
  },
  _getMetadata: function(a, b) {
    var c = new EasyEditAPI;
    c.queue("getKeywordsReplacements", {
      asset_id: a,
      keywords_array: ["%metadata-F_metadata_values%"]
    });
    c.expect(1).run(function(a) {
      EasyEdit.isError(a[0].data) || (a = a[0].data["metadata-F_metadata_values"]["metadata-F_metadata_values"], a = EasyEdit.filterScriptSrc(a), b.call(this, a))
    })
  },
  _getTemplate: function(a) {
    var b = "",
      c = this;
    EasyEditAssetManager.getCurrentAsset(function(d) {
      c._getMetadata(d.id, function(d) {
        d === EasyEditLocalise._("You must apply one or more schemas before entering metadata values.") ? (d = EasyEditLocalise._("This asset has no metadata schema applied. Your administrator will need to apply one or more schemas before you will be able to enter any metadata values."),
          b = '<div id="ees_editMetadata"><h2>' + EasyEditLocalise._("No Metadata Applied") + '</h2><p class="noMetadataMessage">' + d + "</p></div>") : b = '<div id="ees_editMetadata">' + c._reRender(d) + "</div>";
        a.call(this, b)
      })
    })
  },
  reRenderWysiwyg: function(a, b) {
    $wysiwygs = b.find("div[id$=_wysiwyg_container]");
    $wysiwygs.length && ($wysiwygs.find("script").remove(), $wysiwygs.each(function() {
      var a = jQuery(this).find('div[id$="_contents_div"]');
      a.length && (a.removeAttr("onclick"), jQuery(this).removeAttr("style"), jQuery('div[id$="_switch_option_div"]',
        this).remove(), a = a.attr("id").replace("_contents_div", ""), b.find('input[id="' + a + '_default"]').removeAttr("onclick"))
    }));
    return [a, b]
  },
  _reRender: function(a) {
    var b = this,
      c = "",
      d = jQuery(a),
      d = b.reRenderWysiwyg(a, d),
      a = d[0],
      d = d[1];
    $sectionTables = d.find("table.sq-backend-section-table-inner").find("td.sq-limbo-field:eq(0)").parent().parent().parent();
    if (!$sectionTables.length) return EasyEdit.tmpl.render("simple_tag", {
      tag: "div",
      content: "<h3>" + EasyEditLocalise._("No Metadata Applied") + '</h3><p class="noMetadataMessage">' +
        EasyEditLocalise._("This asset has no metadata schema applied. Your administrator will need to apply one or more schemas before you will be able to enter any metadata values.") + "</p>"
    });
    jQuery($sectionTables).parent().parent().prev().find("td.sq-limbo-section-subheading:eq(0)").parents(".sq-backend-section-table-inner").parents(".sq-backend-section-table").find('td[class$="heading"]:eq(0)').each(function(a) {
      var d = jQuery(this),
        a = '<h3 class="schemaHeading_' + a + '">' + d.text() + "</h3>";
      c += a;
      $sectionTables =
        d.parent().next().find("table.sq-backend-section-table");
      $sectionTables.each(function(a) {
        var d = jQuery(this).children().find("td.sq-limbo-section-subheading:eq(0)").text();
        c += '<h4 class="sectionHeading_' + a + '">' + d + '</h4><div class="editSection section_' + a + '">';
        jQuery(".sq-limbo-field", this).each(function(a) {
          var d = jQuery(this),
            e = jQuery(this).next(),
            f = e.find(".sq-backend-smallprint"),
            g = 0 === e.find("input, textarea, select").length,
            j = 0 < jQuery(':contains("*")', d).length,
            d = '<span class="inputLabel">' + d.text() +
            '</span><span class="notes">' + f.html() + "</span>";
          f.hide();
          e.find("input[type=text]").addClass("inputText typeText");
          e.find("textarea").addClass("inputText typeTextArea");
          e.find("select").addClass("typeSelect");
          e.find("input[type=radio]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeRadioSelect");
          e.find("input[type=checkbox]").parents('[id*="metadata_field_select"]:eq(0)').addClass("typeCheckBoxSelect");
          e.find('input[id$="_default"]').addClass("defaultCheckbox");
          e.find('label[for$="_default"]').addClass("defaultLabel");
          e.find('div[id^="metadata_field_related_asset"]').addClass("typeRelatedAsset");
          e.find('span[id*="_select"]').css("display", "block");
          e.find('div[id$="_wysiwyg_container"]').addClass("wysiwygContainer content_type_wysiwyg").nextAll().css("clear", "both");
          e.find('div[id$="switch_option_div"]').addClass("wysiwygSwitchers");
          e.find('div[id$="default_html_container"]').addClass("wysiwygDefaultContainer");
          e.find('input[id*="metadata_field_date"]').parent().addClass("dateTime");
          j && !g && e.prepend('<span title="' +
            EasyEditLocalise._("Required") + '" class="fieldRequired"><span></span></span>');
          f = "";
          g && (g = e.find('div[id*="asset-tag-line-"]').parent(), g.parent().addClass("ees_relatedAssets"), g.find("img").remove(), e.prepend('<span title="' + EasyEditLocalise._("Non Editable") + '" class="fieldNonEditable"><span></span></span>'), f = "locked");
          g = b._filterNotSupported(e);
          j = e.find("div[id$=_wysiwyg_container]").length ? "rowWithWYSIWYG" : "";
          j = e.find("input[id^=metadata_field_thesaurus]").length ? "thesaurusContainer" : j;
          e.find("th:first").length &&
            "Term" === jQuery.trim(e.find("th:first").text()) && (j = "thesaurusContainer");
          c += '<div class="row ' + j + " row_" + a + '"><div class="cellName">' + d + '</div><div class="cellData ' + f + '">' + g + "</div></div>"
        });
        c += "</div>"
      })
    });
    return c
  },
  _filterNotSupported: function(a) {
    return 0 < jQuery('input[id*="_hierarchy"]', a).length ? '<div class="notSupported">' + EasyEditLocalise._("Use admin mode to edit this field.") + "</div>" : a.html()
  },
  attachWysiwygEvents: function() {},
  _attachEvents: function() {
    function a(a, b, e) {
      a.append('<li class="child"><a href="#" class="assetDeleteOption alignRight" title="' +
        EasyEditLocalise._("Delete this option") + '"></a><a class="dragIcon alignLeft" title="' + EasyEditLocalise._("Drag to re-arrange") + '" href="#"></a><input type="text" name="' + b + '" value="' + e + '" /></li>')
    }
    this.attachWysiwygEvents();
    var b = jQuery(".cellData", this.containerId);
    b.find("input[id^=metadata_field_date_],select[id^=metadata_field_date_]").not("input[id$=default]").change(function() {
      jQuery(this).parent().find("input[id$=default]").attr("checked", !1)
    }).parent().addClass("dateTime").find('b:contains("OR")').text("Otherwise Select");
    jQuery(".dateTime", this.containerId).find("input[type=text]").parents(".dateTime").addClass("dateTimeTextInputs");
    jQuery("div[id$=_switch_option_div]").click(function() {
      EasyEditComponentsToolbar.enableSaveButton()
    });
    jQuery(".ees_relatedAssets li", b).filter(function() {
      return jQuery(this).is("li")
    }).each(function() {
      function a(c, f, g) {
        if (f.length) {
          for (var j = g.getLineageFromTreeId(g.attr.tree_id), c = j.length - 1; 0 < c && "site" !== j[c].type_code; --c);
          j.splice(0, c);
          var c = b.parents('div[class*="sq-restricted-root-nodes"]'),
            h = [];
          jQuery(c).is("div") && (h = c.data("root-nodes").split("|"), h.pop(), j = null);
          b.click(function() {
            EasyEditAssetFinder.init({
              focusAssetId: g.id,
              selectedLineage: j,
              rootNodes: h,
              callback: function(a, b, c) {
                EasyEdit.redirect({
                  asset: a,
                  url: c,
                  screen: "details",
                  lineage: b
                })
              }
            })
          })
        }
      }
      var b = jQuery(this);
      jQuery(".sq-info-assetid", b).each(function() {
        var b = jQuery(this),
          d = jQuery.trim(b.text());
        d.length && EasyEditAssetManager.getAsset(d, function(g) {
          a(b, d, g)
        })
      })
    });
    jQuery(".typeRelatedAsset", this.containerId).filter(function() {
      return jQuery(this).is('[id$="_default_ra_container"]')
    }).each(function() {
      function a(c,
        e) {
        var f = jQuery(e);
        "" !== c ? v[e].loadAsset(c, null, function(a) {
          f.find("input[id*=assetid]").val(a.id);
          f.find("input[id$=label]").val(a.attribute("name") + " - #" + a.id);
          f.find("input[id*=linkid]").val(a.attribute("link_info").link_id)
        }) : (f.find("input[id*=assetid]").val(""), f.find("input[id$=label]").val(""), f.find("input[id*=linkid]").val(""));
        f.next("div[id*=metadata_field_related_asset]").removeClass("screenHide");
        b()
      }

      function b() {
        1 < g.find(".relatedMetadata:not(.screenHide)").length ? (g.find("a.sortHandle").addClass("dragIcon"),
          g.sortable({
            axis: "y",
            handle: ".dragIcon",
            stop: function() {
              EasyEditComponentsToolbar.enableSaveButton();
              t.attr("checked", !1)
            }
          })) : g.find("a.sortHandle").removeClass("dragIcon")
      }
      var e = jQuery(this),
        f = [],
        g = e.prev("div"),
        j = e.parent(),
        h = g.find("input");
      h.addClass("screenHide");
      j.append(h);
      h.each(function() {
        f.push({
          id: jQuery(this).attr("id"),
          value: jQuery(this).val()
        })
      });
      g.find("div.sq-multiple-asset-finder-wrapper").detach();
      g.appendTo(j);
      var h = g.attr("id"),
        k = j.find("input[id*=\\[assetid\\]]"),
        l = g.data("restricted-types");
      l && (l = l.split("|"));
      var n = g.data("restricted-roots");
      n && (n = n.split("|"), n.pop());
      var m = g.data("asset-types");
      m && (m = m.split("|"));
      for (var o = [], r = [], p = 1, s = 0; s < k.length; s++) $currentAssetField = jQuery(k[s]), p = $currentAssetField.val(), 0 == p && (p = ""), o[s] = p, r[s] = h + "_" + s, p = jQuery('<div id="' + r[s] + '"></div>'), p.append('<div id="' + r[s] + '_picker"></div>'), p.append(j.find("input[id*=\\[" + s + "\\]]")), p.append(j.find("input[id$=_" + s + "__label]")), baseFieldName = $currentAssetField.attr("id").replace("[assetid]", ""),
        p.append('<input id="sq_asset_finder_' + baseFieldName + '_assetid" name="sq_asset_finder_' + baseFieldName + '_assetid" value="' + $currentAssetField.val() + '" class="screenHide" type="text" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_label" name="sq_asset_finder_' + baseFieldName + '_label" value="" class="screenHide" type="text" />'), g.append(p), p = s;
      var q = h.replace(/^[^0-9]*/, "").replace(/[^0-9]*$/, "");
      (k = g.data("max-selections")) || (k = 1);
      if (p < k)
        for (s = p + 1; s < k; s++) r[s] = h + "_" + s, p = jQuery('<div id="' +
          r[s] + '" class="screenHide"></div>'), p.append('<div id="' + r[s] + '_picker"></div>'), baseFieldName = "metadata_field_related_asset_" + q + "_value[" + s + "]", p.append('<input id="' + baseFieldName + '[assetid]" name="' + baseFieldName + '[assetid]" value="" class="screenHide" type="hidden" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_assetid" name="sq_asset_finder_' + baseFieldName + '_assetid" value="" class="screenHide" type="text" />'), p.append('<input id="sq_asset_finder_' + baseFieldName + '_label" name="sq_asset_finder_' +
          baseFieldName + '_label" value="" class="screenHide" type="text" />'), g.append(p);
      e.hide();
      g.show();
      var t = jQuery(".defaultCheckbox", j.parent());
      t.attr("onclick", "");
      var w = e.find("span.sq-info-assetid");
      t.click(function() {
        for (var a = true, c = 0; c < r.length; c++) {
          var e = jQuery.data(j.get(0), "picker" + c),
            f = w[c] !== void 0 ? jQuery(w[c]).text() : "",
            k = jQuery("#" + r[c]);
          if (jQuery(this).is(":checked"))
            if (f === "") {
              if (a) {
                k.removeClass("screenHide");
                a = false
              } else k.addClass("screenHide");
              e.clear()
            } else {
              k.removeClass("screenHide");
              k.find("input[id*=assetid]").val() !== f && e.loadAsset(f, null, function(a) {
                k.find("input[id*=assetid]").val(a.id);
                k.find("input[id$=label]").val(a.attribute("name") + " - #" + a.id);
                k.find("input[id*=linkid]").val(a.attribute("link_info").link_id)
              })
            }
          else if (f === "" && a) {
            k.removeClass("screenHide");
            a = false
          }
        }
        b()
      });
      j.find('img[src$="asset_locator.png"]').hide();
      for (var v = [], s = 0; s < r.length; s++) {
        e = "#" + r[s];
        p = o[s];
        q = {
          bindElem: e + "_picker",
          bindFn: function(b) {
            return function(d) {
              typeof d === "undefined" || d === null ? a("",
                b) : a(d.id, b);
              EasyEditComponentsToolbar.enableSaveButton()
            }
          }(e),
          itemRefiner: function(a) {
            if (a.type_code === "image_variety") a.is_dependant = 0;
            return a
          },
          types: l,
          restrictedRootNodes: n,
          groupId: 1 < k ? "field_group_" + h.replace(/[^\d]/g, "") : ""
        };
        if (p) {
          var u = void 0 !== m[s] ? m[s] : "";
          q.prefillNode = {
            assetid: p,
            type_code: u,
            type: u.replace("_", " ").replace(/\S+/g, function(a) {
              return a.charAt(0).toUpperCase() + a.substr(1)
            }),
            name: jQuery(e).find("input[id$=label]").val()
          }
        }
        v[e] = new EasyEditAssetPicker(q);
        jQuery.data(j.get(0), "picker" +
          s, v[e]);
        var y = jQuery(e);
        y.addClass("relatedMetadata fieldContainer");
        y.prepend('<a class="sortHandle alignLeft" title="Drag to re-arrange" href="#"></a>');
        "" !== q.restrictedRootNodes && null !== q.prefillNode && p && EasyEditAssetManager.getAsset(p, function(a) {
          var b = true,
            c = y.parent().parent().parent().parent(),
            d = c[0].className.split(" "),
            e = jQuery("p#ees_rootNodeWarning.warningMessage_" + d[2]);
          for (parent in a.parentIds)
            if (n.indexOf(parent) === -1) b = false;
            else {
              b = true;
              break
            }!b && e.length == 0 && c.prepend('<p id="ees_rootNodeWarning" class="warningMessage ees_screenWarning warningMessage_' +
            d[2] + '">' + EasyEditLocalise._("<strong>Warning:</strong> some of the related assets are not under the restricted root nodes. Please review the related asset metadata field below and update its values accordingly, otherwise the related assets not under the restricted root nodes will not be saved.") + "</p>")
        })
      }
      g.find(".assetChangeButton").bind("click", function() {
        t.is(":checked") && t.attr("checked", false)
      });
      g.find(".assetClearSelection").bind("click", function() {
        t.is(":checked") && t.attr("checked", false)
      });
      g.on("click", ".assetDescription span.assetIcon", function() {
        t.is(":checked") && t.attr("checked", false)
      });
      b()
    });
    b.find("span[id^=metadata_field_multiple_text_]").parent().addClass("multipleText");
    b = jQuery(".multipleText", this.containerId);
    b.find("input:disabled").parents(".multipleText").addClass("disabled");
    b.each(function() {
      function b() {
        d.find("input[type=text]").each(function(a) {
          jQuery(this).attr("id", f.replace("[]", "[" + a + "]"))
        })
      }
      var d = jQuery(this),
        e = d.clone();
      d.empty();
      var f = e.find("input[type=text]:first").attr("name");
      d.html('<ul class="ees_directChildrenList"></ul>');
      var g = d.find("ul");
      e.find("input[type=text]").each(function() {
        a(g, f, jQuery(this).val())
      });
      g.on("focus", "input[type=text]", function() {
        var d = g.find("input[type=text]"),
          e = g.find("input:last"),
          k = jQuery(this).val(),
          h = 0;
        d.each(function() {
          "" === jQuery(this).val() && (h += 1)
        });
        "" === e.val() && "" === k && 2 > h && (a(g, f, ""), b())
      });
      d.prepend(e.find(".fieldRequired"));
      d.append(e.find("input.defaultCheckbox"));
      d.append(e.find('label[for$="_default"]'));
      var j = d.prev().find("input.defaultCheckbox"),
        h = (j.attr("onclick") + "").match(/\[(.*)\]/);
      null !== h && (h = h[0]);
      var k = null !== h ? eval(h) : null;
      j.attr("onclick", "");
      j.unbind("click");
      j.is(":checked") && d.find("input[type=text]").attr("disabled", !0).parent().addClass("defaultMode");
      window.handleDefaultClickMT = function() {};
      j.click(function() {
        d.toggleClass("disabled");
        if (j.is(":checked")) {
          g.empty();
          if (null !== k) {
            for (var l = 0, h = k.length; l < h; l++) a(g, f, k[l]);
            a(g, f, "")
          } else e.find("input[type=text]").each(function() {
            a(g, f, jQuery(this).val())
          });
          d.find("input[type=text]").not(".deleted").attr("disabled", !0).parent().addClass("defaultMode");
          b()
        } else d.find("input[type=text]").not(".deleted").attr("disabled", !1).parent().removeClass("defaultMode")
      });
      d.on("click", ".assetDeleteOption", function(a) {
        a.preventDefault();
        if (j.is(":checked")) return !1;
        EasyEditComponentsToolbar.enableSaveButton();
        var a = jQuery(this).parent(),
          b = a.find("input");
        a.hasClass("markedForDeletion") ? (a.removeClass("markedForDeletion").removeClass("defaultMode"), b.attr("disabled", !1).removeClass("deleted")) : (a.addClass("markedForDeletion").addClass("defaultMode"),
          b.attr("disabled", !0).addClass("deleted"))
      });
      b();
      g.sortable({
        axis: "y",
        handle: ".dragIcon",
        cancel: "li.defaultMode",
        stop: function() {
          EasyEditComponentsToolbar.enableSaveButton();
          b()
        }
      })
    });
    jQuery(".thesaurusContainer", this.containerId).each(function() {
      var a = jQuery('div[id$="_interface"]', this);
      if (a.length) {
        var b = a.attr("id"),
          e = /Id:\s#([0-9]+)/gi.exec(a.text());
        if (!EasyEdit.isset(e)) return !1;
        var f = jQuery(this).find('input[id$="_default"]'),
          g = jQuery('div[id$="_defaults"]', this);
        g.addClass("screenHide");
        var g =
          g.text(),
          j = [];
        "" !== g && (j = g.split(","));
        a.attr("id", b + "_old").addClass("screenHide");
        g = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field", {
          default_items: j,
          id: b + "_select",
          options: [{
            text: EasyEditLocalise._("-- Select a term --"),
            value: ""
          }],
          description: EasyEditLocalise._("There are currently no terms configured"),
          title: EasyEditLocalise._("Add"),
          loading_message: EasyEditLocalise._("Loading terms...")
        }));
        jQuery(".cellData", this).append(g);
        var h = jQuery(EasyEdit.tmpl.render("light_button", {
            href: "#",
            title: EasyEditLocalise._("Click to load terms"),
            content: EasyEditLocalise._("Click to load terms"),
            attr: {
              id: b + "_loadTerms"
            }
          })),
          k = jQuery("select", this),
          g = jQuery("a.addNew", this),
          l = jQuery("ul.editableItems", this),
          n = jQuery("ul.defaultItems", this),
          m = jQuery("div.addNewTerm", this),
          j = jQuery("div.clickToLoadTerms", this),
          o = jQuery("div.loadingTerms", this);
        j.append(h);
        j = function() {
          f.is(":checked") ? (l.addClass("screenHide"), n.removeClass("screenHide"), h.addClass("screenHide"), m.addClass("screenHide")) : (l.removeClass("screenHide"), 1 === k.find("option").length ?
            h.removeClass("screenHide") : m.removeClass("screenHide"), n.addClass("screenHide"))
        };
        f.removeAttr("onclick");
        f.click(j);
        j();
        var r = function(a, c) {
          if ("" !== a && 0 !== a && !l.find('input[value="' + a + '"]').length) {
            l.find(".defaultItem").remove();
            var e = jQuery("li", l).length,
              e = b.replace("_interface", "") + "_thes_term[" + e + "][assetid]",
              f = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field_tag", {
                delete_title: EasyEditLocalise._("Delete this tag"),
                drag_title: EasyEditLocalise._("Drag to re-arrange"),
                tag: c,
                id: e,
                name: e,
                value: a
              }));
            l.append(f);
            f.find("a.assetDeleteOption").click(function(a) {
              a.preventDefault();
              f.toggleClass("markedForDeletion");
              f.hasClass("markedForDeletion") ? f.find("input").attr("disabled", "disabled") : f.find("input").removeAttr("disabled");
              EasyEditComponentsToolbar.enableSaveButton()
            })
          }
          EasyEditComponentsToolbar.enableSaveButton()
        };
        f.is(":checked") || a.find('input[id$="[assetid]"]').each(function(b) {
          var d = jQuery(this).val(),
            b = a.find('input[id$="' + b + '__label"]').val();
          "" !== d && 0 !== d && "" !== b && r(d, b)
        });
        a.find("input").not('[id$="_terms_submitted"]').remove();
        g.click(function(a) {
          a.preventDefault();
          f.is(":checked") && f.removeAttr("checked");
          var a = k.val(),
            b = k.find("option:selected").text();
          r(a, b)
        });
        var p = function(a, b) {
          var c = k.find("option:first");
          c.text(EasyEditLocalise._("Loading..."));
          EasyEditAssetManager.getAssetMap({
            assetids: [{
              id: a
            }],
            cache: !1,
            callback: function(d) {
              if (EasyEdit.isset(d["ID_" + a]) && d["ID_" + a].hasOwnProperty("children"))
                for (var d = d["ID_" + a].children, e = 0, f = d.length; e < f; e += 1) k.append('<option value="' +
                  decodeURIComponent(d[e].assetid) + '">' + decodeURIComponent(d[e].name).replace(/\+/g, " ") + "</option>"), d[e].assetid && (p(d[e].assetid, b), b.call(this));
              c.text(EasyEditLocalise._("-- Select a term --"));
              b.call(this)
            }
          })
        };
        l.sortable({
          axis: "y",
          handle: ".dragIcon",
          cancel: "li.markedForDeletion",
          stop: function() {
            EasyEditComponentsToolbar.enableSaveButton();
            l.find("input").each(function(a) {
              a = b.replace("_interface", "") + "_thes_term[" + a + "][assetid]";
              jQuery(this).attr("id", a).attr("name", a)
            })
          }
        });
        if (EasyEdit.isset(e) &&
          EasyEdit.isset(e[1])) {
          var s = parseFloat(e[1]);
          h.click(function(a) {
            a.preventDefault();
            h.addClass("screenHide");
            o.removeClass("screenHide");
            p(s, function() {
              o.addClass("screenHide");
              m.removeClass("screenHide")
            })
          });
          k.bind("change", function() {
            f.is(":checked") && f.removeAttr("checked")
          })
        }
        var q = jQuery(".cellData", this).get(0);
        jQuery.each(q.childNodes, function(a, b) {
          EasyEdit.isset(b) && 3 === b.nodeType && -1 !== b.nodeValue.indexOf("(untick to customise)") && q.removeChild(b)
        })
      } else {
        var t = [];
        jQuery("a", this).each(function() {
          "#" !==
          jQuery(this).attr("href") && t.push(jQuery(this).text())
        });
        g = jQuery(EasyEdit.tmpl.render("metadata_thesaurus_field", {
          default_items: t
        }));
        jQuery(".cellData", this).append(g);
        jQuery("ul.defaultItems", this).removeClass("screenHide");
        jQuery("table", this).remove()
      }
    })
  },
  attachWysiwygEvents: function() {
    var a = jQuery(".rowWithWYSIWYG", this.containerId);
    if (a.length) {
      a.addClass("clearfix");
      jQuery("#ees_screenContentWrapper").addClass("withViper");
      this.viper = EasyEdit.loadViper({
        toolbarContainer: jQuery("#ees_editMetadata"),
        editableDivs: a.find('div[id$="_contents_div"]').filter(function() {
          return 0 === jQuery(this).find("div.locked").length
        }),
        scrollable: !0,
        scrollThreshold: 118,
        viperName: "metadata-screen"
      });
      if (null === this.viper) return !1;
      viper = this.getViper();
      a.each(function() {
        if (!jQuery(this).find(".cellData").hasClass("locked")) {
          var a = jQuery(this).find(".cellData"),
            c = jQuery(this).find('div[id$="_contents_div"]'),
            d = jQuery(this).find('input[id$="_default"]'),
            e = d.parent(),
            f = jQuery(this).find('div[id$="_default_html_container"]');
          jQuery(".ees_viperEditCallToAction", this);
          var g = viper.cleanHTML(f.html());
          f.hide();
          e.removeAttr("style").addClass("tools clearfix");
          a.prepend(e);
          var j = function() {
            $(this).is(":checked") ? (jQuery.data(this, "originalValue", viper.getHtml()), viper.setHtml(g), viper.getHistoryManager().clear()) : "undefined" !== typeof jQuery.data(this, "originalValue") && viper.setHtml(jQuery.data(this, "originalValue"))
          };
          c.bind("click keyup focus", function() {
            d.is(":checked") && (d.attr("checked", !1), j.call(d.get(0)))
          });
          d.change(j)
        }
      })
    }
  }
};
if (EasyEditConfig.hasOwnProperty("contextsEnabled") && EasyEditConfig.contextsEnabled) {
  var metadataScreen = EasyEditScreens.screen.metadataDefault,
    oldInit = metadataScreen.init;
  metadataScreen.init = function(a, b, c) {
    oldInit.apply(metadataScreen, [a, b, function() {
      function b(a) {
        var c = jQuery('input,textarea,select,div[id$="_contents_div"]', f);
        EasyEdit.util.unique.call(jQuery.map(c, function(a) {
          var b = jQuery(a).attr("id"),
            c = /field_([a-z]+)_([0-9]+)_/.exec(b),
            c = null === c ? /(wysiwyg)_([0-9]+)_contents_div/.exec(b) : c;
          if (null !== c) return j[c[2]] = jQuery(a), c[2];
          c = /([0-9]+)_options\[([0-9]+)\]/.exec(b);
          if (null !== c) return j[c[1]] = jQuery(a), c[1]
        }));
        EasyEditAssetManager.getCurrentAsset(function(b) {
          g.queue("getMetadataSchema", {
            assetid: b.id
          });
          g.run(function(b) {
            if (EasyEdit.isset(b[0]) && EasyEdit.isset(b[0].data) && !b[0].data.hasOwnProperty("error")) {
              var b = b[0].data,
                c;
              for (c in b)
                if (b.hasOwnProperty(c))
                  for (var d in b[c])
                    if (b[c].hasOwnProperty(d) && "1" !== b[c][d].is_contextable.value && j.hasOwnProperty(d)) {
                      var f = j[d].parents(".cellData");
                      e(f)
                    }
            }
            a.call(this)
          })
        })
      }

      function e(a) {
        a.addClass("global");
        var b = EasyEdit.context.getCurrentContextInfo().name,
          b = jQuery(EasyEdit.tmpl.render("context_global_field_warning", {
            message: EasyEditLocalise._('The current context is "<strong>%1</strong>" but this field is not contextable. Any changes will affect all contexts.', b),
            button: EasyEditLocalise._("Continue")
          }));
        a.before(b);
        a.hide();
        b.click(function(b) {
          b.preventDefault();
          jQuery(this).hide();
          a.fadeIn("fast")
        })
      }
      var f = jQuery(a),
        g = new EasyEditAPI,
        j = {};
      0 !== EasyEdit.context.currentContextId ? b(function() {
        c.call(metadataScreen)
      }) : c.call(metadataScreen)
    }])
  }
}
EasyEditScreens.screen.workflowDefault = {
  containerId: null,
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(b) {
      e.queue("getKeywordsReplacements", {
        asset_id: b.id,
        keywords_array: ["%workflow-S_running_workflows%"]
      });
      e.run(function(b) {
        var b = '<div id="ees_editWorkflow">' + d._buildWorflowSections(b[0].data["workflow-S_running_workflows"]["workflow-S_running_workflows"]) + "</div>",
          e = jQuery(a),
          f = e.find("#ees_editWorkflow");
        f.length ? f.replaceWith(b) :
          e.append(b);
        jQuery('#ees_workflowSummary td span:contains("[Escalated]")').each(function() {
          var a = jQuery(this).parents("table:eq(0)").parent("td");
          a.attr("colspan", "2");
          a.parent("tr").next("tr").find("td:eq(0)").attr("colspan", "2")
        });
        EasyEditComponentsToolbar.detectScreenEdits();
        b = EasyEdit.getURL();
        if ("string" === typeof b.params.workflow_link_action) switch (b.params.workflow_link_action) {
          case "approve":
            jQuery("#ees_editWorkflow select option").each(function() {
              "Approve" === jQuery(this).val() && jQuery(this).attr("selected", !0)
            });
            break;
          case "reject":
            jQuery("#ees_editWorkflow select option").each(function() {
              "Reject" === jQuery(this).val() && jQuery(this).attr("selected", !0)
            })
        }
        c.call(this)
      })
    })
  },
  _getBackendUrl: function(a) {
    return EasyEdit.getURLFromString(a.attribute("web_path")).url + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + a.id + "&SQ_BACKEND_PAGE=main&sq_link_path=&sq_asset_path=&asset_ei_screen=workflow"
  },
  save: function(a) {
    var b = jQuery("#main_form textarea"),
      c = b.val();
    if (!0 === b.hasClass("sq-requires-userlog") &&
      (jQuery(this.containerId).find(".fieldWarning").remove(), null !== /^\s*$/g.exec(c))) {
      var d = jQuery(EasyEdit.tmpl.render("simple_tag", {
        "class": "fieldWarning",
        content: EasyEditLocalise._("Please enter a log message"),
        tag: "span"
      }));
      b.after(d);
      b.unbind("keyup change").bind("keyup change", function() {
        null !== /^\s*$/g.exec(b.val()) ? d.show() : d.hide()
      });
      return !1
    }
    $statusSelect = jQuery('#main_form select[id$="_change_status"]');
    EasyEditAssetManager.getCurrentAsset(function(b) {
      EasyEditOverlay.showOverlay("loading");
      var c = $statusSelect.val(),
        d = jQuery("option", $statusSelect).length;
      0 !== c && 1 <= d && (d = jQuery('#main_form input[id$="_change_status_all_children"]').is(":checked"), b.setStatus(c, d));
      $statusSelect.val(0);
      c = new EasyEditSimpleEditRequest({
        backend_assetid: b.id,
        assetid: b.id,
        screen: "workflow"
      });
      c.setParamsFromElement(jQuery("#main_form"));
      c.setParam("ees_content_no_filter", "1");
      c.send(function() {
        b.acquireLock("all", function() {
          b.save(function(c) {
            var d = EasyEdit.filterErrorArray(c),
              f = d.length >= 1 ? false : true;
            b.refreshAttributes(function() {
              a.apply(this, [f, d, {
                refresh: true
              }])
            })
          })
        })
      })
    })
  },
  _buildWorflowSections: function(a) {
    var b = "",
      c = "",
      d = jQuery("<div>" + a + "</div>"),
      a = d.find('select[id$="_change_status"]').parent(),
      e = d.find('textarea[id$="_log_message"]').parent(),
      f = d.find('td.sq-limbo-field:contains("Logs")').next().find("table:eq(0)"),
      g = d.find("table.sq-backend-section-table:eq(1)"),
      j = a.find('option:contains("Reject"),option:contains("Approve"),option:contains("Safe")').length,
      d = d.find(".sq-backend-data .sq-backend-warning");
    d.length && EasyEditScreens.displayWarning({
      message: d.html(),
      buttonId: "ees_warningMetadata",
      buttonText: "Go to metadata screen",
      bindFn: function() {
        EasyEditScreens.switchScreen("metadataDefault")
      }
    });
    !j && g.length && (c = "<p>" + EasyEditLocalise._("This item is in workflow but you do not have permission to approve/reject it. Review the %1Workflow Summary%2 table below for more information.", '<a href="#summaryTable">', "</a>") + "</p>");
    g.length || (c = "<p>" + EasyEditLocalise._("Not currently in workflow") + ".</p>");
    b += '<h3 class="sectionHeading">' + EasyEditLocalise._("Workflow Status") +
      '</h3><div id="ees_runningWorkflows" class="workflowSection">';
    "" !== c && (b += c);
    j && (b += '<table border="0" cellpadding="0" cellspacing="0"><tr><td class="sq-limbo-field" valign="top">' + EasyEditLocalise._("Change Status") + "?</td><td>" + a.html() + '</td></tr><tr><td class="sq-limbo-field" valign="top">' + EasyEditLocalise._("Log Message") + '</td><td class="sq-backend-fineprint">' + e.html() + "</td></tr></table>");
    b += "</div>";
    f.find('td a[href*="asset_ei_screen=logs"]').parents("tr:eq(0)").hide();
    f.find('td.sq-backend-table-header[colspan="3"]').addClass("subheading");
    f.find('td a[href*="asset_ei_screen=workflow"],[href*="asset_ei_screen=preview"]').each(function() {
      var a = $(this).attr("href");
      /(?=.*\/_admin)(?=.*am_section)(?=.*assetid)/g.test(a) && (EasyEditAssetManager.getCurrentAsset(function(b) {
        b = EasyEdit.getURLFromString(b.attribute("web_path")).url + "/" + EasyEdit.systemInfo.suffixes.edit + "?limbo_assetid=" + b.id + "&asset_ei_screen="; - 1 != a.indexOf("asset_ei_screen=workflow") ? b += "workflow" : -1 != a.indexOf("asset_ei_screen=preview") && (b += "preview");
        $globalUrl = b
      }), $(this).attr("href",
        $globalUrl))
    });
    b += '<h3 class="sectionHeading">' + EasyEditLocalise._("Workflow Logs") + '</h3><div id="ees_workflowLogs" class="workflowSection">';
    b = f.length ? b + ('<table border="0" cellpadding="0" cellspacing="0">' + f.html() + "</table>") : b + ("<p>" + EasyEditLocalise._("No workflow logs available.") + "</p>");
    b += "</div>";
    g.find("img.sq-icon").hide();
    g.find('td.sq-limbo-section-subheading:contains("Summary")').parent().hide();
    g.find("td.sq-limbo-section-subheading").addClass("subheading");
    g.find("tr:eq(1) td:first").addClass("clearPadding");
    g.find("table").attr({
      border: "0",
      cellpadding: "0",
      cellspacing: "0"
    });
    b += '<h3 class="sectionHeading">' + EasyEditLocalise._("Workflow Summary") + '</h3><div id="ees_workflowSummary" class="workflowSection">';
    b = g.length ? b + ('<table border="0" cellpadding="0" cellspacing="0" id="summaryTable">' + g.html() + "</table>") : b + ("<p>" + EasyEditLocalise._("Not currently in workflow") + ".</p>");
    return b + "</div>"
  }
};
EasyEditScreens.assetTypes.news_item = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsNewsItem",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Content: {
        objectName: "contentNewsItem",
        className: "content",
        displayName: EasyEditLocalise._("Content"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId ||
      delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.contentNewsItem = {
  containerId: null,
  viper: null,
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(a) {
      e.queue("getKeywordsReplacements", {
        asset_id: a.id,
        keywords_array: ["%details-S_edit_contents%"]
      });
      e.expect(1).run(function(e) {
        var e = jQuery(e[0].data["details-S_edit_contents"]["details-S_edit_contents"]),
          j = e.find('div[id$="_contents_div"]');
        j.length || (j = e.find("td.sq-backend-data"), b = !0);
        var h = jQuery.map(j, function(a) {
            return {
              content: $(a).html(),
              data_keywords: $(a).attr("data-keywords"),
              data_snippets: $(a).attr("data-snippets")
            }
          }),
          j = jQuery(d.containerId),
          k = j.find("#ees_viperContentWrapper");
        h.length ? (h[0].heading = EasyEditLocalise._("Summary"), h[1].heading = EasyEditLocalise._("Body"), h[0].assetid = a.id, h[1].assetid = a.id, h = jQuery(EasyEdit.tmpl.render("news_content", {
            wrapper_id: "ees_viperContentWrapper",
            container_id: "ees_viperContent",
            editing_divs: h
          })), k.length ? k.replaceWith(h) : j.append(h), e = e.find("textarea"), e.hide(), h.append(e), jQuery("#ees_viperContentWrapper").addClass("withViper"),
          b || d._attachEvents()) : k.length ? k.replaceWith(e) : j.append(e);
        c.call(this)
      })
    })
  },
  _attachEvents: function() {
    var a = jQuery(this.containerId).find(".bodycopy_content");
    this.viper = EasyEdit.loadViper({
      editableDivs: a
    })
  },
  save: function(a) {
    var b = this,
      c = [],
      d = {},
      e = jQuery(b.containerId);
    EasyEditOverlay.showOverlay("loading");
    EasyEditAssetManager.getCurrentAsset(function(f) {
      var g = b.viper.getHtml(e.find(".bodycopy_content").get(0)),
        j = b.viper.getHtml(e.find(".bodycopy_content").get(1)),
        h = e.find("textarea:eq(0)").attr("id"),
        k = e.find("textarea:eq(1)").attr("id"),
        l = new EasyEditSimpleEditRequest({
          backend_assetid: f.id,
          assetid: f.id,
          screen: "details"
        });
      l.setParam(h, g);
      l.setParam(k, j);
      l.setParam("ees_content_no_filter", "1");
      l.send(function() {
        f.acquireLock("all", function() {
          a.apply(this, [!0, c, d])
        })
      })
    })
  },
  cleanUp: function() {
    null !== this.viper && (this.viper.destroy(), this.viper = null)
  }
};
EasyEditScreens.screen.detailsNewsItem = {
  containerId: null,
  sliders: {},
  linkPicker: null,
  validationRules: {
    ees_inputHeadline: {
      required: !0
    }
  },
  init: function(a, b, c) {
    var d = this;
    d.validator = null;
    d.containerId = a;
    var e = new EasyEditAPI;
    EasyEditAssetManager.getCurrentAsset(function(f) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(f, function(g) {
        d._getDetailsHTML(f, function(j) {
          var h = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(f),
            j = '<div id="ees_editDetails">' + g + j + h + "</div>",
            h = jQuery(d.containerId),
            k = h.find("#ees_editDetails");
          k.length ? k.replaceWith(j) : h.append(j);
          j = f.attributes();
          jQuery("#ees_inputHeadline").val(j.hasOwnProperty("name") ? j.name : "");
          jQuery("#ees_inputContactName").val(j.hasOwnProperty("contact_name") ? j.contact_name : "");
          jQuery("#ees_inputContactPhone").val(j.hasOwnProperty("contact_phone") ? j.contact_phone : "");
          jQuery("#ees_linkURL").val(j.hasOwnProperty("link_url") ? j.link_url : "");
          jQuery("#ees_linkSuffix").val(j.hasOwnProperty("url_suffix") ? j.url_suffix : "");
          h = {
            show_headline: "ees_displayHeadline",
            show_summary: "ees_displaySummary",
            show_body: "ees_displayBody",
            show_contact_name: "ees_displayContactName",
            show_contact_phone: "ees_displayContactPhone"
          };
          for (attrName in h) b ? jQuery("#" + h[attrName]).text(j.hasOwnProperty(attrName) && 1 === Number(j[attrName]) ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No")) : (d.sliders[attrName] = new EasyEditSlider({
            bindElem: "#" + h[attrName],
            defaultVal: j.hasOwnProperty(attrName) && 1 === Number(j[attrName]) ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No"),
            options: [
              [EasyEditLocalise._("Yes"),
                EasyEditLocalise._("Show this item"),
                function() {}
              ],
              [EasyEditLocalise._("No"), EasyEditLocalise._("Hide this item"), function() {}]
            ]
          }), d.sliders[attrName].events.observe("change", function() {
            EasyEditComponentsToolbar.enableSaveButton()
          }));
          var j = jQuery("#ees_linkPicker").attr("data-assetid"),
            l = {
              bindElem: "#ees_linkPicker",
              rootNode: f.id,
              bindFn: function(a) {
                a ? jQuery("#ees_linkPicker").attr("data-new-assetid", a.id) : jQuery("#ees_linkPicker").attr("data-new-assetid", 0);
                EasyEditComponentsToolbar.enableSaveButton()
              }
            };
          "0" !== "" + j ? e.queue("getGeneral", {
            asset_id: j
          }).run(function(a) {
            EasyEdit.isset(a[0]) && a[0].hasOwnProperty("data") && !EasyEdit.isError(a[0].data) && (b ? (a = {
              asset: a[0].data,
              status: {
                className: a[0].data.status.replace(/\s/g, "").toLowerCase(),
                description: EasyEditLocalise._("Status") + ": " + a[0].data.status
              }
            }, jQuery("#ees_linkPicker").html(EasyEdit.tmpl.render("asset_info", a)), jQuery("#ees_linkPicker").find("a.ees_assetInfo").click(function(a) {
              a.preventDefault();
              EasyEditOverlay.showOverlay("loading");
              a = parseFloat(jQuery(this).find(".assetId").text().replace("#",
                ""));
              EasyEditAssetManager.getAsset(a, function(a) {
                EasyEdit.redirect({
                  asset: a
                })
              })
            })) : (l.prefillNode = {
              assetid: a[0].data.id,
              name: a[0].data.name,
              type_code: a[0].data.type_code,
              type: a[0].data.type
            }, d.linkPicker = new EasyEditAssetPicker(l)))
          }) : !b && EasyEdit.isset(l) && (d.linkPicker = new EasyEditAssetPicker(l));
          EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c)
        })
      })
    })
  },
  save: function(a) {
    var b = jQuery("#ees_inputHeadline");
    if (!this.hasOwnProperty("validator") || null === this.validator) {
      this.validator = new EasyEditValidationController;
      var c = new EasyEditValidationErrorInline({
        element: b
      });
      this.validator.addTest(b, {
        required: {
          args: null,
          message: EasyEditLocalise._("A headline is required.")
        }
      }, c)
    }
    this.validator.valid() || !b.length ? (EasyEditOverlay.showOverlay("loading"), this._doSave(function(b, c) {
      EasyEditAssetManager.getCurrentAsset(function(f) {
        f.acquireLock("all", function() {
          a.apply(this, [b, c, {
            refresh: !0
          }])
        })
      })
    })) : ($warnings = jQuery(".fieldWarning"), 0 < $warnings.length && EasyEditComponents.scrollIntoView($warnings[0]))
  },
  _doSave: function(a) {
    var b =
      this,
      c = new EasyEditAPI;
    EasyEditAssetManager.getCurrentAsset(function(d) {
      var e = !1,
        f = {
          name: "ees_inputHeadline",
          contact_name: "ees_inputContactName",
          contact_phone: "ees_inputContactPhone",
          link_url: "ees_linkURL",
          url_suffix: "ees_linkSuffix"
        };
      for (attrName in f) {
        var g = jQuery("#" + f[attrName]).val();
        g !== d.attribute(attrName) && jQuery("#" + f[attrName]).length && (e = !0, d.attribute(attrName, g))
      }
      f = {
        show_headline: "ees_displayHeadline",
        show_summary: "ees_displaySummary",
        show_body: "ees_displayBody",
        show_contact_name: "ees_displayContactName",
        show_contact_phone: "ees_displayContactPhone"
      };
      for (attrName in f) b.sliders[attrName] && (g = b.sliders[attrName].getSelected() === EasyEditLocalise._("Yes") ? 1 : 0, g !== d.attribute(attrName) && (e = !0, d.attribute(attrName, g)));
      var f = "" + jQuery("#ees_linkPicker").attr("data-assetid"),
        g = jQuery("#ees_linkPicker").attr("data-new-assetid"),
        g = void 0 === g ? f : "" + g,
        j = null,
        h = null;
      if (g && f !== g && (0 !== Number(f) && (j = {
          parent_id: d.id,
          child_id: f,
          link_type: "SQ_LINK_NOTICE",
          link_value: "link_asset"
        }, e = !0), 0 !== Number(g))) h = {
        parent_id: d.id,
        child_id: g,
        link_type: 8,
        link_value: "link_asset",
        sort_order: 0,
        is_dependant: 0,
        is_exclusive: 0
      }, e = !0;
      EasyEditScreens.screen.detailsDefault.checkStatus(d, function(b) {
        EasyEditScreens.screen.detailsDefault.saveFutureStatus(function() {
          EasyEditScreens.screen.detailsDefault.saveThumbnail(function() {
            if (b || e) {
              var f = function() {
                d.save(function(b) {
                  b = EasyEdit.filterErrorArray(b);
                  a.apply(this, [1 <= b.length ? !1 : !0, b])
                })
              };
              h || j ? (j && c.queue("removeLink", j), h && c.queue("createLink", h), c.run(function(a) {
                for (var b = !0, c = 0; c <
                  a.length; c++)
                  if (!a[c].hasOwnProperty("data") || EasyEdit.isError(a[c].data)) {
                    b = !1;
                    break
                  }!0 === b && f()
              })) : f()
            } else a.apply(this, [!0, []])
          })
        })
      })
    })
  },
  _getDetailsHTML: function(a, b) {
    var c = this;
    (new EasyEditAPI).queue("getKeywordsReplacements", {
      asset_id: a.id,
      keywords_array: ["%details-S_link%"]
    }).run(function(d) {
      d = d[0];
      if (d.hasOwnProperty("data") && !EasyEdit.isError(d.data)) {
        var e = jQuery(d.data["details-S_link"]["details-S_link"]),
          f = e.find('input[id$="_link_assetid[assetid]"]'),
          d = 0;
        0 < f.length ? d = f.val() : (f = e.find('span[id$="_link_assetid_readonly"] .sq-info-assetid'),
          0 < f.length && (d = f.text()));
        a.attributes();
        e = '<h3 class="sectionHeading">' + EasyEditLocalise._("News Information") + '</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label for="ees_inputHeadline" class="inputLabel">' + EasyEditLocalise._("Headline") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputHeadline" name="ees_inputHeadline" class="inputText" value="" /> &nbsp;</div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputContactName" class="inputLabel">' +
          EasyEditLocalise._("Contact Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputContactName" name="ees_inputContactName" class="inputText" value="" /> &nbsp;</div></div><div class="row"><div class="cellName alignLeft"><label for="ees_inputContactPhone" class="inputLabel">' + EasyEditLocalise._("Contact Phone") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputContactPhone" name="ees_inputContactPhone" class="inputText" value="" /> &nbsp;</div></div></div>';
        e += '<h3 class="sectionHeading">' + EasyEditLocalise._("Display") + '</h3><div id="ees_displayInformation"><div class="row"><div class="cellName alignLeft"><label for="ees_displayHeadline" class="inputLabel">' + EasyEditLocalise._("Show Headline") + '</label></div><div class="cellData alignLeft"><div id="ees_displayHeadline"></div></div></div><br/><div class="row"><div class="cellName alignLeft"><label for="ees_displaySummary" class="inputLabel">' + EasyEditLocalise._("Show Summary") + '</label></div><div class="cellData alignLeft"><div id="ees_displaySummary"></div></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_displayBody" class="inputLabel">' +
          EasyEditLocalise._("Show Body") + '</label></div><div class="cellData alignLeft"><div id="ees_displayBody"></div></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_displayContactName" class="inputLabel">' + EasyEditLocalise._("Show Contact Name") + '</label></div><div class="cellData alignLeft"><div id="ees_displayContactName"></div></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_displayContactPhone" class="inputLabel">' + EasyEditLocalise._("Show Phone Number") +
          '</label></div><div class="cellData alignLeft"><div id="ees_displayContactPhone"></div></div></div><div class="notes">' + EasyEditLocalise._('Selecting "%1" for an item above will make that item display in the News Item\'s default contents.', EasyEditLocalise._("Yes")) + " " + EasyEditLocalise._("All item contents are always available through attribute keywords.") + "</div></div>";
        e += '<h3 class="sectionHeading">' + EasyEditLocalise._("Related Link") + '</h3><div id="ees_linkInformation"><div class="row"><div class="cellName alignLeft"><label for="ees_linkURL" class="inputLabel">' +
          EasyEditLocalise._("URL") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_linkURL" name="ees_linkURL" class="inputText" value="" /> &nbsp;</div></div><div class="row"><div class="cellName alignLeft"><label for="ees_linkPicker" class="inputLabel">' + EasyEditLocalise._("Asset") + '</label></div><div class="cellData alignLeft"><div id="ees_linkPicker" data-assetid="' + d + '"></div></div></div><div class="row"><div class="cellName alignLeft"><label for="ees_linkSuffix" class="inputLabel">' +
          EasyEditLocalise._("Query String Suffix") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_linkSuffix" name="ees_linkSuffix" class="inputText" value="" /> &nbsp;</div></div><div class="notes">' + EasyEditLocalise._("You may associate one asset or URL with a News Item.") + " " + EasyEditLocalise._("If both are specified, the asset takes precedence.") + "<br/>" + EasyEditLocalise._("If no Related Link is specified, the URL used in link keywords will be that of the News Item itself.") +
          "</div></div>";
        b.call(c, e)
      }
    })
  }
};
EasyEditScreens.assetTypes.excel_doc = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
BodycopyDivCode = function(a) {
  this.events = new ObservableEvents(this, ["change", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.$container = null
};
BodycopyDivCode.prototype.getFriendlyContainerName = function() {
  return EasyEditLocalise._("Code Content Container")
};
BodycopyDivCode.prototype.queueSave = function(a, b) {
  this.$container.find("input,textarea,select").each(function() {
    var b = "";
    switch ($(this).attr("type")) {
      case "radio":
        $(this).is(":checked") && a.setParam($(this).attr("name"), $(this).attr("value"));
        break;
      case "checkbox":
        $(this).is(":checked") && a.setParam($(this).attr("name"), 1);
        break;
      default:
        b = $(this).val(), a.setParam($(this).attr("name"), EasyEdit.fixHtml(b))
    }
  });
  a.setParam("bodycopy_saved[bodycopy_" + b.bodycopyId + "][" + this.id + "]", "");
  this.events.trigger("save_queued");
  return a
};
BodycopyDivCode.prototype.render = function(a) {
  var b = this;
  b.$container = a;
  a = jQuery("<div />");
  jQuery(b.attribute("raw_content")).appendTo(a);
  var c = a.find("textarea");
  c.removeAttr("style");
  c.bind("change", function() {
    b.events.trigger("change")
  });
  b.$container.append(c);
  b.$container.append(a.find("table.sq-backend-table"));
  b.events.trigger("render")
};
EasyEditScreens.assetTypes.thumbnail = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsImage",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.analyticsDefault = new function() {
  this.containerId = null;
  this.sliders = {};
  this.subScreens = {};
  this.current = {
    asset: null,
    isView: !1,
    months: 1,
    subScreen: "summary"
  };
  var a = this,
    b = 0,
    c = [1, 3, 6],
    d = ["summary", "traffic", "audience", "goals"],
    e = null,
    f = function(a) {
      return !1 === a instanceof EasyEditAsset ? null : localStorage.getItem("analytics.cachedUrl")
    },
    g = function(a, b) {
      !0 === a instanceof EasyEditAsset && localStorage.setItem("analytics.cachedUrl", b)
    },
    j = function(a, b) {
      var c = f(a),
        d = document.createElement("select");
      d.id = "ees_analyticsUrlSelector";
      for (var e = 0; e < b.length; e++) {
        var g = document.createElement("option");
        g.setAttribute("value", b[e]);
        (c === b[e] || null === c && 0 === e) && g.setAttribute("selected", "selected");
        EasyEdit.util.setText(g, b[e]);
        d.appendChild(g)
      }
      return d
    },
    h = function(b, c) {
      var d = jQuery(c).find("select");
      d.on("change", null, function() {
        var c = d.val();
        g(b, c);
        a.getReport();
        EasyEditComponentsToolbar.disableSaveButton()
      })
    };
  this.init = function(b, c, d) {
    a.containerId = b;
    b = [];
    b.push(function(b) {
      var c = new EasyEditAPI;
      EasyEditAssetManager.getCurrentAsset(function(d) {
        a.current.asset = d;
        a.current.isView = !1;
        "google_analytics_view" === d.attribute("type_code") && (a.current.isView = !0);
        var e = null,
          k = f(d);
        if (!1 === a.current.isView) {
          var l = a.current.asset.attribute("urls"),
            e = null === k ? "undefined" == typeof l[0] ? null : l[0] : EasyEditUrl.getClosestAssetUrl(l, k);
          g(d, e);
          b(d, l)
        } else c.queue("getParents", {
          asset_id: d.id,
          levels: 0,
          type_codes: ["site"]
        }).expect(1).run(function(a) {
          var c = [];
          if (!a[0].errorCode && !a[0].data.error)
            for (var f = 0; f < a[0].data.length; f++)
              for (var l =
                  0; l < a[0].data[f].urls.length; l++) c.push(a[0].data[f].urls[l]);
          e = k === null ? typeof c[0] == "undefined" ? null : c[0] : EasyEditUrl.getClosestAssetUrl(c, k);
          g(d, e);
          b(d, c)
        })
      })
    });
    b.push(function(b, c, e) {
      b = a.getBaseInterface();
      c = document.createElement("div");
      c.id = "ees_editAnalytics";
      var f = document.createElement("div");
      f.className = "sectionHeading";
      var k = document.createElement("span");
      k.id = "ees_editAnalyticsPageTitle";
      EasyEdit.util.setText(k, "Statistics");
      f.appendChild(k);
      k = document.createElement("div");
      k.id = "ees_analyticsReportPeriodText";
      k.className = "alignRight";
      f.appendChild(k);
      var g = null,
        k = null,
        k = document.createElement("div");
      k.id = "ees_analyticsUrlSelectorRow";
      k.className = "row clearfix";
      g = document.createElement("div");
      g.className = "ees_analyticsHeaderLabel";
      EasyEdit.util.setText(g, EasyEditLocalise._("URL") + ":");
      k.appendChild(g);
      1 < e.length ? g = j(a.current.asset, e) : (g = document.createElement("div"), g.className = "ees_analyticsUrlSingle", EasyEdit.util.setText(g, e[0]));
      k.appendChild(g);
      e = document.createElement("div");
      e.className = "ees_analyticsGoalsNoUrlLabel";
      EasyEdit.util.setText(e, EasyEditLocalise._("The Goals screen is based upon all data within the View."));
      k.appendChild(e);
      e = document.createElement("div");
      e.className = "ees_analyticsExperimentsNoUrlLabel";
      EasyEdit.util.setText(e, EasyEditLocalise._("The Experiments screen is based upon all data within the View."));
      k.appendChild(e);
      e = document.createElement("button");
      e.setAttribute("type", "button");
      e.id = "ees_analyticsRefreshButton";
      e.className = "guiButton light alignRight";
      EasyEdit.util.setText(e, EasyEditLocalise._("Refresh"));
      k.appendChild(e);
      jQuery(e).on("click", null, function() {
        a.showLoadingScreen();
        a.refreshQueryData(function(a, b) {
          document.getElementById("ees_analyticsReportContents").innerHTML = "<div><p>" + EasyEditLocalise._("Gathering analytics data; please wait...") + " (" + EasyEdit.util.formatNumber(a / b * 100, 0) + "%)</p></div>"
        }, function() {
          a.getReport()
        })
      });
      e = document.createElement("div");
      e.id = "ees_analyticsDataAgeValue";
      e.className = "alignRight";
      EasyEdit.util.setText(e, "N/A");
      k.appendChild(e);
      e = document.createElement("div");
      e.id = "ees_analyticsDataAgeLabel";
      e.className = "alignRight";
      EasyEdit.util.setText(e, EasyEditLocalise._("Generated") + ":" + String.fromCharCode(160));
      k.appendChild(e);
      e = document.createElement("div");
      e.id = "ees_analyticsReportContents";
      c.appendChild(b);
      c.appendChild(f);
      k && c.appendChild(k);
      c.appendChild(e);
      document.querySelector(a.containerId).appendChild(c);
      a.attachSliders();
      k && h(a.current.asset, k);
      EasyEditOverlay.hideOverlay("loading");
      a.getReport();
      d.call(a)
    });
    EasyEdit.util.async.series(b)
  };
  this.detectScreenEdits =
    function() {
      EasyEditComponentsToolbar.disableSaveButton();
      var a = jQuery("#ees_screenContent");
      jQuery("input,select,textarea", a).bind("change keyup", function(a) {
        "ees_analyticsUrlSelector" !== a.currentTarget.id && EasyEditComponentsToolbar.enableSaveButton()
      })
    };
  this.showLoadingScreen = function() {
    var a = document.getElementById("ees_analyticsReportContents");
    a.innerHTML = "<div><p>" + EasyEditLocalise._("Gathering analytics data; please wait...") + "</p></div>";
    a.className = "status-loading"
  };
  this.hideLoadingScreen =
    function() {
      var a = document.getElementById("ees_analyticsReportContents");
      a.innerHTML = "";
      jQuery(a).removeClass("status-loading")
    };
  this.getGoals = function(b, c) {
    var d = new EasyEditAPI,
      f = [];
    !0 === c && (e = null);
    null !== e && b(e);
    f.push(function(b) {
      d.queue("getGoogleAnalyticsGoals", {
        assetid: a.getViewId()
      });
      d.run(b, d.runMode.BATCH)
    });
    f.push(function(a, c) {
      goals = c[0].data;
      for (var d = 0; d < goals.length; d++) {
        var e = EasyEditLocalise._("Unknown Type");
        switch (goals[d].type) {
          case "URL_DESTINATION":
            e = !0 === goals[d].urlDestinationDetails.firstStepRequired &&
              0 < goals[d].urlDestinationDetails.steps.length ? EasyEditLocalise._("Destination (Funnel)") : EasyEditLocalise._("Destination");
            break;
          case "VISIT_NUM_PAGES":
            e = EasyEditLocalise._("Page Depth");
            break;
          case "VISIT_TIME_ON_SITE":
            e = EasyEditLocalise._("Session Duration");
            break;
          case "EVENT":
            e = EasyEditLocalise._("Event Tracking")
        }
        goals[d].sqTypeName = e
      }
      b(goals)
    });
    EasyEdit.util.async.series(f)
  };
  this.getBaseInterface = function() {
    var a = document.createElement("div");
    a.id = "ees_editAnalyticsHeader";
    var b = document.createElement("div");
    b.className = "clearfix";
    var c = document.createElement("div");
    c.className = "row alignLeft";
    var d = document.createElement("div");
    d.id = "ees_analyticsReportType";
    d.className = "alignLeft";
    c.appendChild(d);
    b.appendChild(c);
    c = document.createElement("div");
    c.className = "row alignRight";
    d = document.createElement("div");
    d.className = "alignLeft ees_analyticsHeaderLabel";
    c.appendChild(d);
    d = document.createElement("div");
    d.id = "ees_analyticsReportPeriod";
    d.className = "alignLeft";
    c.appendChild(d);
    b.appendChild(c);
    a.appendChild(b);
    return a
  };
  this.attachSliders = function() {
    a.sliders.reportPeriod = new EasyEditSlider({
      bindElem: "#ees_analyticsReportPeriod",
      defaultVal: EasyEditLocalise._("1"),
      options: [
        [EasyEditLocalise._("1"), EasyEditLocalise._("Show statistics for the previous month"), function() {}],
        [EasyEditLocalise._("3"), EasyEditLocalise._("Show statistics for the previous 3 months"), function() {}],
        [EasyEditLocalise._("6"), EasyEditLocalise._("Show statistics for the previous 6 months"), function() {}]
      ]
    });
    a.sliders.reportPeriod.events.observe("change",
      function() {
        a.current.months = c[a.sliders.reportPeriod.getSelectedIndex()];
        a.getReport()
      });
    for (var b = d.map(function(b) {
        var c = !0;
        !0 === EasyEdit.util.isFunction(a.subScreens[b].showIf) && (c = a.subScreens[b].showIf());
        return !0 === c ? [a.subScreens[b].name, EasyEditLocalise._("Switch to the %1 sub-screen", a.subScreens[b].name), function() {
          a.current.subScreen = b;
          a.getReport()
        }] : null
      }), e = 0; e < b.length; e++) null === b[e] && (b.splice(e, 1), e--);
    a.sliders.reportType = new EasyEditSlider({
      bindElem: "#ees_analyticsReportType",
      defaultVal: a.subScreens[d[0]].name,
      options: b
    })
  };
  this.getReport = function() {
    var b = jQuery(".ees_analyticsHeaderLabel, #ees_analyticsUrlSelector, .ees_analyticsUrlSingle"),
      c = jQuery(".ees_analyticsGoalsNoUrlLabel"),
      d = jQuery(".ees_analyticsExperimentsNoUrlLabel");
    switch (a.current.subScreen) {
      case "summary":
      case "audience":
      case "traffic":
        jQuery(b).show().removeClass("hidden");
        jQuery(c).hide().addClass("hidden");
        jQuery(d).hide().addClass("hidden");
        break;
      case "goals":
        jQuery(b).hide().addClass("hidden");
        jQuery(c).show().removeClass("hidden");
        jQuery(d).hide().addClass("hidden");
        break;
      case "experiments":
        jQuery(b).hide().addClass("hidden"), jQuery(c).hide().addClass("hidden"), jQuery(d).show().removeClass("hidden")
    }
    a.showLoadingScreen();
    EasyEdit.util.setText(document.getElementById("ees_editAnalyticsPageTitle"), a.subScreens[a.current.subScreen].pageTitle);
    a.subScreens[a.current.subScreen].show.call(a, a.current.asset, a.current.months)
  };
  this.save = function() {
    a.subScreens[this.current.subScreen].save && a.subScreens[this.current.subScreen].save.call(this)
  };
  this._buildHelpRollover = function(a, c) {
    var d = document.createElement("span");
    d.className = "helpRollover";
    d.id = "ees_analyticsHelpIcon" + b;
    var e = EasyEdit.tip.create({
      targetId: d.id,
      containerId: "ees_analyticsHelpIconTooltip" + b,
      position: "south",
      title: null,
      message: a,
      buttons: c,
      className: "analyticsHelpTooltip"
    });
    b++;
    jQuery(e.$element).on("mouseenter", null, function() {
      e.show();
      var a = e.$element.offset();
      a.top -= 2.5;
      a.left -= 5;
      e.$element.offset(a)
    });
    jQuery(e.$element).on("mouseleave", null, function() {
      e.hide()
    });
    jQuery(d).on("mouseenter",
      null,
      function(a) {
        e.$target = jQuery(a.target);
        e.show();
        a = e.$element.offset();
        a.top -= 2.5;
        a.left -= 5;
        e.$element.offset(a)
      });
    jQuery(d).on("mouseleave", null, function() {
      e.hide()
    });
    return d
  };
  this._buildPlainSummaryUnit = function(a, b, c, d) {
    var e = document.createElement("div");
    e.className = "summaryUnit";
    var f = document.createElement("div");
    f.className = "titleDiv";
    EasyEdit.util.setText(f, a);
    if (3 <= arguments.length) {
      var g = this._buildHelpRollover(c, d);
      f.appendChild(g)
    }
    e.appendChild(f);
    e.appendChild(b);
    return e
  };
  this._buildBarGraph =
    function(b, c, d) {
      !1 === d.hasOwnProperty("tooltip") && (d.tooltip = null);
      !1 === d.hasOwnProperty("xAxisMarks") && (d.xAxisMarks = function() {
        return false
      });
      !1 === d.hasOwnProperty("tickFormat") && (d.tickFormat = function(a) {
        return a > 1E7 ? Math.floor(a / 1E6) + "M" : a > 1E6 ? Math.floor(a / 1E5) / 10 + "M" : a > 1E4 ? Math.floor(a / 1E3) + "k" : a
      });
      !1 === d.hasOwnProperty("tooltipWidth") && (d.tooltipWidth = 250);
      !1 === d.hasOwnProperty("styles") && (d.styles = "chartColour1,chartColour2,chartColour3,chartColour4,chartColour5,chartColour6".split(","));
      !1 ===
        d.hasOwnProperty("dimensions") && (d.dimensions = {
          height: 200,
          barHeight: 190,
          width: 698,
          tickTextMargin: 30
        });
      !1 === d.hasOwnProperty("tooltip") && (d.tooltip = null);
      b.setAttribute("viewBox", "0 0 " + d.dimensions.width + " " + d.dimensions.height);
      b.setAttribute("preserveAspectRatio", "none");
      b.setAttribute("class", "chart");
      for (var e = 0, f = 0, g = [], h = 0; h < c.length; h++) {
        f = 0;
        if (c[h].length)
          for (var j = 0; j < c[h].length; j++) g.push([h, j, f, c[h][j]]), f += c[h][j];
        else g.push([h, 0, 0, c[h]]), f = c[h];
        f > e && (e = f)
      }
      h = a.util.tickValue(e);
      e = Math.ceil(e /
        h) * h;
      d3.select(b).selectAll("rect").data(g).enter().append("rect").attr("y", function(a) {
        return d.dimensions.barHeight - (a[2] + a[3]) * d.dimensions.barHeight / e
      }).attr("x", function(a) {
        return d.dimensions.tickTextMargin + (a[0] + 0.05) * ((d.dimensions.width - 2 * d.dimensions.tickTextMargin) / c.length)
      }).attr("height", function(a) {
        return a[3] * d.dimensions.barHeight / e
      }).attr("width", 0.9 * ((d.dimensions.width - 2 * d.dimensions.tickTextMargin) / c.length)).attr("class", function(a) {
        return d.styles instanceof Array ? d.styles[a[1]] :
          typeof d.styles === "function" ? d.styles(a[1]) : ""
      }).text(function(a) {
        return a[3]
      });
      g = a.util.svgEl("rect");
      g.setAttribute("x", 0);
      g.setAttribute("y", d.dimensions.barHeight);
      g.setAttribute("width", d.dimensions.width);
      g.setAttribute("height", 1);
      g.setAttribute("fill", "#555555");
      b.appendChild(g);
      for (g = h; g <= e; g += h) {
        f = a.util.svgEl("rect");
        f.setAttribute("x", 0);
        f.setAttribute("y", d.dimensions.barHeight * (1 - g / e));
        f.setAttribute("width", d.dimensions.width);
        f.setAttribute("height", 1);
        f.setAttribute("fill", "#888888");
        b.insertBefore(f, b.firstChild);
        f = a.util.svgEl("text");
        f.setAttribute("x", 0);
        f.setAttribute("y", d.dimensions.barHeight * (1 - g / e) + 12);
        f.setAttribute("font-family", "Helvetica, Arial");
        f.setAttribute("font-size", "11px");
        f.setAttribute("fill", "#888888");
        j = a.util.svgEl("text");
        j.setAttribute("x", d.dimensions.width);
        j.setAttribute("y", d.dimensions.barHeight * (1 - g / e) + 12);
        j.setAttribute("font-family", "Helvetica, Arial");
        j.setAttribute("font-size", "11px");
        j.setAttribute("fill", "#888888");
        j.setAttribute("text-anchor",
          "end");
        var q = d.tickFormat(g);
        EasyEdit.util.setText(f, q);
        EasyEdit.util.setText(j, q);
        b.appendChild(f);
        b.appendChild(j)
      }
      for (g = h / 2; g < e; g += h) f = a.util.svgEl("rect"), f.setAttribute("x", 0), f.setAttribute("y", d.dimensions.barHeight * (1 - g / e)), f.setAttribute("width", d.dimensions.width), f.setAttribute("height", 1), f.setAttribute("fill", "#cccccc"), b.insertBefore(f, b.firstChild);
      for (h = 0; h < c.length; h++) !0 === d.xAxisMarks(h) && (g = a.util.svgEl("circle"), g.setAttribute("cx", d.dimensions.tickTextMargin + (h + 0.5) * ((d.dimensions.width -
        2 * d.dimensions.tickTextMargin) / c.length)), g.setAttribute("cy", d.dimensions.barHeight + 5), g.setAttribute("r", 2.5), g.setAttribute("fill", "#cccccc"), b.appendChild(g));
      d.tooltip && (h = c.map(d.tooltip), a.util.hoverRect(b, d.dimensions, c.length, !1, "ees_analyticsGraphTooltip_" + Math.floor(1E6 * Math.random()), h, d.tooltipWidth))
    };
  this._buildPieGraph = function(b, c, d) {
    !1 === d.hasOwnProperty("styles") && (d.styles = "chartColour1,chartColour2,chartColour3,chartColour4,chartColour5,chartColour6,chartColour1 lessOpaque,chartColour2 lessOpaque,chartColour3 lessOpaque,chartColour4 lessOpaque,chartColour5 lessOpaque,chartColour6 lessOpaque".split(","));
    !1 === d.hasOwnProperty("dimensions") && (d.dimensions = {});
    !1 === d.dimensions.hasOwnProperty("radius") && (d.dimensions.radius = 30);
    !1 === d.dimensions.hasOwnProperty("innerRadius") && (d.dimensions.innerRadius = 0);
    var e = a.util.svgEl("g");
    b.setAttribute("viewBox", "0 0 " + 2 * d.dimensions.radius + " " + 2 * d.dimensions.radius);
    b.setAttribute("preserveAspectRatio", "none");
    b.setAttribute("class", "pieChart");
    b.setAttribute("width", 2 * d.dimensions.radius + "px");
    b.setAttribute("height", 2 * d.dimensions.radius + "px");
    e.setAttribute("transform",
      "translate(" + d.dimensions.radius + " " + d.dimensions.radius + ")");
    b.appendChild(e);
    var f = d3.svg.arc().innerRadius(d.dimensions.innerRadius).outerRadius(d.dimensions.radius),
      b = d3.layout.pie().sort(null).value(function(a) {
        return a
      });
    d3.select(e).selectAll("path").data(b(c)).enter().append("path").attr("d", function(a) {
      return f(a)
    }).attr("class", function(a, b) {
      return d.styles instanceof Array ? d.styles[b] : typeof d.styles === "function" ? d.styles(b) : ""
    }).text(function(a, b) {
      return EasyEdit.util.formatNumber(c[b],
        2) + "%"
    })
  };
  this._buildSmallList = function(b, c, d, e) {
    !0 !== e && (e = !1);
    b.className += " smallList";
    for (var f = 0; f < d; f++) {
      var g = document.createElement("div"),
        h = document.createElement("span");
      h.className = "name";
      var j = document.createElement("span");
      j.className = "value";
      f < c.length && (h.title = 2 < c[f].length ? c[f][2] : c[f][0], !0 === e ? h.innerHTML = c[f][0] : EasyEdit.util.setText(h, c[f][0]), EasyEdit.util.setText(j, a.util.abbrevStat(c[f][1])));
      g.appendChild(h);
      g.appendChild(j);
      b.appendChild(g)
    }
    return b
  };
  this._buildChangeSummaryUnit =
    function(b, c, d, e, f, g, h, j) {
      var q = document.createElement("div");
      q.className = "summaryUnit";
      var t = document.createElement("div");
      t.className = "titleDiv";
      EasyEdit.util.setText(t, b);
      if (6 <= arguments.length) {
        var w = this._buildHelpRollover(g, h);
        t.appendChild(w)
      }
      w = document.createElement("div");
      w.className = "valueDiv";
      c.nodeType ? w.appendChild(c) : w.innerHTML = c;
      var v = document.createElement("div"),
        u = document.createElement("span");
      v.className = "changeDiv";
      !0 === f && (v.className += " lowerBetter");
      var y = a.sliders.reportPeriod.getSelectedIndex();
      if (d === e) {
        var z = [EasyEditLocalise._("No change from previous month"), EasyEditLocalise._("No change from previous 3 months"), EasyEditLocalise._("No change from previous 6 months")];
        v.className += " steady";
        EasyEdit.util.setText(u, EasyEditLocalise._("steady"))
      } else if (d > e)
        if (v.className += f ? " worse" : " better", 0 === e) z = [EasyEditLocalise._("Increase from zero in the previous month"), EasyEditLocalise._("Increase from zero in the previous 3 months"), EasyEditLocalise._("Increase from zero in the previous 6 months")],
          EasyEdit.util.setText(u, EasyEditLocalise._("Infinity"));
        else {
          var x = 100 * (d / e - 1);
          10 > Math.round(10 * x) ? (z = [EasyEditLocalise._("%1% increase from previous month", EasyEdit.util.formatNumber(x, 1)), EasyEditLocalise._("%1% increase from previous 3 months", EasyEdit.util.formatNumber(x, 1)), EasyEditLocalise._("%1% increase from previous 6 months", EasyEdit.util.formatNumber(x, 1))], EasyEdit.util.setText(u, EasyEdit.util.formatNumber(x, 1) + "%")) : (z = [EasyEditLocalise._("%1% increase from previous month", EasyEdit.util.formatNumber(x,
            0)), EasyEditLocalise._("%1% increase from previous 3 months", EasyEdit.util.formatNumber(x, 0)), EasyEditLocalise._("%1% increase from previous 6 months", EasyEdit.util.formatNumber(x, 0))], EasyEdit.util.setText(u, EasyEdit.util.formatNumber(x, 0) + "%"))
        }
      else v.className += f ? " better" : " worse", x = 100 * (1 - d / e), 10 > Math.round(10 * x) ? (z = [EasyEditLocalise._("%1% decrease from previous month", EasyEdit.util.formatNumber(x, 1)), EasyEditLocalise._("%1% decrease from previous 3 months", EasyEdit.util.formatNumber(x, 1)),
        EasyEditLocalise._("%1% decrease from previous 6 months", EasyEdit.util.formatNumber(x, 1))
      ], EasyEdit.util.setText(u, EasyEdit.util.formatNumber(x, 1) + "%")) : (z = [EasyEditLocalise._("%1% decrease from previous month", EasyEdit.util.formatNumber(x, 0)), EasyEditLocalise._("%1% decrease from previous 3 months", EasyEdit.util.formatNumber(x, 0)), EasyEditLocalise._("%1% decrease from previous 6 months", EasyEdit.util.formatNumber(x, 0))], EasyEdit.util.setText(u, EasyEdit.util.formatNumber(x, 0) + "%"));
      v.setAttribute("title",
        z[y]);
      v.appendChild(u);
      q.appendChild(t);
      q.appendChild(w);
      q.appendChild(v);
      return q
    };
  this._createDrilldownSet = function(a) {
    for (var b = [], c = {}, d = {}, e = 0; e < a.detailData.length; e++) {
      var f = !0;
      a.filter && a.filter instanceof Function && (f = a.filter(a.detailData[e]));
      if (!0 === Boolean(f) && (f = "", f = a.majorDimension instanceof Function ? a.majorDimension(a.detailData[e]) : a.detailData[e][a.majorDimension], null !== f)) {
        if (!1 === c.hasOwnProperty(f)) {
          var g = b.length;
          c[f] = g;
          b[g] = {
            name: f,
            value: {},
            minorValues: {}
          };
          for (var h in a.detailData[e]) "number" ===
            typeof a.detailData[e][h] && (b[g].value[h] = a.detailData[e][h])
        } else
          for (h in g = c[f], a.detailData[e]) "number" === typeof a.detailData[e][h] && (b[g].value[h] += a.detailData[e][h]);
        for (h in a.detailData[e]) "number" === typeof a.detailData[e][h] && (d[h] = !0 === d.hasOwnProperty(h) ? d[h] + a.detailData[e][h] : a.detailData[e][h]);
        if (a.minorDimension && 0 < a.maxMinorRows && (minorValue = a.minorDimension instanceof Function ? a.minorDimension(a.detailData[e]) : a.detailData[e][a.minorDimension], null !== minorValue))
          if (b[g].minorValues[minorValue])
            for (h in a.detailData[e]) "number" ===
              typeof a.detailData[e][h] && (b[g].minorValues[minorValue][h] += a.detailData[e][h]);
          else b[g].minorValues[minorValue] = a.detailData[e]
      }
    }
    return {
      summary: d,
      detail: b
    }
  };
  this._buildDrilldownTable = function(a) {
    var b = this,
      c = document.createElement("table");
    c.id = a.id;
    c.className = "styled drilldown";
    var d = b.util.sessionStat();
    void 0 === a.sortColumn && (a.sortColumn = 1);
    void 0 === a.summaryName && (a.summaryName = !0 === b.current.isView ? EasyEditLocalise._("Site Total") : EasyEditLocalise._("Page Total"));
    void 0 === a.columns && (a.columns = [{
      title: "",
      stat: function(a) {
        return a.name
      },
      width: 38
    }, {
      title: EasyEditLocalise._("Sessions"),
      stat: d,
      width: 17,
      showPercent: !0
    }, {
      title: EasyEditLocalise._("Page Views"),
      stat: "ga:pageviews",
      width: 17,
      showPercent: !0
    }, {
      title: EasyEditLocalise._("Page Time"),
      stat: function(a) {
        return a.value["ga:pageviews"] === a.value["ga:exits"] ? null : a.value["ga:timeOnPage"] / (a.value["ga:pageviews"] - a.value["ga:exits"])
      },
      format: function(a) {
        return a === null ? EasyEditLocalise._("N/A") : b.util.formatTime(Math.round(a))
      },
      width: 14
    }, {
      title: EasyEditLocalise._("Bounce Rate"),
      stat: function(a) {
        return a.value[d] === 0 ? null : a.value["ga:bounces"] / a.value[d] * 100
      },
      format: function(a) {
        return a === null ? EasyEditLocalise._("N/A") : EasyEdit.util.formatNumber(a, 2) + "%"
      },
      width: 14
    }]);
    var e = this._createDrilldownSet(a);
    e.detail.sort(function(b, c) {
      var d = a.columns[a.sortColumn].stat;
      return d instanceof Function ? d(c) - d(b) : c.value[d] - b.value[d]
    });
    a.columns.map(function(a) {
      var b = document.createElement("col");
      b.setAttribute("width", a.width + "%");
      c.appendChild(b)
    });
    var f = document.createElement("tr");
    a.columns.map(function(a) {
      f.appendChild(b.util.cell(a.title, true))
    });
    var g = document.createElement("tr");
    g.className = "siteTotal";
    for (var h = 0; h < a.columns.length; h++) {
      var j = "",
        t;
      t = a.columns[h].stat instanceof Function ? a.columns[h].stat({
        name: a.summaryName,
        value: e.summary
      }) : e.summary[a.columns[h].stat];
      j = a.columns[h].format instanceof Function ? j + a.columns[h].format(t) : "number" === typeof t ? j + b.util.abbrevStat(t, 0) : j + t;
      g.appendChild(b.util.cell(j))
    }
    c.appendChild(f);
    c.appendChild(g);
    for (g = 0; g < Math.min(e.detail.length,
        a.maxMajorRows); g++) {
      var w = document.createElement("tr");
      w.className = "majorRow";
      for (h = 0; h < a.columns.length; h++) {
        j = "";
        !0 === a.columns[h].showPercent && (j += '<span class="alignLeft">');
        t = a.columns[h].stat instanceof Function ? a.columns[h].stat(e.detail[g]) : e.detail[g].value[a.columns[h].stat];
        j = a.columns[h].format instanceof Function ? j + a.columns[h].format(t) : "number" === typeof t ? j + b.util.abbrevStat(t, 0) : j + t;
        if (!0 === a.columns[h].showPercent) {
          var j = j + '</span><span class="alignRight percentStr">',
            v = a.columns[h].stat instanceof
          Function ? a.columns[h].stat({
            name: a.summaryName,
            value: e.summary
          }) : e.summary[a.columns[h].stat];
          0 < v && (j += EasyEdit.util.formatNumber(100 * (t / v), 2) + "%");
          j += "</span>"
        }
        w.appendChild(b.util.cell(j, !1, !0))
      }
      c.appendChild(w);
      var u = [],
        y;
      for (y in e.detail[g].minorValues) u.push({
        name: y,
        value: e.detail[g].minorValues[y]
      });
      u.sort(function(b, c) {
        var d = a.columns[a.sortColumn].stat;
        return d instanceof Function ? d(c) - d(b) : c.value[d] - b.value[d]
      });
      if (a.minorDimension && 0 < u.length && 0 < a.maxMinorRows) {
        w.className += " clickable";
        w.firstChild.innerHTML = '<span class="alignRight expand"></span>' + w.firstChild.innerHTML;
        for (w = 0; w < Math.min(u.length, a.maxMinorRows); w++) {
          y = u[w].name;
          var z = document.createElement("tr");
          z.className = "minorRow collapsed";
          for (var x = "", x = a.minorDimension instanceof Function ? a.minorDimension(e.detail[g].minorValues[y]) : e.detail[g].minorValues[y][a.minorDimension], h = 0; h < a.columns.length; h++) j = "", !0 === a.columns[h].showPercent && (j += '<span class="alignLeft">'), t = a.columns[h].stat instanceof Function ? a.columns[h].stat({
            name: x,
            value: e.detail[g].minorValues[y]
          }) : e.detail[g].minorValues[y][a.columns[h].stat], j = a.columns[h].format instanceof Function ? j + a.columns[h].format(t) : "number" === typeof t ? j + b.util.abbrevStat(t, 0) : j + t, !0 === a.columns[h].showPercent && (j += '</span><span class="alignRight percentStr">', v = a.columns[h].stat instanceof Function ? a.columns[h].stat({
            name: a.summaryName,
            value: e.summary
          }) : e.summary[a.columns[h].stat], 0 < v && (j += EasyEdit.util.formatNumber(100 * (t / v), 2) + "%"), j += "</span>"), z.appendChild(b.util.cell(j, !1, !0));
          c.appendChild(z)
        }
      }
    }
    jQuery(c).on("click", ".majorRow.clickable", function(a) {
      a = jQuery(a.target).parents("tr.majorRow");
      a.toggleClass("expanded");
      for (a = a[0].nextSibling; a !== null && a.className.indexOf("minorRow") !== -1;) {
        jQuery(a).toggleClass("collapsed");
        a = a.nextSibling
      }
    });
    return c
  };
  this._buildTrafficSourceGraph = function(b, c, d, e) {
    void 0 === d && (d = 12);
    var f = [];
    void 0 === e && (e = a.util.sessionStat());
    for (var g = 0; g < b.length; g++) {
      for (var h = b[g]["ga:medium"], j = !1, q = 0; q < f.length; q++)
        if (f[q].name === h) {
          f[q].value +=
            b[g][e];
          j = !0;
          break
        }!1 === j && f.push({
        name: h,
        value: b[g][e]
      })
    }
    f.sort(function(a, b) {
      return b.value - a.value
    });
    var t = 0;
    if (f.length > d) {
      b = f.splice(d - 1, f.length);
      for (g = 0; g < b.length; g++) t += b[g].value;
      f.push({
        name: EasyEditLocalise._("Other"),
        value: t
      })
    }
    g = a.util.svgEl("svg");
    a._buildPieGraph(g, f.map(function(a) {
      return a.value
    }), {
      dimensions: {
        radius: 50
      },
      styles: function(a) {
        var b = [];
        a === d - 1 && 0 < t ? b.push("chartColourEmpty") : (b.push("chartColour" + (a % 6 + 1)), 6 < a && b.push("lessOpaque"));
        return b.join(" ")
      }
    });
    c.insertBefore(g,
      c.firstChild.nextSibling)
  };
  this._buildTrafficSourceSummary = function(b, c, d, e, f) {
    void 0 === d && (d = 12);
    void 0 === e && (e = 6);
    var g = [];
    void 0 === f && (f = a.util.sessionStat());
    for (var h = {
        organic: EasyEditLocalise._("Organic search"),
        cpc: EasyEditLocalise._("Paid search"),
        ppc: EasyEditLocalise._("Paid search"),
        "(none)": EasyEditLocalise._("Direct"),
        referral: EasyEditLocalise._("Referrals"),
        social: EasyEditLocalise._("Social"),
        email: EasyEditLocalise._("Email")
      }, j = 0; j < b.length; j++) {
      var q = b[j]["ga:medium"],
        t = !1;
      h[q] && (q =
        h[q]);
      for (var w = 0; w < g.length; w++)
        if (g[w][0] === q) {
          g[w][1] += b[j][f];
          t = !0;
          break
        }!1 === t && g.push([q, b[j][f]])
    }
    g.sort(function(a, b) {
      return b[1] - a[1]
    });
    b = 0;
    if (g.length > d) {
      e = g.splice(d - 1, g.length);
      for (j = 0; j < e.length; j++) b += e[j].value;
      g.push([EasyEditLocalise._("Other"), b])
    } else g.length < d && (d = Math.max(e, g.length));
    for (j = 0; j < g.length; j++) e = ["bauble"], j === d - 1 && 0 < b ? e.push("chartColourEmpty") : (e.push("chartColour" + (j % 6 + 1)), 6 < j && e.push("lessOpaque")), g[j][2] = g[j][0], g[j][0] = '<span class="' + e.join(" ") + '"></span> ' +
      g[j][0];
    a._buildSmallList(c, g, d, !0);
    return d
  };
  this._buildTopCampaigns = function(b, c, d) {
    for (var e = [], f = a.util.sessionStat(), g = 0; g < b.length; g++) {
      switch (b[g]["ga:medium"]) {
        case "organic":
          e.push(["Search: " + EasyEdit.util.ucWords(b[g]["ga:source"]), b[g][f]]);
          break;
        case "cpc":
        case "ppc":
          e.push(["Paid search: " + EasyEdit.util.ucWords(b[g]["ga:source"]), b[g][f]]);
          break;
        case "feed":
          e.push(["Feed: " + EasyEdit.util.ucWords(b[g]["ga:source"]), b[g][f]]);
          break;
        case "email":
          e.push(["Email: " + EasyEdit.util.ucWords(b[g]["ga:source"]),
            b[g][f]
          ]);
          break;
        case "social":
          e.push(["Social: " + EasyEdit.util.ucWords(b[g]["ga:source"]), b[g][f]]);
          break;
        case "referral":
        case "(none)":
          break;
        default:
          e.push([EasyEdit.util.ucWords(b[g]["ga:medium"]) + ": " + EasyEdit.util.ucWords(b[g]["ga:source"]), b[g][f]])
      }
      if (e.length >= d) break
    }
    e.sort(function(a, b) {
      return b[1] - a[1]
    });
    a._buildSmallList(c, e, d);
    return c
  };
  this._buildTopInternalReferrers = function(b, c, d) {
    b.sort(function(a, b) {
      return b["ga:pageviews"] - a["ga:pageviews"]
    });
    for (var e = [], f = 0; f < Math.min(b.length,
        d); f++) e[f] = [b[f]["ga:previousPagePath"], b[f]["ga:pageviews"]];
    a._buildSmallList(c, e, d);
    return c
  };
  this._buildTopExternalReferrers = function(b, c, d) {
    for (var e = [], f = a.util.sessionStat(), g = 0; g < b.length; g++) "referral" === b[g]["ga:medium"] && e.push([b[g]["ga:source"], b[g][f]]);
    e.sort(function(a, b) {
      return b[1] - a[1]
    });
    a._buildSmallList(c, e, d);
    return c
  };
  this.refreshQueryData = function(b, c) {
    var d = [],
      e = ["all"],
      f = [];
    void 0 === c && (c = function() {});
    d.push(function(b) {
      var c = new EasyEditAPI;
      c.queue("getGoogleAnalyticsGoals", {
        assetid: a.getViewId()
      });
      c.queue("getGoogleAnalyticsExperiments", {
        assetid: a.getViewId()
      });
      c.expect(2).run(b, c.runMode.BATCH)
    });
    d.push(function(b, c) {
      for (var d = c[0].data, g = c[1].data, h = 0; h < d.length; h++) e.push(d[h].id);
      for (h = 0; h < g.length; h++) f.push(g[h].id);
      a.getBasicPageQuery(function(a) {
        b(a)
      })
    });
    d.push(function(d, f) {
      f.force_cache = !1;
      customQueries = [
        ["current", {
          canned_query: "current"
        }],
        ["previous", {
          canned_query: "previous"
        }],
        ["campaigns", {
          canned_query: "campaigns"
        }],
        ["previousPath", {
          canned_query: "previous_path"
        }],
        ["pagePath", {
          canned_query: "page_path"
        }],
        ["byDay", {
          canned_query: "by_day"
        }],
        ["device", {
          canned_query: "device"
        }],
        ["referralPages", {
          canned_query: "referral_pages"
        }],
        ["byDay", {
          canned_query: "by_day_alt"
        }],
        ["browser", {
          canned_query: "browser"
        }],
        ["os", {
          canned_query: "os"
        }],
        ["deviceDaily", {
          canned_query: "device_daily"
        }],
        ["location", {
          canned_query: "location"
        }],
        ["language", {
          canned_query: "language"
        }],
        ["orgs", {
          canned_query: "orgs"
        }]
      ];
      0 < e.length && (customQueries.push(["currentAll", {
        canned_query: "current",
        context: "all",
        url: null
      }]), customQueries.push(["previousAll", {
        canned_query: "previous",
        context: "all",
        url: null
      }]));
      for (var g = 0; g < e.length; g++) customQueries.push(["currentGoal", {
        canned_query: "current",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["previousGoal", {
        canned_query: "previous",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["campaignsGoal", {
        canned_query: "campaigns",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["previousPathGoal", {
        canned_query: "previous_path",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["byDayGoal", {
        canned_query: "by_day",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["deviceGoal", {
        canned_query: "device",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["pagePathGoal", {
        canned_query: "page_path",
        context: "goal",
        goalid: e[g],
        url: null
      }]), customQueries.push(["pagePathConversionsGoal", {
        canned_query: "page_path_conversions",
        context: "goal",
        goalid: e[g],
        url: null
      }]);
      "site" === f.context ? (customQueries.push(["goalSummary", {
        canned_query: "goal_summary",
        context: "all",
        url: null
      }]), customQueries.push(["goalSummaryPrevious", {
        canned_query: "goal_summary",
        context: "all",
        start_period: "previous",
        url: null
      }])) : (customQueries.push(["allOfSite", {
        canned_query: "current",
        context: "site"
      }]), customQueries.push(["byDaySite", {
        canned_query: "by_day_alt",
        context: "site"
      }]), customQueries.push(["deviceSite", {
        canned_query: "device",
        context: "site"
      }]), customQueries.push(["deviceSiteDaily", {
        canned_query: "device_daily",
        context: "site"
      }]));
      (function t(d, e, g) {
        var h = new EasyEditAPI;
        d.slice(e, e + g).map(function(b) {
          h.queue("getGoogleAnalyticsStatistics", a.util.extendQuery(f, b[1]))
        });
        h.run(function() {
          e = e + g;
          if (e > d.length) c();
          else {
            b(e, d.length);
            t(d, e, g)
          }
        }, h.runMode.BATCH)
      })(customQueries, 0, 5)
    });
    EasyEdit.util.async.series(d)
  };
  this.getBasicPageQuery = function(b) {
    var c = a.current.asset,
      d = a.current.months,
      e = f(c);
    null === e && (e = c.attribute("web_path")); - 1 !== e.indexOf("://") && (e = e.substr(e.indexOf("://") + 3));
    d = {
      assetid: a.getViewId(),
      duration: "P" + d + "M",
      url: e,
      context: "url+index"
    };
    "google_analytics_view" ===
    c.attribute("type_code") && (d.context = "site");
    b.call(this, d)
  };
  this.getViewId = function() {
    var a = EasyEditConfig.analyticsViewId;
    this.current.asset && !0 === this.current.isView && (a = this.current.asset.id);
    return a
  };
  this.util = {
    cell: function(a, b, c) {
      b = !0 === b ? document.createElement("th") : document.createElement("td");
      c ? b.innerHTML = a : EasyEdit.util.setText(b, a);
      return b
    },
    svgEl: function(a) {
      var b = document.createElementNS("http://www.w3.org/2000/svg", a);
      "svg" === a && b.setAttribute("xmlns", "http://www.w3.org/2000/svg");
      return b
    },
    dateString: function(a) {
      a instanceof Date ? a = [a.getFullYear(), a.getMonth(), a.getDate()] : (a = a.split("-"), a[1]--);
      return EasyEdit.util.ordinal(Number(a[2])) + " " + "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",")[Number(a[1])] + " " + a[0]
    },
    formatTime: function(a) {
      var b = Math.floor(a / 60),
        a = Math.floor(a % 60);
      10 > b && (b = "0" + b);
      10 > a && (a = "0" + a);
      return b + ":" + a
    },
    tickValue: function(a) {
      var a = Math.ceil(a),
        b = Math.pow(10, ("" + a).length - 1),
        a = a / b;
      6 < a ? b *= 2 : 3 >= a ? b = Math.max(0.5 * b, 1) : 1.6 >= a && (b = Math.max(0.2 *
        b, 1));
      return b
    },
    abbrevStat: function(a) {
      var a = Math.floor(a),
        b = "";
      1E9 < a ? (a /= 1E9, b = "b") : 1E6 < a && (a /= 1E6, b = "m");
      if ("" !== b) {
        if (1E3 <= a) a = EasyEdit.util.formatNumber(Math.floor(a), 0);
        else {
          a = a.toString().substr(0, 5);
          for (-1 === a.indexOf(".") && (a += "."); 5 > a.length;) a += "0"
        }
        a += b
      } else a = EasyEdit.util.formatNumber(a, 0);
      return a
    },
    tableOption: function(a, b, c, d) {
      if (d3) {
        var e = "";
        !0 === d && (e = ' checked="checked"');
        return '<input type="radio" id="' + (a + "_" + c) + '" name="' + a + '" data-colour="' + c + '" value="' + b + '"' + e + "/>"
      }
      return ""
    },
    tableLabel: function(a, b, c) {
      return d3 ? '<label for="' + (a + "_" + b) + '">' + c + "</label>" : c
    },
    bauble: function(a, b) {
      var c = "";
      !0 === b && (c = " siteBauble");
      return '<div class="bauble chartColour' + a + c + '"></div>'
    },
    sessionStat: function() {
      return !0 === a.current.isView ? "ga:sessions" : "ga:uniquePageviews"
    },
    extendQuery: function(a, b) {
      var c = {};
      for (d in a) !0 === a.hasOwnProperty(d) && (c[d] = !0 === a[d] instanceof Array ? [].concat(a[d]) : a[d]);
      for (var d in b) null === b[d] ? delete c[d] : c[d] = b[d];
      return c
    },
    hoverRect: function(b, c, d, e, f, g, h) {
      void 0 ===
        h && (h = 250);
      var j = (c.width - 2 * c.tickTextMargin) / (d - (e ? 1 : 0)),
        q = a.util.svgEl("rect");
      q.setAttribute("id", f + "_rect");
      q.setAttribute("style", "opacity: 0");
      q.setAttribute("fill", "#000000");
      q.setAttribute("y", 0);
      q.setAttribute("height", c.barHeight);
      q.setAttribute("width", j);
      b.appendChild(q);
      var t = EasyEdit.tip.create({
        targetId: f + "_rect",
        containerId: f,
        position: "south",
        title: null,
        message: "",
        buttons: null,
        className: "analyticsGraphTooltip"
      });
      jQuery(b).on("mouseover", null, function(a) {
        var d = jQuery(b).offset(),
          a =
          a.clientX + document.documentElement.scrollLeft - d.left,
          d = null;
        if (a >= c.tickTextMargin - (e ? j / 2 : 0) && a < c.width - c.tickTextMargin + (e ? j / 2 : 0)) d = (a - c.tickTextMargin) / j, d = e ? Math.round(d) : Math.floor(d);
        null !== d ? (q.setAttribute("style", "opacity: 0.1"), q.setAttribute("x", c.tickTextMargin + (d - (e ? 0.5 : 0)) * j), !1 === t.$element.is(":visible") && (t.$element.find(".tooltipMessage").html(g[d]), t.show(), a = t.$element.offset(), a.top += 185, a.left += j / 2, a.left -= 4, t.$element.width(h), t.$element.offset(a))) : (q.setAttribute("style", "opacity: 0"),
          t.hide())
      });
      jQuery(b).on("mouseout", null, function() {
        q.setAttribute("style", "opacity: 0");
        t.hide()
      })
    }
  }
};
EasyEditScreens.assetTypes.link = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsLink",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsLink = {
  containerId: null,
  picker: null,
  readOnly: !1,
  init: function(a, b, c) {
    this.containerId = a;
    this.readOnly = b;
    var d = this,
      e = new EasyEditAPI;
    EasyEditAssetManager.getCurrentAsset(function(f) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(f, function(g) {
        var j = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(f);
        d.getTemplate(f, function(h) {
          var k = jQuery(d.containerId),
            h = jQuery(h),
            l = '<div id="ees_editDetails">' + g + j + "</div>",
            n = k.find("#ees_editDetails");
          n.length ? n.replaceWith(l) :
            k.append(l);
          k.find("#ees_editStatus").after(h);
          h = 0;
          if (!b) var m = k.find("input.ees_redirectAssetId"),
            o = k.find("input.ees_redirectAssetName"),
            h = parseFloat(m.val());
          var r = {
            bindElem: "#ees_redirectAsset",
            rootNode: f.id,
            bindFn: function(a) {
              EasyEdit.isset(a) ? (m.val(a.id), o.val(a.attribute("name"))) : (m.val(""), o.val(""));
              EasyEditComponentsToolbar.enableSaveButton()
            }
          };
          0 !== h && !isNaN(h) ? e.queue("getGeneral", {
            asset_id: h
          }).run(function(e) {
            EasyEdit.isset(e[0]) && e[0].hasOwnProperty("data") && !EasyEdit.isError(e[0].data) &&
              (r.prefillNode = {
                assetid: m.val(),
                name: o.val(),
                type_code: e[0].data.type_code
              }, d.picker = new EasyEditAssetPicker(r), EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c))
          }) : (!b && EasyEdit.isset(r) && (d.picker = new EasyEditAssetPicker(r)), EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c))
        })
      })
    })
  },
  save: function(a) {
    EasyEditScreens.screen.detailsDefault.save(function() {
      EasyEditOverlay.showOverlay("loading");
      EasyEditAssetManager.getCurrentAsset(function(b) {
        var c = new EasyEditSimpleEditRequest({
          assetid: b.id,
          backend_assetid: b.id,
          screen: "details"
        });
        jQuery("#ees_detailsRedirect,#ees_pageNaming").find("input").each(function() {
          c.setParam(jQuery(this).attr("name"), jQuery(this).val())
        });
        c.send(function() {
          a.apply(this, [!0, [], {
            refresh: !0
          }])
        })
      })
    })
  },
  getTemplate: function(a, b) {
    var c = this,
      d = new EasyEditAPI;
    d.queue("getKeywordsReplacements", {
      asset_id: a.id,
      keywords_array: ["%details-S_link_information%", "%details-F_name%"]
    }).run(function(a) {
      var d = a[0];
      if (d.hasOwnProperty("data") && !EasyEdit.isError(d.data)) {
        var a = jQuery(d.data["details-S_link_information"]["details-S_link_information"]),
          a = jQuery("<div />").append(a),
          d = jQuery("<div />").append(d.data["details-F_name"]["details-F_name"]),
          g = "";
        if (c.readOnly) g = a.find(".sq-backend-data:first").text(), d = d.text(), a = a.find(".sq-backend-data:eq(1)").find("div,img").remove().end().text(), g = EasyEdit.tmpl.render("details_screen_link_asset_read_only", {
          heading: EasyEditLocalise._("Link Options"),
          title: {
            label: EasyEditLocalise._("Title"),
            value: d
          },
          redirect_url: {
            label: EasyEditLocalise._("Link to URL"),
            value: g
          },
          redirect_asset: {
            label: EasyEditLocalise._("Link to asset"),
            name: a
          }
        });
        else var g = a.find('input[id$="[assetid]"]'),
          j = a.find('input[id$="_label"]'),
          h = a.find("input:first"),
          a = a.find("input:last"),
          d = d.find("input:first"),
          g = EasyEdit.tmpl.render("details_screen_link_asset", {
            heading: EasyEditLocalise._("Link Options"),
            title: {
              id: d.attr("id"),
              label: EasyEditLocalise._("Title"),
              value: d.val()
            },
            redirect_url: {
              label: EasyEditLocalise._("Link to URL"),
              notes: EasyEditLocalise._("URL to link to, including URI scheme (for example, http://www.squizsuite.net/)."),
              value: h.val(),
              id: h.attr("id")
            },
            redirect_asset: {
              label: EasyEditLocalise._("Link to asset"),
              notes: EasyEditLocalise._("Select an asset to link the user to."),
              id: g.attr("id"),
              value: g.val()
            },
            redirect_asset_name: {
              id: j.attr("id"),
              value: j.val()
            },
            relation: {
              label: EasyEditLocalise._("Relation"),
              notes: EasyEditLocalise._('The rel attribute specifies the relationship between the current page and the linked page. For example the use of "nofollow" indicates to a search crawler that the link should not be crawled.'),
              value: a.val(),
              id: a.attr("id")
            }
          });
        b.call(c, g)
      }
    }, d.runMode.BATCH)
  }
};
EasyEditScreens.assetTypes.video_file = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
"use strict";
EasyEditScreens.assetTypes.page_custom_form = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsCustomForm",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Content: {
        objectName: "contentsCustomForm",
        className: "content",
        displayName: EasyEditLocalise._("Content"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Emails: {
        objectName: "emailCustomForm",
        className: "email",
        displayName: EasyEditLocalise._("Emails"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
(function(a) {
  EasyEditScreens.screen.detailsCustomForm = {
    _bindActions: {
      display: function(a, c) {
        c ? a.fadeIn() : a.fadeOut()
      }
    },
    sectionConfig: [{
      title: EasyEditLocalise._("Customised Content"),
      rows: [{
        attr: "use_bodycopy_main",
        title: EasyEditLocalise._("Customise Form Page"),
        note: EasyEditLocalise._("Customise the HTML for the display of the form."),
        type: "slider"
      }, {
        attr: "use_bodycopy_confirmation",
        title: EasyEditLocalise._("Customise Confirmation Page"),
        note: EasyEditLocalise._("Customise the confirmation message displayed before the form is submitted."),
        type: "slider"
      }, {
        attr: "use_bodycopy_thank_you",
        title: EasyEditLocalise._("Customise Thank You Page"),
        note: EasyEditLocalise._("Customise the content displayed after the form is submitted."),
        type: "slider"
      }, {
        attr: "use_confirmation_page",
        title: EasyEditLocalise._("Use Confirmation Page"),
        note: EasyEditLocalise._('If "Yes", a confirmation page will appear after the form (or the last page) is completed, but before the form as a whole is fully submitted. This will allow the form\'s users to confirm that they have filled all parts of the form correctly, before they submit the form.'),
        type: "slider"
      }]
    }, {
      title: EasyEditLocalise._("Formatting"),
      rows: [{
        attr: "reset_button",
        title: EasyEditLocalise._("Reset Button Text"),
        note: EasyEditLocalise._("If left empty, 'Reset' will be used as the text for this button."),
        type: "text"
      }, {
        attr: "submit_button",
        title: EasyEditLocalise._("Submit Button Text"),
        note: EasyEditLocalise._("If left empty, 'Submit' will be used as the text for this button."),
        type: "text"
      }, {
        attr: "next_button",
        title: EasyEditLocalise._("Next Page Button Text"),
        type: "text",
        note: EasyEditLocalise._('If either "Multiple Pages" or "Use Confirmation Page" are set to "Yes", the Submit Button keyword will be replaced with the Next Page Button on pages other than the last. If left empty, "Next Page" will be used as the text for this button.')
      }, {
        attr: "previous_button",
        title: EasyEditLocalise._("Previous Page Button Text"),
        type: "text",
        note: EasyEditLocalise._('If either "Multiple Pages" or "Use Confirmation Page" are set to "Yes", a Previous Page Button with this text will be made available as a keyword. On the first page of a form, or if settings are both set to "No", the Previous Page Button keyword instead will be blank. If left empty, "Previous Page" will be used as the text for this button.')
      }]
    }, {
      title: EasyEditLocalise._("Multiple Page Options"),
      rows: [{
        attr: "multi_page",
        title: EasyEditLocalise._("Multiple Pages"),
        note: EasyEditLocalise._('Separates form sections into 1 page per section. If "No" then all questions will appear on a single page.'),
        type: "slider"
      }]
    }, {
      title: EasyEditLocalise._("Logging"),
      rows: [{
        attr: "log_submissions",
        title: EasyEditLocalise._("Log Submissions"),
        note: EasyEditLocalise._("Enable this option to make the form log the submissions to Matrix, so that they can then be exported using the tool below."),
        type: "slider"
      }]
    }, {
      title: EasyEditLocalise._("Submissions"),
      rows: [{
        attr: "submission_limit",
        title: EasyEditLocalise._("Submission Limit"),
        note: EasyEditLocalise._("Limit the total number of times this form can be submitted. Set to zero (0) to disable."),
        type: "numeric"
      }, {
        attr: "submission_limit_reached_text",
        title: EasyEditLocalise._("Limit Reached Error Text"),
        note: EasyEditLocalise._("Message to display if a user is still filling in a form by the time the submission limit is reached."),
        type: "text"
      }]
    }],
    $container: null,
    init: function(b, c, d) {
      var e = this;
      e.containerId =
        b;
      e.$container = a(b);
      e.events = new ObservableEvents(this);
      EasyEdit.util.async.series(function(a) {
          EasyEditAssetManager.getCurrentAsset(a)
        }, function(a, b) {
          EasyEditScreens.screen.contentsCustomForm.initForm(c, function() {
            a(b)
          })
        }, function(b, c) {
          EasyEditAPI.getInstance().queue("getKeywordsReplacements", {
            asset_id: c.id,
            keywords_array: ["%log-S_export%"]
          }).run(function(e) {
            EasyEdit.getToken(function(h) {
              if (EasyEdit.isError(e[0].data)) return d.call(this), !1;
              h = {
                am_form_submitted: 1,
                am_section: "limbo",
                asset_action: "edit",
                asset_ei_screen: "log",
                assetid: c.id,
                backend_assetid: c.id,
                backend_section: "am",
                process_form: "1",
                sq_link_path: "",
                sq_lock_release_manual: "0",
                sq_lock_type: "all",
                sq_preview_url: c.attribute("web_path"),
                token: h
              };
              h["page_custom_form_" + c.id + "_export_switch"] = "1";
              h = {
                hidden: EasyEdit.util.map(h, function(a, b) {
                  return {
                    key: a,
                    value: b
                  }
                }),
                path: EasyEditUrl.buildEditURL(c.attribute("web_path")),
                matrixContent: e[0].data["log-S_export"]["log-S_export"]
              };
              h = a("<div />").append(EasyEdit.tmpl.render("custom_form_export_logs",
                h));
              h.find(".sq-limbo-section-heading").remove();
              h.find('input[type="button"]').addClass("guiButton default");
              b(c, h.html())
            })
          })
        }, function(a, b, c) {
          var d = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(b),
            k = EasyEditScreens.screen.detailsDefault._getDetailsHTML(b),
            l = e.getSectionHTML();
          EasyEditScreens.screen.detailsDefault.getStatusHTML(b, function(n) {
            var n = '<div id="ees_editDetails">' + n + k + l + c + d + "</div>",
              m = jQuery(e.containerId),
              o = m.find("#ees_editDetails");
            o.length ? o.replaceWith(n) : m.append(n);
            a(b)
          })
        },
        function(a, d) {
          EasyEditScreens.screen.detailsDefault.commonDetailsInit(b, d, c, a);
          c || e._bindEvents()
        }, d)
    },
    getSectionHTML: function() {
      var b = "",
        c = EasyEditScreens.screen.contentsCustomForm.content;
      a.each(this.sectionConfig, function(d, e) {
        a.each(e.rows, function(a, b) {
          var e = "details_screen_section_attr_name_" + (EasyEditGlobalTemplates.hasOwnProperty("details_screen_section_attr_name_" + b.type) ? b.type : "default"),
            h = "details_screen_section_attr_data_" + (EasyEditGlobalTemplates.hasOwnProperty("details_screen_section_attr_data_" +
              b.type) ? b.type : "default");
          b.cellName = EasyEdit.tmpl.render(e, {
            id: "attr-section-" + d + "_" + a,
            title: b.title
          });
          b.cellData = EasyEdit.tmpl.render(h, {
            textValue: c.hasOwnProperty(b.attr) && 1 === parseFloat(c[b.attr]) ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No"),
            value: c.hasOwnProperty(b.attr) ? c[b.attr] : ""
          });
          b.title = b.title;
          b.note = b.note
        });
        b += EasyEdit.tmpl.render("details_screen_section", e)
      });
      return b
    },
    getAttrValue: function(b) {
      var c = null,
        b = a('.row[data-attr="' + b + '"]', this.$container);
      if (b.length) switch (b.data("type")) {
        case "text":
        case "numeric":
          c =
            a.trim(a("input", b).val());
          break;
        case "slider":
          c = a(".slider-target", b).data("selected")
      }
      return c
    },
    _bindEvents: function() {
      var b = this;
      a(".slider-target", this.$container).each(function() {
        var c = a(this),
          d = c.parents(".row"),
          e = EasyEditLocalise._("Yes"),
          f = EasyEditLocalise._("No"),
          g = new EasyEditSlider({
            bindElem: c,
            defaultVal: 0 === c.data("default-value") ? f : e
          });
        g.events.observe("change", function() {
          var a = g.isTrue() ? 1 : 0;
          c.data("selected", a);
          EasyEditComponentsToolbar.enableSaveButton();
          b.events.trigger("attr-change",
            d.data("attr"), a, d)
        })
      });
      a(".details-screen-section .inputText").on("change", function() {
        var c = a(this).parents(".row"),
          d = c.data("attr"),
          e = b.getAttrValue(d);
        EasyEditComponentsToolbar.enableSaveButton();
        b.events.trigger("attr-change", d, e, c)
      });
      a(".row[data-bind]", this.$container).each(function() {
        var c = a(this),
          d = c.data("bind"),
          e = c.data("bind-action"),
          f = c.data("bind-value"),
          g = b.getAttrValue(d);
        b._bindActions[e].call(b, c, g === f);
        b.events.observe("attr-change", function(a, g) {
          a === d && b._bindActions[e].call(b,
            c, g === f)
        })
      })
    },
    save: function(b) {
      var c = EasyEditAPI.getInstance(),
        d = EasyEditScreens.screen.contentsCustomForm.content.asset_id,
        e = {},
        f = {};
      EasyEditOverlay.showOverlay("loading");
      var g = EasyEdit.util.map(this.sectionConfig[0].rows.slice(0, 3), function(a, b) {
        return b.attr
      });
      a(".details-screen-section .row").each(function() {
        var b = a(this),
          c = b.data("attr");
        if (EasyEdit.util.contains(g, c)) b = parseFloat(b.find(".slider-target").data("selected")), 1 === b ? f[c] = b : e[c] = b;
        else switch (b.data("type")) {
          case "text":
          case "numeric":
            e[c] =
              b.find("input").val();
            break;
          case "slider":
            e[c] = b.find(".slider-target").data("selected")
        }
      });
      EasyEdit.util.async.series(function(a) {
        if (1 <= EasyEdit.util.size(f)) {
          var b = new EasyEditSimpleEditRequest({
            assetid: d,
            backend_assetid: d,
            screen: "contents"
          });
          b.setParam(f);
          b.send(a)
        } else a()
      }, function(a) {
        c.queue("setMultipleAttributes", {
          asset_id: EasyEditScreens.screen.contentsCustomForm.content.asset_id,
          field_info: e
        });
        c.run(function() {
          EasyEditScreens.screen.detailsDefault.save(b);
          a()
        })
      })
    }
  }
})(jQuery);
(function(a) {
  function b(a, b) {
    if (a.hasOwnProperty("optionWidget")) {
      var c = a.optionWidget.fetch();
      c.length && (b["default"] = c[0].value);
      c = a.attribute("multiple");
      b.height = null !== c && 1 === parseFloat(c) ? 3 : 1
    }
    return b
  }

  function c(a, b) {
    var c = {},
      d = a.options.type;
    j.hasOwnProperty(d) && EasyEdit.util.each(j[d], function(d, e) {
      EasyEdit.util.contains(e.types, b) && (c = e.fn.call(a, a, c))
    });
    return c
  }

  function d(a) {
    EasyEdit.util.each(a, function(a, b) {
      b.hasOwnProperty("attributes") && b.attributes.hasOwnProperty("create_location") &&
        /^[0-9]+$/g.test(b.attributes.create_location) && (f[b.attributes.create_location] = {})
    })
  }
  var e = null,
    f = {},
    g = {
      text: "Text",
      numeric: "Number input",
      email_address: "Email",
      select: "Selection list",
      tickbox_list: "Checkboxes",
      option_list: "Radio buttons",
      datetime: "Date and Time",
      country: "Country",
      file_upload: "File Upload",
      password: "Password",
      tickbox_table: "Checkbox Table"
    },
    j = {
      text: [{
        types: ["select"],
        fn: function(a, b) {
          var c = {},
            d = a.attribute("default");
          null !== d && (c[d] = d, b.options = EasyEdit.util.serialise(c));
          return b
        }
      }, {
        types: ["option_list", "tickbox_list"],
        fn: function(a, b) {
          var c = a.attribute("default");
          null !== c && (b.options = EasyEdit.util.serialise([c]));
          return b
        }
      }],
      select: [{
        types: ["option_list", "tickbox_list"],
        fn: function(a, b) {
          var c = a.optionWidget.fetch();
          c.length && (b.options = EasyEdit.util.serialise(EasyEdit.util.map(c, function(a, b) {
            return b.value
          })));
          b.multiple = null !== a.attribute("multiple") ? a.attribute("multiple") : "0";
          return b
        }
      }, {
        types: ["text"],
        fn: b
      }],
      option_list: [{
        types: ["select", "tickbox_list"],
        fn: function(a,
          b) {
          b.options = null !== a.attribute("options") ? a.attribute("options") : "";
          b.multiple = null !== a.attribute("multiple") ? a.attribute("multiple") : "0";
          return b
        }
      }, {
        types: ["text"],
        fn: b
      }],
      tickbox_list: [{
        types: ["select", "options_list"],
        fn: function(a, b) {
          b.options = null !== a.attribute("options") ? a.attribute("options") : "";
          b.multiple = null !== a.attribute("multiple") ? a.attribute("multiple") : "0";
          return b
        }
      }, {
        types: ["text"],
        fn: b
      }]
    };
  EasyEditScreens.screen.contentsCustomForm = {
    bodycopies: {},
    bodycopyManagers: {},
    tips: null,
    $container: null,
    $questions: null,
    destructive: {
      clone: !1,
      morph: !1
    },
    clearUserAccept: function() {
      sessionStorage.removeItem("destructive_clone_change_accepted");
      sessionStorage.removeItem("destructive_morph_change_accepted");
      this.destructive.clone = !1;
      this.destructive.morph = !1
    },
    initForm: function(b, c) {
      var e = this,
        g = EasyEditAPI.getInstance();
      if ("undefined" !== typeof sessionStorage) {
        var j = sessionStorage.getItem("destructive_clone_change_accepted"),
          o = sessionStorage.getItem("destructive_morph_change_accepted");
        EasyEdit.isset(j) &&
          (e.destructive.clone = !0);
        EasyEdit.isset(o) && (e.destructive.morph = !0)
      }
      EasyEdit.util.async.series(function(a) {
        EasyEditAssetManager.getCurrentAsset(a)
      }, function(b, c) {
        var d = "status-" + c.attribute("status").replace(/\s+/g, "-").toLowerCase();
        a("#ees_eesUi").addClass(d);
        b(c)
      }, function(a, b) {
        g.queue("getChildren", {
          asset_id: b.id,
          levels: 1,
          get_attributes: 1
        }).run(function(b) {
          EasyEdit.isError(b[0].data) || EasyEdit.util.each(b[0].data, function(a, b) {
            "form_email" === b.type_code && (e.content = b, EasyEditScreens.additionalLockAssets.push(e.content.id));
            b.hasOwnProperty("questions") && d(b.questions)
          });
          a(e.content)
        }, g.runMode.BATCH)
      }, function(a, b) {
        e.sections = {};
        g.queue("getChildren", {
          asset_id: b.id,
          type_codes: ["form_section", "bodycopy"],
          levels: 1,
          get_attributes: 1
        }).run(function(b) {
          EasyEditDebug.log("Form Contents children", b);
          "undefined" === typeof b[0].data.error && EasyEdit.util.each(b[0].data, function(a, b) {
            "form_section" === b.type_code && (e.sections[b.asset_id] = b);
            "bodycopy" === b.type_code && (e.bodycopies[b.name] = b);
            b.hasOwnProperty("questions") && d(b.questions)
          });
          a()
        }, g.runMode.BATCH)
      }, function(a) {
        if (b) a();
        else {
          g.queue("acquireLock", {
            asset_id: e.content.id,
            screen_name: "all"
          });
          for (var c in f) f.hasOwnProperty(c) && g.queue("getGeneral", {
            asset_id: c,
            get_attributes: 1
          });
          g.run(function(b) {
            for (var c = 0, d = b.length; c < d; c += 1) !EasyEdit.isError(b[c]) && b[c].hasOwnProperty("data") && "getGeneral" === b[c].fnName && (f[b[c].data.asset_id] = b[c].data);
            a()
          }, g.runMode.BATCH)
        }
      }, c)
    },
    currentlyEditing: null,
    init: function(b, c, d) {
      var e = this,
        f = EasyEditAPI.getInstance();
      this.$container = a(b);
      e.sort_order = {};
      e.sections = {};
      e.content = {};
      this.events = new ObservableEvents(this);
      if (!Squiz_Matrix_API.prototype.hasOwnProperty("createQuestion") || !Squiz_Matrix_API.prototype.hasOwnProperty("updateQuestion") || !Squiz_Matrix_API.prototype.hasOwnProperty("removeQuestion") || !Squiz_Matrix_API.prototype.hasOwnProperty("updateQuestionOrder")) EasyEditScreens.displayWarning({
        message: EasyEditLocalise._("This form is not editable. Please ensure all form related JavaScript API functions are enabled.")
      }), c = !0;
      EasyEdit.util.async.series(function(a) {
        e.initForm(c,
          a)
      }, function(a) {
        e.sort_order[e.content.id] = 0;
        f.queue("getAttributes", {
          asset_id: e.content.id
        });
        var b = 1,
          c;
        for (c in e.sections) e.sections.hasOwnProperty(c) && (e.sort_order[c] = b, f.queue("getAttributes", {
          asset_id: c
        })), b += 1;
        f.run(function(b) {
          for (var c in e.sort_order) e.sort_order.hasOwnProperty(c) && "undefined" !== typeof b[e.sort_order[c]] && !EasyEdit.isError(b[e.sort_order[c]].data) && b[e.sort_order[c]].data.hasOwnProperty("sort_order") ? e.sort_order[c] = b[e.sort_order[c]].data.sort_order : (new EasyEditError({
            message: EasyEditLocalise._("Unable to populate sort order of form questions")
          })).display();
          a()
        }, f.runMode.BATCH)
      }, function(a) {
        c ? e.renderReadOnly(a) : (e.renderEditable(a), e._bindEvents())
      }, d)
    },
    renderReadOnly: function(b) {
      var c = {
        total_sections: 0,
        total_unattached: 0
      };
      this.content.hasOwnProperty("questions") && (c.unattached = EasyEdit.util.map(this.content.questions, function(a, b) {
        c.total_unattached += 1;
        return {
          name: b.attributes.name,
          type: g[b.question_type_code.replace("form_question_type_", "")]
        }
      }));
      c.sections = EasyEdit.util.map(this.sections, function(a, b) {
        return {
          title: b.name,
          questions: EasyEdit.util.map(b.questions,
            function(a, b) {
              c.total_sections = c.total_sections + 1;
              return {
                name: b.attributes.name,
                type: g[b.question_type_code.replace("form_question_type_", "")]
              }
            })
        }
      });
      c.total = c.total_unattached + c.total_sections;
      this.$questions = a('<div id="ees_questionWrapper"></div>').appendTo(this.$container).append(EasyEdit.tmpl.render("custom_form_unattached_header")).append(EasyEdit.tmpl.render("custom_form_read_only", c));
      0 === c.total_unattached && this.$questions.find(".custom-form-questions").remove();
      0 === c.total_sections && this.$questions.find(".custom-form-sections").remove();
      b()
    },
    renderEditable: function(b) {
      function c(a) {
        a = EasyEdit.util.indexOf(j, a);
        return -1 !== a && "1" !== d.content[o[a]] ? !0 : !1
      }
      var d = this,
        f = [{
          name: EasyEditLocalise._("Form Fields"),
          id: "questions"
        }],
        j = ["page", "confirmation", "thank"],
        o = ["use_bodycopy_main", "use_bodycopy_confirmation", "use_bodycopy_thank_you"];
      EasyEdit.util.each(this.bodycopies, function(a, b) {
        var e = a.split(" ").shift().toLowerCase(),
          a = "page" === e ? EasyEditLocalise._("Form Page") : "thank" === e ? EasyEditLocalise._("Thank You Page") : EasyEditLocalise._(-1 !==
            a.indexOf(" ") ? a.split(" ").slice(0, 2).join(" ") : a);
        EasyEdit.util.contains(j, e) && (d.bodycopyManagers[e] = {
          name: a,
          attributes: b
        }, f.push({
          name: a,
          id: e,
          disabled: c(e),
          disabledMessage: EasyEditLocalise._("The %1 option has been disabled from the details screen. You may still continue to edit, but the form will not use this content until the option is enabled.", "<strong>" + a + "</strong>")
        }))
      });
      f.sort(function(a, b) {
        var c = EasyEdit.util.indexOf(j, a.id),
          d = EasyEdit.util.indexOf(j, b.id);
        return c < d ? -1 : c > d ? 1 : 0
      });
      var r =
        this.$container.find("#ees_customFormWrapper");
      r.length || (r = a('<div id="ees_customFormWrapper"></div>').appendTo(this.$container));
      1 <= EasyEdit.util.size(d.bodycopyManagers) && (this.tabWidget = r.EasyEditTabScreenWidget({
        tabs: f,
        defaultId: "questions"
      }).data("EasyEditTabScreenWidget"));
      r = this.hasOwnProperty("tabWidget") ? this.tabWidget.$elem.find('.ees-tab-screen__tab[data-id="questions"]') : this.$container;
      d.$questions = a('<div id="ees_questionWrapper"></div>');
      e = new Viper("custom_form_contents");
      e.getPluginManager().setPlugins([]);
      d.$questions.append(EasyEdit.tmpl.render("custom_form_unattached_header"));
      var p = a(EasyEdit.tmpl.render("custom_form_unattached", {
        id: d.content.asset_id
      })).appendTo(d.$questions);
      a.each(d.sort_order[d.content.id], function(a, b) {
        var c = parseFloat(b.replace(/^[0-9]+:q([0-9]+)$/, "$1")),
          e = d.content.questions[c],
          f = e.question_type_code.replace("form_question_type_", "");
        d.addQuestion({
          id: c,
          parent: d.content.asset_id,
          type: f,
          exists: true
        }, e.attributes, {
          elem: d.$questions.find('[data-id="' + d.content.asset_id + '"]'),
          method: "append"
        })
      });
      a(EasyEdit.tmpl.render("custom_form_add_new_question")).appendTo(p);
      var s = a(EasyEdit.tmpl.render("custom_form_section_wrapper")).appendTo(d.$questions),
        q = [];
      a.each(d.sections, function(a, b) {
        q.push({
          id: a,
          section: b
        })
      });
      q.sort(function(a, b) {
        return parseFloat(a.section.sort_order) - parseFloat(b.section.sort_order)
      });
      a.each(q, function(b, c) {
        var e = c.id,
          f = d.addSection({
            name: c.section.name,
            id: e
          }, {
            elem: s,
            method: "append"
          });
        a.each(d.sort_order[e], function(a, b) {
          var c = parseFloat(b.replace(/^[0-9]+:q([0-9]+)$/,
              "$1")),
            g = parseFloat(b.replace(/^([0-9]+):q[0-9]+$/, "$1"));
          if (d.sections.hasOwnProperty(g)) {
            var g = d.sections[g].questions[c],
              h = g.question_type_code.replace("form_question_type_", "");
            d.addQuestion({
              id: c,
              parent: e,
              type: h,
              exists: true
            }, g.attributes, {
              elem: f.find('[data-id="' + e + '"]'),
              method: "append"
            })
          }
        })
      });
      a(EasyEdit.tmpl.render("custom_form_add_new_section", {
        id: "insert_section"
      })).appendTo(s);
      this.tips = new EasyEditToolTipManager;
      this.insertTip = this.tips.create({
        containerId: "custom_form_inline_insert",
        className: "custom-form-modal__inline-insert",
        title: EasyEditLocalise._("Insert Form Field"),
        buttons: EasyEdit.tmpl.render("custom_form_modal_insert_buttons"),
        message: function() {
          var a = {};
          a.types = jQuery.map(g, function(a, b) {
            return {
              type: b,
              text: a
            }
          });
          a.types = EasyEdit.util.filter(a.types, function(a, b) {
            return b.type !== "tickbox_table" && b.type !== "password"
          });
          return EasyEdit.tmpl.render("custom_form_modal_question_type_list", a)
        }(),
        position: "west"
      });
      this.sectionTip = this.tips.create({
        containerId: "custom_form_insert_section",
        className: "custom-form-modal__insert-section",
        title: EasyEditLocalise._("Insert Form Section"),
        buttons: EasyEdit.tmpl.render("custom_form_modal_insert_buttons"),
        message: EasyEdit.tmpl.render("custom_form_add_new_section_modal"),
        position: "west"
      });
      p = r.find("#ees_questionWrapper");
      p.length ? p.replaceWith(d.$questions) : r.append(d.$questions);
      d.updateSectionNumbering();
      d.makeSortable();
      b()
    },
    _bindEvents: function() {
      function b() {
        a(".custom-form-section, .custom-form-questions", d.$container).each(function() {
          var b = a(this);
          0 === a(this).find(".custom-form-question").filter(function() {
              return !a(this).hasClass("custom-form__deleted")
            }).length ?
            b.addClass("custom-form__empty") : b.removeClass("custom-form__empty")
        })
      }

      function c(a) {
        "undefined" !== typeof f && null !== f && f.getPluginManager().getPlugin("ViperToolbarPlugin").setParentElement(a.get(0))
      }
      var d = this;
      d.insertTip.events.observe("show", function() {
        d.insertTip.$target.parents(".custom-form-question__insert-widget").addClass("active")
      });
      d.insertTip.events.observe("hide", function() {
        d.insertTip.$target.parents(".custom-form-question__insert-widget").removeClass("active")
      });
      a(this.$container).off("click.insert-question").on("click.insert-question",
        ".custom-form-question__insert-button, .custom-form__add-new-question-button",
        function(b) {
          b.preventDefault();
          d.insertTip.hide();
          d.insertTip.$target = a(this);
          d.insertTip.position();
          d.insertTip.show()
        });
      a(".custom-form-section, .custom-form-questions").on("sortchange", function() {
        d.events.trigger("change")
      });
      d.events.observe("change", function() {
        EasyEditComponentsToolbar.enableSaveButton();
        b()
      });
      b();
      a("body").off("click.form-content").on("click.form-content", function(b) {
        var c = a(b.target).parents();
        if (d.currentlyEditing instanceof EasyEditQuestion) {
          var b = d.currentlyEditing.$element,
            e = !1;
          d.currentlyEditing.tips.each(function() {
            c.filter(this.$element.get(0)).length && (e = !0)
          });
          0 === c.filter(b.get(0)).length && !e && (d.currentlyEditing.setEditMode(!1), d.currentlyEditing = null)
        }
      });
      var f = null;
      this.hasOwnProperty("tabWidget") && (this.tabWidget.events.observe("load", function(a) {
        EasyEditViperComments.hideAllComments();
        if (d.bodycopyManagers.hasOwnProperty(a) && !d.bodycopyManagers[a].hasOwnProperty("manager")) {
          var b = d.tabWidget.$elem.find('.ees-tab-screen__tab[data-id="' +
            a + '"]');
          EasyEditOverlay.showOverlay("loading");
          var e = new EasyEditAsset(d.bodycopyManagers[a].attributes.id, d.bodycopyManagers[a].attributes),
            g = new EasyEditBodycopyManager(e, b, function() {
              g.render();
              f = g.viper;
              EasyEditOverlay.hideOverlay("loading");
              EasyEditEventManager.trigger("EasyEditCustomFormLoadComplete")
            }, f);
          g.events.observe("change", function() {
            d.events.trigger("change")
          });
          d.bodycopyManagers[a].manager = g;
          g.events.observe("bind", function() {
            c(g.$element)
          })
        } else d.bodycopyManagers.hasOwnProperty(a) &&
          (EasyEditEventManager.trigger("EasyEditCustomFormLoadComplete"), c(d.bodycopyManagers[a].manager.$element))
      }), this.tabWidget.loadTab());
      var g = d.insertTip.$element.find(".custom-form-modal__question-type-item");
      g.on("click", function() {
        g.removeClass("selected");
        a(this).addClass("selected")
      }).on("dblclick", function() {
        g.removeClass("selected");
        a(this).addClass("selected");
        d.insertTip.$element.find(".button-insert").trigger("click")
      });
      d.insertTip.events.observe("hide", function() {
        g.removeClass("selected")
      });
      d.insertTip.$element.find(".button-cancel").click(function(a) {
        a.preventDefault();
        d.insertTip.hide()
      });
      d.insertTip.$element.find(".button-insert").click(function(a) {
        a.preventDefault();
        var b = d.insertTip.$element.find(".selected");
        if (!b.length) return false;
        var c = d.insertTip.$target.parents(".custom-form-questions, .custom-form-section").find(".custom-form__parent"),
          e = d.insertTip.$target.parents(".custom-form-question"),
          a = {
            elem: null,
            method: "before"
          };
        if (e.length) a.elem = e;
        else {
          a.elem = c;
          a.method = "append"
        }
        b = {
          id: d.getNextId(),
          parent: c.data("id"),
          type: b.data("type")
        };
        c = {
          name: EasyEditLocalise._("New Form Field #%1", b.id)
        };
        d.addQuestion(b, c, a);
        d.insertTip.hide()
      });
      this.$container.off("click.insert-section").on("click.insert-section", ".custom-form__add-new-section-button, .custom-form-section__insert-button", function(b) {
        b.preventDefault();
        if (b.target === d.sectionTip.$target.get(0)) d.sectionTip.toggle();
        else {
          d.sectionTip.$target = a(b.target);
          d.sectionTip.position();
          d.sectionTip.show();
          d.sectionTip.$element.find('input[name="insert_section"]').focus()
        }
      });
      a(".button-cancel", d.sectionTip.$element).on("click", function(a) {
        a.preventDefault();
        d.sectionTip.hide()
      });
      a('input[name="insert_section"]', d.sectionTip.$element).on("keyup", function(b) {
        b.which === 13 && a(".button-insert", d.sectionTip.$element).trigger("click")
      });
      a(".button-insert", d.sectionTip.$element).on("click", function(b) {
        b.preventDefault();
        var c = d.sectionTip.$target,
          b = {
            elem: c.parents(".custom-form-section"),
            method: "before"
          };
        if (c.is("#insert_section")) {
          b.elem = c.parent();
          b.method = "before"
        }
        var c = a('input[name="insert_section"]',
            d.sectionTip.$element),
          e = c.val();
        c.val("");
        if (/^\s*$/.test(e)) return false;
        d.sectionTip.hide();
        d.addSection({
          name: e
        }, b)
      });
      var j = {
        9: !1,
        13: !1,
        16: !1
      };
      e.registerCallback("Viper:keyDown", "ees-custom-form-question", function(b) {
        if (b.which in j) {
          b.preventDefault();
          return false
        }
        b = e.getEditableElement();
        a(b).hasClass("custom-form-question__note") && a(b).parent().removeClass("custom-form-question__note-default")
      });
      e.registerCallback("Viper:keyUp", "ees-custom-form-question", function() {
        EasyEditComponentsToolbar.enableSaveButton();
        d.currentlyEditing !== null && d.currentlyEditing.events.trigger("update-requested")
      })
    },
    _bindQuestionEvents: function(b) {
      var d = this;
      b.events.observe("clone-requested", function(c, e) {
        var f = {
          elem: b.$element,
          method: "after"
        };
        "undefined" !== typeof c && "undefined" !== typeof e && (0 === e ? (f.elem = c, f.method = "prepend") : (f.elem = a(".custom-form-question:nth-child(" + (e + 1) + ")", c), f.method = "after"));
        "undefined" === typeof c && (c = b.$element.parents(".custom-form__parent"));
        d.addQuestion({
          id: d.getNextId(),
          parent: c.data("id"),
          type: b.options.type,
          exists: !1,
          is_cloned: !0,
          cloned_from: b
        }, jQuery.extend({}, b.attributes), f)
      });
      b.events.observe("morph-requested", function(a) {
        var e = [];
        d.destructive.morph || e.push(function(a) {
          d.showDestructiveWarning("morph", a, function() {})
        });
        EasyEdit.util.async.series.apply(this, e.concat(function(e) {
          b.update();
          b.remove(!0);
          var f = c(b, a),
            g = {};
          EasyEdit.util.each(["name", "note", "sticky", "is_required", "cust_required_text"], function(a, c) {
            var d = b.attribute(c);
            null !== d && (g[c] = d)
          });
          d.addQuestion({
            id: d.getNextId(),
            parent: b.options.parent,
            type: a,
            exists: !1,
            is_morphed: !0,
            morphed_from: b
          }, jQuery.extend({}, f, g), {
            elem: b.$element,
            method: "after"
          });
          e()
        }))
      });
      b.events.observe("edit", function() {
        var a = d.currentlyEditing;
        null !== a && a.hasOwnProperty("options") && (a.options.id !== this.options.id || a.options.parent !== this.options.parent) && a.setEditMode(!1);
        d.currentlyEditing = this
      });
      a("input, select, textarea", this.$container).on("keydown", function(a) {
        d.events.trigger("question-keydown", a, a.target)
      }).on("keyup", function(a) {
        d.events.trigger("question-keyup",
          a, a.target)
      });
      b.events.observe("change", function() {
        EasyEditComponentsToolbar.enableSaveButton()
      })
    },
    _bindSectionEvents: function(b) {
      var c = this;
      a(".custom-form-section__remove-button", b).on("click", function(a) {
        a.preventDefault();
        b.toggleClass("custom-form__deleted");
        c.events.trigger("change")
      });
      a(".custom-form-section__title .viper-editable", b).on("click", function() {
        if (e.getEditableElement() === this) return !1;
        e.setEditableElement(this);
        e.selectElement(a(this).find("p:first").get(0))
      });
      a(".custom-form-section__drag-handle",
        b).on("click", function(b) {
        b.preventDefault();
        EasyEditOverlay.showOverlay("reorderSections", {
          sections: a(".custom-form-section", c.$container)
        }, function() {
          this.$container.find(".custom-form-section__sort-list").off("sortstop.callback").on("sortstop.callback", function() {
            c.events.trigger("change")
          })
        })
      })
    },
    getNextId: function() {
      var b = a(".custom-form-question", this.$container);
      if (!b.length) return 1;
      b = b.map(function() {
        return parseFloat(a(this).data("id"))
      });
      EasyEdit.util.isArray(b) || (b = a.makeArray(b));
      return Math.max.apply(this,
        b) + 1
    },
    each: function(b) {
      var c = this;
      a(".custom-form-question", this.$container).each(function() {
        b.call(c, a(this).data("question"))
      })
    },
    updateSectionNumbering: function() {
      a(".custom-form-section", this.$container).each(function(b) {
        a(this).find(".order").text(b + 1)
      })
    },
    showDestructiveWarning: function(b, c, d) {
      var e = this,
        f = EasyEditLocalise._("This change and will result in a different asset ID for the form field you are changing, are you sure you wish to continue?"),
        f = EasyEdit.tmpl.render("custom_form_email_destructive_warning", {
          message: f,
          id: b
        });
      EasyEditOverlay.showOverlay("confirm", {
        message: f,
        confirmFn: function() {
          var d = EasyEditOverlay.overlays.confirm.getContainer();
          a('input[type="checkbox"]:checked', d).length && ("undefined" !== typeof sessionStorage && sessionStorage.setItem("destructive_" + b + "_change_accepted", 1), e.destructive[b] = !0);
          c();
          EasyEditOverlay.hideOverlay("confirm")
        },
        cancelFn: function() {
          d();
          EasyEditOverlay.hideOverlay("confirm")
        }
      })
    },
    addSection: function(b, c) {
      b = jQuery.extend({
        id: null,
        name: "New Section"
      }, b);
      null === b.id &&
        (b.id = "", this.events.trigger("change"));
      var d = {
        title: b.name,
        id: b.id
      };
      d.subtitle = this.content.hasOwnProperty("multi_page") && 1 === parseFloat(this.content.multi_page) ? EasyEditLocalise._("Page") : EasyEditLocalise._("Section");
      this.sections.hasOwnProperty(b.id) && (d.link_id = this.sections[b.id].link_id);
      d = a(EasyEdit.tmpl.render("custom_form_section", d));
      c.elem[c.method](d);
      a(EasyEdit.tmpl.render("custom_form_add_new_question")).appendTo(a(".custom-form-section__inner", d));
      var e = a(".custom-form-section", this.$container);
      1 < e.length ? e.find(".custom-form-section__drag-handle").show() : e.find(".custom-form-section__drag-handle").hide();
      this.updateSectionNumbering();
      this._bindSectionEvents(d);
      this.makeSortable();
      this.events.trigger("change");
      this.events.trigger("add");
      return d
    },
    addQuestion: function(b, c, d) {
      b = a.extend({
        id: null,
        parent: null,
        exists: !1,
        type: "",
        createLocations: f
      }, b);
      c = new EasyEditQuestion(b, c, e);
      c.attach(d.elem, d.method);
      this._bindQuestionEvents(c);
      b.exists || a(".viper-editable:first", c.$element).click();
      this.events.trigger("change");
      this.events.trigger("add");
      return c
    },
    makeSortable: function() {
      var b, c, d, e = this,
        f = a(".custom-form__parent");
      f.filter(function() {
        return a(this).hasClass("ui-sortable")
      }).sortable("destroy");
      d = c = b = null;
      f.sortable({
        handle: ".custom-form-question__drag-handle",
        items: "> .custom-form-question",
        placeholder: "custom-form-question__drag-placeholder",
        connectWith: ".custom-form__parent",
        dropOnEmpty: !0,
        forceHelperSize: !1
      }).off("sortreceive sortstart sortstop").on("sortstart", function(a, c) {
        c.item.parent();
        c.item.index();
        b = c.item.data("question")
      }).on("sortstop", function() {
        e.events.trigger("change")
      }).on("sortreceive", function(a, f) {
        function g() {
          b.events.trigger("clone-requested", c, d);
          f.sender.sortable("cancel");
          b.remove(!0)
        }
        c = f.item.parent();
        d = f.item.index();
        e.destructive.clone ? g() : e.showDestructiveWarning("clone", g, function() {})
      }).on("sortstart sortstop", function(a, b) {
        b.item.css("height", "auto");
        a.stopPropagation();
        e.currentlyEditing instanceof EasyEditQuestion && e.currentlyEditing.setEditMode(!1)
      })
    },
    getExistingShadowIds: function(a) {
      var b =
        null,
        c = [];
      parseFloat(this.content.asset_id) === parseFloat(a) && this.content.hasOwnProperty("questions") ? b = this.content.questions : this.sections.hasOwnProperty(a) && this.sections[a].hasOwnProperty("questions") && (b = this.sections[a].questions);
      null !== b && (c = c.concat(jQuery.map(b, function(b, c) {
        return a + ":q" + c
      })));
      return c
    },
    cleanUp: function() {
      null !== this.tips && (this.tips.removeAll(), this.each(function(a) {
        a.tips.removeAll()
      }))
    },
    save: function(b) {
      var c = EasyEditAPI.getInstance(),
        d = this;
      EasyEditOverlay.showOverlay("loading", {
        message: EasyEditLocalise._("Saving content...")
      });
      var e = [],
        f = this.$container.find(".custom-form-question").filter(function() {
          return !a(this).parents(".custom-form__deleted").length
        }),
        g = this.$container.find(".custom-form-section").filter(function() {
          return !a(this).hasClass("custom-form__deleted")
        }),
        j = this.$container.find(".custom-form-section").filter(function() {
          return a(this).hasClass("custom-form__deleted")
        }),
        p = function(a, b) {
          var c = d.getExistingShadowIds(a);
          return EasyEdit.util.difference(b, c)
        };
      EasyEdit.util.async.series(function(b) {
        var e = [];
        g.each(function(b) {
          var f = a(".custom-form__parent", this),
            g = a(".custom-form-section__header .viper-editable", this).text(),
            h = f.data("id");
          /^[0-9]+$/.test(h) && d.sections.hasOwnProperty(h) ? d.sections[h].name !== g && c.queue("setMultipleAttributes", {
            asset_id: h,
            field_info: {
              name: g
            }
          }) : (e.push({
            fnIndex: c.getQueueLength(),
            elem: f
          }), c.queue("createAsset", {
            parent_id: d.content.id,
            type_code: "form_section",
            asset_name: g,
            link_type: "2",
            link_value: "",
            is_dependant: 1,
            is_exclusive: 0,
            sort_order: b
          }))
        });
        j.each(function() {
          var b =
            a(".custom-form__parent", this).data("id");
          /^[0-9]+$/.test(b) && d.sections.hasOwnProperty(b) && c.queue("trashAsset", {
            asset_ids: [b],
            check_dependent: 0
          })
        });
        c.run(function(c) {
          EasyEdit.util.each(e, function(b, d) {
            var e = c[d.fnIndex].data;
            if (!EasyEdit.isError(e) && e.hasOwnProperty("id")) {
              var f = parseFloat(e.id);
              d.elem.data("id", f);
              a(".custom-form-question", d.elem).each(function() {
                a(this).data("question").options.parent = f
              })
            }
          });
          b()
        }, c.runMode.BATCH)
      }, function(b) {
        f.each(function() {
          var b = a(this),
            d = b.data("question"),
            b = b.parents(".custom-form__parent"),
            b = parseFloat(b.data("id"));
          d.options.is_deleted && d.options.exists && null !== d.options.id && c.queue("removeQuestion", {
            assetid: b,
            question_id: "q" + d.options.id
          });
          !d.options.exists && !d.options.is_deleted && (e.push({
            fnIndex: c.getQueueLength(),
            question: d
          }), c.queue("createQuestion", {
            assetid: b,
            type_code: d.options.type,
            units: 1
          }))
        });
        var d = {};
        EasyEdit.util.each(e, function(a, b) {
          d[b.question.options.parent] = !0
        });
        EasyEdit.util.each(d, function(a) {
          d[a] = c.getQueueLength();
          c.queue("getGeneral", {
            asset_id: a,
            get_attributes: 1
          })
        });
        c.run(function(a) {
            var c = {};
            EasyEdit.util.each(e, function(b, d) {
              var f = a[e[b].fnIndex],
                g = d.question;
              f.hasOwnProperty("data") && !EasyEdit.isError(f.data) && (g.options.exists = !0, c.hasOwnProperty(g.options.parent) || (c[g.options.parent] = []), c[g.options.parent].push(g))
            });
            EasyEdit.util.each(d, function(b, d) {
              var e = p(b, a[d].data.sort_order);
              EasyEdit.util.each(c[b], function(a, b) {
                var c = parseFloat(e[a].replace(/^[0-9]+:q([0-9]+)$/, "$1"));
                b.options.exists = !0;
                b.options.id = c
              })
            });
            b()
          },
          c.runMode.BATCH)
      }, function(b) {
        if (g.length) {
          var e = [];
          g.each(function(b) {
            var c = a(".custom-form__parent", this).data("id");
            /^[0-9]+$/.test(c) ? (b = {
              child: c,
              parent: d.content.id,
              link_type: "SQ_LINK_TYPE_2",
              existing_link_type: "SQ_LINK_TYPE_2",
              link_value: "",
              existing_link_value: "",
              sort_order: b,
              link_lock: 0
            }, d.sections.hasOwnProperty(c) && (b.existing_link_type = "SQ_LINK_TYPE_" + d.sections[c].link_type, b.existing_link_value = d.sections[c].link_value, b.link_lock = d.sections[c].locked), e.push(b)) : (new EasyEditError({
              message: EasyEditLocalise._("Fatal error assigning section sort order, unknown asset id")
            })).display()
          });
          1 <= e.length && c.queue("updateMultipleLinks", {
            link_info: {
              links: e
            }
          })
        }
        var h = {};
        f.each(function() {
          var b = a(this).data("question"),
            d = b.options.parent;
          if (b.options.exists && !b.options.is_deleted) {
            var e = b.save();
            c.queue("updateQuestion", {
              assetid: d,
              question_id: "q" + b.options.id,
              field_info: e
            });
            h.hasOwnProperty(d) || (h[d] = []);
            h[d].push(d + ":q" + b.options.id)
          }
        });
        EasyEdit.util.each(h, function(a, b) {
          c.queue("updateQuestionOrder", {
            assetid: a,
            sort_order: b
          })
        });
        c.run(function(a) {
          EasyEdit.util.each(a, function(b, c) {
            c.hasOwnProperty("data") ||
              EasyEdit.isError(a[b].data)
          });
          b()
        }, c.runMode.BATCH)
      }, function(a) {
        var b = EasyEdit.util.map(d.bodycopyManagers, function(a, b) {
          return function(a) {
            b.hasOwnProperty("manager") ? b.manager.save(a) : a()
          }
        });
        EasyEdit.util.async.series.apply(this, b.concat(function(b) {
          b();
          a()
        }))
      }, function(a) {
        d.cleanUp();
        b(!0, [], {});
        a()
      })
    }
  }
})(jQuery);
(function(a) {
  function b(a) {
    var b = {},
      c = EasyEditScreens.screen.contentsCustomForm;
    c.content.hasOwnProperty("questions") && EasyEdit.util.each(c.content.questions, function(d, h) {
      h.question_type_code === "form_question_type_" + a && (b[c.content.asset_id + ":q" + d] = h.attributes)
    });
    c.hasOwnProperty("sections") && EasyEdit.util.each(c.sections, function(c, d) {
      d.hasOwnProperty("questions") && EasyEdit.util.each(d.questions, function(d, g) {
        g.question_type_code === "form_question_type_" + a && (b[c + ":q" + d] = g.attributes)
      })
    });
    return b
  }
  var c = [],
    d = function(b) {
      this.$raw = b;
      this.heading = a(".sq-limbo-section-heading", b).text();
      this.$inputs = a("input, textarea, select, button", b);
      this.events = new ObservableEvents(this)
    };
  d.prototype = {
    render: function(d) {
      var f = {
          id: "custom-form-email-" + d,
          heading: this.heading,
          rows: []
        },
        g = {};
      g.$to = a('input[id*="_to_emails_options"]', this.$raw);
      g.$from = a('input[id$="_from"]', this.$raw);
      g.$reply = a('input[id$="_reply_to"]', this.$raw);
      g.$subject = a('input[id$="_subject"]', this.$raw);
      g.$attach = a('input[id$="_inc_attachments"]',
        this.$raw);
      g.$wysiwyg = a("textarea:first", this.$raw);
      g.$textBody = a('textarea[id$="_text_body"]', this.$raw);
      g.$questionSelector = a('input[id$="_staf_field[assetid]"], input[id$="_rec_field[assetid]"]', this.$raw);
      if (g.$questionSelector.length) {
        var j = a('<select name="' + g.$questionSelector.attr("name") + '" />').append('<option value="">-- ' + EasyEditLocalise._("Leave Empty") + " --</option>"),
          h = g.$questionSelector.val();
        g.$questionSelector.remove();
        d = b("email_address");
        EasyEdit.util.each(d, function(a, b) {
          j.append('<option value="' +
            a + '"' + (h === a ? "selected" : "") + ">" + b.name + " #" + a + "</option>")
        });
        f.rows.push({
          label: EasyEditLocalise._("Recipient Form Field"),
          note: EasyEditLocalise._('The email address entered in response to this form field will always receive emails. If this is left empty, no "Receipt/Send To A Friend" emails will be sent.'),
          content: 1 <= EasyEdit.util.size(d) ? a("<div />").append(j).html() : EasyEditLocalise._("No email fields have been configured, this email will not be sent.")
        })
      }
      var k = a('<ul class="custom_form_email__sortable"></ul>');
      g.$to.each(function() {
        a(this).addClass("inputText");
        a(EasyEdit.tmpl.render("custom_form_email_address_list_item")).find(".custom_form_email__sortable-input").append(this).end().appendTo(k)
      });
      f.rows.push({
        label: -1 !== this.heading.indexOf("Recipient") ? EasyEditLocalise._("To Address") : EasyEditLocalise._("Additional To Address"),
        content: a("<div />").append(k).html()
      });
      d = [{
        name: EasyEditLocalise._("From Address"),
        prop: "$from"
      }, {
        name: EasyEditLocalise._("Reply Address"),
        prop: "$reply"
      }, {
        name: EasyEditLocalise._("Subject"),
        prop: "$subject"
      }];
      EasyEdit.util.each(d, function(b, c) {
        var d = a("<div />").append(g[c.prop]);
        d.addClass("inputText");
        f.rows.push({
          label: c.name,
          content: d.html()
        })
      });
      d = b("file_upload");
      1 <= EasyEdit.util.size(d) && f.rows.push({
        label: EasyEditLocalise._("Attachments"),
        content: a("<div />").append(g.$attach).append('<label for="' + g.$attach.attr("id") + '">' + EasyEditLocalise._("Include File Uploads As Attachments") + "</label>").html()
      });
      g.$textBody.add(g.$wysiwyg).attr({
        rows: "",
        cols: ""
      });
      var l = {};
      EasyEdit.util.each(c,
        function(a, b) {
          b.hasOwnProperty("questions") && EasyEdit.util.isArray(b.questions) && EasyEdit.util.each(b.questions, function(a, b) {
            var c = b.name;
            b.keyword.indexOf("title") ? EasyEditLocalise._("Section Title: %1", c) : b.keyword.indexOf("response") && EasyEditLocalise._("Response: %1", c);
            l[b.keyword.replace(/^%([^%]+)%$/, "$1")] = b.name
          });
          l.form_summary = EasyEditLocalise._("Form Summary");
          l.form_info = EasyEditLocalise._("Form Info")
        });
      g.$wysiwyg.addClass("screenHide");
      f.textBody = a("<div />").append(g.$textBody).html();
      f.viperContent = g.$wysiwyg.val();
      f.viperEmpty = /^\s*$/.test(f.viperContent);
      f.viperTextArea = a("<div />").append(g.$wysiwyg).html();
      this.$elem = a(EasyEdit.tmpl.render("custom_form_email_bodycopy", f));
      this.$elem.find(".viper-editable").before(g.$wysiwyg).attr("data-keywords", JSON.stringify(l));
      this.$elem.append(this.$raw);
      this.$raw.hide()
    },
    attach: function(a, b) {
      $existingElem = a.find("#" + this.$elem[0].id);
      if ($existingElem.length) $existingElem.replaceWith(this.$elem);
      else a[b](this.$elem);
      this._bindEvents()
    },
    remove: function() {
      this.$elem.remove()
    },
    _bindEvents: function() {
      function b() {
        var c = a("input", m),
          d = c.filter(function() {
            return /^\s*$/.test(a(this).val())
          });
        (2 >= c.length || 1 >= d.length) && m.append(a(EasyEdit.tmpl.render("custom_form_email_address_list_item", {
          input: !0
        })))
      }
      a("input, textarea", this.$elem).on("change keyup", function() {
        EasyEditComponentsToolbar.enableSaveButton()
      });
      var c = EasyEditLocalise._("Text"),
        d = EasyEditLocalise._("HTML"),
        j = EasyEditLocalise._("Editing Text Version"),
        h = EasyEditLocalise._("Editing HTML Version"),
        k = a(".custom-form-email__body-status-text", this.$elem),
        l = a(".custom-form-email__body-viper", this.$elem),
        n = a(".custom-form-email__body-text-only", this.$elem);
      k.text(h);
      this.textSlider = new EasyEditSlider({
        bindElem: a(".custom-form-email__body-text-slider", this.$elem),
        options: [
          [c, EasyEditLocalise._("Text only email content"), function() {
            k.text(j);
            n.removeClass("screenHide");
            l.addClass("screenHide")
          }],
          [d, EasyEditLocalise._("HTML email content"), function() {
            k.text(h);
            n.addClass("screenHide");
            l.removeClass("screenHide")
          }]
        ],
        defaultVal: d
      });
      var m = a(".custom_form_email__sortable", this.$elem);
      m.hasClass("ui-sortable") && m.sortable("destroy");
      m.sortable({
        handle: ".custom_form_email__sortable-drag-handle",
        items: "> .custom_form_email__sortable-item",
        placeholder: "custom_form_email__sortable-drag-placeholder"
      }).on("sortstop", function() {
        m.trigger("change.widget")
      });
      m.on("click", ".custom_form_email__sortable-delete-button", function(b) {
        b.preventDefault();
        var c = a(this).parents(".custom_form_email__sortable-item");
        c.fadeOut(function() {
          setTimeout(function() {
            c.remove();
            m.trigger("delete.widget")
          }, 100)
        })
      });
      m.on("change", "input", b);
      m.on("change.widget", b);
      m.on("delete.widget add.widget", function() {
        m.hasClass("ui-sortable") && m.sortable("refresh");
        m.trigger("change.widget")
      })
    }
  };
  EasyEditScreens.screen.emailCustomForm = {
    $raw: null,
    $container: null,
    init: function(b, c, d) {
      var j = this,
        h = EasyEditAPI.getInstance(),
        b = a(b),
        k = b.find(".ees_viperContentWrapper:first");
      this.$container = k.length ? k : a('<div class="ees_viperContentWrapper"><div class="ees_viperContent"></div></div>').appendTo(b);
      EasyEditScreens.screen.contentsCustomForm.initForm(c, function() {
        EasyEdit.util.async.series(function(a) {
          EasyEditAssetManager.getCurrentAsset(a)
        }, function(b) {
          if (c) b();
          else {
            var d = EasyEditScreens.screen.contentsCustomForm.content.asset_id,
              d = EasyEditUrl.getBaseSiteURL() + "/__lib/web/popups/thank_you_keywords.php?assetid=" + d;
            a.ajax({
              url: d,
              success: function(a) {
                j.parseResponseKeywords(a, b)
              }
            })
          }
        }, function(a) {
          c ? j.renderReadOnly(a) : h.queue("getKeywordsReplacements", {
            asset_id: EasyEditScreens.screen.contentsCustomForm.content.asset_id,
            keywords_array: ["%recipient-%"]
          }).run(function(b) {
            try {
              j.renderEditable(b[0].data["recipient-"]["recipient-"], a)
            } catch (c) {
              (new EasyEditError({
                message: c.message
              })).display(), a()
            }
          })
        }, function(a) {
          c || j._bindEvents();
          a()
        }, d)
      })
    },
    renderEditable: function(b, c) {
      var d = this,
        j;
      j = EasyEdit.filterScriptSrc("<div>" + b + "</div>");
      j = j.replace(/<blockquote \\\/>/g, "");
      this.$raw = a(j);
      a("script", this.$raw).remove();
      var h = 0;
      this.$raw.find("table.sq-backend-section-table").each(function() {
        var b = a(this);
        1 < a("input", b).length &&
          d.addEmailBody(b, h++)
      });
      c()
    },
    addEmailBody: function(b, c) {
      var g = new d(b, c);
      g.render(c);
      g.attach(a(".ees_viperContent", this.$container), "append")
    },
    renderReadOnly: function(a) {
      this.$container.html('<div class="custom-form-email__read-only">' + EasyEditLocalise._("You must have locks on this screen to be able to view and edit email options") + "</div>");
      a()
    },
    parseResponseKeywords: function(b, d) {
      var g = a(b);
      a(".sq-backend-table", g).each(function() {
        var b = {
          heading: a("th:first").text(),
          questions: []
        };
        a("> tbody > tr:not(:eq(0))",
          this).each(function() {
          var c = a(this);
          b.questions.push({
            keyword: c.find("td:first").text(),
            name: c.find(".sq-info-asset-name").text()
          })
        });
        c.push(b)
      });
      d()
    },
    _bindEvents: function() {
      this.viper = EasyEdit.loadViper({
        editableDivs: a(".viper-editable", this.$container),
        toolbarContainer: this.$container
      })
    },
    save: function(b) {
      var c = this,
        d = EasyEditScreens.screen.contentsCustomForm.content.asset_id;
      a(".viper-editable", this.$container).each(function() {
        var b = a(this),
          c = b.html();
        b.siblings("textarea").val(c)
      });
      d = new EasyEditSimpleEditRequest({
        assetid: d,
        backend_assetid: d,
        screen: "recipient"
      });
      d.setParamsFromElement(c.$container, !0);
      EasyEditOverlay.showOverlay("loading");
      d.send(function() {
        b.call(c, !0, [], {})
      })
    }
  }
})(jQuery);
EasyEditScreens.assetTypes.data_record = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsDataRecord",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsDataRecord = {
  init: function(a, b, c) {
    var d = this;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(e, function(f) {
        var g = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(e),
          f = '<div id="ees_editDetails">' + f + d._getTemplate(e) + g + "</div>",
          g = jQuery(d.containerId),
          j = g.find("#ees_editDetails");
        j.length ? j.replaceWith(f) : g.append(f);
        EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, e, b, c)
      })
    })
  },
  save: function(a) {
    EasyEditAssetManager.getCurrentAsset(function(b) {
      var c = !1,
        d = jQuery("#ees_inputName").val();
      d !== b.attribute("name") && jQuery("#ees_inputName").length && "" !== d && (c = !0, b.attribute("name", d));
      EasyEditScreens.screen.detailsDefault.checkStatus(b, function(d) {
        EasyEditScreens.screen.detailsDefault.saveFutureStatus(function() {
          EasyEditScreens.screen.detailsDefault.saveThumbnail(function() {
            c || d ? b.save(function(c) {
              var d = EasyEdit.filterErrorArray(c),
                e = d.length >= 1 ? false : true;
              b.acquireLock("all", function() {
                a.apply(this, [e, d])
              })
            }) : b.acquireLock("all", function() {
              a.apply(this, [true, []])
            })
          })
        })
      })
    })
  },
  _getTemplate: function(a) {
    var b = '<h3 class="sectionHeading">' + EasyEditLocalise._("Name") + '</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label for="ees_inputShortName" class="inputLabel">' + EasyEditLocalise._("Record Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /> &nbsp;</div></div></div>',
      b = jQuery("<div>" + b + "</div>");
    b.find("#ees_inputName").attr("value",
      a.attribute("name"));
    return b.html()
  }
};
BodycopyDivNested = function(a) {
  this.events = new ObservableEvents(this, ["change", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.selectedAssetId = this.$container = null;
  this.selectedAssetLinkId = "";
  this.nestedPicker = null;
  this.paramPrefix = ""
};
BodycopyDivNested.prototype.getFriendlyContainerName = function() {
  return EasyEditLocalise._("Nested Content Container")
};
BodycopyDivNested.prototype.queueSave = function(a, b) {
  this.events.trigger("save_queued");
  var c = "",
    d = "";
  EasyEdit.isset(this.selectedAssetId) && (c = this.selectedAssetId, d = this.selectedAssetLinkId);
  a.setParam(this.paramPrefix + "dynamic_nest_get", "");
  this.$container.find('input[name*="additional_get"]').each(function() {
    a.setParam(jQuery(this).attr("name"), jQuery(this).val())
  });
  a.setParam(this.paramPrefix + "nested_assetid[assetid]", c);
  a.setParam(this.paramPrefix + "nested_assetid[linkid]", d);
  a.setParam(this.paramPrefix +
    "nested_assetid[url]", "");
  c = this.$container.find('select[name="layout_type"]').val();
  d = "0";
  "arbitrary" === c && (d = this.$container.find('select[name="layout_list"]').val(), "" === d && (c = "raw"));
  var e = this.$container.find('input[id$="_dynamic_nest_get"]');
  a.setParam(e.attr("name"), e.val());
  a.setParam(this.paramPrefix + "paint_with", EasyEdit.isset(c) ? c : "raw");
  a.setParam(this.paramPrefix + "paint_with_layout[assetid]", d);
  a.setParam(this.paramPrefix + "paint_with_layout[linkid]", "");
  a.setParam(this.paramPrefix + "paint_with_layout[url]",
    "");
  a.setParam("bodycopy_saved[bodycopy_" + b.bodycopyId + "][" + this.id + "]", "");
  return a
};
BodycopyDivNested.prototype.render = function(a) {
  function b(a, b, c) {
    return m + "additional_get[" + b + "][" + c + "]"
  }
  var c = this;
  c.$container = a;
  if (!0 !== c.attribute("readonly")) {
    var d = jQuery("<div />").append(this.attribute("raw_content")),
      a = /^bodycopy_([0-9+)_content_type_nest_content_([0-9]+)_/.exec(d.find("input:first").attr("id"));
    null !== a && (c.paramPrefix = a[0]);
    var e = "",
      f = e = "",
      g = d.find('div[id*="more-details"]'),
      j = g.find("img.sq-icon:eq(0)"),
      h = d.find('input[id*="nested_assetid[assetid]"]').val(),
      k = d.find('input[id*="nested_assetid_label"]').val(),
      l = "ees_nestedContent_" + this.id,
      a = "page_custom_form,page_asset_builder,page_user_group_manager,page_password_reset,page_link_manager,page_online_quiz,page_poll,ecommerce_checkout,ecommerce_cart,page_custom_form_ecommerce,payment_gateway,page_redirect".split(",");
    g.length && (e = j.attr("src").split("/").reverse(), e = e[1], f = j.attr("alt"));
    j = {
      bindElem: "#" + l,
      bindFn: function(a) {
        if (a !== null) {
          c.selectedAssetId = a.id;
          c.selectedAssetLinkId = a.attribute("link_info")
        } else {
          c.selectedAssetId = "";
          c.selectedAssetLinkId =
            ""
        }
        c.events.trigger("change")
      }
    };
    "" !== h && (j.prefillNode = {
      assetid: h,
      name: k,
      type_code: e,
      type: f
    }, this.selectedAssetId = jQuery('input[name$="nested_assetid[assetid]"]', d).val(), this.selectedAssetLinkId = jQuery('input[name$="nested_assetid[linkid]"]', d).val());
    var h = {
        tag: "div",
        id: l,
        "class": "ees-nested-content-div"
      },
      n = jQuery(EasyEdit.tmpl.render("id_tag", h));
    d.find("#sq_preview_new_window").prepend(n.find(".bodycopy_nested_additional_get"));
    k = d.find('a[id*="additional_get"]');
    if (k.length) {
      var m = k.attr("id").split("additional_get")[0],
        k = "bodycopy_nested_content";
      j.bindElem += " .bodycopy_nested_content_picker";
      var o = [{
          name: {
            label: EasyEditLocalise._("Name"),
            id: b(m, 0, "name"),
            value: ""
          },
          value: {
            label: EasyEditLocalise._("Value"),
            id: b(m, 0, "value"),
            value: ""
          },
          delete_title: EasyEditLocalise._("Delete this parameter")
        }],
        l = d.find('input[name*="[name]"]');
      l.length && (o = [], l.each(function(a) {
        var c = jQuery(this).attr("name").replace("[name]", "[value]");
        o.push({
          name: {
            label: EasyEditLocalise._("Name"),
            id: b(m, a, "name"),
            value: jQuery(this).val()
          },
          value: {
            label: EasyEditLocalise._("Value"),
            id: b(m, a, "value"),
            value: d.find('input[name="' + c + '"]').val()
          },
          delete_title: EasyEditLocalise._("Delete this parameter")
        })
      }));
      l = d.find('input[id$="_dynamic_nest_get"]');
      h.dynamic_get = {
        title: EasyEditLocalise._("Dynamic Options"),
        description: EasyEditLocalise._("Dynamically change the asset being nested using a GET parameter in the URL of the site. In this field, set a GET variable name - this variable can then be used in conjunction with an asset ID to change the nested content."),
        input: {
          id: l.attr("id"),
          label: EasyEditLocalise._("GET variable name"),
          value: l.val()
        }
      };
      h.additional_get = {
        title: EasyEditLocalise._("Additional GET Parameters"),
        description: EasyEditLocalise._("Pass extra GET variables to the asset that is being nested. These values can include Global Keyword Replacements (%globals_*%), Keyword Replacements of the nested asset (%nested_asset_*%) and Keyword Replacements of the nesting asset (%asset_*%). To add a new GET variable, click the Add a new variable button. Additional fields will appear where you can enter the details for the variable."),
        note: "",
        add: EasyEditLocalise._("Add new variable") + "...",
        params: o
      };
      l = {
        title: EasyEditLocalise._("Paint Layouts"),
        description: EasyEditLocalise._("Style the content that is being nested through the use of a Paint Layout. A list of predefined Paint Layouts can be specified in the Edit+ configuration file."),
        types: [{
          value: "raw",
          description: EasyEditLocalise._("No Paint Layout")
        }, {
          value: "default",
          description: EasyEditLocalise._("Inherit the Paint Layout applied to current asset")
        }]
      };
      f = d.find('input[id$="_paint_with_layout[assetid]"]').val();
      g = d.find('input[id$="_paint_with_layout_label"]').val();
      if (0 !== parseInt(f, 10) || EasyEdit.isset(EasyEditConfig.paintLayouts) && EasyEdit.isset(EasyEditConfig.paintLayouts.length) && 1 <= EasyEditConfig.paintLayouts.length) {
        l.types.push({
          value: "arbitrary",
          description: EasyEditLocalise._("Select from a list of predefined Paint Layouts")
        });
        l.list = [{
          id: "",
          name: EasyEditLocalise._("None selected")
        }];
        if (0 !== parseInt(f, 10)) {
          var r = !1;
          if (EasyEdit.isset(EasyEditConfig.paintLayouts))
            for (var p = 0; p < EasyEditConfig.paintLayouts.length; p++)
              if (EasyEditConfig.paintLayouts[p].id.toString() ===
                f.toString()) {
                r = !0;
                break
              }!1 === r && l.list.push({
            id: f,
            name: EasyEditLocalise._("Leave unchanged (%1)", g)
          })
        }
        EasyEdit.isset(EasyEditConfig.paintLayouts) && (l.list = l.list.concat(EasyEditConfig.paintLayouts))
      }
      h.layout = l;
      h.show_button = EasyEditLocalise._("Show additional options");
      h.form_nesting_warning = ""; - 1 !== jQuery.inArray(e, a) && (h.formNestedMessage = EasyEditLocalise._("You are nesting in a form based asset. This can cause issues if caching is enabled. Please ensure caching settings are properly configured."),
        h.form_nesting_warning = !0);
      var n = jQuery(EasyEdit.tmpl.render(k, h)),
        a = d.find('input[name$="_paint_with"]:checked').val(),
        e = n.find(".layout_type"),
        s = n.find(".layout_list");
      e.removeClass("screenHide");
      n.find('option[value="' + a + '"]').attr("selected", "selected");
      "arbitrary" === a && (s.removeClass("screenHide"), n.find("option").filter(function() {
        return d.find('input[id$="_paint_with_layout[assetid]"]').val() === jQuery(this).val()
      }).attr("selected", "selected"));
      n.find('select[name="layout_type"]').on("change",
        function() {
          jQuery(this).val() === "arbitrary" ? s.removeClass("screenHide") : s.addClass("screenHide")
        });
      var q = n.find(".showButton"),
        t = n.find(".bodycopy_nested_additional_get");
      t.hide();
      q.click(function(a) {
        a.preventDefault();
        t.is(":visible") ? q.text(EasyEditLocalise._("Show additional options")) : q.text(EasyEditLocalise._("Hide additional options"));
        t.slideToggle()
      });
      var w = n.find(".nested_param:first").clone(),
        v = n.find(".bodycopy_nested_params"),
        u = function(a, c) {
          a.find(".name input").attr({
            id: b(m, c, "name"),
            name: b(m, c, "name")
          });
          a.find(".value input").attr({
            id: b(m, c, "value"),
            name: b(m, c, "value")
          });
          return a
        };
      n.find(".addNewParam").click(function(a) {
        a.preventDefault();
        var a = w.clone(),
          b = n.find(".nested_param").length,
          a = u(a, b);
        a.find("input").val("");
        v.append(a)
      });
      n.on("click", ".deleteButton", function(a) {
        a.preventDefault();
        var b = jQuery(this).parent().parent();
        b.find("input").val("");
        b.fadeOut(500, function() {
          b.remove()
        });
        n.find(".nested_param").each(function(a) {
          u(jQuery(this), a)
        });
        EasyEditComponentsToolbar.enableSaveButton()
      });
      n.on("change", "input", function() {
        EasyEditComponentsToolbar.enableSaveButton()
      })
    }
    d.find('div[id$="wysiwyg_div"]').remove();
    d.find(">div").each(function() {
      $(this).removeAttr("onclick")
    });
    d.html(Viper.prototype.cleanHTML(d.html()));
    d.find(".sq-backend-nest-content-table").next("script").remove();
    d.find(".sq-backend-nest-content-table").replaceWith(n);
    this.$container.append(d);
    this.nestedPicker = new EasyEditAssetPicker(j);
    this.events.trigger("rendered")
  }
};
BodycopyDivWysiwyg = function(a) {
  this.events = new ObservableEvents(this, ["change", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.$container = null;
  this.paramPrefix = ""
};
BodycopyDivWysiwyg.prototype.getFriendlyContainerName = function() {
  if ("undefined" !== this.attr.data.name) return EasyEditLocalise._(this.attr.data.name)
};
BodycopyDivWysiwyg.prototype.queueSave = function(a, b) {
  a.setParam(this.paramPrefix, this.getContent(b.viper));
  a.setParam("ees_content_no_filter", "1");
  a.setParam("bodycopy_saved[bodycopy_" + b.bodycopyId + "][" + this.id + "]", "");
  for (key in b.comments) a.setParam("container_comments_" + key, b.comments[key]);
  this.events.trigger("save_queued");
  return a
};
BodycopyDivWysiwyg.prototype.getContent = function(a) {
  var b = this.$container.find('div[id$="contents_div"][id*="content_type_wysiwyg_"], textarea[name$="contents_div_viper_input"][id*="content_type_wysiwyg_"]').get(0);
  if (b) return a.getHtml(b)
};
BodycopyDivWysiwyg.prototype.render = function(a) {
  this.$container = a;
  a = jQuery("<div />");
  jQuery(this.attribute("raw_content")).appendTo(a);
  this.paramPrefix = a.find('textarea[id*="content_type_wysiwyg_"]').attr("id");
  a.find('div[id$="wysiwyg_div"]').remove();
  a.find(">div").each(function() {
    $(this).removeAttr("onclick")
  });
  a.html(Viper.prototype.cleanHTML(a.html()));
  this.$container.append(a.html())
};
EasyEditScreens.assetTypes.page_standard = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Content: {
        objectName: "contentPageStandard",
        className: "content",
        displayName: EasyEditLocalise._("Content"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.contentPageStandard = {
  containerId: null,
  bodycopyManager: null,
  init: function(a, b, c) {
    var d = this;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(e) {
      d.bodycopyManager = new EasyEditBodycopyManager(e, a, function() {
        0 >= d.bodycopyManager.bodycopies.length || b ? EasyEditScreens.getLockError(function(a) {
          var b = jQuery(".ees_viperContent:first");
          b.parent().addClass("readOnly");
          var c = 0;
          jQuery.each(d.bodycopyManager.$html, function(a, b) {
            "script" === b.nodeName.toLowerCase() && (c += 1)
          });
          null !==
            a && -1 !== a.indexOf("Unable to acquire") && 5 <= c ? b.append("<h2>" + EasyEditLocalise._("This content is locked for editing") + '</h2><div class="message">' + a + '</div><div class="suggestion">' + EasyEditLocalise._("To resolve a potential locking conflict please contact the person who holds locks or wait for locks to expire.") + "</div>") : 5 <= c ? d.bodycopyManager.render() : b.append(d.bodycopyManager.$html)
        }) : d.bodycopyManager.render();
        d._attachEvents(c);
        EasyEditEventManager.trigger("EasyEditPageStandardLoadComplete")
      });
      d.bodycopyManager.events.observe("change", function() {
        EasyEditComponentsToolbar.enableSaveButton()
      })
    })
  },
  save: function(a) {
    EasyEditOverlay.showOverlay("loading", {
      message: EasyEditLocalise._("Saving content...")
    });
    this.bodycopyManager.save(a)
  },
  _attachEvents: function(a) {
    a.call(this)
  },
  cleanUp: function() {
    this.bodycopyManager.hasOwnProperty("viper") && null !== this.bodycopyManager.viper && (this.bodycopyManager.viper.destroy(), this.bodycopyManager.viper = null)
  }
};
EasyEditScreens.assetTypes.defaultAsset = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  },
  iframeLoadCounter: 0,
  readablizeBytes: function(a) {
    var b = [EasyEditLocalise._("bytes"), EasyEditLocalise._("kb"),
        EasyEditLocalise._("MB"), EasyEditLocalise._("GB"), EasyEditLocalise._("TB"), EasyEditLocalise._("PB")
      ],
      c = Math.floor(Math.log(a) / Math.log(1024));
    return (a / Math.pow(1024, Math.floor(c))).toFixed(2) + " " + b[c]
  },
  addStylesToEditingFrame: function(a) {
    var b = EasyEditScreens.assetTypes.defaultAsset;
    if ("object" === typeof a && a.find(".htmlarea iframe").hasClass("active")) return !1;
    if (1 == b.iframeLoadCounter) {
      var a = jQuery(".htmlarea iframe"),
        c = '<link rel="stylesheet" type="text/css" href="' + EasyEditUrl.getBaseSiteURL() +
        '/__data/ees/CSS/wysiwyg-iframe-styles.css"  media="screen" />';
      a.addClass("active").attr("frameborder", "0");
      a.contents().find("body").addClass("editingFrame");
      a.contents().find("head").append(c);
      b.iframeLoadCounter = 0
    } else b.iframeLoadCounter++, timer = setTimeout(b.addStylesToEditingFrame, 100)
  }
};
EasyEditScreens.assetTypes.page_redirect = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsRedirectPage",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.detailsRedirectPage = {
  containerId: null,
  picker: null,
  slider: null,
  readOnly: !1,
  init: function(a, b, c) {
    this.containerId = a;
    this.readOnly = b;
    var d = this,
      e = new EasyEditAPI;
    EasyEditAssetManager.getCurrentAsset(function(f) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(f, function(g) {
        var j = EasyEditScreens.screen.detailsDefault._getDetailsHTML(f),
          h = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(f);
        d.getTemplate(f, function(k) {
          var l = jQuery(d.containerId),
            k = '<div id="ees_editDetails">' +
            g + j + k + h + "</div>",
            l = jQuery(d.containerId),
            n = l.find("#ees_editDetails");
          n.length ? n.replaceWith(k) : l.append(k);
          k = 0;
          if (!b) {
            var m = l.find("input.ees_redirectAssetId"),
              o = l.find("input.ees_redirectAssetName"),
              k = parseFloat(m.val()),
              r = l.find("input.ees_permanentRedirect");
            d.slider = new EasyEditSlider({
              bindElem: "#ees_detailsRedirect .ees_permanentRedirectSlider",
              defaultVal: 1 === parseFloat(r.val()) ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No"),
              options: [
                [EasyEditLocalise._("Yes"), EasyEditLocalise._("Make this redirect permanent"),
                  function() {}
                ],
                [EasyEditLocalise._("No"), EasyEditLocalise._("Make this redirect temporary"), function() {}]
              ]
            });
            d.slider.events.observe("change", function() {
              r.val(d.slider.getSelected() === EasyEditLocalise._("Yes") ? 1 : 0);
              EasyEditComponentsToolbar.enableSaveButton()
            });
            var p = {
              bindElem: "#ees_redirectAsset",
              rootNode: f.id,
              bindFn: function(a) {
                EasyEdit.isset(a) ? (m.val(a.id), o.val(a.attribute("name"))) : (m.val(""), o.val(""));
                EasyEditComponentsToolbar.enableSaveButton()
              }
            }
          }
          0 !== k && !isNaN(k) ? e.queue("getGeneral", {
            asset_id: k
          }).run(function(e) {
            EasyEdit.isset(e[0]) &&
              e[0].hasOwnProperty("data") && !EasyEdit.isError(e[0].data) && (p.prefillNode = {
                assetid: m.val(),
                name: o.val(),
                type_code: e[0].data.type_code
              }, d.picker = new EasyEditAssetPicker(p), EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c))
          }) : (!b && EasyEdit.isset(p) && (d.picker = new EasyEditAssetPicker(p)), EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c))
        })
      })
    })
  },
  save: function(a) {
    EasyEditScreens.screen.detailsDefault.save(function() {
      EasyEditOverlay.showOverlay("loading");
      EasyEditAssetManager.getCurrentAsset(function(b) {
        var c =
          new EasyEditSimpleEditRequest({
            assetid: b.id,
            backend_assetid: b.id,
            screen: "details"
          });
        jQuery("#ees_detailsRedirect").find("input").each(function() {
          c.setParam(jQuery(this).attr("name"), jQuery(this).val())
        });
        c.send(function() {
          a.apply(this, [!0, [], {
            refresh: !0
          }])
        })
      })
    })
  },
  getTemplate: function(a, b) {
    var c = this,
      d = new EasyEditAPI;
    d.queue("getKeywordsReplacements", {
      asset_id: a.id,
      keywords_array: ["%details-S_location%"]
    }).queue("getKeywordsReplacements", {
      asset_id: a.id,
      keywords_array: ["%details-S_redirect_type%"]
    }).run(function(a) {
      var d =
        a[0],
        a = a[1];
      if (d.hasOwnProperty("data") && !EasyEdit.isError(d.data)) {
        var d = jQuery(d.data["details-S_location"]["details-S_location"]),
          a = jQuery(a.data["details-S_redirect_type"]["details-S_redirect_type"]),
          g = jQuery.merge(d, a).wrap("<div />").parent(),
          d = "";
        if (c.readOnly) {
          var j = "",
            h = "";
          jQuery.each(g, function(a, b) {
            var c = jQuery(b).find("table.sq-backend-section-table-inner");
            c.length && jQuery(b).find(".sq-limbo-section-heading").filter(function() {
              return "Location" === jQuery(this).text()
            }).length && (c = c.find(".sq-backend-data"),
              j = jQuery(c[0]).find(".sq-backend-smallprint").remove().end().text(), h = jQuery(c[1]).find("div").remove().end().text())
          });
          d = EasyEdit.tmpl.render("details_screen_page_redirect_read_only", {
            heading: EasyEditLocalise._("Redirect Options"),
            redirect_url: {
              label: EasyEditLocalise._("Redirect to URL"),
              value: j
            },
            redirect_asset: {
              label: EasyEditLocalise._("Redirect to asset"),
              name: h
            }
          })
        } else var d = g.find('input[id$="_redirect_assetid[assetid]"]'),
          a = g.find('input[id$="_redirect_assetid_label"]'),
          k = g.find("input:first"),
          g = g.find("select:first"),
          l = EasyEditLocalise._("Selecting 'Yes' will send a 301 response code, selecting 'No' will send a 302 response code. The code '301' is interpreted as 'moved permanently' (which is useful for search engines) whereas '302' is interpreted as 'moved temporarily'."),
          d = EasyEdit.tmpl.render("details_screen_page_redirect", {
            heading: EasyEditLocalise._("Redirect Options"),
            redirect_url: {
              label: EasyEditLocalise._("Redirect to URL"),
              notes: EasyEditLocalise._("URL to redirect to, including URI scheme (for example, http://www.squiz.net/). Global keywords are supported."),
              value: k.val(),
              id: k.attr("id")
            },
            redirect_asset: {
              label: EasyEditLocalise._("Redirect to asset"),
              notes: EasyEditLocalise._("Select an asset to redirect the user to."),
              id: d.attr("id"),
              value: d.val()
            },
            redirect_asset_name: {
              id: a.attr("id"),
              value: a.val()
            },
            permanent_redirect: {
              label: EasyEditLocalise._("Permanent?"),
              notes: l,
              value: g.val(),
              id: g.attr("id")
            }
          });
        b.call(c, d)
      }
    }, d.runMode.BATCH)
  }
};
BodycopyDivMarkdown = function(a) {
  this.events = new ObservableEvents(this, ["change", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.$container = null;
  this.paramPrefix = ""
};
BodycopyDivMarkdown.prototype.queueSave = function(a, b) {
  a.setParam(this.paramPrefix + "markdown", this.getContent());
  a.setParam("bodycopy_saved[bodycopy_" + b.bodycopyId + "][" + this.id + "]", "");
  this.events.trigger("save_queued");
  return a
};
BodycopyDivMarkdown.prototype.getFriendlyContainerName = function() {
  return EasyEditLocalise._("Markdown Content Container")
};
BodycopyDivMarkdown.prototype.getContent = function() {
  return EasyEdit.fixHtml(this.$container.find("textarea").val())
};
BodycopyDivMarkdown.prototype.render = function(a) {
  var b = this;
  b.$container = a;
  a = jQuery("<div />");
  jQuery(b.attribute("raw_content")).appendTo(a);
  a = a.find("textarea");
  a.removeAttr("style");
  var c = /^bodycopy_([0-9+)_content_type_markdown_([0-9]+)_/.exec(a.attr("id"));
  null !== c && (b.paramPrefix = c[0]);
  a.bind("change", function() {
    b.events.trigger("change")
  });
  b.$container.append(a);
  b.events.trigger("render")
};
EasyEditScreens.screen.manageContent = {
  containerId: null,
  directChildList: null,
  hasCategory: !1,
  category: "",
  init: function(a, b, c) {
    var d = this;
    d.containerId = a;
    EasyEditWorkspaceManager.getCurrentWorkspace(function(b) {
      jQuery(a).html(d._getTemplate(b.name));
      "string" === typeof b.category && (d.hasCategory = !0, d.category = b.category);
      d.buildWorkspace(b.rootNode, function() {
        if (d.hasCategory) EasyEditComponentsCategory.init({
          rootNode: b.rootNode,
          category: b.category,
          onSelect: function(a) {
            var b = a.find(".assetId").text(),
              a =
              a.find(".assetName").text();
            d.reset(a);
            EasyEditOverlay.showOverlay("loading");
            d.buildWorkspace(b, function() {
              EasyEditOverlay.hideOverlay()
            })
          },
          onMouseover: function(a) {
            a.addClass("dropTarget")
          },
          onMouseout: function(a) {
            a.removeClass("dropTarget")
          }
        }, function() {
          d._attachEvents();
          c.call(d)
        });
        else {
          d._attachEvents();
          c.call(d)
        }
      })
    })
  },
  save: function(a) {
    EasyEditOverlay.showOverlay("loading");
    var b = EasyEditScreens.getCurrentScreen();
    b.directChildList.save(function(c, d, e) {
      a.apply(this, [c, d, jQuery.extend(e, {
        onSave: function() {
          b.buildWorkspace.apply(b, [b.directChildList.settings.rootNode, function() {}])
        },
        refresh: !1
      })])
    })
  },
  _getTemplate: function(a) {
    return '<div id="ees_workspace"><h3>' + a + '</h3><div id="ees_lastLinkWarning" class="screenHide"><span class="warningTitle">' + EasyEditLocalise._("Warning") + "</span> " + EasyEditLocalise._("Content items marked for deletion will be moved to the trash when you click the save button") + ". <br />  " + EasyEditLocalise._("Hyperlinks or references to items marked for deletion will not work when the item is in the trash") +
      ". </div></div>"
  },
  stopDrag: function(a, b) {
    EasyEditComponentsToolbar.enableSaveButton();
    var c = b.item.find(".assetId").text().replace("#", ""),
      d = jQuery("#ees_categoryList .dropTarget");
    if (d.length && "undefined" !== typeof c) {
      var e = d.find(".assetName:first").text(),
        f = d.find(".assetId:first").text();
      c === f ? (new EasyEditError(EasyEditLocalise._("You cannot move an asset beneath itself."))).display(5) : EasyEditTooltip.init({
        targetSelectorRule: d,
        containerId: "ees_moveCategoryTooltip",
        position: "east",
        tooltipHTML: "<p>" +
          EasyEditLocalise._('Are you sure you want to move this asset under "%1"?', e) + '</p><p><a href="#" id="ees_tooltipMoveConfirm" class="alignLeft blackButton"><span>' + EasyEditLocalise._("Confirm") + '</span><span></span></a><a href="#" id="ees_tooltipMoveCancel" class="alignLeft blackButton"><span>' + EasyEditLocalise._("Cancel") + "</span><span></span></a></p>",
        onComplete: function() {
          jQuery("#ees_tooltipMoveConfirm").click(function(a) {
            var b = EasyEditScreens.getCurrentScreen();
            a.preventDefault();
            EasyEditOverlay.showOverlay("loading");
            jQuery("#ees_moveCategoryTooltip").remove();
            EasyEditAssetManager.getAsset(c, function(a) {
              var c = jQuery("#ees_categoryList .ees_categoryListBody").find(".selected").find(".assetId:first").text();
              a.move(c, f, function(d) {
                EasyEdit.isError(d) ? ((new EasyEditError(EasyEdit.getError(d))).display(5), EasyEditOverlay.hideOverlay()) : (b.reset.call(b, jQuery("#ees_workspace h3:first").text()), b.buildWorkspace.apply(b, [c, function() {
                  b.hasCategory && null !== a && b.category === a.attribute("type_code") && EasyEditComponentsCategory.moveCategory(a.id,
                    f);
                  EasyEditOverlay.hideOverlay()
                }]))
              })
            })
          });
          jQuery("#ees_tooltipMoveCancel").click(function(a) {
            a.preventDefault();
            jQuery("#ees_moveCategoryTooltip").remove()
          })
        }
      })
    }
    jQuery("#ees_categoryList .ees_categoryListBody>ul").removeClass("dragActive");
    jQuery("#ees_screenContent").css("position", "relative")
  },
  startDrag: function() {
    jQuery("#ees_categoryList .ees_categoryListBody>ul").addClass("dragActive");
    jQuery("#ees_screenContent").css("position", "static")
  },
  buildWorkspace: function(a, b) {
    var c = this;
    c.directChildList =
      new EasyEditAssetChildList({
        rootNode: a,
        bindElem: "#ees_workspace",
        canDelete: !0,
        maxChar: 80,
        sortable: {
          axis: "xy",
          cancel: "li.markedForDeletion",
          handle: ".dragIcon",
          zIndex: 2E3,
          start: c.startDrag,
          stop: c.stopDrag
        },
        onLoad: function() {
          EasyEditScreens.getCurrentScreen().hasCategory && jQuery(".assetDeleteOption", "#ees_workspace").click(function() {
            var a = [],
              b = jQuery(this).parent().find(".assetId").text().replace("#", "");
            jQuery(this).parent().parent().hasClass("markedForDeletion") || a.push(b);
            jQuery("#ees_workspace li.markedForDeletion .assetId").each(function() {
              var c =
                jQuery(this).text().replace("#", "");
              1 * c !== 1 * b && a.push(c)
            });
            EasyEditComponentsCategory.hideCategories(a)
          });
          b.call(c)
        }
      })
  },
  reset: function(a) {
    jQuery(this.containerId).html(this._getTemplate(a))
  },
  _attachEvents: function() {}
};
EasyEditScreens.assetTypes.calendar_event_single = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsSingleCalendarEvent",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Content: {
        objectName: "contentCalendarEvent",
        className: "content",
        displayName: EasyEditLocalise._("Content"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.assetTypes.calendar_event_recurring = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsRecurringCalendarEvent",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Content: {
        objectName: "contentCalendarEvent",
        className: "content",
        displayName: EasyEditLocalise._("Content"),
        lockType: ["attributes", "links"],
        isDefault: !1
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.contentCalendarEvent = {
  containerId: null,
  viper: null,
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(a) {
      e.queue("getKeywordsReplacements", {
        asset_id: a.id,
        keywords_array: ["%details-F_description%"]
      });
      e.expect(1).run(function(e) {
        var e = e[0].data,
          j = e["details-F_description"]["details-F_description"];
        EasyEdit.isError(e);
        var e = jQuery(j),
          h = e.find('div[id$="_contents_div"]'),
          k = h.html();
        h.length || (k = j, b = !0);
        j = h.attr("data-keywords");
        h = h.attr("data-snippets");
        k = jQuery(EasyEdit.tmpl.render("calendar_content", {
          wrapper_id: "ees_viperContentWrapper",
          container_id: "ees_viperContent",
          heading: "Event Description",
          content: k,
          assetid: a.id,
          data_keywords: j,
          data_snippets: h
        }));
        e = e.find("textarea");
        e.hide();
        k.append(e);
        e = jQuery(d.containerId);
        j = e.find("#ees_viperContentWrapper");
        j.length ? j.replaceWith(k) : e.append(k);
        jQuery("#ees_viperContentWrapper").addClass("withViper");
        b || d._attachEvents();
        c.call(this)
      })
    })
  },
  _attachEvents: function() {
    var a = jQuery(this.containerId).find(".bodycopy_content");
    this.viper = EasyEdit.loadViper({
      editableDivs: a
    })
  },
  save: function(a) {
    var b = this,
      c = [],
      d = {};
    EasyEditOverlay.showOverlay("loading");
    EasyEditAssetManager.getCurrentAsset(function(e) {
      var f = b.viper.getHtml(jQuery(b.containerId).find(".bodycopy_content").get(0)),
        g = jQuery(b.containerId).find("textarea").attr("id"),
        j = new EasyEditSimpleEditRequest({
          backend_assetid: e.id,
          assetid: e.id,
          screen: "details"
        });
      j.setParam(g, f);
      j.setParam("ees_content_no_filter", "1");
      j.send(function() {
        e.acquireLock("all", function() {
          a.apply(this, [!0, c, d])
        })
      })
    })
  },
  cleanUp: function() {
    null !== this.viper && (this.viper.destroy(), this.viper = null)
  }
};
EasyEditScreens.screen.detailsSingleCalendarEvent = {
  containerId: null,
  startDatePicker: null,
  endDatePicker: null,
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditDebug.log("CALENDAR DETAILS", a, b);
    EasyEditAssetManager.getCurrentAsset(function(f) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(f, function(g) {
        var j = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(f);
        e.queue("getKeywordsReplacements", {
          asset_id: f.id,
          keywords_array: ["%details-F_start_end%"]
        });
        e.expect(1).run(function(e) {
          var e =
            e[0].data,
            k = '<div id="ees_editDetails">' + g + d._getDetailsHTML(f),
            l = f.attribute("status");
          !b && "Archived" !== l && -1 === l.indexOf("Approved") && (k += '<h3 class="sectionHeading">' + EasyEditLocalise._("Event Date") + '</h3><div id="ees_dateInfoContainer"><div id="ees_originalDateSelection" class="screenHide">' + EasyEdit.filterScriptSrc(e["details-F_start_end"]["details-F_start_end"]) + '</div><div id="ees_allDayEvent"><div class="cellName alignLeft">' + EasyEditLocalise._("All day event?") + '</div><div class="cellData"></div></div><div id="ees_useEndDate"><div class="cellName alignLeft">' +
            EasyEditLocalise._("Use end date?") + '</div><div class="cellData"></div></div><div id="ees_startDate"><div class="cellName alignLeft">' + EasyEditLocalise._("Start date") + '</div><div class="cellData alignLeft"><span class="currentStart"></span></div></div><div id="ees_changeStartDate"><div class="cellName alignLeft">' + EasyEditLocalise._("Change") + '</div><div class="cellData alignLeft"><span class="picker"></span></div></div><div id="ees_endDate" class="endDateBlock"><div class="cellName alignLeft">' +
            EasyEditLocalise._("End date") + '</div><div class="cellData alignLeft"><span class="currentEnd"></span></div></div><div id="ees_changeEndDate" class="endDateBlock"><div class="cellName alignLeft">' + EasyEditLocalise._("Change") + '</div><div class="cellData alignLeft"><span class="picker"></span></div></div></div>');
          var k = k + (j + "</div>"),
            l = jQuery(d.containerId),
            n = l.find("#ees_editDetails");
          n.length ? n.replaceWith(k) : l.append(k);
          b && (jQuery("#ees_dateInfoContainer").hide(), e = '<h3 class="sectionHeading">' +
            EasyEditLocalise._("Event date") + '</h3><div class="dateSelection">' + e["details-F_start_end"]["details-F_start_end"] + "</div>", jQuery("#ees_pageNaming").after(e));
          EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c);
          jQuery("#ees_pageNaming span.readOnly").length && jQuery("#ees_dateInfoContainer").remove();
          d._attachEvents()
        })
      })
    })
  },
  _attachEvents: function() {
    var a = this,
      b = jQuery("#ees_originalDateSelection");
    b.find('input[type="checkbox"]').attr("onclick", "");
    var c = b.find('input[type="checkbox"][id$="_start_time_enabled"]').prop("checked") ||
      b.find('input[type="checkbox"][id$="_end_time_enabled"]').prop("checked"),
      d = jQuery("#ees_allDayEvent .cellData");
    d.length && (slider = new EasyEditSlider({
      bindElem: d,
      defaultVal: c ? EasyEditLocalise._("No") : EasyEditLocalise._("Yes")
    }));
    var e = b.find('input[type="checkbox"][id$="_end_enabled"]').prop("checked"),
      f = jQuery("#ees_useEndDate .cellData");
    f.length && (slider = new EasyEditSlider({
      bindElem: f,
      defaultVal: e ? EasyEditLocalise._("Yes") : EasyEditLocalise._("No")
    }));
    if (jQuery("#ees_changeStartDate").length && (a.startDatePicker =
        new EasyEditDatePicker({
          bindElem: "#ees_changeStartDate .picker",
          matrixDateElem: "#ees_originalDateSelection table:eq(0)",
          minimumDate: function() {
            return new Date("1 Jan " + ((new Date).getFullYear() - 10))
          },
          invalidHandler: function() {},
          onChange: function() {
            EasyEditComponentsToolbar.enableSaveButton();
            var b = a.startDatePicker.getDate(),
              c = a.endDatePicker.getDate();
            b > c && (a.endDatePicker.setDate(b), a.endDatePicker.onChange());
            jQuery("#ees_dateInfoContainer .fieldWarning").remove()
          },
          onLoad: function() {
            var a = this.getDate(),
              b = this.ordinalise(a.getDate()) + " " + this.monthIndexToName(a.getMonth()) + " " + a.getFullYear();
            c && (b = b + ", " + this.addLeadingZero((a.getHours() + 11) % 12 + 1) + ":" + this.addLeadingZero(a.getMinutes()) + " " + (12 <= a.getHours() ? "pm" : "am"));
            jQuery("#ees_startDate .currentStart").text(b);
            EasyEditComponentsToolbar.disableSaveButton()
          }
        }), a.endDatePicker = new EasyEditDatePicker({
          bindElem: "#ees_changeEndDate .picker",
          matrixDateElem: "#ees_originalDateSelection table:eq(1)",
          minimumDate: function() {
            return a.startDatePicker.settings.minimumDate()
          },
          invalidHandler: function() {},
          onChange: function() {
            EasyEditComponentsToolbar.enableSaveButton();
            var b = a.startDatePicker.getDate(),
              c = a.endDatePicker.getDate();
            b > c && (a.startDatePicker.setDate(c), a.startDatePicker.onChange());
            jQuery("#ees_dateInfoContainer .fieldWarning").remove()
          },
          onLoad: function() {
            var a = this.getDate(),
              b = this.ordinalise(a.getDate()) + " " + this.monthIndexToName(a.getMonth()) + " " + a.getFullYear();
            c && (b = b + ", " + this.addLeadingZero((a.getHours() + 11) % 12 + 1) + ":" + this.addLeadingZero(a.getMinutes()) +
              " " + (12 <= a.getHours() ? "pm" : "am"));
            jQuery("#ees_endDate .currentEnd").text(b);
            EasyEditComponentsToolbar.disableSaveButton()
          }
        }), d.length && (d.find("a[data-id]").click(function(b) {
          b.preventDefault();
          b = 1 == $(this).attr("data-id");
          a.startDatePicker.includeTimeComponent(b);
          a.endDatePicker.includeTimeComponent(b);
          EasyEditComponentsToolbar.enableSaveButton()
        }), a.startDatePicker.includeTimeComponent(c), a.endDatePicker.includeTimeComponent(c)), f.length)) f.find("a[data-id]").click(function(a) {
      a.preventDefault();
      a = $(this).attr("data-id") == 0;
      b.find('input[type="checkbox"][id$="_end_enabled"]').prop("checked", a);
      b.find('input[type="radio"][id$="_end_date_enabled"]').attr("disabled", !a);
      b.find('input[type="text"][id$="_end_day"]').attr("disabled", !a);
      b.find('select[id$="_end_month"]').attr("disabled", !a);
      b.find('input[type="text"][id$="_end_year"]').attr("disabled", !a);
      if (c) {
        b.find('input[type="checkbox"][id$="_end_time_enabled"]').attr("disabled", !a);
        b.find('input[type="text"][id$="_end_hours"]').attr("disabled", !a);
        b.find('input[type="text"][id$="_end_minutes"]').attr("disabled", !a);
        b.find('select[id$="end_is_pm"]').attr("disabled", !a)
      }
      a ? jQuery("#ees_dateInfoContainer .endDateBlock").removeClass("screenHide") : jQuery("#ees_dateInfoContainer .endDateBlock").addClass("screenHide");
      EasyEditComponentsToolbar.enableSaveButton()
    }), e || jQuery("#ees_dateInfoContainer .endDateBlock").addClass("screenHide")
  },
  save: function(a) {
    if (EasyEdit.isset(this.startDatePicker) && EasyEdit.isset(this.endDatePicker) && jQuery("#ees_originalDateSelection table:eq(1)").find('input[type="checkbox"][id$="_end_enabled"]').prop("checked")) {
      var b =
        this.startDatePicker.getDate(),
        c = this.endDatePicker.getDate();
      if (b > c) return b = jQuery(EasyEdit.tmpl.render("simple_tag", {
        content: EasyEditLocalise._("Event start date must be before the end date."),
        tag: "span",
        "class": "fieldWarning"
      })), jQuery("#ees_startDate").prev(".fieldWarning").remove(), jQuery("#ees_startDate").before(b), EasyEditOverlay.hideOverlay(), !1
    }
    EasyEditScreens.screen.detailsDefault.save(function() {
      EasyEditOverlay.showOverlay("loading");
      EasyEditAssetManager.getCurrentAsset(function(b) {
        b.acquireLock("all",
          function() {
            var c = new EasyEditSimpleEditRequest({
              backend_assetid: b.id,
              assetid: b.id,
              screen: "details"
            });
            c.setParamsFromElement(jQuery("#ees_dateInfoContainer"));
            c.setParam("ees_content_no_filter", "1");
            c.send(function() {
              b.acquireLock("all", function() {
                a.apply(this, [!0, [], {
                  refresh: !0
                }])
              })
            })
          })
      })
    })
  },
  _getDetailsHTML: function(a) {
    a.attributes();
    var b = '<h3 class="sectionHeading">' + EasyEditLocalise._("Event Name") + '</h3><div id="ees_pageNaming"><div class="row"><div class="cellName alignLeft"><label for="ees_inputShortName" class="inputLabel">' +
      EasyEditLocalise._("Page Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputName" name="ees_inputName" class="inputText" value="" /> &nbsp;</div></div><div class="row" style="display:none"><div class="cellName alignLeft"><label for="ees_inputName" class="inputLabel">' + EasyEditLocalise._("Page Short Name") + '</label></div><div class="cellData alignLeft"><input type="text" id="ees_inputShortName" name="ees_inputShortName" class="inputText" value="" /> &nbsp;</div></div></div>',
      b = jQuery("<div>" + b + "</div>");
    b.find("#ees_inputName").attr("value", a.attribute("name"));
    b.find("#ees_inputShortName").attr("value", a.attribute("short_name"));
    return b.html()
  }
};
EasyEditScreens.screen.detailsRecurringCalendarEvent = jQuery.extend({}, EasyEditScreens.screen.detailsSingleCalendarEvent, {
  init: function(a, b, c) {
    var d = this,
      e = new EasyEditAPI;
    d.containerId = a;
    EasyEditAssetManager.getCurrentAsset(function(f) {
      EasyEditScreens.screen.detailsDefault.getStatusHTML(f, function(g) {
        var j = EasyEditScreens.screen.detailsDefault.getThumbnailHTML(f);
        e.queue("getKeywordsReplacements", {
          asset_id: f.id,
          keywords_array: ["%details-F_start_end%", "%details-F_frequency%"]
        });
        e.expect(1).run(function(e) {
          var k =
            e[0].data,
            e = '<div id="ees_editDetails">' + g + d._getDetailsHTML(f),
            l = f.attribute("status");
          !b && "Archived" !== l && -1 === l.indexOf("Approved") && (e += '<h3 class="sectionHeading">' + EasyEditLocalise._("Date Information") + '</h3><div id="ees_dateInfoContainer"><div id="ees_allDayEvent"><div class="cellName alignLeft">' + EasyEditLocalise._("All day event?") + '</div><div class="cellData"></div></div><div id="ees_useEndDate"><div class="cellName alignLeft">' + EasyEditLocalise._("Use end date?") + '</div><div class="cellData"></div></div><h2 class="dateInfoHeading">' +
            EasyEditLocalise._("First Instance of Event") + '</h2><div id="ees_editEventDates"><p class="notes">' + EasyEditLocalise._("When will this event first occur?") + '</p><div id="ees_originalDateSelection" class="screenHide">' + EasyEdit.filterScriptSrc(k["details-F_start_end"]["details-F_start_end"]) + '</div><div id="ees_startDate"><div class="cellName alignLeft">' + EasyEditLocalise._("Start date") + '</div><div class="cellData alignLeft"><span class="currentStart"></span></div></div><div id="ees_changeStartDate"><div class="cellName alignLeft">' +
            EasyEditLocalise._("Change") + '</div><div class="cellData alignLeft"><span class="picker"></span></div></div><div id="ees_endDate" class="endDateBlock"><div class="cellName alignLeft">' + EasyEditLocalise._("End date") + '</div><div class="cellData alignLeft"><span class="currentEnd"></span></div></div><div id="ees_changeEndDate" class="endDateBlock"><div class="cellName alignLeft">' + EasyEditLocalise._("Change") + '</div><div class="cellData alignLeft"><span class="picker"></span></div></div></div><h2 class="dateInfoHeading">' +
            EasyEditLocalise._("Event Frequency") + '</h2><div id="ees_editEventFrequency"><p class="notes">' + EasyEditLocalise._("How often will this event occur?") + '</p><div id="ees_frequency">' + k["details-F_frequency"]["details-F_frequency"] + "</div></div></div>");
          e += j + "</div>";
          k = jQuery(d.containerId);
          l = k.find("#ees_editDetails");
          l.length ? l.replaceWith(e) : k.append(e);
          EasyEditScreens.screen.detailsDefault.commonDetailsInit(a, f, b, c);
          jQuery("#ees_pageNaming span.readOnly").length && jQuery("#ees_dateInfoContainer").remove();
          d._attachEvents()
        })
      })
    })
  }
}, !0);
EasyEditScreens.assetTypes.powerpoint_doc = {
  getConfig: function() {
    var a = {
      Details: {
        objectName: "detailsFileDefault",
        className: "details",
        displayName: EasyEditLocalise._("Details"),
        lockType: ["attributes", "links"],
        isDefault: !0
      },
      Metadata: {
        objectName: "metadataDefault",
        className: "metadata",
        displayName: EasyEditLocalise._("Metadata"),
        lockType: "metadata",
        isDefault: !1
      },
      Workflow: {
        objectName: "workflowDefault",
        className: "workflow",
        displayName: EasyEditLocalise._("Workflow"),
        lockType: "workflow",
        isDefault: !1
      },
      Linking: {
        objectName: "linkingDefault",
        className: "linking",
        displayName: EasyEditLocalise._("Linking"),
        lockType: "links",
        isDefault: !1
      },
      URLs: {
        objectName: "urlsDefault",
        className: "urls",
        displayName: EasyEditLocalise._("URLs"),
        lockType: "lookups",
        isDefault: !1
      },
      Analytics: {
        objectName: "analyticsDefault",
        className: "analytics",
        displayName: EasyEditLocalise._("Analytics"),
        lockType: "none",
        isDefault: !1
      }
    };
    EasyEditConfig.analyticsViewId || delete a.Analytics;
    return a
  }
};
EasyEditScreens.screen.analyticsDefault.subScreens.goals = new function() {
  var a = this,
    b = EasyEditScreens.screen.analyticsDefault;
  this.name = EasyEditLocalise._("Goals");
  this.pageTitle = EasyEditLocalise._("Goals Summary");
  this.goals = null;
  this.showIf = function() {
    return !0 === b.current.isView
  };
  this.buildGoalDropdown = function(c, e, f, g) {
    c = [];
    c.push(function(a) {
      b.getGoals.call(b, function(b) {
        a(b)
      })
    });
    c.push(function(b, c) {
      var d = document.createElement("div");
      d.id = "ees_analyticsGoalSelectionClicker";
      d.className = "dropDownClicker";
      var l = document.createElement("span");
      l.className = "alignRight expand";
      var n = document.createElement("span");
      n.className = "textSpan";
      var m = EasyEditLocalise._("Select Goal"),
        o = "";
      f || (o = ' class="active"');
      for (var r = ['<a data-subscreen="summary"' + o + ">" + EasyEditLocalise._("Goals Summary") + "</a>"], p = 0; p < c.length; p++) o = "", f && f.id === c[p].id && (o = ' class="active"'), r.push('<a data-subscreen="' + c[p].id + '"' + o + '><span class="small-goal-type-sprite type-' + c[p].type.toLowerCase().replace(/_/g, "-") + '"></span>' + c[p].name +
        "</a>");
      null === f ? EasyEdit.util.setText(n, EasyEditLocalise._("Goals Summary")) : n.innerHTML = '<span class="small-goal-type-sprite type-' + f.type.toLowerCase().replace(/_/g, "-") + '"></span>' + f.name;
      d.appendChild(l);
      d.appendChild(n);
      e.appendChild(d);
      var s = EasyEdit.tip.create({
        targetId: "ees_analyticsGoalSelectionClicker",
        containerId: "ees_analyticsGoalSelectionTooltip",
        position: "south",
        title: m,
        message: r.join(""),
        buttons: [],
        className: "analyticsDropDownTooltip"
      });
      s.$element.find(".tooltipButtons").remove();
      s.$element.on("click", "a", function(b) {
        s.hide();
        b = b.target;
        EasyEdit.util.setText(d, EasyEdit.util.getText(b));
        d.innerHTML = '<span class="alignRight expand"></span>' + d.innerHTML;
        jQuery(e).children("div").addClass("hidden");
        jQuery("#ees_analyticsGoalSelectionClicker").removeClass("hidden");
        b = b.getAttribute("data-subscreen");
        "summary" === b ? a.show() : a.showGoal(b)
      });
      jQuery(d).on("click", null, function() {
        s.toggle()
      });
      g(d)
    });
    EasyEdit.util.async.series(c)
  };
  var c = function(a) {
    var c = "",
      f = b.util.bauble(5) + " " + EasyEditLocalise._("Conversion rate (% of all sessions)");
    switch (a.type) {
      case "URL_DESTINATION":
        c = EasyEditLocalise._("This goal is converted for a session when the set destination page is reached.");
        a.urlDestinationDetails.steps && 0 < a.urlDestinationDetails.steps.length && (c += " " + EasyEditLocalise._('This goal also tracks sessions that start a set "funnel" of pages, but then fail to reach the destination.'), f = b.util.bauble(5) + " " + EasyEditLocalise._("Conversion rate (% of all sessions)") + "<br/>" + b.util.bauble(2) + " " + EasyEditLocalise._("Abandonment rate (% of funnel starts)"));
        break;
      case "VISIT_TIME_ON_SITE":
        var g = Number(a.visitTimeOnSiteDetails.comparisonValue);
        "GREATER_THAN" === a.visitTimeOnSiteDetails.comparisonType && (g += 1);
        var j = "";
        60 <= g && (j += EasyEditLocalise._n("1 minute", "%1 minutes", Math.floor(g / 60), Math.floor(g / 60)));
        0 < g % 60 && ("" !== j && (j += " "), j += EasyEditLocalise._n("1 second", "%1 seconds", Math.floor(g % 60), Math.floor(g % 60)));
        switch (a.visitTimeOnSiteDetails.comparisonType) {
          case "GREATER_THAN":
            c = EasyEditLocalise._("This goal is converted when a session's duration (from first to last interaction) is at least %1.",
              j);
            break;
          case "LESS_THAN":
            c = EasyEditLocalise._("This goal is converted when a session's duration (from first to last interaction) is shorter than %1.", j);
            break;
          case "EQUAL":
            c = EasyEditLocalise._("This goal is converted when a session's duration  (from first to last interaction, to the nearest second) is exactly %1.", j)
        }
        break;
      case "VISIT_NUM_PAGES":
        g = Number(a.visitNumPagesDetails.comparisonValue);
        switch (a.visitNumPagesDetails.comparisonType) {
          case "GREATER_THAN":
            j = EasyEditLocalise._n("1 page", "%1 pages",
              g + 1, g + 1);
            c = EasyEditLocalise._("This goal is converted when a user views at least %1 in a session.", j);
            break;
          case "LESS_THAN":
            j = EasyEditLocalise._n("1 page", "%1 pages", g, g);
            c = EasyEditLocalise._("This goal is converted when a user views fewer than %1 in a session.", j);
            break;
          case "EQUAL":
            c = EasyEditLocalise._("This goal is converted when a user views exactly %1 in a session.", j)
        }
        break;
      case "EVENT":
        c = EasyEditLocalise._("This goal is converted when a Google Analytics Event Tracking event occurs that matches the goal's conditions.")
    }
    return b._buildHelpRollover(c,
      f)
  };
  this.show = function() {
    var d = document.querySelector("#ees_analyticsReportContents"),
      e = [],
      f = new EasyEditAPI,
      g = [
        ["goal_summary", {
          queryid: "goal_summary"
        }],
        ["goal_summary_previous", {
          queryid: "goal_summary",
          start_period: "previous"
        }],
        ["by_day", {
          queryid: "by_day"
        }],
        ["campaigns", {
          queryid: "campaigns"
        }],
        ["device", {
          queryid: "device"
        }]
      ];
    e.push(function(a) {
      b.getGoals.call(b, function(b) {
        a(b)
      })
    });
    e.push(function(a, c) {
      b.getBasicPageQuery.call(b, function(b) {
        a(b, c)
      })
    });
    e.push(function(a, c, e) {
      if (0 === e.length) d.innerHTML =
        "<div><p>" + EasyEditLocalise._("No goals have been created for this view") + "</p></div>", jQuery(d).addClass("status-goals-empty");
      else {
        for (var l, n = 0; n < g.length; n++) l = "goal_summary" === g[n][1].queryid ? {
          canned_query: "goal_summary",
          context: "all",
          url: null
        } : {
          canned_query: g[n][1].queryid,
          context: "goal",
          url: null,
          goalid: "all"
        }, g[n][1].start_period && (l.start_period = g[n][1].start_period), f.queue("getGoogleAnalyticsStatistics", b.util.extendQuery(c, l));
        f.expect(5).run(function(b) {
          a(e, b)
        }, f.runMode.BATCH)
      }
    });
    e.push(function(a,
      b, c) {
      for (var d = 0; d < c.length; d++)
        if (c[d].data.error) {
          (c[d].data.errorDetail && 0 < c[d].data.errorDetail.length ? new EasyEditError(c[d].data.error + ": " + c[d].data.errorDetail[0].message) : new EasyEditError(c[d].data.error)).display();
          return
        }
      a(b, c)
    });
    e.push(function(c, e, f) {
      b.hideLoadingScreen();
      for (var l = document.createElement("div"), n = {}, m = 0; m < g.length; m++) n[g[m][0]] = f[m].data;
      null === n.goal_summary.rows ? (b.hideLoadingScreen(), d.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for the selected URL and time period.") +
        "</strong></p><p>" + EasyEditLocalise._('You can generate statistics for this page by clicking "%1".', EasyEditLocalise._("Refresh")) + "<br/>" + EasyEditLocalise._("This may take a couple of minutes or more, depending on the popularity of your site.") + "</p></div>", jQuery(d).addClass("status-stats-empty")) : (n.goal_summary = n.goal_summary.rows[0], n.goal_summary_previous = n.goal_summary_previous.rows[0], d.appendChild(l), a.buildGoalDropdown(e, l, null, function() {
        c(e, f, n)
      }))
    });
    e.push(function(e, f, g, l) {
      var n = g[0].data["start-date"],
        e = g[0].data["end-date"],
        g = g[0].data.period,
        m = "",
        o = b.util.dateString(n),
        e = b.util.dateString(e);
      jQuery("#ees_analyticsReportPeriodText").html("<strong>" + o + " - " + e + "</strong> (" + g + " days)");
      for (var m = l.goal_summary["ga:sessions"], r = e = 0, p = 0, s = 0, q = 0, t = 0, w = 0, g = [], o = 0; o < f.length; o++) {
        var v = [0, null, 0],
          u = "ga:goal" + f[o].id + "Completions",
          y = "ga:goal" + f[o].id + "Value",
          z = "ga:sessions",
          e = e + l.goal_summary[u],
          q = q + l.goal_summary[y],
          t = t + l.goal_summary_previous[u],
          w = w + l.goal_summary_previous[y];
        "URL_DESTINATION" === f[o].type &&
          f[o].urlDestinationDetails.steps && 0 < f[o].urlDestinationDetails.steps.length && (y = "ga:goal" + f[o].id + "Starts", s++, r += l.goal_summary[y], p += l.goal_summary[y] - l.goal_summary[u], v[1] = 100 * ((l.goal_summary[y] - l.goal_summary[u]) / l.goal_summary[z]));
        0 < l.goal_summary[z] && (v[0] = 100 * (l.goal_summary[u] / l.goal_summary[z]));
        v[2] = 100 - v[0] - v[1];
        g[o] = v
      }
      u = document.createElement("div");
      o = document.createElement("div");
      o.className = "summaryUnit fullWidth goalSummary";
      z = document.createElement("div");
      z.id = "ees_analyticsGoalSummary_overallConvGraph";
      z.className = "overallConvGraph";
      z.appendChild(b.util.svgEl("svg"));
      o.appendChild(z);
      s = '<div class="headline">' + b.util.bauble(5) + " <strong>" + EasyEdit.util.formatNumber(100 * (e / (f.length * m)), 2) + "%</strong></div>";
      s += '<div class="detail">' + EasyEditLocalise._("Conversion Rate") + "</div>";
      s += '<div class="headline">' + b.util.bauble(2) + " <strong>";
      s = 0 < r ? s + (EasyEdit.util.formatNumber(100 * (p / r), 2) + "%") : s + EasyEditLocalise._("N/A");
      s = s + "</strong></div>" + ('<div class="detail">' + EasyEditLocalise._("Funnel Abandonment Rate") +
        "</div>");
      z = document.createElement("div");
      z.className = "overallConvGraphLegend";
      z.innerHTML = s;
      r = b._buildHelpRollover(EasyEditLocalise._("The Funnel Abandonment Rate is a percentage of sessions which reached a step of a Destination (Funnel) goal but did not convert it. It is shown in the chart as a proportion of total sessions, to allow comparison with the number of conversions."));
      o.appendChild(z);
      z.appendChild(r);
      r = '<div class="headline">' + b.util.abbrevStat(e, 0) + "</div>";
      r += '<div class="detail">' +
        EasyEditLocalise._("Conversions") + "</div>";
      r += '<div class="detail">' + EasyEditLocalise._("out of %1 total", b.util.abbrevStat(m * f.length, 0)) + "</div>";
      0 < t && (r = e > t ? r + ('<div class="changeDiv better detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (e / t - 1), 0) + "%</div>") : e < t ? r + ('<div class="changeDiv worse detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (1 - e / t), 0) + "%</div>") : r + ('<div class="changeDiv detail"><span></span> ' + EasyEditLocalise._("Steady") + "</div>"));
      z = document.createElement("div");
      z.className = "statSummary";
      z.innerHTML = r;
      r = b._buildHelpRollover(EasyEditLocalise._("The total number of goal conversions that took place during the current time period."), EasyEditLocalise._("The possible number of conversions is the number of goals multiplied by the number of sessions."));
      o.appendChild(z);
      z.appendChild(r);
      t = '<div class="headline">' + a._currencyFormat(q, l.goal_summary["sq:profileCurrency"]) + "</div>";
      t += '<div class="detail"><strong>' + a._currencyName(l.goal_summary["sq:profileCurrency"]) +
        "</strong></div>";
      t += '<div class="detail">' + EasyEditLocalise._("Conversion Value") + "</div>";
      0 < w && (t = q > w ? t + ('<div class="changeDiv better detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (q / w - 1), 0) + "%</div>") : q < w ? t + ('<div class="changeDiv worse detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (1 - q / w), 0) + "%</div>") : t + ('<div class="changeDiv detail"><span></span> ' + EasyEditLocalise._("Steady") + "</div>"));
      z = document.createElement("div");
      z.className = "statSummary";
      z.innerHTML = t;
      r = b._buildHelpRollover(EasyEditLocalise._("The total value of goal conversions, based on the value of each goal (and view currency), taken from Google Analytics' settings."),
        EasyEditLocalise._("For Event Tracking goals, a value can also be set when the event is triggered."));
      o.appendChild(z);
      z.appendChild(r);
      u.appendChild(o);
      d.appendChild(u);
      var q = jQuery("#ees_analyticsGoalSummary_overallConvGraph svg")[0],
        x = [e, p, m * f.length - e - p];
      b._buildPieGraph(q, x, {
        styles: ["chartColour5", "chartColour2", "chartColourEmpty"],
        dimensions: {
          radius: 30,
          innerRadius: 18
        }
      });
      for (o = 0; o < f.length; o++) m = "", 0 === o ? m = " first" : o === f.length - 1 && (m = " last"), u = "ga:goal" + f[o].id + "Completions", z = "ga:sessions",
        p = EasyEdit.util.formatNumber(g[o][0], 2) + "%", q = null, null !== g[o][1] && (q = 0 < g[o][0] + g[o][1] ? EasyEdit.util.formatNumber(100 * (g[o][1] / (g[o][0] + g[o][1])), 2) + "%" : EasyEditLocalise._("N/A")), w = "type-" + f[o].type.toLowerCase().replace(/_/g, "-"), t = document.createElement("div"), t.id = "ees_analyticsGoalSummary_" + f[o].id, t.className = "ees_analyticsGoalSummaryItem clearfix" + m, m = "", m += '<div class="field-id">' + f[o].id + "</div>", m += '<div class="field-goal-type-sprite ' + w + '"></div>', m += '<div class="block-name-desc"><div class="field-name" title="' +
        f[o].name + '">' + f[o].name + "</div>", m += '<div class="field-description">' + f[o].sqTypeName + "</div></div>", m += '<div class="field-conversion-pie"><svg></svg></div>', m += '<div class="block-conversion"><div class="field-conversionRate">' + b.util.bauble(5) + " " + p + "</div>", null !== q && (m += '<div class="field-abandonRate">' + b.util.bauble(2) + " " + q + "</div>"), m += "</div>", m += '<div class="field-conversions">' + b.util.abbrevStat(l.goal_summary[u], 0) + " / " + b.util.abbrevStat(l.goal_summary[z], 0) + "</div>", m = 0 < l.goal_summary_previous[u] ?
        l.goal_summary[u] > l.goal_summary_previous[u] ? m + ('<div class="field-change changeDiv better"><span></span> ' + EasyEdit.util.formatNumber(100 * (l.goal_summary[u] / l.goal_summary_previous[u] - 1), 0) + "%</div>") : l.goal_summary[u] < l.goal_summary_previous[u] ? m + ('<div class="field-change changeDiv worse"><span></span> ' + EasyEdit.util.formatNumber(100 * (1 - l.goal_summary[u] / l.goal_summary_previous[u]), 0) + "%</div>") : m + ('<div class="field-change changeDiv"><span></span> ' + EasyEditLocalise._("Steady") + "</div>") : m + '<div class="field-change changeDiv"></div>',
        m += '<div class="field-help"></div>', t.innerHTML = m, d.appendChild(t);
      for (o = 0; o < f.length; o++) r = c(f[o]), jQuery("#ees_analyticsGoalSummary_" + f[o].id + " .field-help")[0].appendChild(r), q = jQuery("#ees_analyticsGoalSummary_" + f[o].id + " .field-conversion-pie svg")[0], b._buildPieGraph(q, g[o], {
        dimensions: {
          radius: 20,
          innerRadius: 12
        },
        styles: ["chartColour5", "chartColour2", "chartColourEmpty"]
      });
      jQuery(".ees_analyticsGoalSummaryItem").on("click", null, function(b) {
        b = jQuery(b.currentTarget).find(".field-id").text();
        a.showGoal.call(a,
          b)
      });
      if (0 === e) u = document.createElement("div"), u.innerHTML = "<div><p>" + EasyEditLocalise._("None of these goals have been converted yet") + "</p></div>", jQuery(u).addClass("status-goals-no-conversions");
      else {
        if (d3) {
          for (var u = document.createElement("div"), q = b.util.svgEl("svg"), B = [], C = [], o = 0; o < l.by_day.period; o++) B[o] = [0, 0], C[o] = [0, 0];
          var E = [0, 0];
          l.by_day.rows.map(function(a) {
            var b = parseInt(a["ga:nthDay"], 10);
            "New Visitor" === a["ga:userType"] ? (B[b][0] = a["ga:goalCompletionsAll"], C[b][0] = a["ga:sessions"], E[0] +=
              B[b][0]) : (B[b][1] = a["ga:goalCompletionsAll"], C[b][1] = a["ga:sessions"], E[1] += B[b][1])
          });
          e = b.util.bauble(2) + " " + EasyEditLocalise._("New users") + "<br/>" + b.util.bauble(1) + " " + EasyEditLocalise._("Returning users") + "<br/><br/><strong>" + EasyEditLocalise._("Sess.") + ":</strong> " + EasyEditLocalise._("Sessions") + "<br/><strong>" + EasyEditLocalise._("Conv.") + ":</strong> " + EasyEditLocalise._("Conversions") + "<br/><strong>" + EasyEditLocalise._("Conv. %") + ":</strong> " + EasyEditLocalise._("Conversion rate (percent)");
          o = b._buildPlainSummaryUnit(EasyEditLocalise._("Daily Conversion Graph"), q, EasyEditLocalise._("The total number of goal conversions by day, divided by whether the user was a new or returning visitor to the site."), e);
          o.className = "summaryUnit fullWidth";
          u.appendChild(o);
          d.appendChild(u);
          b._buildBarGraph(q, B, {
            styles: ["chartColour2", "chartColour1"],
            xAxisMarks: function(a) {
              var b = new Date(n);
              b.setDate(b.getDate() + a);
              return 0 === b.getDay() || 6 === b.getDay() ? !0 : !1
            },
            tooltip: function(a, c) {
              var d = new Date(n);
              d.setDate(d.getDate() +
                c);
              var d = b.util.dateString(d),
                e = a[0],
                g = a[1],
                j = EasyEditLocalise._("N/A");
              0 < C[c][0] && (j = EasyEdit.util.formatNumber(e / C[c][0] * (100 / f.length), 2) + "%");
              var k = EasyEditLocalise._("N/A");
              0 < C[c][1] && (k = EasyEdit.util.formatNumber(g / C[c][1] * (100 / f.length), 2) + "%");
              var l = EasyEditLocalise._("N/A");
              0 < C[c][0] + C[c][1] && (l = EasyEdit.util.formatNumber((e + g) / (C[c][0] + C[c][1]) * (100 / f.length), 2) + "%");
              return '<table><col width="55%" /><col width="15%" /><col width="15%" /><col width="15%" /><tr><th class="name">' + d + '</th><th class="value">' +
                EasyEditLocalise._("Sess.") + '</th><th class="value">' + EasyEditLocalise._("Conv.") + '</th><th class="value">' + EasyEditLocalise._("Conv. %") + '</th></tr><tr><td class="name">' + b.util.bauble(2) + " " + EasyEditLocalise._("New users") + '</td><td class="value">' + b.util.abbrevStat(C[c][0]) + '</td><td class="value">' + b.util.abbrevStat(e) + '</td><td class="value">' + j + '</td></tr><tr><td class="name">' + b.util.bauble(1) + " " + EasyEditLocalise._("Returning users") + '</td><td class="value">' + b.util.abbrevStat(C[c][1]) + '</td><td class="value">' +
                b.util.abbrevStat(g) + '</td><td class="value">' + k + '</td></tr><tr><td class="total name"><strong>' + EasyEditLocalise._("Total") + '</strong></td><td class="total value"><strong>' + b.util.abbrevStat(C[c][0] + C[c][1]) + '</strong></td><td class="total value"><strong>' + b.util.abbrevStat(e + g) + '</td><td class="total value"><strong>' + l + "</strong></td></tr></table>"
            },
            tooltipWidth: 300
          })
        }
        u = document.createElement("div");
        e = document.createElement("div");
        b._buildTrafficSourceSummary(l.campaigns.rows, e, 5, 5, "ga:goalCompletionsAll");
        o = b._buildPlainSummaryUnit(EasyEditLocalise._("Traffic Sources"), e, EasyEditLocalise._("Breaks down goal conversions by the traffic source type used to reach the site."));
        u.appendChild(o);
        d3 && (o.id = "ees_analyticsGoalSummary_trafficSourcesDiv", o.className += " halfWidth", b._buildTrafficSourceGraph(l.campaigns.rows, e.parentNode, 5, "ga:goalCompletionsAll"));
        var A = [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Tablet"), EasyEditLocalise._("Mobile")],
          x = [0, 0, 0],
          F = 0;
        l.device.rows.map(function(a) {
          F = F + a["ga:goalCompletionsAll"];
          switch (a["ga:deviceCategory"]) {
            case "desktop":
              x[0] = a["ga:goalCompletionsAll"];
              break;
            case "tablet":
              x[1] = a["ga:goalCompletionsAll"];
              break;
            case "mobile":
              x[2] = a["ga:goalCompletionsAll"]
          }
        });
        x = x.map(function(a) {
          return a / F * 100
        });
        l = document.createElement("div");
        o = b._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"), l, EasyEditLocalise._("Breaks down goal conversions by the type of device - desktop, tablet or mobile phone - used to complete the goal."));
        o.className = "summaryUnit deviceUsage";
        u.appendChild(o);
        d3 ? (q = b.util.svgEl("svg"), b._buildPieGraph(q, x, {}), l.innerHTML = x.map(function(a, b) {
          return '<div class="bauble chartColour' + (b + 1) + '"></div><div class="deviceTypeName">' + A[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join(""), l.parentNode.insertBefore(q, l)) : l.innerHTML = x.map(function(a, b) {
          return '<div class="deviceTypeName">' + A[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join("");
        A = [EasyEditLocalise._("New"), EasyEditLocalise._("Returning")];
        x = E.map(function(a) {
          return a / (E[0] + E[1]) * 100
        });
        l = document.createElement("div");
        o = b._buildPlainSummaryUnit(EasyEditLocalise._("User Type"), l, EasyEditLocalise._("Breaks down goal conversions by whether this is the first time a user has visited the site, or they are returning after a previous visit."));
        o.className = "summaryUnit visitorType";
        u.appendChild(o);
        d3 ? (q = b.util.svgEl("svg"), b._buildPieGraph(q, x, {
          styles: ["chartColour2", "chartColour1"]
        }), l.innerHTML = x.map(function(a, b) {
          return '<div class="bauble chartColour' +
            (2 - b) + '"></div><div class="visTypeName">' + A[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join(""), l.parentNode.insertBefore(q, l)) : l.innerHTML = x.map(function(a, b) {
          return '<div class="visTypeName">' + A[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join("")
      }
      d.appendChild(u)
    });
    EasyEdit.util.async.series(e)
  };
  this.showGoal = function(d) {
    b.showLoadingScreen();
    var e = null,
      f = [],
      g = new EasyEditAPI,
      j = b.util.sessionStat(),
      h = !1,
      k = document.querySelector("#ees_analyticsReportContents"),
      l = [
        ["goal_summary", {
          canned_query: "goal_summary",
          context: "all",
          goalid: null
        }],
        ["goal_summary_previous", {
          canned_query: "goal_summary",
          start_period: "previous",
          context: "all",
          goalid: null
        }],
        ["current", {
          canned_query: "current"
        }],
        ["previous", {
          canned_query: "previous"
        }],
        ["currentAll", {
          canned_query: "current",
          context: "all",
          goalid: null
        }],
        ["previousAll", {
          canned_query: "previous",
          context: "all",
          goalid: null
        }],
        ["campaigns", {
          canned_query: "campaigns"
        }],
        ["previousPath", {
          canned_query: "previous_path"
        }],
        ["byDay", {
          canned_query: "by_day"
        }],
        ["device", {
          canned_query: "device"
        }],
        ["pagePath", {
          canned_query: "page_path"
        }],
        ["pagePathConversions", {
          canned_query: "page_path_conversions"
        }]
      ];
    f.push(function(a) {
      b.getGoals.call(b, function(b) {
        a(b)
      })
    });
    f.push(function(a, c) {
      b.getBasicPageQuery.call(b, function(b) {
        a(b, c)
      })
    });
    f.push(function(a, c, f) {
      for (var j = 0; j < f.length; j++)
        if ("" + f[j].id === "" + d) {
          e = f[j];
          break
        }
        "URL_DESTINATION" === e.type && e.urlDestinationDetails.steps && 0 < e.urlDestinationDetails.steps.length && (h = !0);
      f = document.getElementById("ees_editAnalyticsPageTitle");
      EasyEdit.util.setText(f, EasyEditLocalise._("%1", e.name));
      c.context = "goal";
      c.goalid = e.id;
      delete c.url;
      l.map(function(a) {
        g.queue("getGoogleAnalyticsStatistics", b.util.extendQuery(c, a[1]))
      });
      g.expect(l.length).run(a, g.runMode.BATCH)
    });
    f.push(function(a, c) {
      for (var d = 0; d < c.length; d++)
        if (c[d].data.error) {
          (c[d].data.errorDetail && 0 < c[d].data.errorDetail.length ? new EasyEditError(c[d].data.error + ": " + c[d].data.errorDetail[0].message) : new EasyEditError(c[d].data.error)).display();
          return
        }
      0 === c[0].data.rows.length ?
        (b.hideLoadingScreen(), k.innerHTML = "<div><p>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period") + "</p></div>", jQuery(k).addClass("status-stats-empty")) : a(goals, c)
    });
    f.push(function(c, d, f) {
      b.hideLoadingScreen();
      var g = document.createElement("div");
      k.appendChild(g);
      a.buildGoalDropdown(d, g, e, function() {
        c(d, f)
      })
    });
    f.push(function(d, f, g) {
      d = document.getElementById("ees_analyticsGoalSelectionClicker");
      f = document.createElement("div");
      f.id = "ees_editAnalyticsGoalDetailDescription";
      var r = document.createElement("span");
      r.className = "type-name";
      EasyEdit.util.setText(r, e.sqTypeName);
      var p = c(e);
      f.appendChild(r);
      f.appendChild(p);
      d.parentNode.appendChild(f);
      for (var s = {}, f = 0; f < l.length; f++) s[l[f][0]] = g[f].data;
      s.goal_summary = s.goal_summary.rows[0];
      s.goal_summary_previous = s.goal_summary_previous.rows[0];
      var q = g[0].data["start-date"],
        t = g[0].data["end-date"],
        f = g[0].data.period,
        w = s.goal_summary["ga:sessions"],
        v = p = 0,
        d = 0,
        u, y, z, x = "ga:goal" + e.id + "Completions";
      z = "ga:goal" + e.id + "Value";
      r = 0 + s.goal_summary[x];
      u = 0 + s.goal_summary[z];
      y = 0 + s.goal_summary_previous[x];
      z = 0 + s.goal_summary_previous[z];
      if (!0 === h) {
        var B = "ga:goal" + e.id + "Starts";
        d++;
        p += s.goal_summary[B];
        v += s.goal_summary[B] - s.goal_summary[x]
      }
      d = document.createElement("div");
      x = document.createElement("div");
      x.className = "summaryUnit fullWidth goalSummary";
      B = document.createElement("div");
      B.id = "ees_analyticsGoalSummary_overallConvGraph";
      B.className = "overallConvGraph";
      B.appendChild(b.util.svgEl("svg"));
      x.appendChild(B);
      var C = '<div class="headline">' + b.util.bauble(5) +
        " <strong>" + EasyEdit.util.formatNumber(100 * (r / w), 2) + "%</strong></div>",
        C = C + ('<div class="detail">' + EasyEditLocalise._("Conversion Rate") + "</div>");
      !0 === h && (C += '<div class="headline">' + b.util.bauble(2) + " <strong>", C = 0 < p ? C + (EasyEdit.util.formatNumber(100 * (v / p), 2) + "%") : C + EasyEditLocalise._("N/A"), C = C + "</strong></div>" + ('<div class="detail">' + EasyEditLocalise._("Funnel Abandonment Rate") + "</div>"));
      B = document.createElement("div");
      B.className = "overallConvGraphLegend";
      B.innerHTML = C;
      !0 === h && (p = b._buildHelpRollover(EasyEditLocalise._("The Funnel Abandonment Rate is a percentage of sessions which reached a step of a Destination (Funnel) goal but did not convert it. It is shown in the chart as a proportion of total sessions, to allow comparison with the number of conversions.")),
        B.appendChild(p));
      x.appendChild(B);
      p = '<div class="headline">' + b.util.abbrevStat(r, 0) + "</div>";
      p += '<div class="detail">' + EasyEditLocalise._("Conversions") + "</div>";
      p += '<div class="detail">' + EasyEditLocalise._("out of %1 total", b.util.abbrevStat(w, 0)) + "</div>";
      0 < y && (p = r > y ? p + ('<div class="changeDiv better detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (r / y - 1), 0) + "%</div>") : r < y ? p + ('<div class="changeDiv worse detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (1 - r / y), 0) + "%</div>") : p + ('<div class="changeDiv detail"><span></span> ' +
        EasyEditLocalise._("Steady") + "</div>"));
      B = document.createElement("div");
      B.className = "statSummary";
      B.innerHTML = p;
      p = b._buildHelpRollover(EasyEditLocalise._("The total number of goal conversions that took place during the current time period."), EasyEditLocalise._("The possible number of conversions is the number of goals multiplied by the number of sessions."));
      x.appendChild(B);
      B.appendChild(p);
      y = '<div class="headline">' + a._currencyFormat(u, s.goal_summary["sq:profileCurrency"]) + "</div>";
      y += '<div class="detail"><strong>' +
        a._currencyName(s.goal_summary["sq:profileCurrency"]) + "</strong></div>";
      y += '<div class="detail">' + EasyEditLocalise._("Conversion Value") + "</div>";
      0 < z && (y = u > z ? y + ('<div class="changeDiv better detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (u / z - 1), 0) + "%</div>") : u < z ? y + ('<div class="changeDiv worse detail"><span></span> ' + EasyEdit.util.formatNumber(100 * (1 - u / z), 0) + "%</div>") : y + ('<div class="changeDiv detail"><span></span> ' + EasyEditLocalise._("Steady") + "</div>"));
      B = document.createElement("div");
      B.className = "statSummary";
      B.innerHTML = y;
      p = b._buildHelpRollover(EasyEditLocalise._("The total value of goal conversions, based on the value of each goal (and view currency), taken from Google Analytics' settings."), EasyEditLocalise._("For Event Tracking goals, a value can also be set when the event is triggered."));
      x.appendChild(B);
      B.appendChild(p);
      d.appendChild(x);
      k.appendChild(d);
      u = jQuery("#ees_analyticsGoalSummary_overallConvGraph svg")[0];
      var E = [r, v, w - r - v];
      b._buildPieGraph(u, E, {
        styles: ["chartColour5",
          "chartColour2", "chartColourEmpty"
        ],
        dimensions: {
          radius: 30,
          innerRadius: 18
        }
      });
      var A = {};
      l.map(function(a, b) {
        s[a[0]] = g[b].data;
        A[a[0]] = g[b].data.rows
      });
      d = b.util.dateString(q);
      t = b.util.dateString(t);
      jQuery("#ees_analyticsReportPeriodText").html("<strong>" + d + " - " + t + "</strong> (" + f + " days)");
      if (0 === r) d = document.createElement("div"), d.innerHTML = "<div><p>" + EasyEditLocalise._("This goal hasn't been converted yet") + "</p></div>", jQuery(d).addClass("status-goals-no-conversions"), k.appendChild(d);
      else {
        if (d3) {
          d =
            document.createElement("div");
          u = b.util.svgEl("svg");
          for (var F = [], f = 0; f < s.byDay.period; f++) F[f] = [0, 0];
          A.byDay.map(function(a) {
            var b = parseInt(a["ga:nthDay"], 10);
            a["ga:userType"] === "New Visitor" ? F[b][0] = a[j] : F[b][1] = a[j]
          });
          f = b.util.bauble(1) + " " + EasyEditLocalise._("New users") + "<br/>" + b.util.bauble(2) + " " + EasyEditLocalise._("Returning users");
          x = b._buildPlainSummaryUnit(EasyEditLocalise._("Daily Graph"), u, EasyEditLocalise._("The number of sessions on each day that completed this goal."), f);
          x.className =
            "summaryUnit fullWidth";
          d.appendChild(x);
          k.appendChild(d);
          b._buildBarGraph(u, F, {
            styles: ["chartColour2", "chartColour1"],
            xAxisMarks: function(a) {
              var b = new Date(q);
              b.setDate(b.getDate() + a);
              return b.getDay() === 0 || b.getDay() === 6 ? true : false
            },
            tooltip: function(a, c) {
              var d = new Date(q);
              d.setDate(d.getDate() + c);
              var d = b.util.dateString(d),
                e = a[0],
                f = a[1];
              return '<table><col width="80%" /><col width="20%" /><tr><th class="name">' + d + '</th><th class="value">' + EasyEditLocalise._("Conversions") + '</tr><tr><td class="name">' +
                b.util.bauble(2) + " " + EasyEditLocalise._("New users") + '</td><td class="value">' + b.util.abbrevStat(e) + '</td></tr><tr><td class="name">' + b.util.bauble(1) + " " + EasyEditLocalise._("Returning users") + '</td><td class="value">' + b.util.abbrevStat(f) + '</td></tr><tr><td class="total name"><strong>' + EasyEditLocalise._("Total conversions") + '</strong></td><td class="total value"><strong>' + b.util.abbrevStat(e + f) + "</td></tr></table>"
            }
          })
        }
        var D = document.createElement("div"),
          G = document.createElement("div");
        D.id = "ees_analyticsGoalsReportClicker";
        D.className = "dropDownClicker";
        EasyEdit.util.setText(D, EasyEditLocalise._("Session Statistics"));
        D.innerHTML = '<span class="alignRight expand"></span>' + D.innerHTML;
        k.appendChild(D);
        k.appendChild(G);
        d = document.createElement("div");
        x = b._buildChangeSummaryUnit(EasyEditLocalise._("Page Views"), '<span class="value">' + b.util.abbrevStat(A.current[0]["ga:pageviews"]) + "</span>", A.current[0]["ga:pageviews"], A.previous[0] ? A.previous[0]["ga:pageviews"] : 0, !1, EasyEditLocalise._("The total number of times this page was viewed, during sessions where this goal was completed."));
        d.appendChild(x);
        f = "";
        r = EasyEditLocalise._("N/A");
        0 < A.current[0]["ga:pageviews"] - A.current[0]["ga:exits"] ? (r = Math.round(A.current[0]["ga:timeOnPage"] / (A.current[0]["ga:pageviews"] - A.current[0]["ga:exits"])), f = Math.floor(r / 60), r = Math.floor(r % 60), 10 > f && (f = "0" + f), 10 > r && (r = "0" + r), f = '<div><span class="flipper value">' + f + '</span><span class="time-dots value">:</span><span class="flipper value">' + r + "</span></div><div>" + EasyEditLocalise._("min:sec") + "</div>") : f = '<div><span class="flipper value">' + r + "</span></div>";
        x = b._buildChangeSummaryUnit(EasyEditLocalise._("View Duration"), f, A.current[0]["ga:timeOnPage"] / (A.current[0]["ga:pageviews"] - A.current[0]["ga:exits"]), A.previous[0] ? A.previous[0]["ga:timeOnPage"] / (A.previous[0]["ga:pageviews"] - A.previous[0]["ga:exits"]) : 0, !1, EasyEditLocalise._("The average time spent looking at this page. Views that were exits are not counted."));
        d.appendChild(x);
        f = "";
        f = EasyEditLocalise._("N/A");
        0 < A.current[0]["ga:pageLoadSample"] && (f = "" + Math.round(A.current[0]["ga:pageLoadTime"] /
          A.current[0]["ga:pageLoadSample"] / 10), f = f.substr(0, f.length - 2) + "." + f.substr(f.length - 2));
        f = '<div><span class="flipper value">' + f + "</span></div><div>" + EasyEditLocalise._("sec") + "</div>";
        x = b._buildChangeSummaryUnit(EasyEditLocalise._("Page Speed"), f, 0 === A.current[0]["ga:pageLoadSample"] ? 0 : A.current[0]["ga:pageLoadTime"] / A.current[0]["ga:pageLoadSample"], !A.previous[0] || 0 === A.previous[0]["ga:pageLoadSample"] ? 0 : A.previous[0]["ga:pageLoadTime"] / A.previous[0]["ga:pageLoadSample"], !0, EasyEditLocalise._("The average length of time it took for the page to load, from the interaction that started loading it."),
          EasyEditLocalise._("Page speed is based on a random sample of page views (typically 1%). This measure is taken from a sample of <strong>%1</strong> sessions (vs <strong>%2</strong> sessions).", A.current[0]["ga:pageLoadSample"], A.previous[0]["ga:pageLoadSample"]));
        d.appendChild(x);
        var I = [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Tablet"), EasyEditLocalise._("Mobile")],
          E = [0, 0, 0],
          J = 0;
        A.device.map(function(a) {
          J = J + a[j];
          switch (a["ga:deviceCategory"]) {
            case "desktop":
              E[0] = a[j];
              break;
            case "tablet":
              E[1] =
                a[j];
              break;
            case "mobile":
              E[2] = a[j]
          }
        });
        E = E.map(function(a) {
          return a / J * 100
        });
        f = document.createElement("div");
        x = b._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"), f, EasyEditLocalise._("The percentage of sessions that visited this page at least once, broken down by the type of device used (desktop, tablet, or mobile phone)."));
        x.className = "summaryUnit deviceUsage";
        d.appendChild(x);
        d3 ? (u = b.util.svgEl("svg"), b._buildPieGraph(u, E, {}), f.innerHTML = E.map(function(a, b) {
          return '<div class="bauble chartColour' +
            (b + 1) + '"></div><div class="deviceTypeName">' + I[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join(""), f.parentNode.insertBefore(u, f)) : f.innerHTML = E.map(function(a, b) {
          return '<div class="deviceTypeName">' + I[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join("");
        d.id = "ees_analyticsGoalsSwitchableDiv_reportStats1";
        G.appendChild(d);
        d = document.createElement("div");
        f = document.createElement("div");
        b._buildTrafficSourceSummary(s.campaigns.rows,
          f, 5, 5, "ga:goal" + e.id + "Completions");
        x = b._buildPlainSummaryUnit(EasyEditLocalise._("Traffic Sources"), f, EasyEditLocalise._("Breaks down goal conversions by the traffic source type used to reach the site."));
        d.appendChild(x);
        d3 && (x.id = "ees_analyticsGoalSummary_trafficSourcesDiv", x.className += " halfWidth", b._buildTrafficSourceGraph(s.campaigns.rows, f.parentNode, 5, "ga:goal" + e.id + "Completions"));
        f = document.createElement("div");
        b._buildTopExternalReferrers(A.campaigns, f, 5);
        x = b._buildPlainSummaryUnit(EasyEditLocalise._("External Referrers"),
          f, EasyEditLocalise._("The top referring sites to sessions that viewed this page at least once, ordered by the number of sessions."));
        d.appendChild(x);
        f = document.createElement("div");
        b._buildTopCampaigns(A.campaigns, f, 5);
        x = b._buildPlainSummaryUnit(EasyEditLocalise._("Top Campaigns"), f, EasyEditLocalise._("Top tagged campaigns for sessions that viewed this page at least once, ordered by number of sessions. These exclude sessions that used a referring site link."));
        d.id = "ees_analyticsGoalsSwitchableDiv_reportStats2";
        d.appendChild(x);
        G.appendChild(d);
        f = [{
          title: EasyEditLocalise._("Page Path"),
          stat: function(a) {
            return a.name
          },
          width: 60
        }, {
          title: EasyEditLocalise._("Sessions"),
          stat: "ga:uniquePageviews",
          showPercent: !0,
          width: 20
        }, {
          title: EasyEditLocalise._("Page Views"),
          stat: "ga:pageviews",
          showPercent: !0,
          width: 20
        }];
        d = document.createElement("div");
        d.id = "ees_analyticsGoalsSwitchableDiv_topPages";
        r = b._buildDrilldownTable({
          id: "ees_analyticsGoalAllPagesTable",
          summaryData: A.current[0],
          detailData: A.pagePath,
          majorDimension: "ga:pagePath",
          minorDimension: null,
          columns: f,
          maxMajorRows: 50,
          maxMinorRows: Number.POSITIVE_INFINITY
        });
        d.appendChild(r);
        d.className = "row hidden";
        G.appendChild(d);
        d = document.createElement("div");
        d.id = "ees_analyticsGoalsSwitchableDiv_conversionPages";
        f = b._buildDrilldownTable({
          id: "ees_analyticsGoalConversionPagesTable",
          summaryData: A.current[0],
          detailData: A.pagePathConversions,
          majorDimension: "ga:pagePath",
          minorDimension: null,
          columns: f,
          maxMajorRows: 50,
          maxMinorRows: Number.POSITIVE_INFINITY
        });
        d.appendChild(f);
        d.className =
          "row hidden";
        G.appendChild(d);
        var d = ['<a data-subscreen="report-stats" class="active">' + EasyEditLocalise._("Session Statistics") + "</a>", '<a data-subscreen="top-pages">' + EasyEditLocalise._("Most Viewed Pages") + "</a>", '<a data-subscreen="conversion-pages">' + EasyEditLocalise._("Top Conversion Pages") + "</a>"],
          f = EasyEditLocalise._("Reports"),
          H = EasyEdit.tip.create({
            targetId: "ees_analyticsGoalsReportClicker",
            containerId: "ees_analyticsGoalsReportTooltip",
            position: "south",
            title: f,
            message: d.join(""),
            buttons: [],
            className: "analyticsDropDownTooltip"
          });
        H.$element.find(".tooltipButtons").remove();
        jQuery(D).on("click", null, function() {
          H.toggle()
        });
        H.$element.on("click", "a", function(a) {
          H.hide();
          a = a.target;
          EasyEdit.util.setText(D, EasyEdit.util.getText(a));
          D.innerHTML = '<span class="alignRight expand"></span>' + D.innerHTML;
          jQuery(G).children("div, table").addClass("hidden");
          H.$element.find(".tooltipContent a").removeClass("active");
          jQuery(a).addClass("active");
          switch (a.getAttribute("data-subscreen")) {
            case "report-stats":
              jQuery("#ees_analyticsGoalsSwitchableDiv_reportStats1").removeClass("hidden");
              jQuery("#ees_analyticsGoalsSwitchableDiv_reportStats2").removeClass("hidden");
              break;
            case "top-pages":
              jQuery("#ees_analyticsGoalsSwitchableDiv_topPages").removeClass("hidden");
              break;
            case "conversion-pages":
              jQuery("#ees_analyticsGoalsSwitchableDiv_conversionPages").removeClass("hidden")
          }
        })
      }
    });
    EasyEdit.util.async.series(f)
  };
  this._currencyName = function(a) {
    var b = a;
    switch (a) {
      case "ARS":
        b = EasyEditLocalise._("Argentine Pesos");
        break;
      case "AUD":
        b = EasyEditLocalise._("Australian Dollars");
        break;
      case "BGN":
        b =
          EasyEditLocalise._("Bulgarian Leva");
        break;
      case "BRL":
        b = EasyEditLocalise._("Brazilian Reals");
        break;
      case "CAD":
        b = EasyEditLocalise._("Canadian Dollars");
        break;
      case "CHF":
        b = EasyEditLocalise._("Swiss Francs");
        break;
      case "CNY":
        b = EasyEditLocalise._("Chinese Yuan Renminbi");
        break;
      case "CZK":
        b = EasyEditLocalise._("Czech Koruna");
        break;
      case "DKK":
        b = EasyEditLocalise._("Danish Kroner");
        break;
      case "EUR":
        b = EasyEditLocalise._("Euro");
        break;
      case "GBP":
        b = EasyEditLocalise._("Pounds Sterling");
        break;
      case "HKD":
        b = EasyEditLocalise._("Hong Kong Dollars");
        break;
      case "HUF":
        b = EasyEditLocalise._("Hungarian Forints");
        break;
      case "IDR":
        b = EasyEditLocalise._("Indonesian Rupiah");
        break;
      case "INR":
        b = EasyEditLocalise._("Indian Rupees");
        break;
      case "JPY":
        b = EasyEditLocalise._("Japanese Yen");
        break;
      case "KRW":
        b = EasyEditLocalise._("Korean Won");
        break;
      case "LTL":
        b = EasyEditLocalise._("Latvian Lit\u0173");
        break;
      case "MXN":
        b = EasyEditLocalise._("Mexican Pesos");
        break;
      case "NOK":
        b = EasyEditLocalise._("Norwegian Kroner");
        break;
      case "NZD":
        b = EasyEditLocalise._("New Zealand Dollars");
        break;
      case "PHP":
        b = EasyEditLocalise._("Philippine Pesos");
        break;
      case "PLN":
        b = EasyEditLocalise._("Polish Z\u0142oty");
        break;
      case "RUB":
        b = EasyEditLocalise._("Russian Rubles");
        break;
      case "SEK":
        b = EasyEditLocalise._("Swedish Kronor");
        break;
      case "THB":
        b = EasyEditLocalise._("Thai Baht");
        break;
      case "TRY":
        b = EasyEditLocalise._("Turkish Lira");
        break;
      case "TWD":
        b = EasyEditLocalise._("New Taiwan Dollars");
        break;
      case "USD":
        b = EasyEditLocalise._("United States Dollars");
        break;
      case "VND":
        b = EasyEditLocalise._("Vietnamese Dong");
        break;
      case "ZAR":
        b = EasyEditLocalise._("South African Rand")
    }
    return b
  };
  this._currencyFormat = function(a, b) {
    var c = EasyEdit.util.formatNumber(a, 2);
    switch (b) {
      case "ARS":
      case "AUD":
      case "CAD":
      case "NZD":
      case "USD":
      case "HKD":
        c = "$" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "GBP":
        c = "\u00a3" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "ZAR":
        c = "R" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "EUR":
        c = "\u20ac" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "JPY":
        c = "\u00a5" + EasyEdit.util.formatNumber(a, 0);
        c = c.replace(/,/g,
          "");
        break;
      case "KRW":
        c = "\u20a9" + EasyEdit.util.formatNumber(a, 0);
        c = c.replace(/,/g, "");
        break;
      case "PHP":
        c = "P" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "INR":
        c = "\u20b9" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "THB":
        c = "\u0e3f" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "TRY":
        c = "\u20ba" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "BGN":
        c = "\u043b\u0432 " + EasyEdit.util.formatNumber(a, 2);
        break;
      case "BRL":
        c = "R$" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "MXN":
        c = "Mex$" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "IDR":
        c = "Rp " + EasyEdit.util.formatNumber(a, 0);
        break;
      case "RUB":
        c = "\u20bd" + EasyEdit.util.formatNumber(a, 2);
        break;
      case "DKK":
      case "NOK":
      case "SEK":
        c = EasyEdit.util.formatNumber(a, 2) + " kr";
        break;
      case "CHF":
        c = EasyEdit.util.formatNumber(a, 2) + " Fr.";
        break;
      case "CZK":
        c = EasyEdit.util.formatNumber(a, 2) + " K\u010d";
        break;
      case "HUF":
        c = EasyEdit.util.formatNumber(a, 0) + " Ft";
        break;
      case "PLN":
        c = EasyEdit.util.formatNumber(a, 2) + " z\u0142";
        break;
      case "LTL":
        c = EasyEdit.util.formatNumber(a, 2) + " Lt";
        break;
      case "VND":
        c =
          EasyEdit.util.formatNumber(a, 0) + "\u20ab";
        break;
      case "CNY":
        c = EasyEdit.util.formatNumber(a, 2);
        c = c.replace(/,/g, "");
        ".00" === c.substr(c.length - 3, 3) ? c = c.substr(0, c.length - 3) : "0" === c.substr(c.length - 1, 1) && (c = c.substr(0, c.length - 1));
        c = "\u00a5" + c;
        break;
      case "TWD":
        c = EasyEdit.util.formatNumber(a, 2), c = c.replace(/,/g, ""), ".00" === c.substr(c.length - 3, 3) ? c = c.substr(0, c.length - 3) : "0" === c.substr(c.length - 1, 1) && (c = c.substr(0, c.length - 1)), c = "$" + c
    }
    return c
  }
};
BodycopyDivUnsupported = function(a) {
  this.events = new ObservableEvents(this, ["change", "save_queued"]);
  this.id = a.id;
  this.attr = a.attr;
  this.attribute = a.attribute;
  this.$container = null
};
BodycopyDivUnsupported.prototype.getFriendlyContainerName = function() {
  var a = this.attribute("content_data").type_code.replace("content_type", "").replace(/_/g, " ").replace(/(^|\s)([a-z])/g, function(a, c, d) {
    return c + d.toUpperCase()
  });
  return a = EasyEditLocalise._("Unknown Content Container") + " (" + a + ")"
};
BodycopyDivUnsupported.prototype.queueSave = function(a) {
  this.events.trigger("save_queued");
  return a
};
BodycopyDivUnsupported.prototype.render = function(a) {
  this.$container = a;
  this.$container.parent().addClass("unsupported")
};
EasyEditScreens.screen.analyticsDefault.subScreens.summary = new function() {
  var a = EasyEditScreens.screen.analyticsDefault;
  this.name = EasyEditLocalise._("Summary");
  this.pageTitle = EasyEditLocalise._("Analytics Summary");
  this.show = function() {
    var b = a.util.sessionStat(),
      c = [],
      d = [];
    d.push(function(b) {
      a.getBasicPageQuery(function(a) {
        b(a)
      })
    });
    d.push(function(b, d) {
      var g = new EasyEditAPI;
      c = ["device"];
      c.map(function(b) {
        g.queue("getGoogleAnalyticsStatistics", a.util.extendQuery(d, {
          canned_query: b
        }))
      });
      g.expect(c.length).run(function(a) {
        b(d,
          a)
      }, g.runMode.BATCH)
    });
    d.push(function(b, d, g) {
      for (var j = 0; j < g.length; j++)
        if (g[j].data.error) {
          (g[j].data.errorDetail && 0 < g[j].data.errorDetail.length ? new EasyEditError(g[j].data.error + ": " + g[j].data.errorDetail[0].message) : new EasyEditError(g[j].data.error)).display();
          return
        }
      var h = g[0].data["end-date"],
        j = g[0].data.period,
        k = a.util.dateString(g[0].data["start-date"]),
        h = a.util.dateString(h);
      jQuery("#ees_analyticsReportPeriodText").html("<strong>" + k + " - " + h + "</strong> (" + j + " days)");
      if (null === g[0].data.rows) j =
        document.getElementById("ees_analyticsReportContents"), k = document.getElementById("ees_analyticsDataAgeValue"), EasyEdit.util.setText(k, EasyEditLocalise._("Never")), a.hideLoadingScreen(), j.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for the selected URL and time period.") + "</strong></p><p>" + EasyEditLocalise._('You can generate statistics for this page by clicking "%1".', EasyEditLocalise._("Refresh")) + "<br/>" + EasyEditLocalise._("This may take a couple of minutes or more, depending on the popularity of your site.") +
        "</p></div>", jQuery(j).addClass("status-stats-empty");
      else {
        var j = document.getElementById("ees_analyticsReportContents"),
          k = document.getElementById("ees_analyticsDataAgeValue"),
          h = new Date,
          l = new Date;
        l.setSeconds(l.getSeconds() - g[0].data.age);
        h.getMonth() === l.getMonth() && h.getFullYear() === l.getFullYear() ? h.getDate() === l.getDate() ? EasyEdit.util.setText(k, EasyEditLocalise._("Today at %1", a.util.formatTime(60 * l.getHours() + l.getMinutes()))) : (h.setDate(h.getDate() - 1), h.getDate() === l.getDate() ? EasyEdit.util.setText(k,
          EasyEditLocalise._("Yesterday at %1", a.util.formatTime(60 * l.getHours() + l.getMinutes()))) : EasyEdit.util.setText(k, a.util.dateString(l))) : EasyEdit.util.setText(k, a.util.dateString(l));
        if (0 === g[0].data.rows.length) a.hideLoadingScreen(), j.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period.") + "</strong></p></div>", jQuery(j).addClass("status-stats-empty");
        else {
          var n = new EasyEditAPI;
          c = "current,previous,campaigns,previous_path,by_day,device".split(",");
          c.map(function(b) {
            n.queue("getGoogleAnalyticsStatistics", a.util.extendQuery(d, {
              canned_query: b
            }))
          });
          n.expect(c.length).run(function(a) {
            b(a)
          }, n.runMode.BATCH)
        }
      }
    });
    d.push(function(d, f) {
      for (var g = document.querySelector("#ees_analyticsReportContents"), j = 0; j < f.length; j++)
        if (f[j].data.error) {
          (f[j].data.errorDetail && 0 < f[j].data.errorDetail.length ? new EasyEditError(f[j].data.error + ": " + f[j].data.errorDetail[0].message) : new EasyEditError(f[j].data.error)).display();
          return
        }
      if (0 === f[0].data.rows.length) a.hideLoadingScreen(),
        g.innerHTML = "<div><p>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period") + "</p></div>", jQuery(g).addClass("status-stats-empty");
      else {
        var h = f[0].data["start-date"],
          k = {},
          l = {};
        c.map(function(a, b) {
          k[a] = f[b].data;
          l[a] = f[b].data.rows
        });
        a.hideLoadingScreen();
        if (d3) {
          for (var n = document.createElement("div"), m = a.util.svgEl("svg"), o = [], j = 0; j < k.by_day.period; j++) o[j] = [0, 0];
          k.by_day.rows.map(function(a) {
            var c = parseInt(a["ga:nthDay"], 10);
            "New Visitor" === a["ga:userType"] ?
              o[c][0] = a[b] : o[c][1] = a[b]
          });
          j = a.util.bauble(2) + " " + EasyEditLocalise._("New users") + "<br/>" + a.util.bauble(1) + " " + EasyEditLocalise._("Returning users");
          j = a._buildPlainSummaryUnit(EasyEditLocalise._("Daily Graph"), m, EasyEditLocalise._("The total number of sessions that visited this page by day."), j);
          j.className = "summaryUnit fullWidth";
          n.appendChild(j);
          g.appendChild(n);
          a._buildBarGraph(m, o, {
            styles: ["chartColour2", "chartColour1"],
            xAxisMarks: function(a) {
              var b = new Date(h);
              b.setDate(b.getDate() + a);
              return 0 ===
                b.getDay() || 6 === b.getDay() ? !0 : !1
            },
            tooltip: function(b, c) {
              var d = new Date(h);
              d.setDate(d.getDate() + c);
              var d = a.util.dateString(d),
                e = b[0],
                f = b[1];
              return '<table><col width="80%" /><col width="20%" /><tr><th class="name">' + d + '</th><th class="value">' + EasyEditLocalise._("Sessions") + '</tr><tr><td class="name">' + a.util.bauble(2) + " " + EasyEditLocalise._("New users") + '</td><td class="value">' + a.util.abbrevStat(e) + '</td></tr><tr><td class="name">' + a.util.bauble(1) + " " + EasyEditLocalise._("Returning users") + '</td><td class="value">' +
                a.util.abbrevStat(f) + '</td></tr><tr><td class="total name"><strong>' + EasyEditLocalise._("Total sessions") + '</strong></td><td class="total value"><strong>' + a.util.abbrevStat(e + f) + "</td></tr></table>"
            }
          })
        }
        n = document.createElement("div");
        j = a._buildChangeSummaryUnit(EasyEditLocalise._("Sessions"), '<span class="value">' + a.util.abbrevStat(l.current[0][b]) + "</span>", l.current[0][b], l.previous[0] ? l.previous[0][b] : 0, !1, EasyEditLocalise._("The number of users who viewed this page at least once in a session."));
        n.appendChild(j);
        j = a._buildChangeSummaryUnit(EasyEditLocalise._("Page Views"), '<span class="value">' + a.util.abbrevStat(l.current[0]["ga:pageviews"]) + "</span>", l.current[0]["ga:pageviews"], l.previous[0] ? l.previous[0]["ga:pageviews"] : 0, !1, EasyEditLocalise._("The total number of times this page was viewed."));
        n.appendChild(j);
        m = "";
        j = EasyEditLocalise._("N/A");
        0 < l.current[0]["ga:pageviews"] - l.current[0]["ga:exits"] ? (j = Math.round(l.current[0]["ga:timeOnPage"] / (l.current[0]["ga:pageviews"] - l.current[0]["ga:exits"])),
          m = Math.floor(j / 60), j = Math.floor(j % 60), 10 > m && (m = "0" + m), 10 > j && (j = "0" + j), m = '<div><span class="flipper value">' + m + '</span><span class="time-dots value">:</span><span class="flipper value">' + j + "</span></div><div>" + EasyEditLocalise._("min:sec") + "</div>") : m = '<div><span class="flipper value">' + j + "</span></div>";
        j = a._buildChangeSummaryUnit(EasyEditLocalise._("View Duration"), m, l.current[0]["ga:timeOnPage"] / (l.current[0]["ga:pageviews"] - l.current[0]["ga:exits"]), l.previous[0] ? l.previous[0]["ga:timeOnPage"] /
          (l.previous[0]["ga:pageviews"] - l.previous[0]["ga:exits"]) : 0, !1, EasyEditLocalise._("The average time spent looking at this page. Views that were exits are not counted."));
        n.appendChild(j);
        !1 === a.current.isView && (j = a._buildChangeSummaryUnit(EasyEditLocalise._("Landings"), '<span class="value">' + a.util.abbrevStat(l.current[0]["ga:entrances"]) + "</span>", l.current[0]["ga:entrances"], l.previous[0] ? l.previous[0]["ga:entrances"] : 0, !1, EasyEditLocalise._("The total number of sessions where this page was used as a landing or entrance page.")),
          n.appendChild(j));
        !1 === a.current.isView && (g.appendChild(n), n = document.createElement("div"));
        var r = 0;
        0 < l.current[0]["ga:entrances"] && (r = 100 * (l.current[0]["ga:bounces"] / l.current[0]["ga:entrances"]));
        if (d3) {
          var m = a.util.svgEl("svg"),
            p = [r, 100 - r];
          a._buildPieGraph(m, p, {
            dimensions: {
              innerRadius: 12
            },
            styles: ["chartColour2", "chartColourEmpty"]
          });
          var j = a._buildChangeSummaryUnit(EasyEditLocalise._("Bounce Rate"), m, 0 === l.current[0]["ga:entrances"] ? 0 : l.current[0]["ga:bounces"] / l.current[0]["ga:entrances"], !l.previous[0] ||
              0 === l.previous[0]["ga:entrances"] ? 0 : l.previous[0]["ga:bounces"] / l.previous[0]["ga:entrances"], !0, EasyEditLocalise._("The percentage of landings that resulted in being the only page a user interacted with in a session.")),
            s = document.createElement("div");
          s.innerHTML = a.util.bauble(2) + ('<div class="headlineValue">' + EasyEdit.util.formatNumber(r, 2) + "%</div>") + '<div class="rawValue">(' + a.util.abbrevStat(l.current[0]["ga:bounces"]) + ")</div>";
          m.parentNode.appendChild(s);
          j.className = "summaryUnit"
        } else j = a._buildChangeSummaryUnit(EasyEditLocalise._("Bounce Rate"),
          '<span class="value">' + EasyEdit.util.formatNumber(r, 2) + "%</span>", 0 === l.current[0][b] ? 0 : l.current[0]["ga:bounces"] / l.current[0][b], !l.previous[0] || 0 === l.previous[0][b] ? 0 : l.previous[0]["ga:bounces"] / l.previous[0][b], !0, EasyEditLocalise._("The percentage of page views that were the only page a user interacted with in a session."));
        n.appendChild(j);
        "ga:uniquePageviews" !== b && (g.appendChild(n), n = document.createElement("div"));
        !1 === a.current.isView && (r = 0, 0 < l.current[0]["ga:pageviews"] && (r = EasyEdit.util.formatNumber(100 *
          (l.current[0]["ga:exits"] / l.current[0]["ga:pageviews"]), 2)), d3 ? (m = a.util.svgEl("svg"), p = [r, 100 - r], a._buildPieGraph(m, p, {
            dimensions: {
              innerRadius: 12
            },
            styles: ["chartColour2", "chartColourEmpty"]
          }), j = a._buildChangeSummaryUnit(EasyEditLocalise._("Exit Rate"), m, 0 === l.current[0]["ga:pageviews"] ? 0 : l.current[0]["ga:exits"] / l.current[0]["ga:pageviews"], !l.previous[0] || 0 === l.previous[0]["ga:pageviews"] ? 0 : l.previous[0]["ga:exits"] / l.previous[0]["ga:pageviews"], !0, EasyEditLocalise._("The percentage of page views that were the last page a user interacted with in a session. This figure includes bounces (sessions that land and then exit on this page without interacting).")),
          s = document.createElement("div"), s.innerHTML = a.util.bauble(2) + ('<div class="headlineValue">' + EasyEdit.util.formatNumber(r, 2) + "%</div>") + '<div class="rawValue">(' + a.util.abbrevStat(l.current[0]["ga:exits"]) + ")</div>", m.parentNode.appendChild(s), j.className = "summaryUnit") : j = a._buildChangeSummaryUnit(EasyEditLocalise._("Exit Rate"), '<span class="value">' + EasyEdit.util.formatNumber(r, 2) + "%</span>", 0 === l.current[0]["ga:pageviews"] ? 0 : l.current[0]["ga:exits"] / l.current[0]["ga:pageviews"], !l.previous[0] ||
          0 === l.previous[0]["ga:pageviews"] ? 0 : l.previous[0]["ga:exits"] / l.previous[0]["ga:pageviews"], !0, EasyEditLocalise._("The percentage of page views that were the last page a user interacted with in a session. This figure includes bounces (sessions that land and then exit on this page without interacting).")), n.appendChild(j));
        m = "";
        m = EasyEditLocalise._("N/A");
        0 < l.current[0]["ga:pageLoadSample"] && (m = "" + Math.round(l.current[0]["ga:pageLoadTime"] / l.current[0]["ga:pageLoadSample"] / 10), m = m.substr(0, m.length -
          2) + "." + m.substr(m.length - 2));
        m = '<div><span class="flipper value">' + m + "</span></div><div>" + EasyEditLocalise._("sec") + "</div>";
        j = a._buildChangeSummaryUnit(EasyEditLocalise._("Page Speed"), m, 0 === l.current[0]["ga:pageLoadSample"] ? 0 : l.current[0]["ga:pageLoadTime"] / l.current[0]["ga:pageLoadSample"], !l.previous[0] || 0 === l.previous[0]["ga:pageLoadSample"] ? 0 : l.previous[0]["ga:pageLoadTime"] / l.previous[0]["ga:pageLoadSample"], !0, EasyEditLocalise._("The average length of time it took for the page to load, from the interaction that started loading it."),
          EasyEditLocalise._("Page speed is based on a random sample of page views (typically 1%). This measure is taken from a sample of <strong>%1</strong> sessions.", l.current[0]["ga:pageLoadSample"]));
        n.appendChild(j);
        var q = [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Tablet"), EasyEditLocalise._("Mobile")],
          p = [0, 0, 0],
          t = 0;
        l.device.map(function(a) {
          t = t + a[b];
          switch (a["ga:deviceCategory"]) {
            case "desktop":
              p[0] = a[b];
              break;
            case "tablet":
              p[1] = a[b];
              break;
            case "mobile":
              p[2] = a[b]
          }
        });
        p = p.map(function(a) {
          return a /
            t * 100
        });
        d3 ? (m = a.util.svgEl("svg"), a._buildPieGraph(m, p, {}), j = a._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"), m, EasyEditLocalise._("The percentage of sessions that visited this page at least once, broken down by the type of device used (desktop, tablet, or mobile phone).")), r = document.createElement("div"), r.innerHTML = p.map(function(a, b) {
          return '<div class="bauble chartColour' + (b + 1) + '"></div><div class="deviceTypeName">' + q[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) +
            "%)</div>"
        }).join(""), m.parentNode.appendChild(r)) : (r = document.createElement("div"), r.innerHTML = p.map(function(a, b) {
          return '<div class="deviceTypeName">' + q[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join(""), j = a._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"), r, EasyEditLocalise._("The percentage of sessions that visited this page at least once, broken down by the type of device used (desktop, tablet, or mobile phone).")));
        j.className = "summaryUnit deviceUsage";
        n.appendChild(j);
        !1 === a.current.isView && (g.appendChild(n), n = document.createElement("div"));
        !1 === a.current.isView && (m = document.createElement("div"), a._buildTopInternalReferrers(l.previous_path, m, 5), j = a._buildPlainSummaryUnit(EasyEditLocalise._("Internal Referrers"), m, EasyEditLocalise._("The pages inside the current site that was most viewed as the page immediately previous to this one.")), n.appendChild(j));
        m = document.createElement("div");
        a._buildTopExternalReferrers(l.campaigns, m, 5);
        j = a._buildPlainSummaryUnit(EasyEditLocalise._("External Referrers"),
          m, EasyEditLocalise._("The top referring sites to sessions that viewed this page at least once, ordered by the number of sessions."));
        n.appendChild(j);
        m = document.createElement("div");
        a._buildTopCampaigns(l.campaigns, m, 5);
        j = a._buildPlainSummaryUnit(EasyEditLocalise._("Top Campaigns"), m, EasyEditLocalise._("Top tagged campaigns for sessions that viewed this page at least once, ordered by number of sessions. These exclude sessions that used a referring site link."));
        n.appendChild(j);
        g.appendChild(n)
      }
    });
    EasyEdit.util.async.series(d)
  }
};
EasyEditScreens.screen.analyticsDefault.subScreens.traffic = new function() {
  var a = this,
    b = EasyEditScreens.screen.analyticsDefault;
  this.name = EasyEditLocalise._("Traffic");
  this.pageTitle = EasyEditLocalise._("Traffic Statistics");
  this.show = function() {
    var c = [],
      d = b.util.sessionStat(),
      e = [];
    e.push(function(a) {
      b.getBasicPageQuery(function(b) {
        a(b)
      })
    });
    e.push(function(a, d) {
      var e = new EasyEditAPI;
      c = ["device"];
      c.map(function(a) {
        e.queue("getGoogleAnalyticsStatistics", b.util.extendQuery(d, {
          canned_query: a
        }))
      });
      e.expect(c.length).run(function(b) {
        a(d,
          b)
      }, e.runMode.BATCH)
    });
    e.push(function(a, d, e) {
      for (var h = 0; h < e.length; h++)
        if (e[h].data.error) {
          (e[h].data.errorDetail && 0 < e[h].data.errorDetail.length ? new EasyEditError(e[h].data.error + ": " + e[h].data.errorDetail[0].message) : new EasyEditError(e[h].data.error)).display();
          return
        }
      var k = e[0].data["end-date"],
        h = e[0].data.period,
        l = b.util.dateString(e[0].data["start-date"]),
        k = b.util.dateString(k);
      jQuery("#ees_analyticsReportPeriodText").html("<strong>" + l + " - " + k + "</strong> (" + h + " days)");
      if (null === e[0].data.rows) h =
        document.getElementById("ees_analyticsReportContents"), l = document.getElementById("ees_analyticsDataAgeValue"), EasyEdit.util.setText(l, EasyEditLocalise._("Never")), b.hideLoadingScreen(), h.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for the selected URL and time period.") + "</strong></p><p>" + EasyEditLocalise._('You can generate statistics for this page by clicking "%1".', EasyEditLocalise._("Refresh")) + "<br/>" + EasyEditLocalise._("This may take a couple of minutes or more, depending on the popularity of your site.") +
        "</p></div>", jQuery(h).addClass("status-stats-empty");
      else {
        var h = document.getElementById("ees_analyticsReportContents"),
          l = document.getElementById("ees_analyticsDataAgeValue"),
          k = new Date,
          n = new Date;
        n.setSeconds(n.getSeconds() - e[0].data.age);
        k.getMonth() === n.getMonth() && k.getFullYear() === n.getFullYear() ? k.getDate() === n.getDate() ? EasyEdit.util.setText(l, EasyEditLocalise._("Today at %1", b.util.formatTime(60 * n.getHours() + n.getMinutes()))) : (k.setDate(k.getDate() - 1), k.getDate() === n.getDate() ? EasyEdit.util.setText(l,
          EasyEditLocalise._("Yesterday at %1", b.util.formatTime(60 * n.getHours() + n.getMinutes()))) : EasyEdit.util.setText(l, b.util.dateString(n))) : EasyEdit.util.setText(l, b.util.dateString(n));
        if (0 === e[0].data.rows.length) b.hideLoadingScreen(), h.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period.") + "</strong></p></div>", jQuery(h).addClass("status-stats-empty");
        else {
          var m = new EasyEditAPI;
          c = [
            ["current", {
              canned_query: "current"
            }],
            ["allOfSite", {
              canned_query: "current",
              context: "site"
            }],
            ["campaigns", {
              canned_query: "campaigns"
            }],
            ["referralPages", {
              canned_query: "referral_pages"
            }],
            ["byDay", {
              canned_query: "by_day_alt"
            }],
            ["byDaySite", {
              canned_query: "by_day_alt",
              context: "site"
            }],
            ["previousPath", {
              canned_query: "previous_path"
            }],
            ["pagePath", {
              canned_query: "page_path"
            }]
          ];
          c.map(function(a) {
            m.queue("getGoogleAnalyticsStatistics", b.util.extendQuery(d, a[1]))
          });
          m.expect(c.length).run(function(b) {
            a(b)
          }, m.runMode.BATCH)
        }
      }
    });
    e.push(function(e, g) {
      for (var j = document.querySelector("#ees_analyticsReportContents"),
          h = 0; h < g.length; h++)
        if (g[h].data.error) {
          (g[h].data.errorDetail && 0 < g[h].data.errorDetail.length ? new EasyEditError(g[h].data.error + ": " + g[h].data.errorDetail[0].message) : new EasyEditError(g[h].data.error)).display();
          return
        }
      if (0 === g[0].data.rows.length) b.hideLoadingScreen(), j.innerHTML = "<div><p>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period") + "</p></div>", jQuery(j).addClass("status-stats-empty");
      else {
        var k = g[0].data["start-date"],
          l = g[0].data["end-date"],
          n = g[0].data.period,
          m = {};
        c.map(function(a, b) {
          m[a[0]] = g[b].data.rows
        });
        var o = m.current[0]["ga:pageviews"],
          r = m.current[0]["ga:entrances"],
          p = m.current[0]["ga:exits"];
        b.hideLoadingScreen();
        h = b.util.dateString(k);
        l = b.util.dateString(l);
        jQuery("#ees_analyticsReportPeriodText").html("<strong>" + h + " - " + l + "</strong> (" + n + " days)");
        if (!1 === b.current.isView) {
          h = document.createElement("div");
          h.className = "summaryUnit trafficBreakdown entrances";
          l = document.createElement("div");
          l.className = "title";
          EasyEdit.util.setText(l,
            EasyEditLocalise._("Page Entries"));
          h.appendChild(l);
          var l = 305,
            s = Math.round(r / o * l),
            q = document.createElement("div");
          q.className = "percentBar";
          var t = document.createElement("div");
          t.className = "external";
          t.setAttribute("style", "width: " + s + "px");
          var w = document.createElement("div");
          w.className = "internal";
          w.setAttribute("style", "width: " + (l - s) + "px");
          q.appendChild(t);
          q.appendChild(w);
          h.appendChild(q);
          l = document.createElement("div");
          l.className = "external";
          l.innerHTML = '<div class="title">' + EasyEditLocalise._("External Referrers") +
            '</div><div><span class="value">' + b.util.abbrevStat(r) + '</span> <span class="percent">(' + EasyEdit.util.formatNumber(Math.round(100 * (r / o))) + "%)</span></div>";
          h.appendChild(l);
          l = document.createElement("div");
          l.className = "internal";
          l.innerHTML = '<div class="title">' + EasyEditLocalise._("Internal Referrers") + '</div><div><span class="value">' + b.util.abbrevStat(o - r) + '</span> <span class="percent">(' + EasyEdit.util.formatNumber(Math.round(100 * ((o - r) / o))) + "%)</span></div>";
          h.appendChild(l);
          j.appendChild(h);
          h = document.createElement("div");
          h.className = "trafficBdownCentre";
          r = document.createElement("span");
          r.className = "enterExit entrances";
          h.appendChild(r);
          r = document.createElement("span");
          r.className = "ees_assetType typeCode " + b.current.asset.attribute("type_code");
          h.appendChild(r);
          r = document.createElement("span");
          r.className = "enterExit exits";
          h.appendChild(r);
          j.appendChild(h);
          h = document.createElement("div");
          h.className = "summaryUnit trafficBreakdown exits";
          l = document.createElement("div");
          l.className = "title";
          EasyEdit.util.setText(l, EasyEditLocalise._("Page Exits"));
          h.appendChild(l);
          l = 305;
          s = Math.round(p / o * l);
          q = document.createElement("div");
          q.className = "percentBar";
          t = document.createElement("div");
          t.className = "external";
          t.setAttribute("style", "width: " + s + "px");
          w = document.createElement("div");
          w.className = "internal";
          w.setAttribute("style", "width: " + (l - s) + "px");
          q.appendChild(t);
          q.appendChild(w);
          h.appendChild(q);
          r = document.createElement("div");
          r.className = "external";
          r.innerHTML = '<div class="title">' + EasyEditLocalise._("Exits") +
            '</div><div><span class="value">' + b.util.abbrevStat(p) + '</span> <span class="percent">(' + EasyEdit.util.formatNumber(Math.round(100 * (p / o))) + "%)</span></div>";
          h.appendChild(r);
          l = document.createElement("div");
          l.className = "internal";
          l.innerHTML = '<div class="title">' + EasyEditLocalise._("Next Page") + '</div><div><span class="value">' + b.util.abbrevStat(o - p) + '</span> <span class="percent">(' + EasyEdit.util.formatNumber(Math.round(100 * ((o - p) / o))) + "%)</span></div>";
          h.appendChild(l);
          j.appendChild(h)
        }
        o = document.createElement("div");
        p = document.createElement("div");
        r = b._buildTrafficSourceSummary(m.campaigns, p);
        h = b._buildPlainSummaryUnit(EasyEditLocalise._("Traffic Sources"), p, EasyEditLocalise._("Traffic source breakdown by number of sessions."));
        o.appendChild(h);
        d3 && (h.className += " halfWidth", b._buildTrafficSourceGraph(m.campaigns, p.parentNode));
        !1 === b.current.isView && (p = document.createElement("div"), b._buildTopInternalReferrers(m.previousPath, p, r), h = b._buildPlainSummaryUnit(EasyEditLocalise._("Internal Referrers"), p, EasyEditLocalise._("The pages inside the current site that was most viewed as the page immediately previous to this one.")),
          o.appendChild(h));
        p = document.createElement("div");
        b._buildTopCampaigns(m.campaigns, p, r);
        h = b._buildPlainSummaryUnit(EasyEditLocalise._("Top Campaigns"), p, EasyEditLocalise._("Top campaigns by number of sessions. Campaigns include traffic sources other than referrals or direct traffic."));
        o.appendChild(h);
        j.appendChild(o);
        var v = document.createElement("div"),
          h = a._buildStatsTable(m.current[0], m.allOfSite[0]);
        h.id = "ees_analyticsTrafficTable";
        v.appendChild(h);
        if (d3) {
          var u = {
              height: 200,
              barHeight: 190,
              width: 698,
              tickTextMargin: 30
            },
            o = document.createElement("tr"),
            p = document.createElement("td");
          p.className = "chartLegendCell left";
          p.setAttribute("colspan", "4");
          p.innerHTML = !1 === b.current.isView ? "<p>" + EasyEditLocalise._("Page") + "</p>" : "<p>" + EasyEditLocalise._("Site") + "</p>";
          o.appendChild(p);
          p = document.createElement("td");
          p.className = "chartLegendCell right";
          p.setAttribute("colspan", "3");
          p.innerHTML = "<p>" + EasyEditLocalise._("Site") + "</p>";
          o.appendChild(p);
          h.appendChild(o);
          o = document.createElement("tr");
          p = document.createElement("td");
          p.className = "chartCell";
          p.setAttribute("colspan", "7");
          var y = a._buildStatsGraph(m.byDay, m.byDaySite, k, n, d, u, 1);
          y.setAttribute("id", "ees_analyticsTrafficGraph");
          p.appendChild(y);
          o.appendChild(p);
          h.appendChild(o)
        }
        o = document.createElement("div");
        h = [{
          title: EasyEditLocalise._("Page Path"),
          stat: function(a) {
            return a.name
          },
          width: 60
        }, {
          title: EasyEditLocalise._("Sessions"),
          stat: "ga:uniquePageviews",
          showPercent: !0,
          width: 20
        }, {
          title: EasyEditLocalise._("Page Views"),
          stat: "ga:pageviews",
          showPercent: !0,
          width: 20
        }];
        h = b._buildDrilldownTable({
          id: "ees_analyticsTrafficSwitchableDiv_topPages",
          summaryData: m.current[0],
          detailData: m.pagePath,
          majorDimension: "ga:pagePath",
          minorDimension: null,
          columns: h,
          maxMajorRows: 50,
          maxMinorRows: Number.POSITIVE_INFINITY
        });
        h.className += " hidden";
        v.appendChild(h);
        h = b._buildDrilldownTable({
          id: "ees_analyticsReferringSitesTable",
          summaryData: m.current[0],
          detailData: m.referralPages,
          majorDimension: "ga:source",
          minorDimension: "ga:referralPath",
          maxMajorRows: 20,
          maxMinorRows: 5
        });
        h.className += " hidden";
        v.appendChild(h);
        h = b._buildDrilldownTable({
          id: "ees_analyticsReferringPagesTable",
          summaryData: m.current[0],
          detailData: m.referralPages,
          majorDimension: function(a) {
            return a["ga:source"] + a["ga:referralPath"]
          },
          minorDimension: null,
          maxMajorRows: 20,
          maxMinorRows: 0
        });
        h.className += " hidden";
        v.appendChild(h);
        var z = document.createElement("div");
        z.id = "ees_analyticsTrafficReportClicker";
        z.className = "dropDownClicker";
        EasyEdit.util.setText(z, EasyEditLocalise._("Report Period Statistics"));
        z.innerHTML = '<span class="alignRight expand"></span>' +
          z.innerHTML;
        j.appendChild(z);
        j.appendChild(v);
        if (d3) {
          var x = function(a, c, e, f) {
            for (var g = {
                "ga:uniquePageviews": EasyEditLocalise._("Sessions"),
                "ga:sessions": EasyEditLocalise._("Sessions"),
                "ga:pageviews": EasyEditLocalise._("Page Views"),
                "ga:entrances": EasyEditLocalise._("Landings"),
                "ga:exits": EasyEditLocalise._("Exits"),
                "ga:bounceRate": EasyEditLocalise._("Bounce Rate"),
                "ga:avgTimeOnPage": EasyEditLocalise._("Page Time (m:s)")
              }, h = [], j = [], l = new Date(k), m = 0; m < n; m++) {
              var o = b.util.dateString(l);
              h[m] = {
                dateStr: o,
                page: 0,
                site: 0
              };
              l.setDate(l.getDate() + 1)
            }
            b.current.isView === false && a.map(function(a) {
              var b = parseInt(a["ga:nthDay"], 10);
              h[b].page = a[e]
            });
            c.map(function(a) {
              var b = e;
              e === "ga:uniquePageviews" && (b = "ga:sessions");
              var c = parseInt(a["ga:nthDay"], 10);
              h[c].site = a[b]
            });
            for (m = 0; m < n; m++) {
              if (e === "ga:bounceRate") {
                a = EasyEdit.util.formatNumber(h[m].page, 2) + "%";
                c = EasyEdit.util.formatNumber(h[m].site, 2) + "%"
              } else if (e === "ga:avgTimeOnPage") {
                a = b.util.formatTime(h[m].page);
                c = b.util.formatTime(h[m].site)
              } else {
                a = b.util.abbrevStat(h[m].page);
                c = b.util.abbrevStat(h[m].site)
              }
              j[m] = '<table><col width="80%" /><col width="20%" /><tr><th class="name">' + h[m].dateStr + '</th><th class="value">' + g[e] + "</tr>" + (d !== "ga:uniquePageviews" ? "" : '<tr><td class="name">' + b.util.bauble(f) + " " + EasyEditLocalise._("This page") + '</td><td class="value">' + a + "</td></tr>") + '<tr><td class="name">' + b.util.bauble(f, true) + " " + EasyEditLocalise._("All of site") + '</td><td class="value">' + c + "</td></tr></table>"
            }
            return j
          };
          b.util.hoverRect(y, u, n, !0, "ees_analyticsGraphTooltipTraffic",
            x(m.byDay, m.byDaySite, d, 1));
          jQuery("#ees_analyticsTrafficTable").on("click", "input[type=radio]", function(c) {
            var d = c.target,
              c = d.getAttribute("data-colour"),
              d = d.getAttribute("value"),
              e = a._buildStatsGraph(m.byDay, m.byDaySite, k, n, d, u, c);
            e.setAttribute("id", "ees_analyticsTrafficGraph");
            var f = jQuery("#ees_analyticsTrafficGraph")[0];
            f.parentNode.replaceChild(e, f);
            b.util.hoverRect(e, u, n, true, "ees_analyticsGraphTooltipTraffic", x(m.byDay, m.byDaySite, d, c))
          })
        }
        j = ['<a data-subscreen="report-stats" class="active">' +
          EasyEditLocalise._("Report Period Statistics") + "</a>", '<a data-subscreen="top-pages">' + EasyEditLocalise._("Most Viewed Pages") + "</a>", '<a data-subscreen="referring-sites">' + EasyEditLocalise._("Top Referring Sites") + "</a>", '<a data-subscreen="referring-pages">' + EasyEditLocalise._("Top Referring Pages") + "</a>"
        ];
        !1 === b.current.isView && (j[1] = '<a data-subscreen="top-pages">' + EasyEditLocalise._("Most Used Query Strings") + "</a>");
        var y = EasyEditLocalise._("Reports"),
          B = EasyEdit.tip.create({
            targetId: "ees_analyticsTrafficReportClicker",
            containerId: "ees_analyticsTrafficReportTooltip",
            position: "south",
            title: y,
            message: j.join(""),
            buttons: [],
            className: "analyticsDropDownTooltip"
          });
        B.$element.find(".tooltipButtons").remove();
        jQuery(z).on("click", null, function() {
          B.toggle()
        });
        B.$element.on("click", "a", function(a) {
          B.hide();
          a = a.target;
          EasyEdit.util.setText(z, EasyEdit.util.getText(a));
          z.innerHTML = '<span class="alignRight expand"></span>' + z.innerHTML;
          jQuery(v).children("div, table").addClass("hidden");
          B.$element.find(".tooltipContent a").removeClass("active");
          jQuery(a).addClass("active");
          switch (a.getAttribute("data-subscreen")) {
            case "report-stats":
              jQuery("#ees_analyticsTrafficTable").removeClass("hidden");
              d3 && jQuery("#ees_analyticsTrafficGraph").removeClass("hidden");
              break;
            case "top-pages":
              jQuery("#ees_analyticsTrafficSwitchableDiv_topPages").removeClass("hidden");
              break;
            case "referring-sites":
              jQuery("#ees_analyticsReferringSitesTable").removeClass("hidden");
              break;
            case "referring-pages":
              jQuery("#ees_analyticsReferringPagesTable").removeClass("hidden")
          }
        })
      }
    });
    EasyEdit.util.async.series(e)
  };
  this._buildStatsTable = function(a, d) {
    var e = b.util.sessionStat(),
      f = document.createElement("table");
    f.className = "styled";
    [16, 14, 14, 14, 14, 14, 14].map(function(a) {
      var b = document.createElement("col");
      b.setAttribute("width", a + "%");
      f.appendChild(b)
    });
    var g = document.createElement("tr");
    g.appendChild(b.util.cell("", !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", e, 1, !0) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt", 1, EasyEditLocalise._("Sessions")), !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", "ga:pageviews", 2) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt", 2, EasyEditLocalise._("Page Views")), !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", "ga:entrances", 3) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt", 3, EasyEditLocalise._("Landings")), !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", "ga:avgTimeOnPage", 4) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt",
      4, EasyEditLocalise._("Page Time")), !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", "ga:bounceRate", 5) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt", 5, EasyEditLocalise._("Bounce Rate")), !0, !0));
    g.appendChild(b.util.cell(b.util.tableOption("ees_analyticsTrafficGraphOpt", "ga:exits", 6) + " " + b.util.tableLabel("ees_analyticsTrafficGraphOpt", 6, EasyEditLocalise._("Exits")), !0, !0));
    var j = document.createElement("tr");
    j.appendChild(b.util.cell(EasyEditLocalise._("Site Total")));
    j.appendChild(b.util.cell(b.util.bauble(1, !0) + " " + b.util.abbrevStat(d["ga:sessions"]), !1, !0));
    j.appendChild(b.util.cell(b.util.bauble(2, !0) + " " + b.util.abbrevStat(d["ga:pageviews"]), !1, !0));
    j.appendChild(b.util.cell(b.util.bauble(3, !0) + " " + b.util.abbrevStat(d["ga:entrances"]), !1, !0));
    j.appendChild(b.util.cell(b.util.bauble(4, !0) + " " + b.util.formatTime(d["ga:timeOnPage"] / (d["ga:pageviews"] - d["ga:exits"])), !1, !0));
    j.appendChild(b.util.cell(b.util.bauble(5, !0) + " " + EasyEdit.util.formatNumber(100 * (d["ga:bounces"] /
      d["ga:entrances"]), 2) + "%", !1, !0));
    j.appendChild(b.util.cell(b.util.bauble(6, !0) + " " + b.util.abbrevStat(d["ga:exits"]), !1, !0));
    f.appendChild(g);
    f.appendChild(j);
    !1 === b.current.isView && (g = document.createElement("tr"), g.appendChild(b.util.cell(EasyEditLocalise._("Page Total"))), g.appendChild(b.util.cell(b.util.bauble(1) + " " + b.util.abbrevStat(a[e]), !1, !0)), g.appendChild(b.util.cell(b.util.bauble(2) + " " + b.util.abbrevStat(a["ga:pageviews"]), !1, !0)), g.appendChild(b.util.cell(b.util.bauble(3) + " " + b.util.abbrevStat(a["ga:entrances"]), !1, !0)), g.appendChild(b.util.cell(b.util.bauble(4) + " " + b.util.formatTime(a["ga:timeOnPage"] / (a["ga:pageviews"] - a["ga:exits"])), !1, !0)), g.appendChild(b.util.cell(b.util.bauble(5) + " " + EasyEdit.util.formatNumber(100 * (a["ga:bounces"] / a["ga:entrances"]), 2) + "%", !1, !0)), g.appendChild(b.util.cell(b.util.bauble(6) + " " + b.util.abbrevStat(a["ga:exits"]), !1, !0)), f.appendChild(g));
    return f
  };
  this._buildStatsGraph = function(a, d, e, f, g, j, h) {
    var k = b.util.svgEl("svg");
    k.setAttribute("viewBox", "0 0 " + j.width + " " + j.height);
    k.setAttribute("preserveAspectRatio", "none");
    k.setAttribute("class", "chart");
    var l = b.util.svgEl("g"),
      n = b.util.svgEl("g");
    n.setAttribute("class", "siteGraph");
    k.appendChild(l);
    k.appendChild(n);
    var m = [],
      o = [];
    a.map(function(a) {
      var b = parseInt(a["ga:nthDay"], 10);
      m[b] = a[g]
    });
    d.map(function(a) {
      var b = g;
      "ga:uniquePageviews" === b && (b = "ga:sessions");
      var c = parseInt(a["ga:nthDay"], 10);
      o[c] = a[b]
    });
    a = [];
    e = new Date(e);
    for (d = 0; d < f; d++) !1 === m.hasOwnProperty(d) && (m[d] = 0), !1 === o.hasOwnProperty(d) && (o[d] = 0), (0 === e.getDay() ||
      6 === e.getDay()) && a.push(d), e.setDate(e.getDate() + 1);
    var r = Math.max.apply(null, m),
      p = Math.max.apply(null, o),
      e = b.util.tickValue(r),
      r = Math.ceil(r / e) * e,
      s = d = 1;
    if (!1 === b.current.isView) {
      e = b.util.tickValue(r);
      for (r = Math.ceil(r / e) * e; p > r * d * s;)
        if (p <= 2 * r * d) {
          s = 2;
          break
        } else if (10 <= d && p <= 2.5 * r * d) {
        s = 2.5;
        break
      } else if (p <= 5 * r * d) {
        s = 5;
        break
      } else d *= 10
    } else e = b.util.tickValue(p), r = Math.ceil(p / e) * e;
    var p = r * d * s,
      q = d3.svg.line().x(function(a, b) {
        return j.tickTextMargin + b * ((j.width - 2 * j.tickTextMargin) / (f - 1))
      }).y(function(a) {
        return j.barHeight -
          a * j.barHeight / r
      }).interpolate("linear"),
      t = d3.svg.line().x(function(a, b) {
        return j.tickTextMargin + b * ((j.width - 2 * j.tickTextMargin) / (f - 1))
      }).y(function(a) {
        return j.barHeight - a * j.barHeight / p
      }).interpolate("linear");
    !1 === b.current.isView && d3.select(l).selectAll("path").data([m]).enter().append("path").attr("d", function(a) {
      return q(a)
    }).attr("stroke-width", "2").attr("class", "chartColour" + h + "_s").attr("stroke", "#555555").attr("fill", "transparent");
    d3.select(n).selectAll("path").data([o]).enter().append("path").attr("d",
      function(a) {
        return t(a)
      }).attr("stroke-width", "2").attr("class", "chartColour" + h + "_s").attr("stroke", "#555555").attr("fill", "transparent");
    h = b.util.svgEl("rect");
    h.setAttribute("x", 0);
    h.setAttribute("y", j.barHeight);
    h.setAttribute("width", j.width);
    h.setAttribute("height", 1);
    h.setAttribute("fill", "#555555");
    k.appendChild(h);
    for (h = e; h <= r; h += e) {
      l = b.util.svgEl("rect");
      l.setAttribute("x", 0);
      l.setAttribute("y", j.barHeight * (1 - h / r));
      l.setAttribute("width", j.width);
      l.setAttribute("height", 1);
      l.setAttribute("fill",
        "#888888");
      k.insertBefore(l, k.firstChild);
      l = b.util.svgEl("text");
      l.setAttribute("x", 0);
      l.setAttribute("y", j.barHeight * (1 - h / r) + 12);
      l.setAttribute("font-family", "Helvetica, Arial");
      l.setAttribute("font-size", "11px");
      l.setAttribute("fill", "#888888");
      n = b.util.svgEl("text");
      n.setAttribute("x", j.width);
      n.setAttribute("y", j.barHeight * (1 - h / r) + 12);
      n.setAttribute("font-family", "Helvetica, Arial");
      n.setAttribute("font-size", "11px");
      n.setAttribute("fill", "#888888");
      n.setAttribute("text-anchor", "end");
      "ga:avgTimeOnPage" ===
      g ? EasyEdit.util.setText(l, b.util.formatTime(h)) : 1E7 < h ? EasyEdit.util.setText(l, Math.floor(h / 1E6) + "M") : 1E6 < h ? EasyEdit.util.setText(l, Math.floor(h / 1E5) / 10 + "M") : 1E4 < h ? EasyEdit.util.setText(l, Math.floor(h / 1E3) + "k") : EasyEdit.util.setText(l, h);
      var w = h * s * d;
      "ga:avgTimeOnPage" === g ? EasyEdit.util.setText(n, b.util.formatTime(w)) : 1E7 < h ? EasyEdit.util.setText(n, Math.floor(w / 1E6) + "M") : 1E6 < h ? EasyEdit.util.setText(n, Math.floor(w / 1E5) / 10 + "M") : 1E4 < h ? EasyEdit.util.setText(n, Math.floor(w / 1E3) + "k") : EasyEdit.util.setText(n,
        w);
      k.appendChild(l);
      k.appendChild(n)
    }
    for (h = e / 2; h < r; h += e) l = b.util.svgEl("rect"), l.setAttribute("x", 0), l.setAttribute("y", j.barHeight * (1 - h / r)), l.setAttribute("width", j.width), l.setAttribute("height", 1), l.setAttribute("fill", "#cccccc"), k.insertBefore(l, k.firstChild);
    a.map(function(a) {
      var c = b.util.svgEl("circle");
      c.setAttribute("cx", j.tickTextMargin + a * ((j.width - 2 * j.tickTextMargin) / (f - 1)));
      c.setAttribute("cy", j.barHeight + 5);
      c.setAttribute("r", 2.5);
      c.setAttribute("fill", "#cccccc");
      k.appendChild(c)
    });
    return k
  }
};
EasyEditScreens.screen.analyticsDefault.subScreens.audience = new function() {
  var a = EasyEditScreens.screen.analyticsDefault;
  this.name = EasyEditLocalise._("Audience");
  this.pageTitle = EasyEditLocalise._("Audience Statistics");
  var b = function(b, c, f, g, j, h, k) {
      var l = a.util.sessionStat(),
        n = a.util.svgEl("svg");
      n.setAttribute("viewBox", "0 0 " + h.width + " " + h.height);
      n.setAttribute("preserveAspectRatio", "none");
      n.setAttribute("class", "chart");
      var m = a.util.svgEl("g"),
        o = a.util.svgEl("g");
      o.setAttribute("class", "siteGraph");
      n.appendChild(m);
      n.appendChild(o);
      for (var r = [], p = [], s = [], f = new Date(f), q = 0; q < g; q++) r[q] = 0, p[q] = 0, (0 === f.getDay() || 6 === f.getDay()) && s.push(q), f.setDate(f.getDate() + 1);
      b.map(function(a) {
        var b = parseInt(a["ga:nthDay"], 10);
        a["ga:deviceCategory"] === j && (r[b] = a[l])
      });
      c.map(function(a) {
        var b = parseInt(a["ga:nthDay"], 10);
        a["ga:deviceCategory"] === j && (p[b] = a["ga:sessions"])
      });
      for (var t = Math.max.apply(null, r), w = Math.max.apply(null, p), b = a.util.tickValue(t), t = Math.ceil(t / b) * b, f = c = 1; w > t * c * f;)
        if (w <= 2 * t * c) {
          f = 2;
          break
        } else if (10 <=
        c && w <= 2.5 * t * c) {
        f = 2.5;
        break
      } else if (w <= 5 * t * c) {
        f = 5;
        break
      } else c *= 10;
      var w = t * c * f,
        v = d3.svg.line().x(function(a, b) {
          return h.tickTextMargin + b * ((h.width - 2 * h.tickTextMargin) / (g - 1))
        }).y(function(a) {
          return h.barHeight - a * h.barHeight / t
        }).interpolate("linear"),
        u = d3.svg.line().x(function(a, b) {
          return h.tickTextMargin + b * ((h.width - 2 * h.tickTextMargin) / (g - 1))
        }).y(function(a) {
          return h.barHeight - a * h.barHeight / w
        }).interpolate("linear");
      !1 === a.current.isView && d3.select(m).selectAll("path").data([r]).enter().append("path").attr("d",
        function(a) {
          return v(a)
        }).attr("stroke-width", "2").attr("class", "chartColour" + k + "_s").attr("stroke", "#555555").attr("fill", "transparent");
      d3.select(o).selectAll("path").data([p]).enter().append("path").attr("d", function(a) {
        return u(a)
      }).attr("stroke-width", "2").attr("class", "chartColour" + k + "_s").attr("stroke", "#555555").attr("fill", "transparent");
      k = a.util.svgEl("rect");
      k.setAttribute("x", 0);
      k.setAttribute("y", h.barHeight);
      k.setAttribute("width", h.width);
      k.setAttribute("height", 1);
      k.setAttribute("fill",
        "#555555");
      n.appendChild(k);
      for (k = b; k <= t; k += b) m = a.util.svgEl("rect"), m.setAttribute("x", 0), m.setAttribute("y", h.barHeight * (1 - k / t)), m.setAttribute("width", h.width), m.setAttribute("height", 1), m.setAttribute("fill", "#888888"), n.insertBefore(m, n.firstChild), m = a.util.svgEl("text"), m.setAttribute("x", 0), m.setAttribute("y", h.barHeight * (1 - k / t) + 12), m.setAttribute("font-family", "Helvetica, Arial"), m.setAttribute("font-size", "11px"), m.setAttribute("fill", "#888888"), o = a.util.svgEl("text"), o.setAttribute("x",
        h.width), o.setAttribute("y", h.barHeight * (1 - k / t) + 12), o.setAttribute("font-family", "Helvetica, Arial"), o.setAttribute("font-size", "11px"), o.setAttribute("fill", "#888888"), o.setAttribute("text-anchor", "end"), 1E7 < k ? EasyEdit.util.setText(m, Math.floor(k / 1E6) + "M") : 1E6 < k ? EasyEdit.util.setText(m, Math.floor(k / 1E5) / 10 + "M") : 1E4 < k ? EasyEdit.util.setText(m, Math.floor(k / 1E3) + "k") : EasyEdit.util.setText(m, k), q = k * f * c, 1E7 < k ? EasyEdit.util.setText(o, Math.floor(q / 1E6) + "M") : 1E6 < k ? EasyEdit.util.setText(o, Math.floor(q / 1E5) /
        10 + "M") : 1E4 < k ? EasyEdit.util.setText(o, Math.floor(q / 1E3) + "k") : EasyEdit.util.setText(o, q), n.appendChild(m), n.appendChild(o);
      for (k = b / 2; k < t; k += b) m = a.util.svgEl("rect"), m.setAttribute("x", 0), m.setAttribute("y", h.barHeight * (1 - k / t)), m.setAttribute("width", h.width), m.setAttribute("height", 1), m.setAttribute("fill", "#cccccc"), n.insertBefore(m, n.firstChild);
      s.map(function(b) {
        var c = a.util.svgEl("circle");
        c.setAttribute("cx", h.tickTextMargin + b * ((h.width - 2 * h.tickTextMargin) / (g - 1)));
        c.setAttribute("cy", h.barHeight +
          5);
        c.setAttribute("r", 2.5);
        c.setAttribute("fill", "#cccccc");
        n.appendChild(c)
      });
      return n
    },
    c = function(b, c) {
      var f = a.util.sessionStat(),
        g = document.createElement("table");
      g.className = "styled";
      [16, 30, 18, 18, 18].map(function(a) {
        var b = document.createElement("col");
        b.setAttribute("width", a + "%");
        g.appendChild(b)
      });
      var j = {},
        h = {},
        k = 0,
        l = 0;
      b.map(function(a) {
        j[a["ga:deviceCategory"]] = a[f];
        k += a[f]
      });
      c.map(function(a) {
        h[a["ga:deviceCategory"]] = a["ga:sessions"];
        l += a["ga:sessions"]
      });
      var n = document.createElement("tr");
      n.appendChild(a.util.cell("", !0));
      n.appendChild(a.util.cell("All", !0));
      n.appendChild(a.util.cell(a.util.tableOption("ees_analyticsAudienceDeviceOpt", "desktop", 1, !0) + " " + a.util.tableLabel("ees_analyticsAudienceDeviceOpt", 1, EasyEditLocalise._("Desktop")), !0, !0));
      n.appendChild(a.util.cell(a.util.tableOption("ees_analyticsAudienceDeviceOpt", "tablet", 2) + " " + a.util.tableLabel("ees_analyticsAudienceDeviceOpt", 2, EasyEditLocalise._("Tablet")), !0, !0));
      n.appendChild(a.util.cell(a.util.tableOption("ees_analyticsAudienceDeviceOpt",
        "mobile", 3) + " " + a.util.tableLabel("ees_analyticsAudienceDeviceOpt", 3, EasyEditLocalise._("Mobile")), !0, !0));
      var m = document.createElement("tr");
      m.appendChild(a.util.cell(EasyEditLocalise._("Site Total")));
      m.appendChild(a.util.cell(["desktop", "tablet", "mobile"].map(function(a, b) {
        return '<div style="width: ' + EasyEdit.util.formatNumber(204 * h[a] / l, 4) + 'px" class="deviceBarUnit lessOpaque chartColour' + (b + 1) + '"></div>'
      }).join(""), !1, !0));
      m.appendChild(a.util.cell(a.util.bauble(1, !0) + " " + a.util.abbrevStat(h.desktop), !1, !0));
      m.appendChild(a.util.cell(a.util.bauble(2, !0) + " " + a.util.abbrevStat(h.tablet), !1, !0));
      m.appendChild(a.util.cell(a.util.bauble(3, !0) + " " + a.util.abbrevStat(h.mobile), !1, !0));
      g.appendChild(n);
      g.appendChild(m);
      !1 === a.current.isView && (n = document.createElement("tr"), n.appendChild(a.util.cell(EasyEditLocalise._("Page Total"))), n.appendChild(a.util.cell(["desktop", "tablet", "mobile"].map(function(a, b) {
        return '<div style="width: ' + EasyEdit.util.formatNumber(204 * j[a] / k, 4) + 'px" class="deviceBarUnit chartColour' +
          (b + 1) + '"></div>'
      }).join(""), !1, !0)), n.appendChild(a.util.cell(a.util.bauble(1) + " " + a.util.abbrevStat(j.desktop), !1, !0)), n.appendChild(a.util.cell(a.util.bauble(2) + " " + a.util.abbrevStat(j.tablet), !1, !0)), n.appendChild(a.util.cell(a.util.bauble(3) + " " + a.util.abbrevStat(j.mobile), !1, !0)), g.appendChild(n));
      return g
    };
  this.show = function() {
    var d = [],
      e = a.util.sessionStat(),
      f = [];
    f.push(function(b) {
      a.getBasicPageQuery(function(a) {
        b(a)
      })
    });
    f.push(function(b, c) {
      var e = new EasyEditAPI;
      d = ["device"];
      d.map(function(b) {
        e.queue("getGoogleAnalyticsStatistics",
          a.util.extendQuery(c, {
            canned_query: b
          }))
      });
      e.expect(d.length).run(function(a) {
        b(c, a)
      }, e.runMode.BATCH)
    });
    f.push(function(b, c, e) {
      for (var f = 0; f < e.length; f++)
        if (e[f].data.error) {
          (e[f].data.errorDetail && 0 < e[f].data.errorDetail.length ? new EasyEditError(e[f].data.error + ": " + e[f].data.errorDetail[0].message) : new EasyEditError(e[f].data.error)).display();
          return
        }
      var l = e[0].data["end-date"],
        f = e[0].data.period,
        n = a.util.dateString(e[0].data["start-date"]),
        l = a.util.dateString(l);
      jQuery("#ees_analyticsReportPeriodText").html("<strong>" +
        n + " - " + l + "</strong> (" + f + " days)");
      if (null === e[0].data.rows) f = document.getElementById("ees_analyticsReportContents"), n = document.getElementById("ees_analyticsDataAgeValue"), EasyEdit.util.setText(n, EasyEditLocalise._("Never")), a.hideLoadingScreen(), f.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for the selected URL and time period.") + "</strong></p><p>" + EasyEditLocalise._('You can generate statistics for this page by clicking "%1".', EasyEditLocalise._("Refresh")) +
        "<br/>" + EasyEditLocalise._("This may take a couple of minutes or more, depending on the popularity of your site.") + "</p></div>", jQuery(f).addClass("status-stats-empty");
      else {
        var f = document.getElementById("ees_analyticsReportContents"),
          n = document.getElementById("ees_analyticsDataAgeValue"),
          l = new Date,
          m = new Date;
        m.setSeconds(m.getSeconds() - e[0].data.age);
        l.getMonth() === m.getMonth() && l.getFullYear() === m.getFullYear() ? l.getDate() === m.getDate() ? EasyEdit.util.setText(n, EasyEditLocalise._("Today at %1",
          a.util.formatTime(60 * m.getHours() + m.getMinutes()))) : (l.setDate(l.getDate() - 1), l.getDate() === m.getDate() ? EasyEdit.util.setText(n, EasyEditLocalise._("Yesterday at %1", a.util.formatTime(60 * m.getHours() + m.getMinutes()))) : EasyEdit.util.setText(n, a.util.dateString(m))) : EasyEdit.util.setText(n, a.util.dateString(m));
        if (0 === e[0].data.rows.length) a.hideLoadingScreen(), f.innerHTML = "<div><p><strong>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period.") + "</strong></p></div>",
          jQuery(f).addClass("status-stats-empty");
        else {
          var o = new EasyEditAPI;
          d = [
            ["current", {
              canned_query: "current"
            }],
            ["allOfSite", {
              canned_query: "current",
              context: "site"
            }],
            ["browser", {
              canned_query: "browser"
            }],
            ["os", {
              canned_query: "os"
            }],
            ["device", {
              canned_query: "device"
            }],
            ["deviceSite", {
              canned_query: "device",
              context: "site"
            }],
            ["deviceDaily", {
              canned_query: "device_daily"
            }],
            ["deviceSiteDaily", {
              canned_query: "device_daily",
              context: "site"
            }],
            ["location", {
              canned_query: "location"
            }],
            ["language", {
              canned_query: "language"
            }],
            ["orgs", {
              canned_query: "orgs"
            }]
          ];
          d.map(function(b) {
            o.queue("getGoogleAnalyticsStatistics", a.util.extendQuery(c, b[1]))
          });
          o.expect(d.length).run(function(a) {
            b(a)
          }, o.runMode.BATCH)
        }
      }
    });
    f.push(function(f, j) {
      for (var h = document.querySelector("#ees_analyticsReportContents"), k = 0; k < j.length; k++)
        if (j[k].data.error) {
          (j[k].data.errorDetail && 0 < j[k].data.errorDetail.length ? new EasyEditError(j[k].data.error + ": " + j[k].data.errorDetail[0].message) : new EasyEditError(j[k].data.error)).display();
          return
        }
      if (0 === j[0].data.rows.length) a.hideLoadingScreen(),
        h.innerHTML = "<div><p>" + EasyEditLocalise._("There are no statistics available for this URL and selected time period") + "</p></div>", jQuery(h).addClass("status-stats-empty");
      else {
        var l = j[0].data["start-date"],
          k = j[0].data["end-date"],
          n = j[0].data.period,
          m = {};
        d.map(function(a, b) {
          m[a[0]] = j[b].data.rows
        });
        a.hideLoadingScreen();
        var o = a.util.dateString(l),
          k = a.util.dateString(k);
        jQuery("#ees_analyticsReportPeriodText").html("<strong>" + o + " - " + k + "</strong> (" + n + " days)");
        var o = document.createElement("div"),
          r = [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Tablet"), EasyEditLocalise._("Mobile")],
          p = [0, 0, 0],
          s = 0;
        m.device.map(function(a) {
          s += a[e];
          switch (a["ga:deviceCategory"]) {
            case "desktop":
              p[0] = a[e];
              break;
            case "tablet":
              p[1] = a[e];
              break;
            case "mobile":
              p[2] = a[e]
          }
        });
        p = p.map(function(a) {
          return 100 * (a / s)
        });
        if (d3) {
          var q = a.util.svgEl("svg");
          a._buildPieGraph(q, p, {});
          var k = a._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"), q, EasyEditLocalise._("The percentage of sessions that visited this page at least once, broken down by the type of device used (desktop, tablet, or mobile phone).")),
            t = document.createElement("div");
          t.innerHTML = p.map(function(a, b) {
            return '<div class="bauble chartColour' + (b + 1) + '"></div><div class="deviceTypeName">' + r[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
          }).join("");
          q.parentNode.appendChild(t)
        } else t = document.createElement("div"), t.innerHTML = p.map(function(a, b) {
          return '<div class="deviceTypeName">' + r[b] + '</div><div class="rawValue">(' + EasyEdit.util.formatNumber(a, 1) + "%)</div>"
        }).join(""), k = a._buildPlainSummaryUnit(EasyEditLocalise._("Device Usage"),
          t, EasyEditLocalise._("The percentage of sessions that visited this page at least once, broken down by the type of device used (desktop, tablet, or mobile phone)."));
        k.className = "summaryUnit deviceUsage";
        o.appendChild(k);
        for (var q = document.createElement("div"), t = [], w = {}, v, u, k = 0; k < m.location.length; k++) v = m.location[k], u = v["ga:country"], "undefined" !== typeof w[u] ? t[w[u]][1] += v[e] : (w[u] = t.length, t.push([u, v[e]]));
        t.sort(function(a, b) {
          return b[1] - a[1]
        });
        a._buildSmallList(q, t, 5);
        k = a._buildPlainSummaryUnit(EasyEditLocalise._("Top Countries"),
          q, EasyEditLocalise._("The countries that deliver the most visits."));
        k.className = "summaryUnit";
        o.appendChild(k);
        q = document.createElement("div");
        t = [];
        w = [];
        for (k = 0; k < m.browser.length; k++) v = m.browser[k], u = v["ga:browser"], "Internet Explorer" === u && (u = "MSIE"), "Safari" === u && 500 <= v["ga:browserVersion"].split(".")[0] && (u = "Webkit"), u += " " + v["ga:browserVersion"].split(".").splice(0, 2).join("."), "undefined" !== typeof w[u] ? t[w[u]][1] += v[e] : (w[u] = t.length, t.push([u, v[e]]));
        t.sort(function(a, b) {
          return b[1] - a[1]
        });
        a._buildSmallList(q, t, 5);
        k = a._buildPlainSummaryUnit(EasyEditLocalise._("Top Browsers"), q, EasyEditLocalise._('The browsers that deliver the most visits. Browsers are grouped by minor version (ie. the first two version components, such as "10.0").'));
        k.className = "summaryUnit";
        o.appendChild(k);
        q = document.createElement("div");
        t = [];
        w = [];
        for (k = 0; k < m.orgs.length; k++) v = m.orgs[k], u = v["ga:networkLocation"], "(not set)" !== u && (u = EasyEdit.util.ucWords(u), "undefined" !== typeof w[u] ? t[w[u]][1] += v[e] : (w[u] = t.length,
          t.push([u, v[e]])));
        a._buildSmallList(q, t, 5);
        k = a._buildPlainSummaryUnit(EasyEditLocalise._("Top Organisations"), q, EasyEditLocalise._("The top organisations (businesses, or ISPs of smaller entities) that deliver the most visits."));
        k.className = "summaryUnit";
        o.appendChild(k);
        o.id = "ees_analyticsAudience_summaryRow";
        h.appendChild(o);
        var y = document.createElement("div"),
          o = document.createElement("div"),
          z = document.createElement("div"),
          x = document.createElement("div"),
          y = document.createElement("div"),
          q = document.createElement("div"),
          t = document.createElement("div"),
          k = document.createElement("div");
        k.id = "ees_analyticsBrowserDeviceCategorySlider";
        y.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsBrowserTableDesktop",
          summaryData: m.current[0],
          detailData: m.browser,
          majorDimension: function(a) {
            var b = a["ga:browser"],
              c = a["ga:browserVersion"].split(".");
            "Safari" === a["ga:browser"] && 500 <= Number(c[0]) && (b = "Webkit");
            return b
          },
          minorDimension: function(a) {
            var b = a["ga:browserVersion"],
              c = b.split(".");
            switch (a["ga:browser"]) {
              case "Chrome":
              case "Opera":
              case "Firefox":
                b =
                  c.splice(0, 2).join(".")
            }
            return b
          },
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "desktop" === a["ga:deviceCategory"]
          }
        });
        y.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsBrowserTableMobile",
          summaryData: m.current[0],
          detailData: m.browser,
          majorDimension: function(a) {
            var b = a["ga:browser"],
              c = a["ga:browserVersion"].split(".");
            "Safari" === a["ga:browser"] && 500 <= Number(c[0]) && (b = "Webkit");
            return b
          },
          minorDimension: function(a) {
            var b = a["ga:browserVersion"],
              c = b.split(".");
            switch (a["ga:browser"]) {
              case "Chrome":
              case "Opera":
              case "Firefox":
                b = c.splice(0, 2).join(".")
            }
            return b
          },
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "mobile" === a["ga:deviceCategory"]
          }
        });
        k.className += " hidden";
        y.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsBrowserTableTablet",
          summaryData: m.current[0],
          detailData: m.browser,
          majorDimension: function(a) {
            var b = a["ga:browser"],
              c = a["ga:browserVersion"].split(".");
            "Safari" === a["ga:browser"] &&
              500 <= Number(c[0]) && (b = "Webkit");
            return b
          },
          minorDimension: function(a) {
            var b = a["ga:browserVersion"],
              c = b.split(".");
            switch (a["ga:browser"]) {
              case "Chrome":
              case "Opera":
              case "Firefox":
                b = c.splice(0, 2).join(".")
            }
            return b
          },
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "tablet" === a["ga:deviceCategory"]
          }
        });
        k.className += " hidden";
        y.appendChild(k);
        y.id = "ees_analyticsAudienceReportBrowsers";
        k = c(m.device, m.deviceSite);
        q.id = "ees_analyticsAudienceReportDevices";
        q.appendChild(k);
        q.className += " hidden";
        if (d3) {
          var B = {
              height: 200,
              barHeight: 190,
              width: 698,
              tickTextMargin: 30
            },
            w = document.createElement("tr");
          v = document.createElement("td");
          v.className = "chartLegendCell left";
          v.setAttribute("colspan", "3");
          v.innerHTML = !1 === a.current.isView ? "<p>" + EasyEditLocalise._("Page") + "</p>" : "<p>" + EasyEditLocalise._("Site") + "</p>";
          w.appendChild(v);
          v = document.createElement("td");
          v.className = "chartLegendCell right";
          v.setAttribute("colspan", "2");
          v.innerHTML = "<p>" + EasyEditLocalise._("Site") +
            "</p>";
          w.appendChild(v);
          k.appendChild(w);
          w = document.createElement("tr");
          v = document.createElement("td");
          v.className = "chartCell";
          v.setAttribute("colspan", "5");
          var C = b(m.deviceDaily, m.deviceSiteDaily, l, n, "desktop", B, 1);
          C.setAttribute("id", "ees_analyticsAudienceDevicesGraph");
          v.appendChild(C);
          w.appendChild(v);
          k.appendChild(w)
        }
        k = document.createElement("div");
        k.id = "ees_analyticsOSDeviceCategorySlider";
        x.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsOSTableDesktop",
          summaryData: m.current[0],
          detailData: m.os,
          majorDimension: "ga:operatingSystem",
          minorDimension: "ga:operatingSystemVersion",
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "desktop" === a["ga:deviceCategory"]
          }
        });
        x.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsOSTableMobile",
          summaryData: m.current[0],
          detailData: m.os,
          majorDimension: "ga:operatingSystem",
          minorDimension: "ga:operatingSystemVersion",
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "mobile" ===
              a["ga:deviceCategory"]
          }
        });
        k.className += " hidden";
        x.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsOSTableTablet",
          summaryData: m.current[0],
          detailData: m.os,
          majorDimension: "ga:operatingSystem",
          minorDimension: "ga:operatingSystemVersion",
          maxMajorRows: Number.POSITIVE_INFINITY,
          maxMinorRows: Number.POSITIVE_INFINITY,
          filter: function(a) {
            return "tablet" === a["ga:deviceCategory"]
          }
        });
        k.className += " hidden";
        x.appendChild(k);
        x.id = "ees_analyticsAudienceReportOS";
        x.className += " hidden";
        k = document.createElement("div");
        k.id = "ees_analyticsLocationCategorySlider";
        z.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsLocationTable",
          summaryData: m.current[0],
          detailData: m.location,
          majorDimension: "ga:country",
          minorDimension: "ga:city",
          maxMajorRows: 20,
          maxMinorRows: 5
        });
        z.appendChild(k);
        k = a._buildDrilldownTable({
          id: "ees_analyticsLocationTableCities",
          summaryData: m.current[0],
          detailData: m.location,
          majorDimension: function(a) {
            for (var a = [a["ga:city"], a["ga:region"], a["ga:country"]], b = 0; b < a.length;) "(not set)" === a[b] ? a.splice(b,
              1) : b++;
            return 0 === a.length ? "(not set)" : a.join(", ")
          },
          minorDimension: null,
          maxMajorRows: 50,
          maxMinorRows: 0
        });
        k.className += " hidden";
        z.appendChild(k);
        z.id = "ees_analyticsAudienceReportLocation";
        z.className += " hidden";
        k = a._buildDrilldownTable({
          id: "ees_analyticsLanguageTable",
          summaryData: m.current[0],
          detailData: m.language,
          majorDimension: function(a) {
            if ("c" === a["ga:language"]) return EasyEditLocalise._("No language set");
            var a = a["ga:language"].split("-"),
              b = EasyEditLocalise.languageCode(a[0]);
            return null !==
              b ? b : a[0]
          },
          minorDimension: function(a) {
            if ("c" === a["ga:language"]) return null;
            var a = a["ga:language"].split("-"),
              b = "No region set";
            1 < a.length && (b = EasyEditLocalise.langRegionCode(a[1].toUpperCase()), null === b && (b = EasyEditLocalise._("Unknown region %1", a[1])));
            return b
          },
          maxMajorRows: 20,
          maxMinorRows: 5
        });
        o.appendChild(k);
        o.id = "ees_analyticsAudienceReportLanguage";
        o.className += " hidden";
        k = a._buildDrilldownTable({
          id: "ees_analyticsOrgsTable",
          summaryData: m.current[0],
          detailData: m.orgs,
          majorDimension: function(a) {
            a =
              a["ga:networkLocation"];
            return "(not set)" === a ? null : a = EasyEdit.util.ucWords(a)
          },
          minorDimension: "ga:networkDomain",
          maxMajorRows: 50,
          maxMinorRows: Number.POSITIVE_INFINITY
        });
        t.appendChild(k);
        t.id = "ees_analyticsAudienceReportOrg";
        t.className += " hidden";
        var E = document.createElement("div");
        E.id = "ees_analyticsAudienceReportClicker";
        E.className = "dropDownClicker";
        EasyEdit.util.setText(E, EasyEditLocalise._("Browsers"));
        E.innerHTML = '<span class="alignRight expand"></span>' + E.innerHTML;
        h.appendChild(E);
        h.appendChild(o);
        h.appendChild(z);
        h.appendChild(x);
        h.appendChild(y);
        h.appendChild(q);
        h.appendChild(t);
        if (d3) {
          var A = !1,
            F = function(b, c, d, f) {
              for (var g = {
                  desktop: EasyEditLocalise._("Desktop sessions"),
                  tablet: EasyEditLocalise._("Tablet sessions"),
                  mobile: EasyEditLocalise._("Mobile sessions")
                }, h = [], j = [], k = new Date(l), m = 0; m < n; m++) {
                var o = a.util.dateString(k);
                h[m] = {
                  dateStr: o,
                  page: 0,
                  site: 0
                };
                k.setDate(k.getDate() + 1)
              }!1 === a.current.isView && b.map(function(a) {
                if (a["ga:deviceCategory"] === d) {
                  var b = parseInt(a["ga:nthDay"], 10);
                  h[b].page =
                    a[e]
                }
              });
              c.map(function(b) {
                var c = e;
                !1 === a.current.isView && (c = "ga:sessions");
                if (b["ga:deviceCategory"] === d) {
                  var f = parseInt(b["ga:nthDay"], 10);
                  h[f].site = b[c]
                }
              });
              for (m = 0; m < n; m++) j[m] = '<table><col width="80%" /><col width="20%" /><tr><th class="name">' + h[m].dateStr + '</th><th class="value">' + g[d] + "</tr>" + ("ga:uniquePageviews" !== e ? "" : '<tr><td class="name">' + a.util.bauble(f) + " " + EasyEditLocalise._("This page") + '</td><td class="value">' + a.util.abbrevStat(h[m].page) + "</td></tr>") + '<tr><td class="name">' + a.util.bauble(f, !0) + " " + EasyEditLocalise._("All of site") + '</td><td class="value">' + a.util.abbrevStat(h[m].site) + "</td></tr></table>";
              return j
            };
          jQuery("#ees_analyticsAudienceReportDevices").on("click", "input[type=radio]", function(c) {
            var d = c.target,
              c = d.getAttribute("data-colour"),
              d = d.getAttribute("value"),
              e = b(m.deviceDaily, m.deviceSiteDaily, l, n, d, B, c);
            e.setAttribute("id", "ees_analyticsAudienceDevicesGraph");
            var f = jQuery("#ees_analyticsAudienceDevicesGraph")[0];
            f.parentNode.replaceChild(e, f);
            a.util.hoverRect(e, B, n, !0, "ees_analyticsGraphTooltipDevices", F(m.deviceDaily, m.deviceSiteDaily, d, c))
          })
        }
        var o = ['<div class="categoryHeader">' + EasyEditLocalise._("Demographics") + "</div>", '<a data-subscreen="language">' + EasyEditLocalise._("Language") + "</a>", '<a data-subscreen="location">' + EasyEditLocalise._("Location") + "</a>", '<div class="categoryHeader">' + EasyEditLocalise._("Systems") + "</div>", '<a data-subscreen="os">' + EasyEditLocalise._("OS") + "</a>", '<a data-subscreen="browsers" class="active">' + EasyEditLocalise._("Browsers") +
            "</a>", '<a data-subscreen="devices">' + EasyEditLocalise._("Devices") + "</a>", '<div class="categoryHeader">' + EasyEditLocalise._("Organisations") + "</div>", '<a data-subscreen="orgs">' + EasyEditLocalise._("Organisations") + "</a>"
          ],
          k = EasyEditLocalise._("Reports"),
          D = EasyEdit.tip.create({
            targetId: "ees_analyticsAudienceReportClicker",
            containerId: "ees_analyticsAudienceReportTooltip",
            position: "south",
            title: k,
            message: o.join(""),
            buttons: [],
            className: "analyticsDropDownTooltip"
          });
        D.$element.find(".tooltipButtons").remove();
        jQuery(E).on("click", null, function() {
          D.toggle()
        });
        D.$element.on("click", "a", function(b) {
          D.hide();
          b = b.target;
          EasyEdit.util.setText(E, EasyEdit.util.getText(b));
          E.innerHTML = '<span class="alignRight expand"></span>' + E.innerHTML;
          jQuery(h).children("div").addClass("hidden");
          jQuery("#ees_analyticsAudienceReportClicker").removeClass("hidden");
          jQuery("#ees_analyticsAudience_summaryRow").removeClass("hidden");
          D.$element.find(".tooltipContent a").removeClass("active");
          jQuery(b).addClass("active");
          switch (b.getAttribute("data-subscreen")) {
            case "language":
              jQuery("#ees_analyticsAudienceReportLanguage").removeClass("hidden");
              break;
            case "location":
              jQuery("#ees_analyticsAudienceReportLocation").removeClass("hidden");
              break;
            case "os":
              jQuery("#ees_analyticsAudienceReportOS").removeClass("hidden");
              break;
            case "browsers":
              jQuery("#ees_analyticsAudienceReportBrowsers").removeClass("hidden");
              break;
            case "devices":
              jQuery("#ees_analyticsAudienceReportDevices").removeClass("hidden");
              !1 === A && (A = !0, a.util.hoverRect(C, B, n, !0, "ees_analyticsGraphTooltipDevices", F(m.deviceDaily, m.deviceSiteDaily, "desktop", 1)));
              break;
            case "orgs":
              jQuery("#ees_analyticsAudienceReportOrg").removeClass("hidden")
          }
        });
        a.sliders.locationCategory = new EasyEditSlider({
          bindElem: "#ees_analyticsLocationCategorySlider",
          defaultVal: EasyEditLocalise._("Countries"),
          options: [
            [EasyEditLocalise._("Countries"), EasyEditLocalise._("Show statistics based on the countries."), function() {}],
            [EasyEditLocalise._("Cities"), EasyEditLocalise._("Show statistics based on cities."), function() {}]
          ]
        });
        a.sliders.locationCategory.events.observe("change", function() {
          var b = a.sliders.locationCategory.getSelectedIndex();
          jQuery(z).children("table").addClass("hidden");
          switch (b) {
            case 0:
              jQuery("#ees_analyticsLocationTable").removeClass("hidden");
              break;
            case 1:
              jQuery("#ees_analyticsLocationTableCities").removeClass("hidden")
          }
        });
        a.sliders.browserDeviceCategory = new EasyEditSlider({
          bindElem: "#ees_analyticsBrowserDeviceCategorySlider",
          defaultVal: EasyEditLocalise._("Desktop"),
          options: [
            [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Show statistics for browsers on desktop devices"), function() {}],
            [EasyEditLocalise._("Tablet"), EasyEditLocalise._("Show statistics for browsers on tablet devices"),
              function() {}
            ],
            [EasyEditLocalise._("Mobile"), EasyEditLocalise._("Show statistics for browsers on mobile phone devices"), function() {}]
          ]
        });
        a.sliders.browserDeviceCategory.events.observe("change", function() {
          var b = a.sliders.browserDeviceCategory.getSelectedIndex();
          jQuery(y).children("table").addClass("hidden");
          switch (b) {
            case 0:
              jQuery("#ees_analyticsBrowserTableDesktop").removeClass("hidden");
              break;
            case 1:
              jQuery("#ees_analyticsBrowserTableTablet").removeClass("hidden");
              break;
            case 2:
              jQuery("#ees_analyticsBrowserTableMobile").removeClass("hidden")
          }
        });
        a.sliders.osDeviceCategory = new EasyEditSlider({
          bindElem: "#ees_analyticsOSDeviceCategorySlider",
          defaultVal: EasyEditLocalise._("Desktop"),
          options: [
            [EasyEditLocalise._("Desktop"), EasyEditLocalise._("Show statistics for browsers on desktop devices"), function() {}],
            [EasyEditLocalise._("Mobile"), EasyEditLocalise._("Show statistics for browsers on mobile phone devices"), function() {}],
            [EasyEditLocalise._("Tablet"), EasyEditLocalise._("Show statistics for browsers on tablet devices"), function() {}]
          ]
        });
        a.sliders.osDeviceCategory.events.observe("change",
          function() {
            var b = a.sliders.osDeviceCategory.getSelectedIndex();
            jQuery(x).children("table").addClass("hidden");
            switch (b) {
              case 0:
                jQuery("#ees_analyticsOSTableDesktop").removeClass("hidden");
                break;
              case 1:
                jQuery("#ees_analyticsOSTableMobile").removeClass("hidden");
                break;
              case 2:
                jQuery("#ees_analyticsOSTableTablet").removeClass("hidden")
            }
          })
      }
    });
    EasyEdit.util.async.series(f)
  }
};
